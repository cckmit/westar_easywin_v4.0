define("eteams/biaoge/biaogeexternal",
function(g, m, l) {
    g = Backbone.View.extend({
        teams: {},
        initialize: function(d) {
            this.Url = "develop" == TEAMS.runMode ? "X": "X?t_\x3d" + TEAMS.version
        },
        delegateEvents: function() {},
        render: function(d) {},
        remove: function() {
            var d = this.el;
            window.formPlugin && formPlugin.destroyEvents(d)
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formreportmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function(d) {
            this.formId = d.formId;
            this.module = d.module
        },
        queryReportForm: function(d, f) {
            $.ajax({
                type: "post",
                url: "/form/queryReportForm.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        getReports: function(d) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/form/queryFormReports.json",
                dataType: "json",
                data: JSON.stringify({
                    formId: this.formId
                }),
                success: function(f) {
                    d && d(f)
                }
            })
        },
        queryFormReportsForReport: function(d) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/form/queryFormReportsForReport.json",
                dataType: "json",
                data: JSON.stringify({
                    formId: this.formId,
                    module: this.module
                }),
                success: function(f) {
                    d && d(f)
                }
            })
        },
        deleteForm: function(d, f) {
            $.ajax({
                type: "post",
                url: "/form/delete.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/stattextview", ["eteams/biaoge/formstat/statbaseview", "eteams/biaoge/formstat/formfielddetailview", "teams/utils"],
function(g, m, l) {
    m = g("eteams/biaoge/formstat/statbaseview");
    var d = g("eteams/biaoge/formstat/formfielddetailview"),
    f = g("teams/utils");
    g = m.extend({
        render: function() {
            this.tpl = f.template("formstat.stattextview", this.cdata);
            this.container = $(this.tpl);
            this.wrappercontainer.append(this.container);
            this.bindEvents()
        },
        bindEvents: function() {
            var b = this;
            this.container.on("click.StatTextView", ".search-detail",
            function(a) {
                a.preventDefault();
                a = $(this);
                var e = {};
                e.componetKey = a.attr("component-key");
                e.fieldId = a.attr("field-id");
                e.fieldInfo = b.cdata; (new d(e)).showDetail()
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function() {
            this.pageSize = 10
        },
        findForm: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                type: "post",
                url: "/formdatastat/findCellListStat.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findRowListStatForTask: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatastat/findRowListStatForTask.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findRowListStatForReport: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatastat/findRowListStatForReport.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findRowListStatForFlow: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatastat/findRowListStatForFlow.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        exportParam: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                async: !1,
                type: "post",
                url: "/export/exportParam.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findColumnField: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/findColumnField.json",
                dataType: "json",
                async: !1,
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findAdvSearchField: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/findAdvSearchField.json",
                dataType: "json",
                async: !1,
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findStatColumnField: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/findStatColumnField.json",
                dataType: "json",
                async: !1,
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        saveFormColumns: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatastat/saveFormColumns.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findFiledOptions: function(d, f) {
            $.ajax({
                type: "get",
                url: "/formdatastat/findFiledOptions.json",
                dataType: "json",
                data: d,
                async: !1,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        deleteFlow: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/flow/destroy.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        getFormField: function(d, f) {
            $.ajax({
                type: "get",
                url: "/flowsequence/findFormFieldByFormId.json",
                dataType: "json",
                async: !1,
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        incollect: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatareport/incollect.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        getFiledByForm: function(d, f) {
            $.ajax({
                type: "post",
                url: "/form/findFiledByForm.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findStatFormDetail: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/findStatFormDetail.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        existsFormDataQuery: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/existsFormDataQuery.json",
                dataType: "json",
                data: {
                    name: d.name,
                    formId: d.formId
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findFormDataQueryById: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/findFormDataQueryById.json",
                dataType: "json",
                data: {
                    formDataQueryId: d
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        saveFormDataQuery: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/saveFormDataQuery.json",
                dataType: "json",
                data: {
                    name: d.name,
                    formId: d.formId,
                    content: d.content
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        deleteFormDataQueryByName: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/deleteFormDataQueryByName.json",
                dataType: "json",
                data: {
                    name: d.name,
                    formId: d.formId
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        deleteFormDataQueryById: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/deleteFormDataQueryById.json",
                dataType: "json",
                data: {
                    formDataQueryId: d
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findAllFormDataQueries: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/findAllFormDataQueries.json",
                dataType: "json",
                data: {
                    formId: d
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        loadDocForm: function(d, f) {
            $.ajax({
                type: "post",
                dataType: "json",
                url: "/form/loadDocForm.json",
                async: !1,
                data: d,
                success: function(b) {
                    b.actionMsg ? Utils.notify(b.actionMsg.message) : f && f(b)
                }
            })
        },
        loadTaskForm: function(d, f) {
            $.ajax({
                type: "post",
                dataType: "json",
                url: "/form/loadTaskForm.json",
                async: !1,
                data: d,
                success: function(b) {
                    b.actionMsg ? Utils.notify(b.actionMsg.message) : f && f(b)
                }
            })
        },
        findDataColumn: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatastat/findFormDataColumn.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        saveFormDataColumn: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatastat/saveDataColumn.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstattableheaderview", ["teams/utils", "eteams/biaoge/formstat/formstatmodel"],
function(g, m, l) {
    g("teams/utils");
    var d = g("eteams/biaoge/formstat/formstatmodel");
    g = Backbone.View.extend({
        initialize: function(f) {
            this.$htable = f.htable;
            this.$ctable = f.ctable;
            this.fileds = f.fileds;
            this.formId = f.formId;
            this.parentObj = f.parentObj;
            this.model = new d;
            this.isResize = 0 == f.isResize ? !1 : !0
        },
        delegateEvents: function() {
            var d = this;
            d.$htable.on("click.FormStatTableHeaderView", ".j_table_sort",
            function(b) {
                b = $(this).closest("th");
                var a = b.attr("sort");
                b.siblings().removeClass("sorting_desc sorting_asc active").addClass("sorting");
                "desc" == a ? b.attr("sort", "asc").addClass("sorting_asc active").removeClass("sorting_desc sorting") : b.attr("sort", "desc").addClass("sorting_desc active").removeClass("sorting_asc sorting");
                d.parentObj.renderListStatByRow(1)
            });
            if (d.isResize) $(window).on("resize.FormStatTableHeaderView",
            function() {
                d.setFixColumnWidth()
            })
        },
        render: function() {
            this.renderTableHeader();
            this.talbeScrollbar()
        },
        renderTableHeader: function() {
            var d = this;
            d.model.findStatColumnField({
                formId: d.formId
            },
            function(a) {
                d.formFields = a.formFields
            });
            var b = d.formFields;
            if (null != b && 0 != b.length || "task" == d.parentObj.module) {
                var a = d.$htable.find("thead tr").html(""),
                e = d.$ctable.find("tfoot tr").html("");
                a.append("\x3cth class\x3d'num'\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/th\x3e");
                e.append("\x3ctd class\x3d'num'\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/td\x3e");
                for (var h = 0; h < d.fileds.length; h++) {
                    var c = d.fileds[h];
                    a.append("\x3cth title\x3d'" + c.title + "' name\x3d'" + c.name + "' class\x3d'sorting'\x3e\x3cdiv class\x3d'j_table_sort' title\x3d'" + c.title + "'\x3e\x3cspan class\x3d'txt'\x3e" + c.title + "\x3c/span\x3e\x3cspan class\x3d'sort-location'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/th\x3e");
                    e.append("\x3ctd\x3e\x3c/td\x3e")
                }
                for (h = 0; h < b.length; h++) {
                    var c = b[h],
                    k = "",
                    s = "",
                    q = "";
                    if ("Money" == c.componentKey || "NumberComponent" == c.componentKey || "Monitor" == c.componentKey || "Raty" == c.componentKey) k = "ta-r",
                    q = "200";
                    "Money" == c.componentKey && (s = "Money", q = "300");
                    a.append("\x3cth title\x3d'" + c.title + "' fieldId\x3d'" + c.id + "' name\x3d'" + c.id + "' componentKey\x3d'" + c.componentKey + "' class\x3d'sorting'\x3e\x3cdiv class\x3d'j_table_sort' title\x3d'" + c.title + "'\x3e\x3cspan class\x3d'txt' style\x3d'width:" + q + "px;'\x3e" + c.title + "\x3c/span\x3e\x3cspan class\x3d'sort-location'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/th\x3e");
                    e.append("\x3ctd id\x3d'tfoot_" + c.id + "' class\x3d'" + k + "' name\x3d'" + c.id + "' type\x3d'" + s + "'\x3e\x3c/td\x3e")
                }
                d.isResize && (a.append("\x3cth class\x3d'fix j_fixcol'\x3e\x3c/th\x3e"), e.append("\x3ctd class\x3d'fix j_fixcol'\x3e\x3c/td\x3e"), d.$thArray = a.find("th.sorting"), d.setTableHeaderWidth(), d.resizableTableHeader())
            } else $("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e\u5f53\u524d\u8868\u5355\u6ca1\u6709\u4efb\u4f55\u5b57\u6bb5\uff01\x3c/div\x3e')
        },
        resizableTableHeader: function() {
            var d = this;
            d.$thArray.resizable({
                handles: "e",
                minWidth: 30,
                stop: function(b, a) {
                    $(".j_formstatScrX").mCustomScrollbar("update");
                    d.setTableLocalStorage(a.size.width, a.element.attr("name"))
                },
                resize: function(b, a) {
                    a.element.find("span:first").width(a.size.width);
                    var e = a.element.attr("name");
                    d.$ctable.find("tbody td[name\x3d'" + e + "']").find("div:first").width(a.size.width + 30);
                    d.$ctable.find("tfoot td[name\x3d'" + e + "']").find(".j_count").width(a.size.width - 15);
                    d.setFixColumnWidth()
                }
            })
        },
        getOrderParam: function(d) {
            var b = [];
            this.$htable.find("th.active").each(function() {
                var a = $(this),
                e = a.attr("fieldId"),
                h = a.attr("sort"),
                c = "",
                c = e ? "C_" + e + " " + h: a.attr("name") + " " + h;
                b.push({
                    fieldId: e,
                    content: c,
                    componentKey: a.attr("componentKey")
                })
            });
            d.orderFormDatas = b
        },
        setFixColumnWidth: function() {
            var d = this.$htable.find("th.j_fixcol").width(),
            b = $("#statbody").width(),
            a = this.$htable.width(),
            d = 0 < b - a + d ? b - a + d: 0;
            $(".j_fixcol").width(d)
        },
        setfixRow: function(d, b, a) {
            if (1 == d && 10 > b) {
                for (var e = d = "",
                h = 0; h < a; h++) d += "\x3ctd\x3e\x3cdiv class\x3d'fix-row'\x3e\x3c/div\x3e\x3c/td\x3e";
                for (h = b + 1; 11 > h; h++) e = 0 == h % 2 ? e + "\x3ctr class\x3d'other-bgcolor'\x3e": e + "\x3ctr\x3e",
                e += d + "\x3c/tr\x3e";
                this.$ctable.find("tbody").append(e)
            }
        },
        setTableBodyWidth: function(d) {
            this.$thArray.each(function() {
                $th = $(this);
                d.find("td[name\x3d'" + $th.attr("name") + "']").find("div:first").width($th.find("div:first").width())
            });
            d.find("td.j_fixcol").width(this.$htable.find("th.j_fixcol").width())
        },
        setTableFootCount: function(d, b) {
            if (1 == b) {
                var a = this;
                a.$ctable.find("tfoot td").html("");
                if (d && 0 < d.length) {
                    for (var e = 0; e < d.length; e++) {
                        var h = d[e],
                        c = h.fieldId,
                        k = h.sumVal,
                        s = h.avgVal,
                        q = h.maxVal,
                        h = h.minVal;
                        "Money" == a.$ctable.find("tfoot #tfoot_" + c).attr("type") && (k = k + " " + a.moneyToChinese(k), s = s + " " + a.moneyToChinese(s), q = q + " " + a.moneyToChinese(q), h = h + " " + a.moneyToChinese(h));
                        k = "\x3cdiv class\x3d'dropdown dropdown-menu-toggle dropdown-gettext dropdown-icon-up'\x3e\x3ca class\x3d'selectui-result dropdown-toggle nobd ellipsis j_count' title\x3d'\u603b\u548c\uff1a" + k + "'\x3e\u603b\u548c\uff1a" + k + "\x3ci class\x3d'icon-angle-up'\x3e\x3c/i\x3e\x3c/a\x3e\x3cul class\x3d'j_dyna-range dropdown-menu dropdown-menu-right border-dropdown' style\x3d'display: none;'\x3e\x3cli\x3e\x3ca title\x3d'\u603b\u548c\uff1a" + k + "'\x3e\u603b\u548c\uff1a" + k + "\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca title\x3d'\u5e73\u5747\uff1a" + k + "'\x3e\u5e73\u5747\uff1a" + s + "\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca title\x3d'\u6700\u5927\uff1a" + k + "'\x3e\u6700\u5927\uff1a" + q + "\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca title\x3d'\u6700\u5c0f\uff1a" + k + "'\x3e\u6700\u5c0f\uff1a" + h + "\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e";
                        a.$ctable.find("tfoot #tfoot_" + c).html(k)
                    }
                    a.$thArray.each(function() {
                        $th = $(this);
                        var c = a.$ctable.find("tfoot").find("td[name\x3d'" + $th.attr("name") + "']").find(".j_count"),
                        k = $th.find("div:first").width();
                        c.width(k - 45)
                    });
                    a.$ctable.find("tfoot").show()
                } else a.$ctable.find("tfoot").hide()
            }
        },
        setTableHeaderWidth: function() {
            this.getTableLocalStorage();
            var d = this.thWidth,
            b;
            for (b in d) this.$htable.find("thead th[name\x3d'" + b + "']").find("span:first").width(d[b]);
            this.setFixColumnWidth();
            $(window).trigger("resize")
        },
        setTableLocalStorage: function(d, b) {
            var a = TEAMS.currentUser.id + this.formId;
            this.thWidth[b] = d;
            this.getLocalStorage().setItem(a, JSON.stringify(this.thWidth))
        },
        bulidListStats: function(d) {
            var b = {};
            if (d) for (var a = 0; a < d.length; a++) {
                var e = d[a],
                h = e.FORM_DATA;
                if (b[h]) if (1 != b[h].length || b[h][0].DATA_INDEX) b[h].push(e);
                else {
                    var c, k = b[h][0];
                    for (c in k) k[c] && 0 < k[c].length && (e[c] = k[c]);
                    b[h] = [e]
                } else b[h] = [],
                b[h].push(e)
            }
            return b
        },
        renderPageMore: function(d, b, a, e) {
            if (b && b.hasNext) d.find("#more_data").show().data("page", b),
            d.find(".j_form_empty").addClass("hide");
            else if (d.find("#more_data").hide(), 1 == e) {
                if (null == a || 1 > a.length) return d.find(".j_form_empty").removeClass("hide"),
                d.find("#stat_table tfoot").hide(),
                !1;
                d.find(".j_form_empty").addClass("hide");
                d.find("#stat_table tfoot").show()
            } else 0 < a.length && d.find(".j_form_empty").addClass("hide");
            return ! 0
        },
        getTableLocalStorage: function() {
            var d = TEAMS.currentUser.id + this.formId;
            this.thWidth = JSON.parse(this.getLocalStorage().getItem(d)) || {}
        },
        getLocalStorage: function() {
            localStorage || console.log("Your Browser Do Not Support localStorage");
            return localStorage
        },
        moneyToChinese: function(d) {
            var b = "",
            a = "\u4edf\u4f70\u62fe\u4ebf\u4edf\u4f70\u62fe\u4e07\u4edf\u4f70\u62fe\u5143\u89d2\u5206";
            d += "00";
            var e = d.indexOf(".");
            0 <= e && (d = d.substring(0, e) + d.substr(e + 1, 2));
            a = a.substr(a.length - d.length);
            for (e = 0; e < d.length; e++) b += "\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396".substr(d.substr(e, 1), 1) + a.substr(e, 1);
            return b.replace(/\u96f6\u89d2\u96f6\u5206$/, "").replace(/\u96f6[\u4edf\u4f70\u62fe]/g, "\u96f6").replace(/\u96f6{2,}/g, "\u96f6").replace(/\u96f6([\u4ebf|\u4e07])/g, "$1").replace(/\u96f6+\u5143/, "\u5143").replace(/\u4ebf\u96f6{0,3}\u4e07/, "\u4ebf").replace(/^\u5143/, "\u96f6\u5143")
        },
        talbeScrollbar: function() {
            $(".j_formstatScrX").mCustomScrollbar({
                axis: "x",
                theme: "darkblue",
                scrollButtons: {
                    enable: !0
                },
                mouseWheel: "false",
                advanced: {
                    autoExpandHorizontalScroll: !0
                }
            })
        },
        remove: function() {
            var d = this.$htable;
            $(window).off(".FormStatTableHeaderView");
            d.off(".FormStatTableHeaderView")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/baseformstatsearchview", ["teams/utils", "teams/component/typeahead", "eteams/biaoge/formstat/formstatmodel", "teams/component/formview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/typeahead"),
    b = g("eteams/biaoge/formstat/formstatmodel"),
    a = g("teams/component/formview");
    m = Backbone.View.extend({
        initialize: function(e) {
            this.el = e.el ? e.el: ".j_advanceSearch";
            this.formFields = e.formFields;
            this.formId = e.formId;
            this.module = e.module;
            this.model = new b;
            this.parentObj = e.parentObj;
            switch (this.module) {
            case "task":
                $(this.el).html(d.template("formstat.searchfortask"));
                break;
            default:
                $(this.el).html(d.template("formstat.basesearch"))
            }
            this.formView = new a
        },
        delegateEvents: function() {
            var a = this,
            h = $(a.el);
            $("body").on("click.FormStatSearchView",
            function(a) {
                0 == $(a.target).closest(".j_comboselect_ul").length && $(".j_comboselect_ul").removeClass("open")
            });
            h.on("change.FormStatSearchView", ".j_condition",
            function() {
                var a = $(this),
                k = a.val(),
                e = a.closest(".j_formField-condition");
                "null" == k || "notnull" == k ? (a.next().addClass("hide"), e.find(".j_selected,.j_control").addClass("hide")) : (a.next().removeClass("hide"), e.find(".j_selected,.j_control").removeClass("hide"))
            });
            h.on("click.FormStatSearchView", ".j_ok_btn",
            function() {
                var a = $(this).closest(".j_formField-condition"),
                k = a.find("li.active:last"),
                e = k.attr("selectionId"),
                h = k.attr("title"),
                k = k.closest(".combo_select_js").attr("id"),
                b = a.find(".j_selected");
                if (h && e) {
                    var d = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + e + ' title\x3d"' + h + '" selectId\x3d"' + k + '"\x3e' + h + "\x3c/a\x3e\x3c/span\x3e";
                    b.find(".entity-item").each(function(a) {
                        e == $(this).find("a").attr("id") && (d = null)
                    });
                    b.append(d)
                }
                a.find(".j_comboselect_ul").removeClass("open")
            });
            h.find(".j_filterSub").click(function() {
                var a = $(this);
                "true" == a.data("isFilterSub") ? a.data("isFilterSub", "false").removeClass("open") : a.data("isFilterSub", "true").addClass("open")
            });
            h.on("entitySelected", "#statsearch-entity .typeahead-search",
            function(a) {
                var k = $(this).parents(".j_entityContainer").find(".j_selected");
                k.empty();
                for (var e = 1; e < arguments.length; e++) {
                    var h = arguments[e],
                    b = h.name,
                    d = h.id,
                    n = h.module;
                    if (b && d) {
                        var f = '\x3cspan id\x3d"' + d + '" class\x3d"entity-item j_entity_item" name\x3d"j_entity_item"\x3e\x3ca data-placement\x3d"top" data-toggle\x3d"tooltip" data-original-title\x3d"' + b + '" id\x3d"' + d + '" class\x3d"entitybox-toggle" data-module\x3d"' + n + '" data-value\x3d"' + d + '" data-id\x3d"' + d + '"\x3e' + b + "\x3c/a\x3e\x3c/span\x3e";
                        k.find(".entity-item").each(function(a) {
                            d == $(this).find("a").attr("id") && (f = null)
                        });
                        k.append(f);
                        k.find(".j_entity_item").data("object", h)
                    }
                }
            });
            h.on("entitySelected", "#statsearch-entity .j_customer,.j_contact,.j_chance,.j_production",
            function(a) {
                var k = h.find("#statsearch-entity .j_entityContainer .j_selected");
                k.empty();
                for (var e = 1; e < arguments.length; e++) {
                    var b = arguments[e],
                    d = b.module,
                    f = "",
                    f = "contact" == d ? b.username: b.name,
                    n = b.id;
                    if (f && n) {
                        var g = '\x3cspan id\x3d"' + n + '" class\x3d"entity-item j_entity_item" name\x3d"j_entity_item"\x3e\x3ca data-placement\x3d"top" data-toggle\x3d"tooltip" data-original-title\x3d"' + f + '" id\x3d"' + n + '" class\x3d"entitybox-toggle" data-module\x3d"' + d + '" data-value\x3d"' + n + '" data-id\x3d"' + n + '"\x3e' + f + "\x3c/a\x3e\x3c/span\x3e";
                        k.find(".entity-item").each(function(a) {
                            n == $(this).find("a").attr("id") && (g = null)
                        });
                        k.append(g);
                        k.find(".j_entity_item").data("object", b)
                    }
                }
            });
            h.on("change.FormStatSearchView", ".j_formField-select select",
            function() {
                var c = $(this),
                k = (new Date).getTime(),
                b = $(this).find("option:selected"),
                q = b.attr("id"),
                r = b.attr("key"),
                t = b.data("layoutDetail"),
                b = "";
                switch (r) {
                case "name":
                    b = h.find("#name-clone").clone();
                    c.parent().parent().attr("class", "sch-group j_nameSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    break;
                case "createTime":
                    b = h.find("#createTime-clone").clone();
                    b.find(".j_datetime").attr("id", "j_datetime" + k);
                    c.parent().parent().attr("class", "sch-group j_createTimeSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    d.datepicker({
                        el: a.el + " #j_datetime" + k + " #startTime",
                        callback: function(c) {
                            c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                            var h = $(a.el + " #j_datetime" + k).find("#startTime"),
                            b = $(a.el + " #j_datetime" + k).find("#endTime");
                            b.val() && c > b.val() ? (d.notify("\u5f00\u59cb\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65e5\u671f"), h.val("")) : h.val(c)
                        }
                    });
                    d.datepicker({
                        el: a.el + " #j_datetime" + k + " #endTime",
                        callback: function(c) {
                            c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                            var h = $(a.el + " #j_datetime" + k).find("#startTime"),
                            b = $(a.el + " #j_datetime" + k).find("#endTime");
                            h.val() && c < h.val() ? (d.notify("\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65e5\u671f"), b.val("")) : b.val(c)
                        }
                    });
                    break;
                case "type":
                    b = h.find("#type-clone").clone();
                    c.parent().parent().attr("class", "sch-group j_typeSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    break;
                case "operator":
                    b = h.find("#operator-clone").clone();
                    b.find(".j_optcontainer").attr("id", "j_opt" + k);
                    c.parent().parent().attr("class", "sch-group j_optSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    f({
                        el: a.el + " #j_opt" + k + " #typeahead-flow-employee",
                        callback: function(c) {
                            if (c && !$.isEmptyObject(c)) {
                                var b = h.find("#j_opt" + k + " .j_selected");
                                a.renderTypeheader(b, c)
                            }
                        }
                    });
                    break;
                case "content":
                    b = h.find("#content-clone").clone();
                    c.parent().parent().attr("class", "sch-group j_contentSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    break;
                case "manager":
                    b = h.find("#manager-clone").clone();
                    b.find(".j_optcontainer").attr("id", "j_opt" + k);
                    c.parent().parent().attr("class", "sch-group j_managerSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    f({
                        el: a.el + " #j_opt" + k + " #typeahead-flow-employee",
                        callback: function(c) {
                            if (c && !$.isEmptyObject(c)) {
                                var b = h.find("#j_opt" + k + " .j_selected");
                                a.renderTypeheader(b, c)
                            }
                        }
                    });
                    break;
                case "participant":
                    b = h.find("#participant-clone").clone();
                    b.find(".j_optcontainer").attr("id", "j_opt" + k);
                    c.parent().parent().attr("class", "sch-group j_participantSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    f({
                        el: a.el + " #j_opt" + k + " #typeahead-flow-employee",
                        callback: function(c) {
                            if (c && !$.isEmptyObject(c)) {
                                var b = h.find("#j_opt" + k + " .j_selected");
                                a.renderTypeheader(b, c)
                            }
                        }
                    });
                    break;
                case "duedate":
                    b = h.find("#duedate-clone").clone();
                    b.find(".j_datetime").attr("id", "j_datetime" + k);
                    c.parent().parent().attr("class", "sch-group j_duedateSearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    d.datepicker({
                        el: a.el + " #j_datetime" + k + " #startTime",
                        callback: function(c) {
                            c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                            var h = $(a.el + " #j_datetime" + k).find("#startTime"),
                            b = $(a.el + " #j_datetime" + k).find("#endTime");
                            b.val() && c > b.val() ? (d.notify("\u5f00\u59cb\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65e5\u671f"), h.val("")) : h.val(c)
                        }
                    });
                    d.datepicker({
                        el: a.el + " #j_datetime" + k + " #endTime",
                        callback: function(c) {
                            c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                            var h = $(a.el + " #j_datetime" + k).find("#startTime"),
                            b = $(a.el + " #j_datetime" + k).find("#endTime");
                            h.val() && c < h.val() ? (d.notify("\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65e5\u671f"), b.val("")) : b.val(c)
                        }
                    });
                    break;
                case "priority":
                    b = h.find("#priority-clone").clone();
                    c.parent().parent().attr("class", "sch-group j_prioritySearchGroup");
                    c.parent().parent().find(".j_formField-condition").html(b.html());
                    break;
                default:
                    var n = c.parent().parent();
                    g.async("develop" == TEAMS.runMode ? "form/form-plugin": "form.js?t_\x3d" + TEAMS.version,
                    function() {
                        g.async("form/form-plugin",
                        function(c) {
                            formPlugin.renderStatSearch({
                                parentEl: n,
                                fieldId: q,
                                componentKey: r,
                                container: a.el,
                                layoutDetail: t
                            })
                        })
                    })
                }
            });
            h.on("change.FormStatSearchView", ".j_formField-condition .j_resultList",
            function() {
                var a = $(this),
                k = $(this).find("option:selected").attr("id"),
                e = a.val(),
                h = a.next().find(".j_selected");
                if (e && k) {
                    var b = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + k + "\x3e" + e + "\x3c/a\x3e\x3c/span\x3e";
                    h.find(".entity-item").each(function(a) {
                        k == $(this).find("a").attr("id") && (b = null)
                    });
                    h.append(b)
                }
                a.find("option").eq(0).prop("selected", !0)
            });
            h.on("change.FormStatSearchView", ".j_formField-condition .j_multipleSelect",
            function() {
                var a = $(this),
                k = $(this).find("option:selected").attr("id"),
                e = a.val(),
                h = a.next().find(".j_selected");
                if (e) {
                    var b = '\x3cspan class\x3d"entity-item"\x3e\x3ca status\x3d' + k + "\x3e" + e + "\x3c/a\x3e\x3c/span\x3e";
                    h.find(".entity-item").each(function(a) {
                        k == $(this).find("a").attr("status") && (b = null)
                    });
                    h.append(b)
                }
                a.find("option").eq(0).prop("selected", !0)
            });
            h.on("click.FormStatSearchView", ".j_addCondition",
            function() {
                var c = a.formFields,
                k = h.find("#form-search-clone").clone();
                h.find("#search-group-list").append(k.removeAttr("id").removeClass("hide"));
                k = k.find(".j_formField-select select");
                a.renderSearchComponent(c, k);
                $(window).resize()
            });
            h.on("click.FormStatSearchView", ".j_deletesearch",
            function() {
                $(this).parents(".sch-group").remove();
                $(window).resize()
            });
            h.on("click.FormStatSearchView", ".j_search-submit",
            function() {
                a.parentObj && (a.parentObj.isKeyword = !1);
                $("body").trigger("confirmSearch")
            });
            h.on("click.FormStatSearchView", ".j_search-close",
            function() {
                $("#initAdvanceSearch").trigger("click");
                $("body").trigger("closAdvanceSearch")
            });
            h.on("click.FormStatSearchView", ".j_report_close",
            function() {
                $("#initAdvanceSearch").trigger("CLOSE")
            });
            h.on("keyup.FormStatSearchView", ".j_formFieldSearchGroup .j_numberCheck",
            function(a) {
                a = $(this).val();
                $(this).val(a.replace(/[^\d.-]/g, ""))
            });
            h.on("blur.FormStatSearchView", ".j_formFieldSearchGroup .j_numberCheck",
            function(a) {
                $(this).trigger("keyup.FormStatSearchView")
            });
            h.on("keydown.FormStatSearchView", ".j_formFieldSearchGroup .j_numberCheck",
            function(a) {
                a = parseInt(a.keyCode);
                var k = $(this).val();
                if ((110 == a || 190 == a) && 0 <= k.indexOf(".") || (109 == a || 173 == a) && 0 <= k.indexOf("-")) return ! 1
            });
            h.off("entitySelected", "#statsearch-mainline .entity-toggle").on("entitySelected", "#statsearch-mainline .entity-toggle",
            function(a) {
                h.find("#statsearch-mainline").find(".entity-container").empty();
                for (var k = 1; k < arguments.length; k++) {
                    var e = arguments[k],
                    b = e.name,
                    d = e.id;
                    if (b && d) {
                        var f = '\x3cspan id\x3d"' + d + '" class\x3d"entity-item j_entity_item" name\x3d"j_entity_item"\x3e\x3ca id\x3d"' + d + '" class\x3d"entitybox-toggle" data-module\x3d"mainline" data-value\x3d"' + d + '" data-id\x3d"' + d + '"\x3e' + b + "\x3c/a\x3e\x3c/span\x3e";
                        h.find("#statsearch-mainline").find(".entity-item").each(function(a) {
                            d == $(this).find("a").attr("id") && (f = null)
                        });
                        h.find("#statsearch-mainline").find(".entity-container").append(f);
                        h.find("#statsearch-mainline").find(".entity-container").find(".j_entity_item").data("object", e)
                    }
                }
            });
            h.on("click.FormStatSearchView", "#btnSaveFormDataQuery",
            function() {
                $("body").trigger("saveFormDataQuery")
            });
            h.find(".j_commontagList").on("mouseover.FormStatSearchView", ".j_commontag",
            function() {
                $(this).children(".close").removeClass("hide")
            });
            h.find(".j_commontagList").on("mouseleave.FormStatSearchView", ".j_commontag",
            function() {
                $(this).children(".close").addClass("hide")
            });
            h.find(".j_commontagList").on("click.FormStatSearchView", ".j_commontag .close",
            function() {
                var c = $(this).parent().attr("id");
                a.deleteFormDataQueryById(c)
            });
            h.find(".j_commontagList").on("click.FormStatSearchView", ".j_commontag .js_nameLink",
            function() {
                var c = $(this).parent().attr("id");
                a.renderFormDataQuery(c)
            })
        },
        render: function() {
            var a = this,
            h = a.formId,
            c = $(a.el),
            k = c.find("#search-group-list .j_formField-select select");
            c.find(".j_filterSub").data("isFilterSub", "false").removeClass("open");
            a.renderSearchComponent(a.formFields, k);
            c = a.model;
            h && c.findAllFormDataQueries(h,
            function(c) {
                if (c.actionMsg && c.actionMsg.message) d.notify(c.actionMsg.message);
                else if ((c = c.formDataQuerys) && 0 < c.length) for (var k = 0; k < c.length; k++) a.insertCustomQuery(c[k])
            })
        },
        insertCustomQuery: function(a) {
            var h = $(".j_commontagList .j_commontag:first").clone().removeClass("hide");
            h.attr("id", a.id);
            h.find(".js_nameLink").text(a.name).attr("title", a.name);
            $(".j_commontagList").append(h)
        },
        deleteFormDataQueryById: function(a) {
            var h = this,
            c = h.model;
            d.confirm("\u786e\u8ba4\u5220\u9664\uff1f",
            function(k) {
                k && c.deleteFormDataQueryById(a,
                function(c) {
                    c.actionMsg && c.actionMsg.message ? d.notify(c.actionMsg.message) : (d.notify("\u5220\u9664\u6210\u529f\uff01"), h.$(".j_commontag[id\x3d" + a + "]").remove())
                })
            })
        },
        renderFormDataQuery: function(a) {
            var h = this,
            c = h.model,
            k = $(h.el);
            c.findFormDataQueryById(a,
            function(a) {
                a.actionMsg && a.actionMsg.message ? d.notify(a.actionMsg.message) : g.async("develop" == TEAMS.runMode ? "form/form-plugin": "form.js?t_\x3d" + TEAMS.version,
                function() {
                    g.async("form/form-plugin",
                    function(c) {
                        k.find("#search-group-list").html("");
                        if (c = JSON.parse(a.formDataQuerys[0].content)) {
                            c.isFilterSub && 0 < k.find(".j_filterSub").length && ("true" == c.isFilterSub || 1 == c.isFilterSub ? k.find(".j_filterSub").data("isFilterSub", "true").addClass("open") : k.find(".j_filterSub").data("isFilterSub", "false").removeClass("open"));
                            if (0 < c.names.length) for (var e = 0; e < c.names.length; e++) k.find(".j_addCondition").trigger("click"),
                            k.find('#search-group-list .sch-group:last .sch-item select option[key\x3d"name"]').attr("selected", !0).trigger("change"),
                            k.find("#search-group-list .sch-group:last .j_formField-condition select option[value\x3d" + c.names[e].term + "]").attr("selected", !0),
                            k.find("#search-group-list .sch-group:last .j_formField-condition").find("input").val(c.names[e].content);
                            if (0 < c.createTimes.length) for (e = 0; e < c.createTimes.length; e++) k.find(".j_addCondition").trigger("click"),
                            k.find('#search-group-list .sch-group:last .sch-item select option[key\x3d"createTime"]').attr("selected", !0).trigger("change"),
                            k.find("#search-group-list .sch-group:last .j_formField-condition").find("input").eq(0).val(c.createTimes[e].content),
                            k.find("#search-group-list .sch-group:last .j_formField-condition").find("input").eq(1).val(c.createTimes[e].endContent);
                            if (0 < c.types.length) for (e = 0; e < c.types.length; e++) {
                                k.find(".j_addCondition").trigger("click");
                                k.find('#search-group-list .sch-group:last .sch-item select option[key\x3d"type"]').attr("selected", !0).trigger("change");
                                k.find("#search-group-list .sch-group:last .j_formField-condition select option[value\x3d" + c.types[e].term + "]").attr("selected", !0);
                                for (var b = 0; b < c.types[e].ids.length; b++) {
                                    var d = '\x3cspan class\x3d"entity-item"\x3e\x3ca status\x3d"' + c.types[e].ids[b].status + '"\x3e' + c.types[e].ids[b].text + "\x3c/a\x3e\x3c/span\x3e";
                                    k.find("#search-group-list .sch-group:last .j_formField-condition").find(".entity-container").append(d)
                                }
                            }
                            if (0 < c.operators.length) for (e = 0; e < c.operators.length; e++) for (k.find(".j_addCondition").trigger("click"), k.find('#search-group-list .sch-group:last .sch-item select option[key\x3d"operator"]').attr("selected", !0).trigger("change"), k.find("#search-group-list .sch-group:last .j_formField-condition select option[value\x3d" + c.operators[e].term + "]").attr("selected", !0), b = 0; b < c.operators[e].ids.length; b++) d = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d"' + c.operators[e].ids[b].id + '"\x3e' + c.operators[e].ids[b].name + "\x3c/a\x3e\x3c/span\x3e",
                            k.find("#search-group-list .sch-group:last .j_formField-condition").find(".entity-container").append(d);
                            if (0 < c.filterFormDatas.length) for (e = 0; e < c.filterFormDatas.length; e++) {
                                k.find(".j_addCondition").trigger("click");
                                var b = ["DateComponent", "Money", "NumberComponent", "Monitor", "Raty"],
                                d = k.find("#search-group-list .sch-group:last"),
                                f = c.filterFormDatas[e].term,
                                g = c.filterFormDatas[e].componentKey,
                                p = c.filterFormDatas[e].fieldId;
                                k.find('#search-group-list .sch-group:last .sch-item select option[id\x3d"' + p + '"]').attr("selected", !0);
                                h.getType(g, "Text TextArea Email Phone Mobile FileComponent".split(" ")) ? formPlugin.renderStatSearch({
                                    parentEl: d,
                                    fieldId: p,
                                    componentKey: g,
                                    value: c.filterFormDatas[e].content,
                                    term: f,
                                    container: h.el
                                }) : h.getType(g, b) ? formPlugin.renderStatSearch({
                                    parentEl: d,
                                    fieldId: p,
                                    componentKey: g,
                                    startValue: c.filterFormDatas[e].content,
                                    term: f,
                                    endValue: c.filterFormDatas[e].endContent,
                                    container: h.el
                                }) : formPlugin.renderStatSearch({
                                    parentEl: d,
                                    fieldId: p,
                                    componentKey: g,
                                    ids: "ComboSelect" == g ? c.filterFormDatas[e].children: c.filterFormDatas[e].ids,
                                    term: f,
                                    container: h.el
                                });
                                "null" == f || "notnull" == f ? (d.find(".j_condition").next().addClass("hide"), d.find(".j_selected,.j_control").addClass("hide")) : (d.find(".j_condition").next().removeClass("hide"), d.find(".j_selected,.j_control").removeClass("hide"))
                            }
                        }
                        $("body").trigger("confirmSearch")
                    })
                })
            })
        },
        assembleFormDataQueryParam: function() {
            var a = this,
            b = $(a.el),
            c = {},
            k = [];
            b.find("#search-group-list .j_nameSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                e = "",
                e = $.trim(a.find("input").val());
                "" == e && (e = null);
                if (null == e) return ! 0;
                k.push({
                    content: e,
                    term: c
                })
            });
            c.names = k;
            var s = [];
            b.find("#search-group-list .j_createTimeSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                k = "",
                e = "",
                k = $.trim(a.find("input").eq(0).val()),
                e = $.trim(a.find("input").eq(1).val());
                "" == k && (k = null);
                "" == e && (e = null);
                if (null == k && null == e) return ! 0;
                s.push({
                    content: k,
                    endContent: e,
                    term: c
                })
            });
            c.createTimes = s;
            var d = [];
            b.find("#search-group-list .j_typeSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                k = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("status");
                    var c = $(this).find("a").text();
                    k.push({
                        status: a,
                        text: c
                    })
                });
                if (0 == k.length) return ! 0;
                d.push({
                    ids: k,
                    term: c
                })
            });
            c.types = d;
            var f = [];
            b.find("#search-group-list .j_optSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                k = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    var c = $(this).find("a").text();
                    a = {
                        id: a,
                        name: c
                    };
                    k.push(a)
                });
                if (0 == k.length) return ! 0;
                f.push({
                    ids: k,
                    term: c
                })
            });
            c.operators = f;
            var t = [];
            b.find("#search-group-list .j_formFieldSearchGroup").each(function(c) {
                var k = $(this).find(".j_formField-select select option:selected"),
                b = $(this).find(".j_formField-condition .j_condition option:selected");
                c = $(this).find(".j_formField-condition");
                var h = $(this).find(".j_formField-condition .j_selected"),
                s = k.attr("id"),
                d = k.text(),
                q = k.attr("subformid"),
                k = k.attr("key"),
                b = b.attr("value"),
                f = "",
                r = "",
                g = [],
                f = "Text TextArea Email Phone Mobile FileComponent".split(" "),
                r = ["DateComponent", "Money", "NumberComponent", "Monitor", "Raty"],
                s = {
                    fieldId: s,
                    fieldTitle: d,
                    subFormId: q,
                    componentKey: k,
                    term: b
                };
                if ("null" != b && "notnull" != b) if (a.getType(k, f)) {
                    f = $.trim(c.find("input").val());
                    if ("" == f) return ! 0;
                    s.content = f
                } else if (a.getType(k, r)) {
                    f = $.trim(c.find("input").eq(0).val());
                    r = $.trim(c.find("input").eq(1).val());
                    "" == f && (f = null);
                    "" == r && (r = null);
                    if (null == f && null == r) return ! 0;
                    s.content = f;
                    s.endContent = r
                } else if ("ComboSelect" == k) {
                    var l = [];
                    h.find(".entity-item").each(function(a) {
                        a = $(this).find("a").attr("selectId");
                        var c;
                        a: {
                            for (c = 0; c < l.length; c++) if (l[c].fieldId == a) {
                                c = !0;
                                break a
                            }
                            c = !1
                        }
                        c || l.push({
                            fieldId: a,
                            componentKey: "Select"
                        })
                    });
                    for (c = 0; c < l.length; c++) d = l[c],
                    g = [],
                    h.find("a[selectId\x3d'" + d.fieldId + "']").each(function(a) {
                        a = $(this).attr("id");
                        var c = $(this).text();
                        g.push({
                            id: a,
                            text: c
                        })
                    }),
                    d.ids = g;
                    if (0 == l.length) return ! 0;
                    s.children = l
                } else {
                    h.find(".entity-item").each(function(a) {
                        a = $(this).find("a").attr("id");
                        var c = $(this).find("a").text();
                        g.push({
                            id: a,
                            text: c
                        })
                    });
                    if (0 == g.length) return ! 0;
                    s.ids = g
                }
                t.push(s)
            });
            c.filterFormDatas = t;
            0 < b.find(".j_filterSub").length && (c.isFilterSub = b.find(".j_filterSub").data("isFilterSub"));
            return c
        },
        renderSearchComponent: function(a, b) {
            $(this.el);
            _.each(a,
            function(a) {
                var k = a.id,
                e = a.componentKey,
                d = a.title,
                f = $("\x3coption id\x3d" + k + " key\x3d" + e + "\x3e" + d + "\x3c/option\x3e");
                a.subForm && a.subForm.id && (f = $("\x3coption id\x3d" + k + " subFormId\x3d" + a.subForm.id + " key\x3d" + e + "\x3e" + d + "\x3c/option\x3e"));
                0 != a["delete"] && (f.addClass("option-line"), f.text(f.text() + "(\u5df2\u5220\u9664)"));
                "ImageComponent" != e && "FileComponent" != e && "FormComponent" != e && (f.data("layoutDetail", a.layoutDetail), b.append(f))
            });
            b.trigger("change.FormStatSearchView")
        },
        assembleParam: function() {
            var a = this,
            b = $(a.el),
            c = {},
            k = [];
            b.find("#search-group-list .j_nameSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                e = "",
                e = $.trim(a.find("input").val());
                "" == e && (e = null);
                if (null == e) return ! 0;
                k.push({
                    content: e,
                    term: c
                })
            });
            c.names = k;
            var s = [];
            b.find("#search-group-list .j_createTimeSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                k = "",
                e = "",
                k = $.trim(a.find("input").eq(0).val()),
                e = $.trim(a.find("input").eq(1).val());
                "" == k && (k = null);
                "" == e && (e = null);
                if (null == k && null == e) return ! 0;
                s.push({
                    content: k,
                    endContent: e,
                    term: c
                })
            });
            c.createTimes = s;
            var d = [];
            b.find("#search-group-list .j_typeSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                k = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("status");
                    k.push(a)
                });
                if (0 == k.length) return ! 0;
                d.push({
                    ids: k,
                    term: c
                })
            });
            c.types = d;
            var f = [];
            b.find("#search-group-list .j_optSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                k = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    k.push(a)
                });
                if (0 == k.length) return ! 0;
                f.push({
                    ids: k,
                    term: c
                })
            });
            c.operators = f;
            var t = [];
            b.find("#search-group-list .j_participantSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                k = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    k.push(a)
                });
                if (0 == k.length) return ! 0;
                t.push({
                    ids: k,
                    term: c
                })
            });
            c.participants = t;
            var n = [];
            b.find("#search-group-list .j_managerSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                k = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    k.push(a)
                });
                if (0 == k.length) return ! 0;
                n.push({
                    ids: k,
                    term: c
                })
            });
            c.managers = n;
            var g = [];
            b.find("#search-group-list .j_contentSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                k = "",
                k = $.trim(a.find("input").val());
                "" == k && (k = null);
                if (null == k) return ! 0;
                g.push({
                    content: k,
                    term: c
                })
            });
            c.contents = g;
            var u = [];
            b.find("#search-group-list .j_duedateSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                k = "",
                e = "",
                k = $.trim(a.find("input").eq(0).val()),
                e = $.trim(a.find("input").eq(1).val());
                "" == k && (k = null);
                "" == e && (e = null);
                if (null == k && null == e) return ! 0;
                u.push({
                    content: k,
                    endContent: e,
                    term: c
                })
            });
            c.duedates = u;
            var p = [];
            b.find("#search-group-list .j_prioritySearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                k = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("status");
                    k.push(a)
                });
                if (0 == k.length) return ! 0;
                p.push({
                    ids: k,
                    term: c
                })
            });
            c.prioritys = p;
            var w = [];
            b.find("#search-group-list .j_formFieldSearchGroup").each(function(c) {
                var k = $(this).find(".j_formField-select select option:selected"),
                b = $(this).find(".j_formField-condition .j_condition option:selected");
                c = $(this).find(".j_formField-condition");
                var h = $(this).find(".j_formField-condition .j_selected"),
                s = k.attr("id"),
                d = k.attr("subformid"),
                k = k.attr("key"),
                b = b.attr("value"),
                q = "",
                f = "",
                t = [],
                q = "Text TextArea Email Phone Mobile FileComponent".split(" "),
                f = ["DateComponent", "Money", "NumberComponent", "Monitor", "Raty"],
                s = {
                    fieldId: s,
                    subFormId: d,
                    componentKey: k,
                    term: b
                };
                if ("null" != b && "notnull" != b) if (a.getType(k, q)) {
                    q = $.trim(c.find("input").val());
                    if ("" == q) return ! 0;
                    s.content = q
                } else if (a.getType(k, f)) {
                    q = $.trim(c.find("input").eq(0).val());
                    f = $.trim(c.find("input").eq(1).val());
                    "" == q && (q = null);
                    "" == f && (f = null);
                    if (null == q && null == f) return ! 0;
                    s.content = q;
                    s.endContent = f
                } else if ("ComboSelect" == k) {
                    var n = [];
                    h.find(".entity-item").each(function(a) {
                        a = $(this).find("a").attr("selectId");
                        var c;
                        a: {
                            for (c = 0; c < n.length; c++) if (n[c].fieldId == a) {
                                c = !0;
                                break a
                            }
                            c = !1
                        }
                        c || n.push({
                            fieldId: a,
                            componentKey: "Select"
                        })
                    });
                    for (c = 0; c < n.length; c++) d = n[c],
                    t = [],
                    h.find("a[selectId\x3d'" + d.fieldId + "']").each(function(a) {
                        a = $(this).attr("id");
                        t.push(a)
                    }),
                    d.ids = t;
                    if (0 == n.length) return ! 0;
                    s.children = n
                } else {
                    h.find(".entity-item").each(function(a) {
                        a = $(this).find("a").attr("id");
                        t.push(a)
                    });
                    if (0 == t.length) return ! 0;
                    s.ids = t
                }
                w.push(s)
            });
            c.filterFormDatas = w;
            0 < b.find(".j_filterSub").length && (c.isFilterSub = b.find(".j_filterSub").data("isFilterSub"));
            return c
        },
        renderTypeheader: function(a, b) {
            if (b.length) for (var c = 0; c < b.length; c++) {
                var k = b[c],
                s = k.name,
                d = k.id;
                if (s && d) {
                    var f = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + d + "\x3e" + s + "\x3c/a\x3e\x3c/span\x3e";
                    a.find(".entity-item").each(function(a) {
                        d == $(this).find("a").attr("id") && (f = null)
                    });
                    a.append(f)
                }
            } else s = b.name,
            d = b.id,
            s && d && (f = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + d + "\x3e" + s + "\x3c/a\x3e\x3c/span\x3e", a.find(".entity-item").each(function(a) {
                d == $(this).find("a").attr("id") && (f = null)
            }), a.append(f))
        },
        getType: function(a, b) {
            return - 1 < b.toString().indexOf(a) ? !0 : !1
        },
        remove: function() {
            $(this.el).off(".FormStatSearchView");
            $("body").off(".FormStatSearchView");
            $(this.el).find(".j_formstat-search").remove();
            this.formView && (this.formView.remove(), this.formView = null)
        }
    });
    l.exports = m
});
define("eteams/biaoge/formstat/formreportview", ["eteams/biaoge/form/formoperationview", "eteams/biaoge/formstat/formreportmodel", "teams/utils"],
function(g, m, l) {
    var d = g("eteams/biaoge/form/formoperationview"),
    f = g("eteams/biaoge/formstat/formreportmodel"),
    b = g("teams/utils");
    g = Backbone.View.extend({
        initialize: function(a) {
            var e = this;
            e.el = a.el;
            e.reportId = a.formId;
            e.$el = $(e.el);
            e.template = "formstat.formreportview";
            e.$tpel = $(b.template(e.template));
            e.$el.html(e.$tpel.siblings("#formfieldstat"));
            e.reportId ? (e.model = new f({
                formId: e.reportId
            }), e.model.getReports(function(a) {
                var c = $(b.template(e.template)).siblings("#formitems");
                e.$el.find("#formlist-loading").remove();
                e.$el.find("#reportstatbody").append(c);
                e.renderForms(a);
                $(window).trigger("resize")
            })) : (e.$el.find("#formlist-loading").remove(), e.$el.find("#formlist-nodata").removeClass("hide"));
            b.layout("#formReportContent");
            this.remove()
        },
        delegateEvents: function() {
            var a = this;
            $("body").on("click.FormReportView", ".goto-top",
            function(a) {
                b.gotoTop("#formReportContent")
            });
            this.$el.off(".FormReportView");
            this.$el.on("click.FormReportView", "#report-create",
            function() {
                var e = {
                    module: "biaoge_report",
                    "form.report.id": a.reportId,
                    el: "#build-newreport"
                };
                e.tpl = b.template("formstat.formreportnew", {
                    userId: TEAMS.currentUser.id,
                    admin: TEAMS.currentUser.admin
                });
                e.ownership = "company";
                e.saveCallback = function(e) {
                    a.model.getReports(function(c) {
                        var k = $(b.template(a.template, c)).siblings("#formitems");
                        a.$el.find("#reportstatbody").html("").append(k);
                        a.renderForms(c);
                        $(window).trigger("resize")
                    })
                };
                a.formoperationView = new d(e);
                a.formoperationView.isReportForm = !0;
                a.formoperationView.reportId = a.reportId;
                a.formoperationView.render()
            });
            this.$el.on("click.FormReportView", ".reportedit",
            function() {
                window.open($(this).attr("reporturl"))
            });
            this.$el.on("click.FormReportView", ".reportpreview",
            function() {
                var a = $(this).attr("previewurl");
                window.open(a)
            });
            this.$el.on("click.FormReportView", ".reportdel",
            function() {
                var e = $(this).attr("formId");
                b.confirm("\u786e\u5b9a\u5220\u9664\u5417\uff1f",
                function(h) {
                    h && a.model.deleteForm({
                        formId: e,
                        module: "biaoge_report"
                    },
                    function(c) {
                        b.notify("\u8868\u5355\u5220\u9664\u6210\u529f");
                        a.model.getReports(function(c) {
                            var e = $(b.template(a.template, c)).siblings("#formitems");
                            a.$el.find("#reportstatbody").html("").append(e);
                            a.renderForms(c);
                            $(window).trigger("resize")
                        })
                    })
                })
            })
        },
        remove: function() {
            $(this.el).off(".FormReportView")
        },
        renderForms: function(a) {
            var e = $("#formitems .js_companyformlist");
            $.each(a.forms,
            function(a) {
                var c = e.find("li:first").clone().show();
                c.find("#form-number").text(a + 1);
                c.find("#title").text(this.name);
                c.find(".operator").text("\u521b\u5efa\u4eba\uff1a" + this.operator.username);
                c.find(".createTime").text("\u521b\u5efa\u65f6\u95f4\uff1a" + Date.create(this.createTime).format("{yyyy}/{MM}/{dd}"));
                c.find(".reportpreview").attr("previewurl", "/form/reportPreview/" + this.id);
                c.find(".reportedit").attr("reporturl", "/form/editreport/" + this.id);
                c.find(".reportdel").attr("formId", this.id);
                e.find("li:last").before(c)
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formfieldstatmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function(d) {
            this.formId = d.formId
        },
        getFormFieldStatData: function(d, f) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formfieldstat/getFormDataFieldStat.json",
                dataType: "json",
                data: JSON.stringify({
                    formId: this.formId
                }),
                success: function(b) {
                    d && d.call(f, b.formFieldStat, b)
                }
            })
        },
        getNumberFieldStatData: function(d) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formfieldstat/findFormNumberCharts.json",
                dataType: "json",
                data: JSON.stringify({
                    formId: this.formId
                }),
                success: function(f) {
                    d && d(f)
                }
            })
        },
        getNumDataTrendData: function(d) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formfieldstat/findNumberDataTrendStat.json",
                dataType: "json",
                data: JSON.stringify({
                    formId: this.formId
                }),
                success: function(f) {
                    d && d(f)
                }
            })
        },
        findFormFieldData: function(d, f) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formfieldstat/findFormFieldData.json",
                dataType: "json",
                data: JSON.stringify({
                    formId: this.formId
                }),
                success: function(b) {
                    d && d.call(f, b)
                }
            })
        },
        findFormStatDataChart: function(d, f, b) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formfieldstat/findFormStatDataChart.json",
                dataType: "json",
                data: JSON.stringify({
                    param: b,
                    formId: this.formId
                }),
                success: function(a) {
                    d && d.call(f, a)
                }
            })
        },
        findFormNumberDataStat: function(d, f) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formfieldstat/findFormNumberDataStat.json",
                dataType: "json",
                data: JSON.stringify({
                    param: d,
                    formId: this.formId
                }),
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatdatachartview", "eteams/biaoge/formstat/formfieldstatmodel eteams/biaoge/formstat/statselectview teams/utils teams/component/entityslider eteams/biaoge/formstat/formstatheaderview eteams/biaoge/formstat/flowstatheaderview".split(" "),
function(g, m, l) {
    var d = g("eteams/biaoge/formstat/formfieldstatmodel"),
    f = g("eteams/biaoge/formstat/statselectview"),
    b = g("teams/utils"),
    a = g("teams/component/entityslider"),
    e = g("eteams/biaoge/formstat/formstatheaderview"),
    h = g("eteams/biaoge/formstat/flowstatheaderview");
    m = Backbone.View.extend({
        initialize: function(a) {
            this.model = new d({
                formId: a.formId
            });
            this.formId = a.formId;
            this.module = a.module || "form";
            this.el = a.el;
            $(this.el).html(b.template("formstat.formstatdatachart"))
        },
        delegateEvents: function() {
            var a = this,
            k = $(this.el);
            $("body").off("confirmSearch").on("confirmSearch",
            function(k) {
                a.renderChartData()
            });
            k.on("click.FormStatDataChartView", ".j_date_type a",
            function() {
                var k = $(this);
                $(this).addClass("active btn-primary").siblings().removeClass("active btn-primary");
                a.barChart && $(window).off("resize", a.barChart.resize);
                a.renderNumChart(k.attr("dateType"))
            })
        },
        render: function(a) {
            this.renderHeader();
            this.renderChartData()
        },
        renderHeader: function() {
            this.headerView = "workflow" == this.module ? new h({
                formId: this.formId,
                container: this.el + " .j_form_header",
                type: "flowstatchart"
            }) : new e({
                formId: this.formId,
                container: this.el + " .j_form_header",
                type: "statchart"
            });
            this.headerView.render()
        },
        renderChartData: function() {
            this.model.findFormStatDataChart(this.renderComponents, this, this.headerView.getParam())
        },
        renderComponents: function(a) {
            var k = $(this.el);
            this.barChart && $(window).off("resize", this.barChart.resize);
            k.find(".j_field_chart").html("");
            k.find("#formlist-loading").addClass("hide");
            k.find("#fieldstatbody").removeClass("hide");
            k.find("#formfieldStatContent").removeClass("hide");
            k.find(".j_no_my_datareport").addClass("hide");
            this.param = a.param;
            if (a && a.form && a.form.permission) {
                if (! (a.formFieldStat && 0 < a.formFieldStat.length)) {
                    var e = 0,
                    h;
                    for (h in a.numberFieldTrendDatas) {
                        if (2 <= e) break;
                        e++
                    }
                    2 > e && (k.find(".j_no_my_datareport").removeClass("hide"), k.find("#formfieldStatContent").addClass("hide"))
                }
                a.numberFieldTrendDatas ? (k.find(".j_numdata_chart").removeClass("hide"), this.renderNumDataTrendChartView(a.numberFieldTrendDatas, a.param.formatType)) : k.find(".j_numdata_chart").addClass("hide");
                if (a.formFieldStat && 0 < a.formFieldStat.length) for (k = k.find(".j_field_chart"), e = 0; e < a.formFieldStat.length; e++) h = a.formFieldStat[e],
                0 <= _.indexOf(["CheckBox", "RadioBox", "Select"], h.componentkey) && (h.number = e + 1, componentView = new f(h, k, this.param), componentView.render())
            } else k.find("#fieldstatbody").html(b.template("base.nopermission", {
                msg: null
            }))
        },
        renderNumChart: function(a) {
            var k = this,
            e = k.headerView.getParam();
            e.formatType = a;
            k.model.findFormNumberDataStat(e,
            function(a) {
                k.renderNumDataTrendChartView(a.numberFieldTrendDatas, a.param.formatType)
            })
        },
        renderNumDataTrendChartView: function(a, k) {
            var e = null,
            b = [],
            h,
            d = this,
            f = $(this.el);
            a.category && (e = a.category.dates);
            f.find(".j_date_type .active").removeClass("btn-primary").removeClass("active");
            f.find(".j_date_type .btn-primary").removeClass("btn-primary").removeClass("active");
            f.find(".j_date_type a[datetype\x3d'" + k + "']").addClass("active btn-primary");
            delete a.category;
            for (var v in a) h = {
                type: "bar"
            },
            h.name = a[v].seriename,
            h.data = a[v].datas,
            b.push(h);
            0 === b.length ? f.find(".j_numdata_chart").addClass("hide") : (option = {
                title: {
                    text: "",
                    x: "center"
                },
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data: ["\u6570\u5b57\u65e5\u671f\u8d8b\u52bf"],
                    x: "left"
                },
                toolbox: {
                    show: !0,
                    feature: {
                        magicType: {
                            show: !0,
                            type: ["line", "bar"]
                        },
                        restore: {
                            show: !0
                        },
                        saveAsImage: {
                            show: !0
                        }
                    }
                },
                calculable: !0,
                xAxis: [{
                    type: "category",
                    data: e
                }],
                yAxis: [{
                    type: "value"
                }],
                dataZoom: {
                    show: !0,
                    realtime: !0,
                    start: 0,
                    end: 100
                },
                series: b
            },
            g.async("https://static.eteams.cn/js/echarts.min.js",
            function() {
                var a = f.find("#numdatatrendstat"),
                a = d.barChart = echarts.init(a.get(0));
                $(window).on("resize", a.resize);
                a.setOption(option);
                var c = echarts.config;
                a.un(c.EVENT.CLICK).on(c.EVENT.CLICK,
                function(a) {
                    d.showChartData(a)
                })
            }))
        },
        showChartData: function(c) {
            view = this;
            view.entitySlider && view.entitySlider.remove();
            if (c) {
                var k = $.extend(!0, {},
                view.param);
                k.createTimes = [{
                    content: c.name,
                    endContent: c.name
                }];
                "workflow" == view.module ? (k.type = "flowstatslider", view.entitySlider = new a({
                    module: "flowformstat",
                    param: k
                })) : view.entitySlider = new a({
                    module: "formstatdata",
                    param: k
                });
                view.entitySlider.render()
            }
        },
        remove: function() {
            this.formsStatHeaderView && (this.formsStatHeaderView.remove(), this.formsStatHeaderView = null);
            $(this.el).off(".FormStatDataChartView")
        }
    });
    l.exports = m
});
define("eteams/biaoge/formstat/formstatlistview", ["teams/utils", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.formId = b.formId;
            this.el = b.container;
            this.type = b.type;
            this.isAdmin = TEAMS.currentUser.admin;
            this.model = new f(b);
            $(this.el).html(d.template("formstat.formstatlist"))
        },
        delegateEvents: function() {
            var b = this,
            a = $(b.el);
            a.on("click.FormStatTabView", ".j_form_search",
            function() {
                b.renderFormList(1)
            });
            a.on("keyup.FormStatTabView", ".js_searchkeyword",
            function(a) {
                13 == a.keyCode && b.renderFormList(1)
            })
        },
        render: function() {
            this.renderFormList()
        },
        renderFormList: function(b) {
            var a = this,
            e = $(a.el);
            b = b ? b: 1;
            var h = {
                keyword: $.trim(e.find(".js_searchkeyword").val()),
                module: "biaoge",
                needCount: !0,
                pageNo: b,
                pageSize: 1E4
            },
            c = e.find("#j_form_item");
            a.model.queryMyFormsKeywords(h,
            function(k) {
                var h = e.find(".j_form_list");
                1 == b && h.html("");
                if (k && k.forms && 0 < k.forms.length) {
                    e.find(".j_no_result").addClass("hide");
                    for (var d = 0; d < k.forms.length; d++) {
                        var f = k.forms[d],
                        t = c.clone().removeClass("hide");
                        t.attr("id", f.id);
                        t.attr("title", f.name);
                        t.find(".j_title").text(f.name);
                        t.find(".j_title").attr("title", f.name);
                        t.attr("href", "/forms/" + TEAMS.currentUser.id + "/" + a.type + "/" + f.id);
                        f.newFillCount && 0 != f.newFillCount && t.find(".j_number").text(f.newFillCount);
                        f.id == a.formId && t.addClass("active");
                        h.append(t)
                    }
                    a.buildSerialNumber(h)
                } else 1 == b && e.find(".j_no_result").removeClass("hide");
                a.show()
            })
        },
        buildSerialNumber: function(b) {
            b.find(".serial").each(function(a) {
                $(this).text(a + 1)
            });
            d.layout(".j_formstattabScr")
        },
        show: function() {
            $(this.el).find(".j_form_goalSlideObj").addClass("sidebar-in")
        },
        remove: function() {
            $(this.el).off(".FormStatTabView")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatview", "teams/utils eteams/biaoge/formstat/formstatmodel eteams/biaoge/formstat/formcolumnview eteams/biaoge/formstat/formstatsearchview eteams/biaoge/formstat/formstattableheaderview eteams/biaoge/formstat/flowstatheaderview".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel");
    g("eteams/biaoge/formstat/formcolumnview");
    g("eteams/biaoge/formstat/formstatsearchview");
    var b = g("eteams/biaoge/formstat/formstattableheaderview"),
    a = g("eteams/biaoge/formstat/flowstatheaderview"),
    e = [{
        title: "\u5ba1\u6279\u540d",
        position: "left",
        name: "FR.NAME"
    },
    {
        title: "\u63d0\u4ea4\u4eba",
        position: "left",
        name: "FR.CREATOR"
    },
    {
        title: "\u63d0\u4ea4\u4eba\u90e8\u95e8",
        position: "left",
        name: "DP.NAME"
    },
    {
        title: "\u63d0\u4ea4\u65f6\u95f4",
        position: "left",
        name: "FR.CREATE_TIME"
    },
    {
        title: "\u7ed3\u675f\u65f6\u95f4",
        position: "left",
        name: "FR.FINISH_TIME"
    },
    {
        title: "\u5ba1\u6279\u72b6\u6001",
        position: "left",
        name: "FR.FINISH_TIME"
    }];
    g = Backbone.View.extend({
        teams: {},
        initialize: function(a) {
            this.formId = a.formId || a.flowSliderParam.formId;
            this.el = a.container ? a.container: "#j_formContent";
            this.flowSliderParam = a.flowSliderParam;
            this.isAdmin = TEAMS.currentUser.admin;
            $(this.el).html(d.template("form.stat"));
            $(this.el).removeClass("scrollwrapper");
            this.model = new f;
            this.fileds = e
        },
        delegateEvents: function() {
            var a = this,
            c = $(a.el);
            $("body").on("click.FormStatView", ".goto-top",
            function(c) {
                d.gotoTop(a.el + " #formStatContent")
            });
            $("body").off("confirmSearch").on("confirmSearch",
            function(c) {
                a.renderListStatByRow(1)
            });
            c.on("click.FormStatView", "#more_data",
            function(c) {
                c = $(this).data("page");
                a.renderListStatByRow(c.nextPage)
            });
            c.on("click.FormStatView", ".j_flowDelAll",
            function(a) {
                a = $(this).is(":checked");
                c.find("#statbody #stat_table .j_flowDel").prop("checked", a);
                a ? $("td.num").addClass("checked") : $("td.num").removeClass("checked")
            });
            c.on("click.FormStatView", "#stat_table .j_flowDel",
            function(a) {
                a = $(this);
                a.is(":checked") ? a.closest("td").addClass("checked") : a.closest("td").removeClass("checked")
            });
            c.on("click.FormStatView", "#delete_formdata",
            function(k) {
                var e = {},
                b = [];
                c.find("#stat_table tbody input:checkbox:checked").each(function(a) {
                    a = $(this).val();
                    b.push(a)
                });
                e.ids = b;
                0 == b.length ? d.notify("\u8bf7\u52fe\u9009\u5ba1\u6279\u540e\u5220\u9664") : d.confirm("\u5220\u9664\u540e\u53ef\u4ee5\u5230\u56de\u6536\u7ad9\u4e2d\u627e\u56de\u6216\u5f7b\u5e95\u5220\u9664,\u786e\u8ba4\u8981\u5220\u9664\u6570\u636e\u5417\uff1f",
                function(c) {
                    c && a.model.deleteFlow(e,
                    function(c) {
                        c.actionMsg ? d.notify(c.actionMsg.message) : (d.notify("\u5ba1\u6279\u5df2\u5220\u9664"), a.renderListStatByRow(1))
                    })
                })
            });
            $("body").off("confirmRenderTable").on("confirmRenderTable",
            function(c) {
                a.againRenderTable()
            })
        },
        render: function() {
            this.flowSliderParam || this.renderHeader();
            this.renderListStatByRow(1)
        },
        renderHeader: function() {
            this.headerView = new a({
                formId: this.formId,
                container: this.el + " .js_flow_header",
                type: "formstat"
            });
            this.headerView.render()
        },
        renderTableheader: function() {
            var a = $(this.el);
            this.tableheader = new b({
                formId: this.formId,
                htable: a.find("#head_table"),
                ctable: a.find("#stat_table"),
                fileds: this.fileds,
                parentObj: this
            });
            this.tableheader.render();
            this.formFields = this.tableheader.formFields;
            this.isAdmin && a.find("#head_table .num").html("\x3cdiv\x3e\x3cinput class\x3d'j_flowDelAll' type\x3d'checkbox'\x3e\x3c/div\x3e")
        },
        renderListStatByRow: function(a) {
            var c = this,
            k = c.el,
            e = c.headerView.getParam();
            c.tableheader ? c.tableheader.getOrderParam(e) : c.renderTableheader();
            null == c.formFields || 0 == c.formFields.length ? $("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e\u5f53\u524d\u8868\u5355\u6ca1\u6709\u4efb\u4f55\u5b57\u6bb5\uff01\x3c/div\x3e') : (e.formId = c.formId, e.pageNo = a, null == e.isFilterSub && (e.isFilterSub = !1), 1 == a && ($(c.el).find("#stat_table").hide(), $(c.el).find("#stat_table tbody").empty()), $(c.el).find("#list-loading").show(), $(c.el).find("#more_data").hide(), c.model.findRowListStatForFlow(e,
            function(e) {
                if (e.message) $(k).find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e' + e.message + "\x3c/div\x3e");
                else {
                    var b = e.formDatas,
                    s = e.listStats,
                    f = e.numberFieldStats,
                    g = e.pageDatas,
                    u = e.form;
                    e = c.formFields;
                    $(c.el).find("#list-loading").hide();
                    $(c.el).find("#stat_table").show();
                    if (null == u) $(k).find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult" style\x3d"color:#e60000;"\x3e\u8868\u5355\u4e0d\u5b58\u5728\x3c/div\x3e');
                    else if (c.tableheader.renderPageMore($(k), g, b, a)) {
                        c.tableheader.setTableFootCount(f, a);
                        s = c.tableheader.bulidListStats(s);
                        for (f = 0; f < b.length; f++) {
                            var u = b[f],
                            p = u.id,
                            w = u.flowId,
                            y = u.flowName;
                            if (! (0 < $(k + " #stat_table tbody #" + p).length)) {
                                var z = null == u.operator.department ? "\u65e0": u.operator.department.name,
                                K = Date.create(u.flowCreateTime),
                                C = null == u.flowFinishTime ? "\u5ba1\u6279\u4e2d": "\u5df2\u7ed3\u675f",
                                l;
                                l = u.flowFinishTime ? Date.create(u.flowFinishTime).format("{yyyy}-{MM}-{dd}") : "";
                                for (var G = s[p] ? s[p] : [""], m = 0; m < G.length; m++) {
                                    var D = G[m],
                                    x = $("\x3ctr id\x3d" + p + "\x3e\x3c/tr\x3e");
                                    c.isAdmin ? x.append("\x3ctd class\x3d'num noSub_flowCheck_" + p + "'\x3e\x3cdiv\x3e\x3cspan\x3e" + (g.first + f) + "\x3c/span\x3e\x3cinput class\x3d'j_flowDel' value\x3d'" + w + "' type\x3d'checkbox'\x3e\x3c/div\x3e\x3c/td\x3e") : x.append("\x3ctd class\x3d'num noSub_flowCheck_" + p + "'\x3e\x3cdiv\x3e\x3cspan\x3e" + (g.first + f) + "\x3c/span\x3e\x3c/div\x3e\x3c/td\x3e");
                                    1 == f % 2 && x.addClass("other-bgcolor");
                                    x.append("\x3ctd title\x3d'" + y + "' name\x3d'FR.NAME' class\x3d'noSub_flowName_" + p + "'\x3e\x3cdiv title\x3d'" + y + '\'\x3e\x3ca class\x3d"j_entityslider-toggle" data-id\x3d"' + w + '" data-module\x3d"workflow" renderType\x3d""\x3e' + y + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e");
                                    x.append("\x3ctd class\x3d'noSub_user_" + p + "' name\x3d'FR.CREATOR'\x3e\x3cdiv\x3e\x3ca class\x3d'router usercard-toggle' userid\x3d'" + u.operator.id + "'\x3e" + u.operator.username + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e");
                                    x.append("\x3ctd class\x3d'noSub_department_" + p + "' name\x3d'DP.NAME'\x3e\x3cdiv\x3e" + z + "\x3c/div\x3e\x3c/td\x3e");
                                    x.append("\x3ctd class\x3d'noSub_createTime_" + p + "' name\x3d'FR.CREATE_TIME'\x3e\x3cdiv\x3e" + K.format("{yyyy}-{MM}-{dd}") + "\x3c/div\x3e\x3c/td\x3e");
                                    x.append("\x3ctd class\x3d'noSub_finishTime_" + p + "' name\x3d'FR.FINISH_TIME'\x3e\x3cdiv\x3e" + l + "\x3c/div\x3e\x3c/td\x3e");
                                    x.append("\x3ctd class\x3d'noSub_status_" + p + "' name\x3d'FR.FINISH_TIME'\x3e\x3cdiv\x3e" + C + "\x3c/div\x3e\x3c/td\x3e");
                                    for (var A = 0; A < e.length; A++) {
                                        var E = e[A],
                                        H = E.id,
                                        I = E.componentKey,
                                        J = "";
                                        D && (J = D["C_" + H] || "");
                                        var N = "noSub_" + p + "_" + H;
                                        E.subForm && (N = "");
                                        E = "";
                                        if ("Money" == I || "NumberComponent" == I) E = "ta-r";
                                        var I = p + "_" + (m + 1) + "_" + H,
                                        L = !0;
                                        try {
                                            var M = JSON.parse(J.replace(/\s+/g, ""));
                                            ocount = "";
                                            if (0 < M.length && null != M[0].optionId) {
                                                for (var O = 0; O < M.length; O++) option = M[O],
                                                "image" == option.type || "imageFile" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.optionId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", L = !1) : option.targeId && 0 < option.targeId.length ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.targeId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", L = !1) : "file" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" data-value\x3d"' + option.optionId + '" href\x3d"/base/download/' + option.optionId + '"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", L = !1) : ocount += option.content + ",";
                                                J = ocount.substring(0, ocount.length - 1)
                                            }
                                        } catch(P) {}
                                        L ? x.append("\x3ctd id\x3d'" + I + "' name\x3d'" + H + "' class\x3d'" + N + " " + E + "' title\x3d'" + J + "'\x3e\x3cdiv title\x3d'" + J + "'\x3e" + J + "\x3c/div\x3e\x3c/td\x3e") : x.append("\x3ctd id\x3d'" + I + "' name\x3d'" + H + "' class\x3d'" + N + " " + E + "'\x3e\x3cdiv\x3e" + J + "\x3c/div title\x3d'" + J + "'\x3e\x3c/td\x3e")
                                    }
                                    x.append("\x3ctd class\x3d'fix j_fixcol noSub_fixcol_" + p + "'\x3e\x3c/td\x3e");
                                    c.tableheader.setTableBodyWidth(x);
                                    $(k).find("#stat_table tbody").append(x)
                                }
                            }
                        }
                        c.mergerCells(b, s);
                        c.tableheader.setfixRow(a, b.length, c.fileds.length + c.formFields.length + 2);
                        d.layout(".j_formstatScrY")
                    }
                }
            }))
        },
        mergerCells: function(a, c) {
            var k = this.formFields;
            if (k && a) for (var e = 0; e < a.length; e++) {
                var b = a[e];
                if (c[b.id]) {
                    var d = c[b.id].length,
                    b = b.id;
                    $(this.el).find("#stat_table .noSub_flowCheck_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_flowCheck_" + b + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_flowName_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_flowName_" + b + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_user_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_user_" + b + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_department_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_department_" + b + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_createTime_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_createTime_" + b + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_finishTime_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_finishTime_" + b + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_status_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_status_" + b + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_fixcol_" + b + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_fixcol_" + b + ":gt(0)").remove();
                    for (var f = 0; f < k.length; f++) {
                        var n = k[f];
                        n.subForm || (n = n.id, $(this.el).find("#stat_table .noSub_" + b + "_" + n + ":eq(0)").attr("rowspan", d), $(this.el).find("#stat_table .noSub_" + b + "_" + n + ":gt(0)").remove())
                    }
                }
            }
        },
        againRenderTable: function() {
            $(this.el);
            this.tableheader.remove();
            this.tableheader = null;
            $(this.el).find("#statbody").html($(d.template("form.stat")).find("#statbody").html());
            $(window).resize();
            this.renderListStatByRow(1)
        },
        remove: function() {
            this.formColumnView && this.formColumnView.remove();
            this.tableheader && this.tableheader.remove();
            $(this.el).off(".FormStatView");
            $(this.el).find("#formstat").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/flowstatdatalistview", ["teams/utils", "eteams/biaoge/formstat/formstatmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel"),
    b = [{
        title: "\u5ba1\u6279\u72b6\u6001",
        position: "left",
        name: "FR.FINISH_TIME"
    },
    {
        title: "\u7ed3\u675f\u65f6\u95f4",
        position: "left",
        name: "FR.FINISH_TIME"
    },
    {
        title: "\u63d0\u4ea4\u65f6\u95f4",
        position: "left",
        name: "FR.CREATE_TIME"
    },
    {
        title: "\u63d0\u4ea4\u4eba\u90e8\u95e8",
        position: "left",
        name: "DP.NAME"
    },
    {
        title: "\u63d0\u4ea4\u4eba",
        position: "left",
        name: "FR.CREATOR"
    },
    {
        title: "\u5ba1\u6279\u540d",
        position: "left",
        name: "FR.NAME"
    }];
    g = Backbone.View.extend({
        initialize: function(a) {
            this.el = a.container;
            this.param = a.param;
            this.model = new f;
            this.fileds = b;
            $(this.el).html(d.template("formstat.flowstatdatalist"))
        },
        delegateEvents: function() {
            var a = this;
            $(a.el).off("click.FlowStatDatalistview", "#more_data").on("click.FlowStatDatalistview", "#more_data",
            function(e) {
                e = $(this).data("page");
                a.renderListStatByRow(e.nextPage)
            })
        },
        render: function() {
            this.renderListStatByRow(1)
        },
        renderListStatByRow: function(a) {
            var e = this,
            b = e.el,
            c = $(e.el),
            k = e.param;
            k.pageNo = a;
            1 == a && ($(e.el).find("#statbody").hide(), $(e.el).find("#stat_table tbody").empty());
            $(e.el).find("#list-loading").show();
            $(e.el).find("#more_data").hide();
            e.model.findRowListStatForFlow(k,
            function(k) {
                var q = k.formFields,
                f = k.formDatas,
                t = k.listStats,
                n = k.numberFieldStats,
                g = k.pageDatas,
                u = k.form;
                if (u) if (e.form = u, $(e.el).find("#list-loading").hide(), $(e.el).find("#statbody").show(), 1 == a && e.talbeScrollbar(), k.message) c.find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e' + k.message + "\x3c/div\x3e");
                else if (null == u) c.find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult" style\x3d"color:#e60000;"\x3e\u8868\u5355\u4e0d\u5b58\u5728\x3c/div\x3e');
                else if (null == q || 0 == q.length) c.find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e\u5f53\u524d\u8868\u5355\u6ca1\u6709\u4efb\u4f55\u5b57\u6bb5\uff01\x3c/div\x3e');
                else {
                    if (0 == c.find("#stat_table thead tr th").length) {
                        var p = c.find("#stat_table thead tr"),
                        w = c.find("#stat_table tfoot tr");
                        for (k = 0; k < q.length; k++) {
                            var y = q[k];
                            p.append("\x3cth title\x3d'" + y.title + "'\x3e\x3cdiv\x3e" + y.title + "\x3c/div\x3e\x3c/th\x3e");
                            var z = u = "";
                            if ("Money" == y.componentKey || "NumberComponent" == y.componentKey) u = "ta-r";
                            "Money" == y.componentKey && (z = "Money");
                            w.append("\x3ctd id\x3d'tfoot_" + y.id + "' class\x3d'" + u + "' type\x3d'" + z + "'\x3e\x3c/td\x3e")
                        }
                        for (k = 0; k < e.fileds.length; k++) y = e.fileds[k],
                        "left" === y.position ? (p.prepend("\x3cth title\x3d'" + y.title + "'\x3e\x3cdiv\x3e" + y.title + "\x3c/div\x3e\x3c/th\x3e"), w.prepend("\x3ctd\x3e\x3c/td\x3e")) : (p.append("\x3cth title\x3d'" + y.title + "'\x3e\x3cdiv\x3e" + y.title + "\x3c/div\x3e\x3c/th\x3e"), w.append("\x3ctd\x3e\x3c/td\x3e"))
                    }
                    if (g && g.hasNext) $(e.el + " #more_data").show(),
                    $(e.el + " #more_data").data("page", g);
                    else if ($(e.el + " #more_data").hide(), 1 == a) {
                        if (null == f || 1 > f.length) {
                            $(b).find(".j_form_empty").removeClass("hide");
                            $(b).find("#stat_table tfoot").hide();
                            return
                        }
                        $(b).find(".j_form_empty").addClass("hide");
                        $(b).find("#stat_table tfoot").show()
                    } else 0 < f.length && $(b).find(".j_form_empty").addClass("hide");
                    if (1 == a) if (c.find("#stat_table tfoot td").html(""), n && 0 < n.length) {
                        for (k = 0; k < n.length; k++) u = n[k],
                        g = u.fieldId,
                        u = u.sumVal,
                        "Money" == c.find("#stat_table tfoot #tfoot_" + g).attr("type") && (u = u + " " + e.moneyToChinese(u)),
                        c.find("#stat_table tfoot #tfoot_" + g).html("\u603b\u548c\uff1a" + u).attr("title", "\u603b\u548c\uff1a" + u);
                        c.find("#stat_table tfoot").show()
                    } else c.find("#stat_table tfoot").hide();
                    n = {};
                    if (t) for (k = 0; k < t.length; k++) g = t[k],
                    u = g.FORM_DATA + "_" + g.DATA_INDEX,
                    n[u] = g;
                    for (k = 0; k < f.length; k++) {
                        var t = f[k],
                        p = t.maxIndex || 1,
                        w = t.id,
                        z = t.flowId,
                        K = t.flowName,
                        C = null == t.operator.department ? "\u65e0": t.operator.department.name;
                        if (! (0 < $(b + " stat_table tr #" + w).length)) for (var l = 0; l < p; l++) {
                            var u = w + "_" + (l + 1),
                            G = n[u],
                            m = $("\x3ctr id\x3d" + w + "\x3e\x3c/tr\x3e"),
                            u = Date.create(t.flowCreateTime),
                            g = null == t.flowFinishTime ? "\u5ba1\u6279\u4e2d": "\u5df2\u7ed3\u675f",
                            y = t.flowFinishTime ? Date.create(t.flowFinishTime).format("{yyyy}-{MM}-{dd}") : "";
                            m.append("\x3ctd title\x3d'" + K + "' name\x3d'FR.NAME' class\x3d'noSub_flowName_" + w + "'\x3e\x3cdiv title\x3d'" + K + '\'\x3e\x3ca class\x3d"entitybox-toggle" data-id\x3d"' + z + '" data-module\x3d"workflow" renderType\x3d""\x3e' + K + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e");
                            m.append("\x3ctd class\x3d'noSub_user_" + w + "' name\x3d'FR.CREATOR'\x3e\x3cdiv\x3e\x3ca class\x3d'router usercard-toggle' userid\x3d'" + t.operator.id + "'\x3e" + t.operator.username + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e");
                            m.append("\x3ctd class\x3d'noSub_department_" + w + "' name\x3d'DP.NAME'\x3e\x3cdiv\x3e" + C + "\x3c/div\x3e\x3c/td\x3e");
                            m.append("\x3ctd class\x3d'noSub_createTime_" + w + "' name\x3d'FR.CREATE_TIME'\x3e\x3cdiv\x3e" + u.format("{yyyy}-{MM}-{dd}") + "\x3c/div\x3e\x3c/td\x3e");
                            m.append("\x3ctd class\x3d'noSub_finishTime_" + w + "' name\x3d'FR.FINISH_TIME'\x3e\x3cdiv\x3e" + y + "\x3c/div\x3e\x3c/td\x3e");
                            m.append("\x3ctd class\x3d'noSub_status_" + w + "' name\x3d'FR.FINISH_TIME'\x3e\x3cdiv\x3e" + g + "\x3c/div\x3e\x3c/td\x3e");
                            for (var D = 0; D < q.length; D++) {
                                var y = q[D],
                                g = y.id,
                                x = y.componentKey,
                                A = "";
                                G && (A = G["C_" + g] || "");
                                var E = "noSub_" + w + "_" + g;
                                y.subForm && (E = "");
                                u = "";
                                if ("Money" == x || "NumberComponent" == x) u = "ta-r";
                                y = w + "_" + (l + 1) + "_" + g;
                                x = !0;
                                try {
                                    var H = JSON.parse(A);
                                    ocount = "";
                                    if (0 < H.length && null != H[0].optionId) {
                                        for (var I = 0; I < H.length; I++) option = H[I],
                                        "image" == option.type || "imageFile" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.optionId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", x = !1) : "file" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" data-value\x3d"' + option.optionId + '" href\x3d"/base/download/' + option.optionId + '"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", x = !1) : ocount += option.content + ",";
                                        A = ocount.substring(0, ocount.length - 1)
                                    }
                                } catch(J) {}
                                x ? m.append("\x3ctd id\x3d'" + y + "' name\x3d'" + g + "' class\x3d'" + E + " " + u + "' title\x3d'" + A + "'\x3e\x3cdiv title\x3d'" + A + "'\x3e" + A + "\x3c/div\x3e\x3c/td\x3e") : m.append("\x3ctd id\x3d'" + y + "' name\x3d'" + g + "' class\x3d'" + E + " " + u + "'\x3e\x3cdiv\x3e" + A + "\x3c/div title\x3d'" + A + "'\x3e\x3c/td\x3e")
                            }
                            $(b).find("#stat_table tbody").append(m)
                        }
                    }
                    e.mergerCells(f, q);
                    d.layout(e.el + " #js_customerTable_wrapper")
                }
            })
        },
        renderDataReport: function(a, e, b) {
            for (var c = this.el,
            k = $(this.el), d = TEAMS.currentTenant.tenantKey, q = 0; q < a.length; q++) {
                var f = a[q],
                t = f.maxIndex || 1,
                n = f.id,
                g = Date.create(f.createTime),
                u = f.name ? f.name: "",
                p = "formdatareport" === f.module ? "\u6570\u636e\u4e0a\u62a5": "\u5916\u90e8\u5206\u53d1";
                if (! (0 < $(c + " stat_table tr #" + n).length)) for (var w = 0; w < t; w++) {
                    var y = e[n + "_" + (w + 1)],
                    z = $("\x3ctr id\x3d" + n + "\x3e\x3c/tr\x3e");
                    z.append("\x3ctd class\x3d'noSub_name_" + n + '\'\x3e\x3ca class\x3d"entitybox-toggle" data-id\x3d"' + n + '" formData\x3d"' + n + '" data-module\x3d"formdatareport" renderType\x3d"subordinates"\x3e' + u + "\x3c/a\x3e\x3c/td\x3e");
                    f.operator && f.operator.id && f.tenantKeyTemp && f.tenantKeyTemp.toLowerCase() == d.toLowerCase() ? z.append("\x3ctd class\x3d'noSub_operate_" + n + "'\x3e\x3ca class\x3d'router usercard-toggle' userid\x3d'" + f.operator.id + "'\x3e" + f.operator.username + "\x3c/a\x3e\x3c/td\x3e") : z.append("\x3ctd class\x3d'noSub_operate_" + n + "'\x3e\u6e38\u5ba2\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_time_" + n + "'\x3e" + g.format("{yyyy}-{MM}-{dd}") + "\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_type_" + n + "'\x3e" + p + "\x3c/td\x3e");
                    for (var l = 0; l < b.length; l++) {
                        var C = b[l],
                        F = C.id,
                        m = C.componentKey,
                        B = "";
                        y && (B = y["C_" + F] || "");
                        var D = "noSub_" + n + "_" + F;
                        C.subForm && (D = "");
                        C = "";
                        if ("Money" == m || "NumberComponent" == m) C = "ta-r";
                        F = n + "_" + (w + 1) + "_" + F;
                        m = !0;
                        try {
                            var x = JSON.parse(B.replace(/\s+/g, ""));
                            ocount = "";
                            if (0 < x.length && null != x[0].optionId) {
                                for (var A = 0; A < x.length; A++) option = x[A],
                                "image" == option.type || "imageFile" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" rel\x3d"fancybox_js" href\x3d"/base/download/img/' + option.optionId + '/image" class\x3d"fancybox_js" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", m = !1) : option.targeId && 0 < option.targeId.length ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.targeId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", m = !1) : "file" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" data-value\x3d"' + option.optionId + '" href\x3d"/base/download/' + option.optionId + '"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", m = !1) : ocount += option.content + ",";
                                B = ocount.substring(0, ocount.length - 1)
                            }
                        } catch(E) {}
                        m ? z.append("\x3ctd id\x3d" + F + " class\x3d'" + D + " " + C + "' title\x3d'" + B + "'\x3e" + B + "\x3c/td\x3e") : z.append("\x3ctd id\x3d" + F + " class\x3d'" + D + " " + C + "'\x3e" + B + "\x3c/td\x3e");
                        $("#" + F).find(".fancybox_js").fancybox({
                            closeBtn: !0,
                            nextEffect: "fade",
                            prevEffect: "fade",
                            afterLoad: function() {
                                this.title = "Image " + (this.index + 1) + " of " + this.group.length + (this.title ? " - " + this.title: "")
                            }
                        })
                    }
                    k.find("#stat_table tbody").append(z)
                }
            }
        },
        mergerCells: function(a, e) {
            if (e && a) for (var b = 0; b < a.length; b++) {
                var c = a[b],
                k = c.maxIndex || 1,
                c = c.id;
                $(this.el).find("#stat_table .noSub_flowCheck_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_flowCheck_" + c + ":gt(0)").remove();
                $(this.el).find("#stat_table .noSub_flowName_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_flowName_" + c + ":gt(0)").remove();
                $(this.el).find("#stat_table .noSub_user_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_user_" + c + ":gt(0)").remove();
                $(this.el).find("#stat_table .noSub_department_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_department_" + c + ":gt(0)").remove();
                $(this.el).find("#stat_table .noSub_createTime_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_createTime_" + c + ":gt(0)").remove();
                $(this.el).find("#stat_table .noSub_finishTime_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_finishTime_" + c + ":gt(0)").remove();
                $(this.el).find("#stat_table .noSub_status_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_status_" + c + ":gt(0)").remove();
                $(this.el).find("#stat_table .noSub_fixcol_" + c + ":eq(0)").attr("rowspan", k);
                $(this.el).find("#stat_table .noSub_fixcol_" + c + ":gt(0)").remove();
                for (var d = 0; d < e.length; d++) {
                    var q = e[d];
                    q.subForm || (q = q.id, $(this.el).find("#stat_table .noSub_" + c + "_" + q + ":eq(0)").attr("rowspan", k), $(this.el).find("#stat_table .noSub_" + c + "_" + q + ":gt(0)").remove())
                }
            }
        },
        talbeScrollbar: function() {
            $(this.el).find(".j_formstarScr").mCustomScrollbar({
                axis: "x",
                scrollButtons: {
                    enable: !0
                },
                mouseWheel: "false",
                theme: "darkblue",
                scrollbarPosition: "inside"
            })
        },
        moneyToChinese: function(a) {
            var e = "",
            b = "\u4edf\u4f70\u62fe\u4ebf\u4edf\u4f70\u62fe\u4e07\u4edf\u4f70\u62fe\u5143\u89d2\u5206";
            a += "00";
            var c = a.indexOf(".");
            0 <= c && (a = a.substring(0, c) + a.substr(c + 1, 2));
            b = b.substr(b.length - a.length);
            for (c = 0; c < a.length; c++) e += "\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396".substr(a.substr(c, 1), 1) + b.substr(c, 1);
            return e.replace(/\u96f6\u89d2\u96f6\u5206$/, "").replace(/\u96f6[\u4edf\u4f70\u62fe]/g, "\u96f6").replace(/\u96f6{2,}/g, "\u96f6").replace(/\u96f6([\u4ebf|\u4e07])/g, "$1").replace(/\u96f6+\u5143/, "\u5143").replace(/\u4ebf\u96f6{0,3}\u4e07/, "\u4ebf").replace(/^\u5143/, "\u96f6\u5143")
        },
        remove: function() {}
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatdatareportview", "eteams/biaoge/form/formoperationview eteams/biaoge/formstat/formreportmodel teams/utils eteams/biaoge/formstat/formstatheaderview eteams/biaoge/formstat/flowstatheaderview teams/component/formview".split(" "),
function(g, m, l) {
    var d = g("eteams/biaoge/form/formoperationview"),
    f = g("eteams/biaoge/formstat/formreportmodel"),
    b = g("teams/utils"),
    a = g("eteams/biaoge/formstat/formstatheaderview"),
    e = g("eteams/biaoge/formstat/flowstatheaderview"),
    h = g("teams/component/formview");
    m = Backbone.View.extend({
        initialize: function(a) {
            this.el = a.el;
            this.reportId = a.formId;
            this.module = a.module;
            this.template = "formstat.formstatdatareport";
            this.$tpel = $(b.template(this.template));
            this.$el.html(this.$tpel.siblings(".j_form_stat"));
            this.model = new f({
                formId: this.reportId,
                module: this.module
            });
            this.formView = new h
        },
        delegateEvents: function() {
            var a = this,
            k = $(a.el);
            k.on("click.FormReportView", "#report-create,.js_report_create",
            function() {
                var k = {
                    module: "biaoge_report",
                    "form.report.id": a.reportId,
                    el: "#build-newreport"
                };
                k.tpl = b.template("formstat.formreportnew", {
                    userId: TEAMS.currentUser.id,
                    admin: TEAMS.currentUser.admin
                });
                k.ownership = "company";
                k.saveCallback = function(k) {
                    a.model.queryFormReportsForReport(function(k) {
                        var e = $(b.template(a.template, k)).siblings("#formitems");
                        a.$el.find("#reportstatbody").html("").append(e);
                        a.renderForms(k);
                        $(window).trigger("resize")
                    })
                };
                a.formoperationView = new d(k);
                a.formoperationView.isReportForm = !0;
                a.formoperationView.reportId = a.reportId;
                a.formoperationView.render()
            });
            k.on("click.FormReportView", ".reportedit",
            function() {
                window.open($(this).attr("reporturl"))
            });
            k.on("click.FormReportView", ".reportpreview",
            function() {
                var a = $(this).attr("previewurl");
                window.open(a)
            });
            k.on("click.FormReportView", ".js_formListBox, .nodata",
            function() {
                var e = $(this),
                b = k.find(".form-view_js").data("reportId", a.reportId),
                h = k.find("#formReportContent").height();
                a.formView.render({
                    parentEl: b,
                    formId: e.attr("formId"),
                    callback: function(a) {
                        k.find(".j-chart-title").attr("title", a.form.name).text(a.form.name);
                        1 == b.children().length && b.children().find(".pieview").css("height", h - 150 + "px");
                        0 == b.children().length && b.html("\x3cdiv class\x3d'nodata' style\x3d'height:" + (h - 150) + "px' \x3e\x3cdiv\x3e\x3ci\x3e\x3c/i\x3e\x3cspan\x3e\u6682\u65e0\u56fe\u8868\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e")
                    }
                });
                k.find(".j-chart-detail").removeClass("hide");
                k.find(".js-chart-list").addClass("hide")
            });
            k.on("click.FormReportView", ".j-chart-close",
            function() {
                k.find(".j-chart-detail").addClass("hide");
                k.find(".js-chart-list").removeClass("hide")
            });
            k.on("click.FormReportView", ".j-chart-refresh",
            function() {
                var k = $(this),
                e = {
                    reportId: k.attr("formId")
                };
                a.model.queryReportForm(e,
                function(e) {
                    var b = k.closest(".js_formitemsli");
                    e = e.form;
                    b.find(".text").attr("title", e.describe).text(e.name);
                    b.find(".reportpreview").attr("previewurl", "/form/reportPreview/" + e.id);
                    e.operator.id == TEAMS.currentUser.id ? (b.find(".reportedit").attr("reporturl", "/form/editreport/" + e.id), b.find(".reportdel").attr("formId", e.id)) : (b.find(".reportedit").remove(), b.find(".reportdel").remove());
                    b.find(".j-chart-refresh").attr("formId", e.id);
                    b.find(".js_formListBox,.nodata").attr("formId", e.id);
                    e.chartLayout ? (b.find(".js_formListBox").removeClass("hide").html("\x3cdiv class\x3d'loading_large'\x3e\x3c/div\x3e"), b.find(".nodata").addClass("hide"), a.formView.renderChartComponent(e.chartLayout, b.find(".js_formListBox"), a.reportId)) : (b.find(".js_formListBox").addClass("hide"), b.find(".nodata").removeClass("hide"))
                })
            });
            k.on("click.FormReportView", ".reportdel",
            function() {
                var k = $(this),
                e = k.attr("formId");
                b.confirm("\u786e\u5b9a\u5220\u9664\u5417\uff1f",
                function(h) {
                    h && a.model.deleteForm({
                        formId: e,
                        module: "biaoge_report"
                    },
                    function(a) {
                        b.notify("\u8868\u5355\u5220\u9664\u6210\u529f");
                        k.closest(".js_formitemsli").remove();
                        $(window).trigger("resize")
                    })
                })
            });
            k.on("click.FormReportView", ".j_more",
            function(a) {
                $(this).parent(".j_moreSpan").find(".j_moreContainer").slideToggle(200)
            });
            $("body").on("click.FormReportView",
            function(a) {
                a = $(a.target);
                $(a).hasClass("j_more") || 0 < $(a).parents(".j_more").length || 0 < $(a).parents(".j_moreContainer").length || $(".j_moreContainer").slideUp(200)
            })
        },
        render: function() {
            var a = this,
            k = $(a.el);
            a.model.queryFormReportsForReport(function(e) {
                var h = $(b.template(a.template)).siblings("#formitems");
                k.find("#formlist-loading").remove();
                k.find("#reportstatbody").append(h);
                a.renderForms(e);
                $(window).trigger("resize")
            });
            a.renderHeader();
            b.layout(".j_formReportContentScr");
            $("body").on("click.FormReportView", ".goto-top",
            function(a) {
                b.gotoTop(".j_formReportContentScr")
            })
        },
        renderHeader: function() {
            this.headerView = "workflow" == this.module ? new e({
                formId: this.reportId,
                container: this.el + " .j_form_header",
                type: "flowstatreport"
            }) : new a({
                formId: this.reportId,
                container: this.el + " .j_form_header",
                type: "statreport"
            });
            this.headerView.render()
        },
        renderForms: function(a) {
            var k = a.form,
            e = this;
            if (k && k.permission) {
                this.$el.find(".j_form_name").text(k.name);
                var h = $("#formitems .js-chart-list");
                a.forms && 0 < a.forms.length ? h.find("li:last").removeClass("hide") : (h.find("li:last").addClass("hide"), $(".js_noresult").removeClass("hide"));
                $.each(a.forms,
                function(a, c) {
                    var k = h.find("li:first").clone().show();
                    k.find(".text").attr("title", c.describe).text(c.name);
                    k.find(".reportpreview").attr("previewurl", "/form/reportPreview/" + c.id);
                    k.find(".j-chart-refresh").attr("formId", c.id);
                    k.find(".js_formListBox,.nodata").attr("formId", c.id);
                    c.operator.id == TEAMS.currentUser.id ? (k.find(".reportedit").attr("reporturl", "/form/editreport/" + c.id), k.find(".reportdel").attr("formId", c.id)) : (k.find(".reportedit").remove(), k.find(".reportdel").remove());
                    h.find("li:last").before(k);
                    c.chartLayout ? (k.find(".js_formListBox").removeClass("hide").html("\x3cdiv class\x3d'loading_large'\x3e\x3c/div\x3e"), k.find(".nodata").addClass("hide"), e.formView.renderChartComponent(c.chartLayout, k.find(".js_formListBox"), e.reportId)) : (k.find(".js_formListBox").addClass("hide"), k.find(".nodata").removeClass("hide"))
                })
            } else this.$el.html(b.template("base.nopermission", {
                msg: null
            }))
        },
        remove: function() {
            $(this.el).off(".FormReportView")
        },
        renderChart: function(a) {
            g.async("https://static.eteams.cn/js/echarts.min.js",
            function() {
                var a = view.el.find(".pieview");
                this.pieChart = echarts.init(a.get(0));
                this.pieChart.setOption(option)
            })
        }
    });
    l.exports = m
});
define("eteams/biaoge/formstat/statselectview", ["eteams/biaoge/formstat/statbaseview", "teams/utils", "teams/component/entityslider"],
function(g, m, l) {
    m = g("eteams/biaoge/formstat/statbaseview");
    var d = g("teams/utils"),
    f = "#5CBAE3 #E5CF0D #B6A2DE #8D98B3 #95706D #E4B600 #89B600 #D87A80".split(" "),
    b = g("teams/component/entityslider");
    m = m.extend({
        render: function() {
            this.template = "formstat.statselectview";
            this.renderTableView()
        },
        bindEvents: function() {
            var a = this;
            this.container.on("click.StatSelectView", ".viewitem",
            function() {
                switch ($(this).attr("view-item")) {
                case "baritem":
                    a.showViewByType("bar");
                    a.renderBarChartView();
                    break;
                case "pieitem":
                    a.showViewByType("pie");
                    a.renderPieChartView();
                    break;
                case "tableitem":
                    a.showViewByType("table"),
                    a.renderTableView()
                }
                $(window).trigger("resize")
            });
            this.container.on("click.StatSelectView", ".j_prograssbar",
            function() {
                var e = $(this).closest("tr").data("data");
                a.showChartData(e);
                return ! 1
            })
        },
        renderTableView: function() {
            if (1 !== this.tableview) {
                this.cdata.options = _.sortBy(this.cdata.options, "optionid");
                this.processData();
                this.tpl = d.template(this.template, this.cdata);
                this.container = $(this.tpl);
                this.wrappercontainer.append(this.container);
                var a = this.container.find("#tableview tbody"),
                e = this.cdata;
                $.each(this.cdata.options,
                function() {
                    var b = a.find("tr:first").clone().show();
                    b.find(".j_content").text(this.content);
                    b.find(".j_prograssbar").css({
                        width: this.percentage,
                        "background-color": this.bgcolor
                    }).find(".j_percentage").text(this.percentage);
                    b.find(".j_votes").text(this.votes);
                    b.data("data", {
                        fieldId: e.fieldId,
                        componentKey: e.componentkey,
                        term: "eq",
                        ids: [this.optionid],
                        subFormId: e.subFormId
                    });
                    a.find("tr:last").before(b)
                });
                this.bindEvents();
                this.tableview = 1
            }
        },
        renderBarChartView: function() {
            if (!this.barChart) {
                for (var a = [], e = [], b = this, c, k = this.cdata, d = 0, q = k.options.length; d < q; d++) {
                    var f = k.options[d].content;
                    20 < k.options[d].content.length && (f = k.options[d].content.substring(0, 20) + "...");
                    a.push(f);
                    e.push({
                        value: k.options[d].votes,
                        name: k.options[d].content,
                        fieldId: k.fieldId,
                        componentKey: k.componentkey,
                        term: "eq",
                        ids: [k.options[d].optionid],
                        subFormId: k.subFormId
                    })
                }
                c = {
                    tooltip: {
                        trigger: "axis"
                    },
                    legend: {
                        data: ["\u6b21\u6570"],
                        x: "left"
                    },
                    toolbox: {
                        show: !0,
                        feature: {
                            magicType: {
                                show: !0,
                                type: ["line", "bar"]
                            },
                            restore: {
                                show: !0
                            },
                            saveAsImage: {
                                show: !0
                            }
                        }
                    },
                    calculable: !0,
                    xAxis: [{
                        type: "category",
                        data: a
                    }],
                    yAxis: [{
                        type: "value"
                    }],
                    series: [{
                        name: "\u603b\u6570",
                        type: "bar",
                        data: e,
                        markPoint: {
                            data: [{
                                type: "max",
                                name: "\u6700\u5927\u503c"
                            },
                            {
                                type: "min",
                                name: "\u6700\u5c0f\u503c"
                            }]
                        },
                        markLine: {
                            data: [{
                                type: "average",
                                name: "\u5e73\u5747\u503c"
                            }]
                        }
                    }]
                };
                g.async("https://static.eteams.cn/js/echarts.min.js",
                function() {
                    var a = b.container.find(".barview");
                    this.barChart = echarts.init(a.get(0));
                    this.barChart.setOption(c);
                    a = echarts.config;
                    this.barChart.un(a.EVENT.CLICK).on(a.EVENT.CLICK,
                    function(a) {
                        b.showChartData(a.data)
                    })
                })
            }
        },
        showChartData: function(a) {
            view = this;
            view.entitySlider && view.entitySlider.remove();
            if (a) {
                var e = $.extend(!0, {},
                view.param);
                if (e.formId) {
                    var h = e.filterFormDatas || [];
                    h.push(a);
                    e.filterFormDatas = h;
                    "workflow" == e.module ? (e.type = "flowstatslider", view.entitySlider = new b({
                        module: "flowformstat",
                        param: e
                    })) : view.entitySlider = new b({
                        module: "formstatdata",
                        param: e
                    });
                    view.entitySlider.render()
                }
            }
        },
        renderPieChartView: function() {
            if (!this.pieChart) {
                for (var a = [], e = [], b = this, c, k = this.cdata, d = 0, q = k.options.length; d < q; d++) {
                    var f = k.options[d].content;
                    20 < k.options[d].content.length && (f = k.options[d].content.substring(0, 20) + "...");
                    a.push(f);
                    e.push({
                        value: k.options[d].votes,
                        name: k.options[d].content,
                        fieldId: k.fieldId,
                        componentKey: k.componentkey,
                        term: "eq",
                        ids: [k.options[d].optionid],
                        subFormId: k.subFormId
                    })
                }
                c = {
                    tooltip: {
                        trigger: "item",
                        formatter: "{a} \x3cbr/\x3e{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: "vertical",
                        x: "left",
                        data: a
                    },
                    toolbox: {
                        show: !0,
                        feature: {
                            magicType: {
                                show: !1,
                                type: ["pie"]
                            }
                        }
                    },
                    calculable: !0,
                    series: [{
                        name: "\u6b21\u6570",
                        type: "pie",
                        radius: "55%",
                        center: ["50%", "60%"],
                        data: e
                    }]
                };
                g.async("https://static.eteams.cn/js/echarts.min.js",
                function() {
                    var a = b.container.find(".pieview");
                    this.pieChart = echarts.init(a.get(0));
                    this.pieChart.setOption(c);
                    a = echarts.config;
                    this.pieChart.un(a.EVENT.CLICK).on(a.EVENT.CLICK,
                    function(a) {
                        b.showChartData(a.data)
                    })
                })
            }
        },
        showViewByType: function(a) {
            switch (a) {
            case "bar":
                this.container.find(".barview").show();
                this.container.find(".table").hide();
                this.container.find(".pieview").hide();
                break;
            case "pie":
                this.container.find(".pieview").show();
                this.container.find(".table").hide();
                this.container.find(".barview").hide();
                break;
            case "table":
                this.container.find(".table").show(),
                this.container.find(".barview").hide(),
                this.container.find(".pieview").hide()
            }
        },
        processData: function() {
            for (var a = this.cdata.options,
            e = 0,
            b = "",
            b = 0,
            c = a.length; b < c; b++) e += a[b].votes;
            this.cdata.totalvotes = e;
            b = 0;
            for (c = a.length; b < c; b++) a[b].percentage = (100 * a[b].votes / e).toFixed(2) + "%",
            a[b].bgcolor = f[b % f.length];
            b = "CheckBox" === this.cdata.componentkey ? "\u591a\u9009": "\u5355\u9009";
            "1" === this.cdata.required && (b += "\u5fc5\u586b");
            this.cdata.titletip = "( " + b + " )"
        }
    });
    l.exports = m
});
define("eteams/biaoge/formstat/formstatchartmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function(d) {
            this.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
            this.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}");
            this.statisticians = [TEAMS.currentUser.id];
            this.formId = d.formId;
            this.xAxis = null
        },
        statisticsByDay: function(d) {
            var f = this;
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formdatastat/findFormDataTrendForChart.json",
                dataType: "json",
                data: JSON.stringify({
                    beginDate: f.beginDate,
                    endDate: f.endDate + " 24:00:00",
                    formId: f.formId
                }),
                success: function(b) {
                    if (d) {
                        var a = f.xAxis = f.calculateX();
                        b = f.parseSeries(b.formTrendData);
                        d({
                            xAxis: a,
                            series: b
                        })
                    }
                }
            })
        },
        calculateX: function() {
            var d = [{
                type: "category",
                data: []
            }];
            Date.range(this.beginDate, this.endDate).every("day",
            function(f) {
                d[0].data.push(f.format("{yyyy}-{MM}-{dd}"))
            });
            return d
        },
        parseSeries: function(d) {
            var f = [{
                name: "\u6b21\u6570",
                type: "bar",
                data: []
            }];
            _.isEmpty(d) || (f[0].data = this.parseMapToArray(d));
            return f
        },
        parseMapToArray: function(d) {
            for (var f = Array(this.xAxis[0].data.length), b, a, e = 0, h = d.length; e < h; e++) a = d[e],
            b = this.xAxis[0].data.indexOf(a.ctime),
            f[b] = a.counts;
            return f
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formfieldstatview", ["eteams/biaoge/formstat/formfieldstatmodel", "eteams/biaoge/formstat/statselectview", "eteams/biaoge/formstat/stattextview", "teams/utils", "eteams/biaoge/formstat/taskformmodel"],
function(g, m, l) {
    var d = g("eteams/biaoge/formstat/formfieldstatmodel"),
    f = g("eteams/biaoge/formstat/statselectview"),
    b = g("eteams/biaoge/formstat/stattextview"),
    a = g("teams/utils"),
    e = g("eteams/biaoge/formstat/taskformmodel"),
    h = {};
    m = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.model = new d({
                formId: a.formId
            });
            this.el = a.el;
            this.componentviews = [];
            this.taskFormModel = new e;
            this.$el.html('\x3cdiv id\x3d"formlist-loading" class\x3d"loading_small"\x3e\x3cspan\x3e\u6b63\u5728\u52a0\u8f7d\u6570\u636e\uff0c\u8bf7\u7a0d\u540e...\x3c/span\x3e\x3c/div\x3e');
            this.model.findFormFieldData(this.renderComponents, this)
        },
        delegateEvents: function() {
            var c = $(this.el),
            k = this;
            $("body").on("click.FormFieldStatView", ".goto-top",
            function(c) {
                a.gotoTop("#fieldstatbody")
            });
            c.off("click.FormFieldStatView");
            c.on("click.FormFieldStatView", "#initFieldAdvanceSearch",
            function(a) {
                a = c.find(".j_advanceSearch");
                var k = a.height(),
                b = $("#fieldstatbody").position();
                $(this).data("open") ? ($(this).find("i").attr("class", "icon-angle-down cs-p"), a.slideUp(), $(this).data("open", !1), $("#fieldstatbody").animate({
                    top: b.top - k + "px"
                })) : ($(this).find("i").attr("class", "icon-angle-up cs-p"), a.slideDown(), $(this).data("open", !0), $("#fieldstatbody").animate({
                    top: b.top + k + "px"
                }))
            });
            c.on("click.FormFieldStatView", "#packup",
            function(a) {
                $("#initFieldAdvanceSearch").trigger("click")
            });
            c.on("click.FormFieldStatView", "input:checkbox",
            function(a) {
                a = $(this);
                var c = a.attr("data-field"),
                c = k.findComponentViewByFieldId(c);
                a.prop("checked") ? c.showView() : c.hideView()
            });
            c.on("change.FormFieldStatView", ".j_tasktype_stat",
            function() {
                var c = $(this).val();
                c ? c != k.formId && (k.formId = c, k.model && (k.model = null), k.model = new d({
                    formId: c
                }), k.model.findFormFieldData(k.renderComponents, k)) : a.notify("\u8be5\u7c7b\u578b\u5c1a\u672a\u8bbe\u7f6e\u8868\u5355\uff01")
            })
        },
        renderComponents: function(c) {
            var k = this,
            b = c.formFieldStat;
            this.$el.html(a.template("formstat.formfieldstat"));
            k.taskFormModel.loadTaskType({
                hasForm: !0
            },
            function(a) {
                $(k.el).find(".j_tasktype_stat").empty();
                a.taskFormLinks && a.taskFormLinks.length && ($(k.el).find(".j_tasktype_stat").closest("li").removeClass("hide"), _.each(a.taskFormLinks,
                function(a) {
                    var c = a.form && a.form.id,
                    b = $("\x3coption /\x3e");
                    a = a.name;
                    c ? k.formId == c && b.attr("selected", !0) : (a += "\uff08\u65e0\u8868\u5355\uff09", b.addClass("option-line"));
                    b.val(c).text(a).appendTo(k.el + " .j_tasktype_stat")
                }))
            });
            $.each(c.formFieldStat,
            function() {
                var a = $(".j_advanceSearch .j_searchfields li:first").clone().show();
                a.find("input").attr("data-field", this.fieldId);
                a.find("span").text(this.title).attr("title", this.title);
                $(".j_advanceSearch .j_searchfields").append(a)
            });
            0 < c.statNumberDatas.length ? k.renderNumberBarChartView(c.statNumberDatas) : k.$el.find("#numberchartstat").remove();
            k.renderNumDataTrendChartView(c.numberFieldTrendDatas);
            this.$el.find(".j_advanceSearch").hide();
            if (b && 0 != b.length) for (var e = 0,
            d = b.length; e < d; e++) b[e].number = e + 1,
            c = this.getComponentView(b[e]),
            c.render(),
            this.componentviews.push(c),
            h[b[e].fieldId] = c;
            else k.$el.find(".j_form_empty").removeClass("hide"),
            k.$el.find("#initFieldAdvanceSearch").addClass("hide");
            a.layout("#fieldstatbody");
            a.layout(".j_advanceSearchScr")
        },
        getComponentView: function(a) {
            var k = a.componentkey,
            e = this.$el.find("#fieldstatbody .js_formfield");
            return 0 <= _.indexOf(["CheckBox", "RadioBox", "Select"], k) ? new f(a, e) : new b(a, e)
        },
        findComponentViewByFieldId: function(a) {
            return h[a]
        },
        renderNumberBarChartView: function(a) {
            for (var k = [], b = [], e = this, h, d = 0, f = a.length; d < f; d++) k.push(a[d].title),
            b.push(a[d].content);
            h = {
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data: ["\u6570\u5b57\u603b\u548c\u7edf\u8ba1"],
                    x: "left"
                },
                toolbox: {
                    show: !0,
                    feature: {
                        magicType: {
                            show: !0,
                            type: ["line", "bar"]
                        },
                        restore: {
                            show: !0
                        },
                        saveAsImage: {
                            show: !0
                        }
                    }
                },
                calculable: !0,
                xAxis: [{
                    type: "category",
                    data: k
                }],
                yAxis: [{
                    type: "value"
                }],
                series: [{
                    name: "\u603b\u6570",
                    type: "bar",
                    data: b,
                    itemStyle: {
                        normal: {
                            label: {
                                show: !0,
                                textStyle: {
                                    color: "#333",
                                    fontWeight: "bold",
                                    fontSize: 14
                                }
                            }
                        }
                    },
                    markLine: {
                        data: [{
                            type: "average",
                            name: "\u5e73\u5747\u503c"
                        }]
                    }
                }]
            };
            g.async("https://static.eteams.cn/js/echarts.min.js",
            function() {
                var a = e.$el.find("#numberchartstat"),
                a = echarts.init(a.get(0));
                $(window).on("resize", a.resize);
                a.setOption(h)
            })
        },
        renderNumDataTrendChartView: function(a) {
            var k = a.category.dates,
            b = [],
            e,
            h = this;
            delete a.category;
            for (var d in a) e = {
                type: "bar"
            },
            e.name = a[d].seriename,
            e.data = a[d].datas,
            b.push(e);
            0 === b.length ? h.$el.find("#numdatatrendstat").remove() : (option = {
                title: {
                    text: "",
                    x: "center"
                },
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data: ["\u6570\u5b57\u65e5\u671f\u8d8b\u52bf"],
                    x: "left"
                },
                toolbox: {
                    show: !0,
                    feature: {
                        magicType: {
                            show: !0,
                            type: ["line", "bar"]
                        },
                        restore: {
                            show: !0
                        },
                        saveAsImage: {
                            show: !0
                        }
                    }
                },
                calculable: !0,
                xAxis: [{
                    type: "category",
                    data: k
                }],
                yAxis: [{
                    type: "value"
                }],
                series: b
            },
            g.async("https://static.eteams.cn/js/echarts.min.js",
            function() {
                var a = h.$el.find("#numdatatrendstat"),
                a = echarts.init(a.get(0));
                $(window).on("resize", a.resize);
                a.setOption(option)
            }))
        }
    });
    l.exports = m
});
define("eteams/biaoge/formstat/flowstatheaderview", "teams/utils eteams/biaoge/formstat/formstatmodel eteams/biaoge/formstat/formcolumnview eteams/biaoge/formstat/formstatsearchview eteams/biaoge/form/formoperationview eteams/biaoge/formmanage/formincollectlogview eteams/biaoge/formstat/formcollectchartview eteams/biaoge/form/formreportconfigview eteams/biaoge/form/formauthconfigview eteams/biaoge/form/formcontinuewriteview eteams/biaoge/formstat/formstatlistview eteams/biaoge/form/formtagview teams/base/importdataview".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel"),
    b = g("eteams/biaoge/formstat/formcolumnview"),
    a = g("eteams/biaoge/formstat/formstatsearchview");
    g("eteams/biaoge/form/formoperationview");
    g("eteams/biaoge/formmanage/formincollectlogview");
    g("eteams/biaoge/formstat/formcollectchartview");
    g("eteams/biaoge/form/formreportconfigview");
    g("eteams/biaoge/form/formauthconfigview");
    g("eteams/biaoge/form/formcontinuewriteview");
    g("eteams/biaoge/formstat/formstatlistview");
    g("eteams/biaoge/form/formtagview");
    g("teams/base/importdataview");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.el = a.container;
            this.type = a.type;
            this.model = new f;
            this.userId = TEAMS.currentUser.id;
            this.isAdmin = TEAMS.currentUser.admin;
            $(this.el).html(d.template("formstat.flowstatheader"));
            this.isAdmin || $(this.el + " #delete_formdata").remove()
        },
        delegateEvents: function() {
            var e = this,
            h = $(e.el),
            c = e.model;
            h.on("click.FormStatDataTableView", "#export_formdata",
            function(a) {
                var c = $(this);
                if (0 != $(this).data("isClick")) {
                    c.data("isClick", !1);
                    var b = {};
                    e.searchView && (b = e.searchView.assembleParam());
                    b.formId = e.formId;
                    e.model.exportParam(b,
                    function(a) {
                        $.ajax({
                            type: "POST",
                            data: b,
                            dataType: "json",
                            url: "/export/checkExportFlowNum.json",
                            success: function(a) {
                                if (a.actionMsg && a.actionMsg.message) d.notify(a.actionMsg.message);
                                else {
                                    d.notify("\u6b63\u5728\u751f\u6210\u6587\u4ef6\uff0c\u8bf7\u7a0d\u540e...", "\u5ba1\u6279\u5bfc\u51fa", "info", !1);
                                    var k = window.setInterval(function() {
                                        $.ajax({
                                            type: "get",
                                            url: "/export/findExportRate.json",
                                            dataType: "json",
                                            success: function(a) {
                                                $("div.ui-pnotify-text").html("\u6b63\u5728\u751f\u6210\u6587\u4ef6\uff0c\u8bf7\u7a0d\u540e... (" + a.actionMsg.message + ")");
                                                "100%" == a.actionMsg.message && (clearInterval(k), d.notify("\u5bfc\u51fa\u5b8c\u6210\uff01", "\u5ba1\u6279\u5bfc\u51fa", "info"))
                                            }
                                        })
                                    },
                                    1E3);
                                    window.location.href = "/export/exportWorkFlow.json?_t\x3d" + (new Date).getTime()
                                }
                                c.data("isClick", !0)
                            }
                        })
                    })
                }
            });
            h.on("click.FlowStatHeaderView", "#columnField",
            function(a) {
                $("body").append("\x3cdiv id\x3d'setupColumnField'\x3e\x3c/div\x3e");
                e.formColumnView = new b({
                    formId: e.formId,
                    container: "body #setupColumnField",
                    parentObj: e
                });
                e.formColumnView.render()
            });
            h.on("click.FlowStatHeaderView", "#initAdvanceSearch",
            function(k) {
                k = $(this);
                k.data("open") ? (k.find("i").attr("class", "icon-angle-down cs-p"), h.find(".j_advanceSearch").hide(), k.data("open", !1)) : ($(this).find("i").attr("class", "icon-angle-up cs-p"), null != h.find(".j_advanceSearch .j_formstat-search").get(0) ? h.find(".j_advanceSearch").show() : (e.searchView && e.searchView.remove(), c.findAdvSearchField({
                    formId: e.formId
                },
                function(c) {
                    e.searchView = new a({
                        formId: e.formId,
                        el: e.el + " .j_advanceSearch",
                        formFields: c.formFields,
                        parentObj: e
                    });
                    e.searchView.render();
                    "formstat" != e.type && $(".j_filterSub").remove();
                    h.find(".j_advanceSearch").show()
                })), k.data("open", !0));
                $(window).resize()
            });
            h.on("CLOSE.FlowStatHeaderView", "#initAdvanceSearch",
            function(a) {
                h.find(".j_advanceSearch").hide();
                h.find("#initAdvanceSearch").data("open", !1);
                h.find("#initAdvanceSearch i").attr("class", "icon-angle-down cs-p");
                $(window).resize()
            });
            h.on("click.FormStatDataTableView", ".j_form_keyword",
            function() {
                e.isKeyword = !0;
                $("body").trigger("confirmSearch")
            });
            h.on("keyup.FormStatDataTableView", ".j_keyword_input",
            function(a) {
                e.isKeyword = !0;
                13 == a.keyCode && $("body").trigger("confirmSearch")
            })
        },
        render: function() {
            var a = this;
            $(a.el);
            a.renderMenu();
            a.model.findStatFormDetail({
                formId: a.formId
            },
            function(b) {
                b = a.form = b.form;
                $(a.el).find(".j_form_name").text(b.name).attr("title", b.name)
            });
            a.renderFormRouter()
        },
        renderMenu: function() {
            var a = this.type,
            b = $(this.el);
            "flowstatchart" === a && (b.find("#columnField").parent().remove(), b.find("#export_formdata").parent().remove(), b.find("#delete_formdata").parent().remove());
            "flowstatreport" === a && (b.find("#columnField").parent().remove(), b.find("#export_formdata").parent().remove(), b.find("#delete_formdata").parent().remove(), b.find("#initAdvanceSearch").parent().remove())
        },
        getParam: function() {
            var a = {},
            b = "";
            0 < $(this.el).find(".j_keyword_input").length && (b = $(this.el).find(".j_keyword_input").val().trim());
            this.isKeyword && b ? a.names = [{
                content: b,
                term: "like"
            }] : this.searchView && (a = this.searchView.assembleParam());
            a.formId = this.formId;
            a.module = "workflow";
            return a
        },
        getFormDataQueryParam: function() {
            var a = {},
            b = "";
            0 < $(this.el).find(".j_keyword_input").length && (b = $(this.el).find(".j_keyword_input").val().trim());
            this.isKeyword && b ? a.names = [{
                content: b,
                term: "like"
            }] : this.searchView && (a = this.searchView.assembleFormDataQueryParam());
            return a
        },
        renderFormRouter: function() {
            var a = this;
            $(a.el).find(".j_flow_router li").each(function() {
                var b = $(this),
                c = b.attr("type");
                b.attr("href", "/workflows/" + TEAMS.currentUser.id + "/" + c + "/" + a.formId);
                c == a.type && b.addClass("active")
            })
        },
        remove: function() {
            this.formColumnView && (this.formColumnView.remove(), this.formColumnView = null);
            this.formOperationView && (this.formOperationView.remove(), this.formOperationView = null);
            this.formStatListView && (this.formStatListView.remove(), this.formStatListView = null);
            $(this.el).off(".FlowStatHeaderView")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/taskformmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function() {
            this.pageSize = 10
        },
        loadTaskType: function(d, f) {
            var b = {};
            _.each(d,
            function(a, e) {
                b["filter." + e] = a
            });
            $.ajax({
                type: "get",
                dataType: "json",
                url: "/task-form.json",
                data: b,
                success: function(a) {
                    f && f(a)
                }
            })
        },
        addTaskType: function(d, f) {
            $.ajax({
                type: "post",
                dataType: "json",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/task-form.json",
                data: JSON.stringify({
                    taskFormLink: d
                }),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        delTaskType: function(d, f) {
            $.ajax({
                type: "post",
                dataType: "json",
                url: "/task-form/" + d.id + ".json",
                data: {
                    _method: "delete"
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        updateTaskType: function(d, f) {
            var b = {
                _method: "put"
            };
            _.each(d,
            function(a, e) {
                b["taskFormLink." + e] = a
            });
            $.ajax({
                type: "post",
                dataType: "json",
                url: "/task-form/" + d.id + ".json",
                data: b,
                success: function(a) {
                    f && f(a)
                }
            })
        },
        getTaskForm: function(d, f, b) {
            $.ajax({
                type: "post",
                dataType: "json",
                async: !b,
                contentType: "application/json;charset\x3dUTF-8",
                url: "/task-form/loadTaskForm.json",
                data: JSON.stringify(d),
                success: function(a) {
                    f && f(a)
                }
            })
        },
        saveFormData: function(d, f) {
            $.ajax({
                type: "post",
                dataType: "json",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/task-form/saveFormData.json",
                data: JSON.stringify({
                    formData: d
                }),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        sort: function(d, f) {
            $.ajax({
                type: "post",
                dataType: "json",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/task-form/sort.json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formcolumnview", ["teams/utils", "eteams/biaoge/formstat/formstatmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel");
    g = Backbone.View.extend({
        teams: {},
        initialize: function(b) {
            this.formId = b.formId;
            this.el = b.container ? b.container: "#setupColumnField";
            this.isAdmin = TEAMS.currentUser.admin;
            this.parentObj = b.parentObj;
            $(this.el).html(d.template("form.column"));
            this.isAdmin || $(this.el).find("#saveDefaultColumn").remove();
            this.model = new f;
            $(this.el).find("#formcolumn").modal()
        },
        delegateEvents: function() {
            var b = this,
            a = $(b.el);
            a.on("hidden.bs.modal",
            function(a) {
                b.remove()
            });
            a.on("click.FormColumnView", "#saveColumn,#saveDefaultColumn",
            function() {
                $(this).data("isClick") || ($(this).data("isClick", !0), b.saveColumn($(this)))
            });
            a.on("click.FormColumnView", "#columnFileds .j_column",
            function() {
                b.selectAllStatus()
            });
            a.on("click.FormColumnView", "#selectAll",
            function() {
                var b = $(this).is(":checked");
                a.find(".j_column").prop("checked", b)
            })
        },
        render: function() {
            var b = this,
            a = b.el;
            b.model.findColumnField({
                formId: b.formId
            },
            function(e) {
                e = e.formFields;
                if (null != e && 0 != e.length) {
                    for (var h = !1,
                    c = 0; c < e.length; c++) {
                        var k = e[c];
                        if (k && k.formColumn) {
                            h = !0;
                            break
                        }
                    }
                    for (c = 0; c < e.length; c++) {
                        var k = e[c],
                        s = k.formColumn,
                        f = k["delete"],
                        g = $(a).find("#columnFiledsClone li").clone(),
                        t = g.find(".j_column"),
                        n = g.find(".j_filedName"),
                        v = g.find(".j_bewrite");
                        t.data("formField", k);
                        n.html(k.title);
                        f && (n.addClass("td-lt c-999"), v.html("\u8be5\u5b57\u6bb5\u4e3a\u5220\u9664\u5b57\u6bb5,\u4e0d\u5728\u5f53\u524d\u8868\u5355\u7248\u672c\u4e2d\uff01"));
                        0 == h ? 0 == f && (t.attr("checked", !0), t.get(0).checked = !0) : s && (t.attr("id", s.id), s.apply && (t.attr("checked", !0), t.get(0).checked = !0));
                        $(a).find("#columnFileds").append(g)
                    }
                    $(a).find("#formcolumn #columnFileds").sortable({
                        stop: function(a, c) {
                            b.renderSort()
                        }
                    });
                    d.layout(a + " #formcolumn .modal-body");
                    b.renderSort();
                    b.selectAllStatus()
                }
            })
        },
        renderSort: function() {
            $(this.el).find("#columnFileds li").each(function() {
                var b = $(this);
                b.find(".j_sort").html(b.index() + 1)
            })
        },
        saveColumn: function(b) {
            var a = this,
            e = a.el,
            h = a.formId,
            c = [],
            k = !1;
            "istmp" == b.attr("istmp") && a.isAdmin && (k = !0);
            $(e).find("#formcolumn #columnFileds li").each(function(a) {
                var b = $(this);
                a = b.index() + 1;
                var e = b.find(".j_column").is(":checked"),
                b = b.find(".j_column").data("formField");
                c.push({
                    form: {
                        id: h
                    },
                    formField: b,
                    sort: a,
                    apply: e,
                    isDefault: k
                })
            });
            a.model.saveFormColumns({
                formId: h,
                columns: c
            },
            function(c) {
                c.actionMsg ? d.notify(c.actionMsg.message) : (d.notify("\u4fdd\u5b58\u6210\u529f\uff01"), b.data("isClick", !1), "function" == typeof a.parentObj.againRenderTable ? a.parentObj.againRenderTable() : $("body").trigger("confirmRenderTable"))
            })
        },
        selectAllStatus: function() {
            var b = $(this.el);
            b.find("#selectAll").prop("checked", !0);
            b.find("#columnFileds .j_column").each(function() {
                0 == $(this).is(":checked") && b.find("#selectAll").prop("checked", !1)
            })
        },
        remove: function() {
            $(".modal-backdrop.fade.in").remove();
            $(this.el).off(".FormColumnView");
            $(this.el).remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formcollectchartview", ["teams/utils", "teams/component/typeahead", "eteams/biaoge/formstat/formcollectchartmodel"],
function(g, m, l) {
    var d = g("teams/utils");
    g("teams/component/typeahead");
    var f = g("eteams/biaoge/formstat/formcollectchartmodel");
    m = Backbone.View.extend({
        initialize: function(b) {
            this.model = new f({
                formId: b.formId
            });
            this.el = "#formcollectchartview";
            $("body").append(d.template("formstat.formcollectchart"));
            this.initComponents()
        },
        initComponents: function() {
            var b = this,
            a = b.model,
            e = $(b.el);
            d.datepicker([{
                el: "#begin-date",
                callback: function(e) {
                    var c = e.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(c, a.endDate) ? a.beginDate = c || a.beginDate: e.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            },
            {
                el: "#end-date",
                callback: function(e) {
                    var c = e.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(a.beginDate, c) ? a.endDate = c || a.endDate: e.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            }]);
            e.find("#begin-date").val(a.beginDate);
            e.find("#end-date").val(a.endDate);
            e.find('[data\x3d"thisMonth"]').addClass("btn-success")
        },
        isBefore: function(b, a) {
            if (b && a) {
                if (Date.create(b).isBefore(a, 864E5)) return ! 0;
                d.notify("\u8bf7\u786e\u8ba4\u8f93\u5165\u7684\u8d77\u59cb\u65e5\u5728\u5230\u671f\u65e5\u4e4b\u524d");
                return ! 1
            }
            return ! 0
        },
        delegateEvents: function() {
            var b = this,
            a = b.model,
            e = $(b.el);
            e.on("hidden.bs.modal.FormCollectChart",
            function(a) {
                b.remove()
            });
            $("body").on("click.FormCollectChart", ".goto-top",
            function(a) {
                d.gotoTop(".js_taskreportScr")
            });
            e.on("click.FormCollectChart", ".j_time a",
            function(h) {
                h = $(h.target);
                switch (h.attr("data")) {
                case "thisWeek":
                    a.beginDate = Date.create().beginningOfWeek().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "last2weeks":
                    a.beginDate = Date.create().beginningOfWeek().addDays( - 7).format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "thisMonth":
                    a.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}");
                    break;
                case "lastMonth":
                    a.beginDate = Date.create().addMonths( - 1).beginningOfMonth().format("{yyyy}-{MM}-{dd}"),
                    a.endDate = Date.create().addMonths( - 1).endOfMonth().format("{yyyy}-{MM}-{dd}")
                }
                e.find("#begin-date").val(a.beginDate);
                e.find("#end-date").val(a.endDate);
                e.find(".j_time .btn").removeClass("btn-success");
                h.addClass("btn-success");
                b.loadDayChart();
                a.pageNo = 1;
                b.search()
            });
            e.on("click.FormCollectChart", "#load",
            function() {
                e.find(".j_time .btn").removeClass("btn-success");
                b.loadDayChart();
                a.pageNo = 1;
                b.search()
            });
            e.find(".page-first").click(function() {
                $(this).hasClass("disabled") || (a.pageNo = 1, b.search())
            });
            e.find(".page-pre").click(function() {
                $(this).hasClass("disabled") || (--a.pageNo, b.search())
            });
            e.find(".page-next").click(function() {
                $(this).hasClass("disabled") || (++a.pageNo, b.search())
            })
        },
        remove: function() {
            $(this.el).off(".FormCollectChart");
            this.dayChart && ($(window).off("resize", this.dayChart.resize), this.dayChart.dispose(), this.dayChart = null);
            this.finishChart && ($(window).off("resize", this.finishChart.resize), this.finishChart.dispose(), this.finishChart = null);
            this.urgencyChart && ($(window).off("resize", this.urgencyChart.resize), this.urgencyChart.dispose(), this.urgencyChart = null);
            this.stopListening();
            this.model = null;
            $("#formcollectchartview").remove()
        },
        render: function(b, a) {
            var e = this;
            $("#formcollectchartview").modal("show");
            d.layout(".js_taskreportScr");
            $("#formcollectchartview").on("shown.bs.modal",
            function() {
                g.async("https://static.eteams.cn/js/echarts.min.js",
                function() {
                    e.initCharts();
                    e.loadDayChart()
                });
                e.search()
            })
        },
        search: function() {
            $("#formlist-loading").removeClass("hide");
            var b = this,
            a = b.model;
            $(b.el);
            var e = "";
            "" != a.beginDate && (e += " and F.create_Time \x3e '" + a.beginDate + "'");
            "" != a.endDate && (e += " and F.create_Time \x3c '" + a.endDate + " 24:00:00'");
            a.search({
                pageNo: a.pageNo,
                pageSize: a.pageSize,
                "form.id": a.formId,
                sortType: "F.CREATE_TIME DESC",
                searchFilter: e
            },
            function(a) {
                $("#formlist-loading").addClass("hide");
                var c = $("#formlog-table tbody");
                $("#formlog-table tbody tr").not(":first").detach();
                $.each(a.formDataPage.result,
                function(a) {
                    var b = $("#formlog-table tbody tr:first").clone().show();
                    b.find("#index").text(a + 1);
                    b.find("#createTime").text((new Date(this.createTime)).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
                    b.find("#spentTime").text(this.spentTime);
                    b.find("#ip").text(this.ip);
                    a = this.client;
                    "undefined" != typeof this.version && (a += " - " + this.version);
                    b.find("#source").text(a);
                    a = "/form/previewFill/" + this.id;
                    b.find("#query a").attr("href", a);
                    b.appendTo(c)
                });
                b.loadPage(a.formDataPage)
            })
        },
        loadPage: function(b) {
            var a = this,
            e = $(a.el),
            h = a.model;
            0 >= b.totalCount ? ($(a.el).find(".page-last").unbind("click"), $(a.el).find(".page-buttons").addClass("disabled"), $(a.el).find(".pagination").find(".active a").html("\u65e0\u8bb0\u5f55")) : ($(a.el).find(".pagination").find(".active a").html("\u7b2c" + b.pageNo + "/" + b.totalPages + "\u9875"), 1 == b.totalPages ? $(a.el).find(".page-buttons").addClass("disabled") : ($(a.el).find(".page-last").click(function() {
                $(this).hasClass("disabled") || (h.pageNo = b.totalPages, a.search())
            }), 1 == b.pageNo && ($(a.el).find(".page-next").removeClass("disabled"), $(a.el).find(".page-last").removeClass("disabled"), $(a.el).find(".page-first").addClass("disabled"), $(a.el).find(".page-pre").addClass("disabled")), b.pageNo == b.totalPages && ($(a.el).find(".page-first").removeClass("disabled"), $(a.el).find(".page-pre").removeClass("disabled"), $(a.el).find(".page-next").addClass("disabled"), $(a.el).find(".page-last").addClass("disabled")), 1 != b.pageNo && b.pageNo != b.totalPages && ($(a.el).find(".page-first").removeClass("disabled"), $(a.el).find(".page-pre").removeClass("disabled"), $(a.el).find(".page-next").removeClass("disabled"), $(a.el).find(".page-last").removeClass("disabled")), e.find(".pagination-centered").removeClass("hide")))
        },
        dayChartBasicOption: {
            title: {
                text: "\u6570\u636e\u91c7\u96c6\u7edf\u8ba1"
            },
            tooltip: {
                trigger: "item"
            },
            legend: {
                data: [""]
            },
            calculable: !0,
            toolbox: {
                show: !0,
                feature: {
                    magicType: {
                        show: !0,
                        type: ["bar", "line"]
                    },
                    restore: {
                        show: !0
                    },
                    saveAsImage: {
                        show: !0
                    }
                }
            },
            dataZoom: {
                show: !0,
                start: 5,
                end: 95
            },
            yAxis: [{
                type: "value"
            }],
            color: ["#3AEC94"]
        },
        dayChart: null,
        initCharts: function() {
            var b;
            b = this.dayChart = echarts.init(document.getElementById("day-chart"), "macarons");
            $(window).on("resize", b.resize)
        },
        loadDayChart: function() {
            var b = this;
            if (b.dayChart) {
                var a = b.dayChart;
                b.dayChart.un(echarts.config.EVENT.CLICK).on(echarts.config.EVENT.CLICK,
                function(a) {
                    a = Date.create(a.name).format("{yyyy}-{MM}-{dd}");
                    b.model.beginDate = a;
                    b.model.endDate = a;
                    b.model.pageNo = 1;
                    b.search()
                });
                a.showLoading({
                    effect: "spin"
                });
                b.model.statisticsByDay(function(e) {
                    a.hideLoading();
                    e = _.extend(e, b.dayChartBasicOption);
                    a.setOption(e, !0)
                })
            } else d.alert("\u672a\u627e\u5230\u56fe\u8868\u7ec4\u4ef6\uff0c\u8bf7\u786e\u8ba4\u9875\u9762\u52a0\u8f7d\u6b63\u786e")
        }
    });
    l.exports = m
});
define("eteams/biaoge/formstat/formstatdatalistview", ["teams/utils", "eteams/biaoge/formstat/formstatmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel"),
    b = [{
        title: "\u7c7b\u578b",
        position: "left"
    },
    {
        title: "\u63d0\u4ea4\u65f6\u95f4",
        position: "left"
    },
    {
        title: "\u63d0\u4ea4\u4eba",
        position: "left"
    },
    {
        title: "\u4e0a\u62a5\u540d\u79f0",
        position: "left"
    }];
    g = Backbone.View.extend({
        initialize: function(a) {
            this.el = a.container;
            this.param = a.param;
            this.model = new f;
            this.fileds = b;
            $(this.el).html(d.template("formstat.formstatdatalist"))
        },
        delegateEvents: function() {
            var a = this;
            $(a.el).off("click.FlowStatDatalistview", "#more_data").on("click.FlowStatDatalistview", "#more_data",
            function(b) {
                b = $(this).data("page");
                a.renderListStatByRow(b.nextPage)
            })
        },
        render: function() {
            this.renderListStatByRow(1)
        },
        renderListStatByRow: function(a) {
            var b = this,
            h = $(b.el),
            c = b.param;
            c.pageNo = a;
            1 == a && ($(b.el).find("#statbody").hide(), $(b.el).find("#stat_table tbody").empty());
            $(b.el).find("#list-loading").show();
            $(b.el).find("#more_data").hide();
            b.model.findRowListStatForReport(c,
            function(c) {
                var s = c.formFields,
                f = c.formDatas,
                g = c.listStats,
                t = c.numberFieldStats,
                n = c.pageDatas,
                v = c.form;
                if (v) if (b.form = v, $(b.el).find("#list-loading").hide(), $(b.el).find("#statbody").show(), 1 == a && b.talbeScrollbar(), v.permission) if (c.message) h.find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e' + c.message + "\x3c/div\x3e");
                else if (null == v) h.find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult" style\x3d"color:#e60000;"\x3e\u8868\u5355\u4e0d\u5b58\u5728\x3c/div\x3e');
                else if (null == s || 0 == s.length) h.find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e\u5f53\u524d\u8868\u5355\u6ca1\u6709\u4efb\u4f55\u5b57\u6bb5\uff01\x3c/div\x3e');
                else {
                    if (0 == h.find("#stat_table thead tr th").length) {
                        var v = h.find("#stat_table thead tr"),
                        u = h.find("#stat_table tfoot tr");
                        for (c = 0; c < s.length; c++) {
                            var p = s[c];
                            v.append("\x3cth title\x3d'" + p.title + "'\x3e\x3cdiv\x3e" + p.title + "\x3c/div\x3e\x3c/th\x3e");
                            var w = "",
                            y = "";
                            if ("Money" == p.componentKey || "NumberComponent" == p.componentKey) w = "ta-r";
                            "Money" == p.componentKey && (y = "Money");
                            u.append("\x3ctd id\x3d'tfoot_" + p.id + "' class\x3d'" + w + "' type\x3d'" + y + "'\x3e\x3c/td\x3e")
                        }
                        for (c = 0; c < b.fileds.length; c++) p = b.fileds[c],
                        "left" === p.position ? (v.prepend("\x3cth title\x3d'" + p.title + "'\x3e\x3cdiv\x3e" + p.title + "\x3c/div\x3e\x3c/th\x3e"), u.prepend("\x3ctd\x3e\x3c/td\x3e")) : (v.append("\x3cth title\x3d'" + p.title + "'\x3e\x3cdiv\x3e" + p.title + "\x3c/div\x3e\x3c/th\x3e"), u.append("\x3ctd\x3e\x3c/td\x3e"))
                    }
                    if (n && n.hasNext) $(b.el + " #more_data").show(),
                    $(b.el + " #more_data").data("page", n);
                    else if ($(b.el + " #more_data").hide(), 1 == a) {
                        if (null == f || 1 > f.length) {
                            h.find(".j_form_empty").removeClass("hide");
                            h.find("#stat_table tfoot").hide();
                            return
                        }
                        h.find(".j_form_empty").addClass("hide");
                        h.find("#stat_table tfoot").show()
                    } else 0 < f.length && h.find(".j_form_empty").addClass("hide");
                    if (1 == a) if (h.find("#stat_table tfoot td").html(""), t && 0 < t.length) {
                        for (c = 0; c < t.length; c++) v = t[c],
                        n = v.fieldId,
                        v = v.sumVal,
                        "Money" == h.find("#stat_table tfoot #tfoot_" + n).attr("type") && (v = v + " " + b.moneyToChinese(v)),
                        h.find("#stat_table tfoot #tfoot_" + n).html("\u603b\u548c\uff1a" + v).attr("title", "\u603b\u548c\uff1a" + v);
                        h.find("#stat_table tfoot").show()
                    } else h.find("#stat_table tfoot").hide();
                    t = {};
                    if (g) for (c = 0; c < g.length; c++) n = g[c],
                    t[n.FORM_DATA + "_" + n.DATA_INDEX] = n;
                    b.renderDataReport(f, t, s);
                    b.mergerCells(s, f);
                    d.layout(b.el + " #js_customerTable_wrapper")
                } else h.html(d.template("base.nopermission", {
                    msg: null
                }))
            })
        },
        renderDataReport: function(a, b, h) {
            for (var c = this.el,
            k = $(this.el), d = TEAMS.currentTenant.tenantKey, f = 0; f < a.length; f++) {
                var g = a[f],
                t = g.maxIndex || 1,
                n = g.id,
                v = Date.create(g.createTime),
                u = g.name ? g.name: "",
                p = "formdatareport" === g.module ? "\u6570\u636e\u4e0a\u62a5": "\u5916\u90e8\u5206\u53d1";
                if (! (0 < $(c + " stat_table tr #" + n).length)) for (var w = 0; w < t; w++) {
                    var y = b[n + "_" + (w + 1)],
                    z = $("\x3ctr id\x3d" + n + "\x3e\x3c/tr\x3e");
                    z.append("\x3ctd class\x3d'noSub_name_" + n + '\'\x3e\x3ca class\x3d"entitybox-toggle" data-id\x3d"' + n + '" formData\x3d"' + n + '" data-module\x3d"formdatareport" renderType\x3d"subordinates"\x3e' + u + "\x3c/a\x3e\x3c/td\x3e");
                    g.operator && g.operator.id && g.tenantKeyTemp && g.tenantKeyTemp.toLowerCase() == d.toLowerCase() ? z.append("\x3ctd class\x3d'noSub_operate_" + n + "'\x3e\x3ca class\x3d'router usercard-toggle' userid\x3d'" + g.operator.id + "'\x3e" + g.operator.username + "\x3c/a\x3e\x3c/td\x3e") : z.append("\x3ctd class\x3d'noSub_operate_" + n + "'\x3e\u6e38\u5ba2\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_time_" + n + "'\x3e" + v.format("{yyyy}-{MM}-{dd}") + "\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_type_" + n + "'\x3e" + p + "\x3c/td\x3e");
                    for (var l = 0; l < h.length; l++) {
                        var C = h[l],
                        F = C.id,
                        m = C.componentKey,
                        B = "";
                        y && (B = y["C_" + F] || "");
                        var D = "noSub_" + n + "_" + F;
                        C.subForm && (D = "");
                        C = "";
                        if ("Money" == m || "NumberComponent" == m) C = "ta-r";
                        F = n + "_" + (w + 1) + "_" + F;
                        m = !0;
                        try {
                            var x = JSON.parse(B.replace(/\s+/g, ""));
                            ocount = "";
                            if (0 < x.length && null != x[0].optionId) {
                                for (var A = 0; A < x.length; A++) option = x[A],
                                "image" == option.type || "imageFile" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" rel\x3d"fancybox_js" href\x3d"/base/download/img/' + option.optionId + '/image" class\x3d"fancybox_js" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", m = !1) : option.targeId && 0 < option.targeId.length ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.targeId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", m = !1) : "file" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" data-value\x3d"' + option.optionId + '" href\x3d"/base/download/' + option.optionId + '"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", m = !1) : ocount += option.content + ",";
                                B = ocount.substring(0, ocount.length - 1)
                            }
                        } catch(E) {}
                        m ? z.append("\x3ctd id\x3d" + F + " class\x3d'" + D + " " + C + "' title\x3d'" + B + "'\x3e" + B + "\x3c/td\x3e") : z.append("\x3ctd id\x3d" + F + " class\x3d'" + D + " " + C + "'\x3e" + B + "\x3c/td\x3e");
                        $("#" + F).find(".fancybox_js").fancybox({
                            closeBtn: !0,
                            nextEffect: "fade",
                            prevEffect: "fade",
                            afterLoad: function() {
                                this.title = "Image " + (this.index + 1) + " of " + this.group.length + (this.title ? " - " + this.title: "")
                            }
                        })
                    }
                    k.find("#stat_table tbody").append(z)
                }
            }
        },
        mergerCells: function(a, b) {
            var h = $(this.el);
            if (a && b) for (var c = 0; c < b.length; c++) {
                var k = b[c],
                d = k.maxIndex || 1,
                f = k.id;
                "task" === this.module && (f = k.taskId);
                h.find("#stat_table .noSub_name_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .noSub_name_" + f + ":gt(0)").remove();
                h.find("#stat_table .noSub_operate_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .noSub_operate_" + f + ":gt(0)").remove();
                h.find("#stat_table .noSub_time_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .noSub_time_" + f + ":gt(0)").remove();
                h.find("#stat_table .noSub_type_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .noSub_type_" + f + ":gt(0)").remove();
                h.find("#stat_table .j_opreate_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .j_opreate_" + f + ":gt(0)").remove();
                h.find("#stat_table .noSub_content_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .noSub_content_" + f + ":gt(0)").remove();
                h.find("#stat_table .noSub_priority_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .noSub_priority_" + f + ":gt(0)").remove();
                h.find("#stat_table .noSub_status_" + f + ":eq(0)").attr("rowspan", d);
                h.find("#stat_table .noSub_status_" + f + ":gt(0)").remove();
                for (k = 0; k < a.length; k++) {
                    var g = a[k];
                    g.subForm || (g = g.id, h.find("#stat_table .noSub_" + f + "_" + g + ":eq(0)").attr("rowspan", d), h.find("#stat_table .noSub_" + f + "_" + g + ":gt(0)").remove())
                }
            }
        },
        talbeScrollbar: function() {
            $(this.el).find(".j_formstarScr").mCustomScrollbar({
                axis: "x",
                scrollButtons: {
                    enable: !0
                },
                mouseWheel: "false",
                theme: "darkblue",
                scrollbarPosition: "inside"
            })
        },
        moneyToChinese: function(a) {
            var b = "",
            h = "\u4edf\u4f70\u62fe\u4ebf\u4edf\u4f70\u62fe\u4e07\u4edf\u4f70\u62fe\u5143\u89d2\u5206";
            a += "00";
            var c = a.indexOf(".");
            0 <= c && (a = a.substring(0, c) + a.substr(c + 1, 2));
            h = h.substr(h.length - a.length);
            for (c = 0; c < a.length; c++) b += "\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396".substr(a.substr(c, 1), 1) + h.substr(c, 1);
            return b.replace(/\u96f6\u89d2\u96f6\u5206$/, "").replace(/\u96f6[\u4edf\u4f70\u62fe]/g, "\u96f6").replace(/\u96f6{2,}/g, "\u96f6").replace(/\u96f6([\u4ebf|\u4e07])/g, "$1").replace(/\u96f6+\u5143/, "\u5143").replace(/\u4ebf\u96f6{0,3}\u4e07/, "\u4ebf").replace(/^\u5143/, "\u96f6\u5143")
        },
        remove: function() {}
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatheaderview", "teams/utils eteams/biaoge/formstat/formstatmodel eteams/biaoge/formstat/formcolumnview eteams/biaoge/formstat/formdatacolumnview eteams/biaoge/formstat/baseformstatsearchview eteams/biaoge/form/formoperationview eteams/biaoge/formmanage/formincollectlogview eteams/biaoge/formstat/formcollectchartview eteams/biaoge/form/formreportconfigview eteams/biaoge/form/formauthconfigview eteams/biaoge/formstat/formstatlistview eteams/biaoge/form/formtagview eteams/biaoge/formmanage/formdistributeview teams/base/importdataview eteams/biaoge/form/messageconfigview eteams/biaoge/form/remindconfigview eteams/biaoge/form/customconfigview".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel"),
    b = g("eteams/biaoge/formstat/formcolumnview"),
    a = g("eteams/biaoge/formstat/formdatacolumnview"),
    e = g("eteams/biaoge/formstat/baseformstatsearchview"),
    h = g("eteams/biaoge/form/formoperationview"),
    c = g("eteams/biaoge/formmanage/formincollectlogview"),
    k = g("eteams/biaoge/formstat/formcollectchartview"),
    s = g("eteams/biaoge/form/formreportconfigview"),
    q = g("eteams/biaoge/form/formauthconfigview"),
    r = g("eteams/biaoge/formstat/formstatlistview"),
    t = g("eteams/biaoge/form/formtagview"),
    n = g("eteams/biaoge/formmanage/formdistributeview"),
    v = g("teams/base/importdataview"),
    u = g("eteams/biaoge/form/messageconfigview"),
    p = g("eteams/biaoge/form/remindconfigview"),
    w = g("eteams/biaoge/form/customconfigview");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.el = a.container;
            this.type = a.type;
            this.model = new f;
            this.userId = TEAMS.currentUser.id;
            $(this.el).html(d.template("formstat.formstatheader"))
        },
        delegateEvents: function() {
            var f = this,
            g = $(f.el),
            l = f.model;
            g.off("click.FormStatHeaderView", ".j_tag").on("click.FormStatHeaderView", ".j_tag",
            function(a) {
                $(this).parents(".j_tagLi").find(".j_tagcontainer").slideToggle("fast"); (new t({
                    targetId: f.formId,
                    module: "biaoge",
                    parentEl: ".j_formstat .js_formtab .j_tagLi",
                    container: ".j_tagcontainer"
                })).render()
            });
            $("body").off("click.FormStatHeaderView").on("click.FormStatHeaderView",
            function(a) {
                a = $(a.target);
                $(a).hasClass("j_tag") || 0 < $(a).parents(".j_tag").length || 0 < $(a).parents(".j_tagcontainer").length || $(".j_tagcontainer").slideUp("fast")
            });
            $("body").off("click.FormStatHeaderView", ".goto-top").on("click.FormStatHeaderView", ".goto-top",
            function(a) {
                d.gotoTop(".j_eformstatScr")
            });
            g.on("click.FormStatHeaderView", ".j_form_goalSlideCtrl",
            function() {
                null == f.formStatListView ? (f.formStatListView = new r({
                    formId: f.formId,
                    container: ".j_eform_list",
                    type: f.type
                }), f.formStatListView.render()) : f.formStatListView.show()
            });
            g.off("click.FormStatDataTableView", "#import_formdata").on("click.FormStatDataTableView", "#import_formdata",
            function() {
                $(this); (new v({
                    formId: f.formId,
                    importtype: "form"
                })).render()
            });
            g.on("click.FormStatDataTableView", "#export_formdata",
            function(a) {
                var c = $(this);
                if (0 != $(this).data("isClick")) {
                    c.data("isClick", !1);
                    var b = f.getParam();
                    f.model.exportParam(b,
                    function(a) {
                        $.ajax({
                            type: "POST",
                            data: b,
                            dataType: "json",
                            url: "/export/checkExportReportNum.json",
                            success: function(a) {
                                if (a.actionMsg && a.actionMsg.message) d.notify(a.actionMsg.message);
                                else {
                                    d.notify("\u6b63\u5728\u751f\u6210\u6587\u4ef6\uff0c\u8bf7\u7a0d\u540e...", "\u4e0a\u62a5\u5bfc\u51fa", "info", !1);
                                    var b = window.setInterval(function() {
                                        $.ajax({
                                            type: "get",
                                            url: "/export/findExportRate.json",
                                            dataType: "json",
                                            success: function(a) {
                                                $("div.ui-pnotify-text").html("\u6b63\u5728\u751f\u6210\u6587\u4ef6\uff0c\u8bf7\u7a0d\u540e... (" + a.actionMsg.message + ")");
                                                "100%" == a.actionMsg.message && (clearInterval(b), d.notify("\u5bfc\u51fa\u5b8c\u6210\uff01", "\u4e0a\u62a5\u5bfc\u51fa", "info"))
                                            }
                                        })
                                    },
                                    1E3);
                                    window.location.href = "/export/exportFormDataReport.json?_t\x3d" + (new Date).getTime()
                                }
                                c.data("isClick", !0)
                            }
                        })
                    })
                }
            });
            g.on("click.FormStatHeaderView", ".j_columnField",
            function(a) {
                $("body").append("\x3cdiv id\x3d'setupColumnField'\x3e\x3c/div\x3e");
                f.formColumnView = new b({
                    formId: f.formId,
                    container: "body #setupColumnField",
                    parentObj: f
                });
                f.formColumnView.render()
            });
            g.on("click.FormStatHeaderView", ".j_datacolumn",
            function(c) {
                $("body").append("\x3cdiv id\x3d'setupColumnField'\x3e\x3c/div\x3e"); (new a({
                    formId: f.formId,
                    container: "#setupColumnField",
                    parentObj: f
                })).render()
            });
            g.on("click.FormStatHeaderView", "#initAdvanceSearch",
            function(a) {
                a = $(this);
                a.data("open") ? (a.find("i").attr("class", "icon-angle-down cs-p"), g.find(".j_advanceSearch").hide(), a.data("open", !1)) : ($(this).find("i").attr("class", "icon-angle-up cs-p"), null != g.find(".j_advanceSearch .j_formstat-search").get(0) ? g.find(".j_advanceSearch").show() : (f.searchView && f.searchView.remove(), l.findAdvSearchField({
                    formId: f.formId
                },
                function(a) {
                    f.searchView = new e({
                        formId: f.formId,
                        el: f.el + " .j_advanceSearch",
                        formFields: a.formFields,
                        parentObj: f
                    });
                    f.searchView.render();
                    "stattable" != f.type && $(".j_filterSub").remove();
                    g.find(".j_advanceSearch").show()
                })), a.data("open", !0));
                $(window).resize()
            });
            g.on("CLOSE.FormStatHeaderView", "#initAdvanceSearch",
            function(a) {
                g.find(".j_advanceSearch").hide();
                g.find("#initAdvanceSearch").data("open", !1);
                g.find("#initAdvanceSearch i").attr("class", "icon-angle-down cs-p");
                $(window).resize()
            });
            $("body").off("saveFormDataQuery").on("saveFormDataQuery",
            function(a) {
                f.saveFormDataQuery()
            });
            g.on("click.FormStatHeaderView", ".j_form_set li",
            function() {
                var a = $(this).children("a").attr("data-target");
                switch (a) {
                case "insideNotice":
                    g.find(".j_form_set .j_employee").click();
                    break;
                case "reportconf":
                    d.notify(a);
                    break;
                case "useflow":
                    var a = TEAMS.currentUser.admin ? !0 : !1,
                    b = {};
                    b.formId = f.formId;
                    b.module = "workflow";
                    b.el = "#copy-form";
                    b.formTitle = f.form.name;
                    b.ownership = f.form.ownership;
                    b.tpl = d.template("flow.formcopy", {
                        userId: TEAMS.currentUser.id,
                        operationtype: "\u4f7f\u7528\u5ba1\u6279",
                        admin: a,
                        type: "\u8868\u5355"
                    });
                    b.copyCallback = function(a) {
                        a && a.form && "company" == a.form.ownership ? ROUTER.navigate("/workflows/" + TEAMS.currentUser.id + "/company", {
                            trigger: !0
                        }) : ROUTER.navigate("/workflows/" + TEAMS.currentUser.id + "/personal", {
                            trigger: !0
                        })
                    };
                    f.formOperationView = new h(b);
                    f.formOperationView.render();
                    break;
                case "editform":
                    window.open("/form/edit/" + f.formId);
                    break;
                case "copyform":
                    a = TEAMS.currentUser.admin ? !0 : !1;
                    b = {};
                    b.formId = f.formId;
                    b.module = "biaoge";
                    b.el = "#copy-form";
                    b.formTitle = f.form.name;
                    b.ownership = f.form.ownership;
                    b.tpl = d.template("flow.formcopy", {
                        userId: TEAMS.currentUser.id,
                        operationtype: "\u590d\u5236",
                        admin: a,
                        type: "\u8868\u5355"
                    });
                    b.copyCallback = function(a) {
                        ROUTER.navigate("/forms/" + TEAMS.currentUser.id + "/write", {
                            trigger: !0
                        })
                    };
                    f.formOperationView = new h(b);
                    f.formOperationView.render();
                    break;
                case "dataTrend":
                    (new k({
                        formId:
                        f.formId
                    })).render();
                    break;
                case "insidCollect":
                    (new c({
                        formId:
                        f.formId
                    })).render();
                    break;
                case "authConfig":
                    f.formauthconfigview = new q({
                        userId: f.userId,
                        formId: f.formId,
                        callback: function(a) {
                            f.formauthconfigview.hide()
                        }
                    });
                    f.formauthconfigview.render();
                    break;
                case "reportConf":
                    f.formreportconfigview = new s({
                        userId: f.userId,
                        formId: f.formId,
                        callback: function(a) {
                            f.formreportconfigview.hide()
                        }
                    });
                    f.formreportconfigview.render();
                    break;
                case "js_messageConfig":
                    f.messageconfigview = new u({
                        parentEl: f.el,
                        userId: f.userId,
                        formId: f.formId,
                        callback: function(a) {
                            f.messageconfigview.hide()
                        }
                    });
                    f.messageconfigview.render();
                    break;
                case "remindConfig":
                    f.remindconfigview = new p({
                        parentEl: f.el,
                        userId: f.userId,
                        formId: f.formId,
                        callback: function(a) {
                            f.remindconfigview.hide()
                        }
                    });
                    f.remindconfigview.render();
                    break;
                case "customConfig":
                    f.customconfigview = new w({
                        parentEl: f.el,
                        userId: f.userId,
                        formId: f.formId,
                        callback: function(a) {
                            f.customconfigview.hide()
                        }
                    }),
                    f.customconfigview.render()
                }
            });
            g.on("confirmHandler.FormStatHeaderView", ".j_employee",
            function(a, c) {
                var b = f.formId,
                k = f.form.name,
                e = c.objs;
                if (c && e && 0 < e.length) {
                    for (var h = {},
                    s = 0; s < e.length; s++) h["userIds[" + s + "]"] = e[s].id;
                    h["form.id"] = b;
                    h["form.name"] = k;
                    l.incollect(h,
                    function(a) {
                        a.actionMsg ? d.notify(a.actionMsg.message) : d.notify("\u64cd\u4f5c\u6210\u529f\uff01")
                    })
                } else d.notify("\u8bf7\u9009\u62e9\u4eba\u5458\uff01")
            });
            g.on("click.FormStatHeaderView", ".js_shareForm",
            function() {
                if ("enable" != f.form.status) d.notify("\u8bf7\u53d1\u5e03\u8868\u5355\u540e\u518d\u5206\u53d1\uff01");
                else {
                    var a = f.formId;
                    f.model.getFiledByForm({
                        formId: a
                    },
                    function(c) {
                        if (c.formFields && 0 < c.formFields.length) {
                            c = f.form.name;
                            var b = f.form.describe,
                            k = window.location.protocol + "//" + window.location.host;
                            TEAMS.service.external && (k = TEAMS.service.external);
                            new n({
                                container: "#baidushare",
                                shareTitle: c,
                                shareDesc: b,
                                shareUrl: k + "/biaoge/fill/" + a,
                                formId: a,
                                form: f.form
                            });
                            $("#distributeModal").modal("show")
                        } else d.notify("\u8bf7\u4e3a\u8868\u5355\u6dfb\u52a0\u5185\u5bb9\u518d\u5206\u53d1\uff01")
                    })
                }
            });
            g.on("click.FormStatDataTableView", ".j_form_keyword",
            function() {
                f.isKeyword = !0;
                $("body").trigger("confirmSearch")
            });
            g.on("keyup.FormStatDataTableView", ".j_keyword_input",
            function(a) {
                f.isKeyword = !0;
                13 == a.keyCode && $("body").trigger("confirmSearch")
            })
        },
        render: function() {
            var a = this,
            c = $(a.el);
            a.renderMenu();
            a.model.findStatFormDetail({
                formId: a.formId
            },
            function(b) {
                b = a.form = b.form;
                if (b.permission) {
                    "write" == b.permission && (c.find(".js_shareForm").remove(), c.find(".j_form_set_btn").remove());
                    "check" == b.permission && c.find(".j_form_set_btn").remove();
                    "disable" == b.collectStatus ? $(".js_shareForm").find("a").addClass("disabled") : $(".js_shareForm").find("a").removeClass("disabled");
                    var k = $(a.el).find("#write_report");
                    b && b.operator && b.operator.department && (k.attr("data-id", b.id), k.attr("userid", TEAMS.currentUser.id));
                    $(a.el).find(".j_form_name").text(b.name).attr("title", b.name)
                } else $(a.el).html("")
            });
            a.renderFormRouter()
        },
        saveFormDataQuery: function() {
            var a = this;
            $(a.el);
            var c = a.model,
            b = a.formId,
            k = a.getFormDataQueryParam();
            d.prompt("\u8bf7\u8f93\u5165\u540d\u79f0",
            function(e) {
                if (null != e) if ("" == e.trim()) d.notify("\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01");
                else {
                    var h = e.trim(),
                    f = {
                        formId: b,
                        name: h,
                        content: JSON.stringify(k)
                    };
                    c.existsFormDataQuery(f,
                    function(b) {
                        b.actionMsg && b.actionMsg.message ? d.notify(b.actionMsg.message) : 0 < b.formDataQuerys.length ? d.confirm("\u5df2\u5b58\u5728\u76f8\u540c\u540d\u79f0\uff0c\u662f\u5426\u8986\u76d6\uff1f",
                        function(b) {
                            b && c.deleteFormDataQueryByName(f,
                            function(b) {
                                c.saveFormDataQuery(f,
                                function(c) {
                                    c.actionMsg && c.actionMsg.message ? d.notify(c.actionMsg.message) : (d.notify("\u6dfb\u52a0\u6210\u529f\uff01"), $(".j_commontagList .j_commontag").each(function(a, c) {
                                        $(c).find(".js_nameLink").text().trim() == h && $(c).remove()
                                    }), a.insertCustomQuery(c.formDataQuery))
                                })
                            })
                        }) : c.saveFormDataQuery(f,
                        function(c) {
                            c.actionMsg && c.actionMsg.message ? d.notify(c.actionMsg.message) : (d.notify("\u4fdd\u5b58\u6210\u529f\uff01"), a.insertCustomQuery(c.formDataQuery))
                        })
                    })
                }
            });
            var e = $(".modal .modal-body form .input-block-level");
            e.css("width", "100%").addClass("form-control");
            setTimeout(function() {
                e.attr("maxLength", 100).focus();
                e.keydown(function(a) {
                    if (13 == a.keyCode) return ! 1
                })
            },
            500)
        },
        insertCustomQuery: function(a) {
            var c = $(".j_commontagList .j_commontag:first").clone().removeClass("hide");
            c.attr("id", a.id);
            c.find(".js_nameLink").text(a.name).attr("title", a.name);
            $(".j_commontagList").append(c)
        },
        renderMenu: function() {
            var a = this.type,
            c = $(this.el);
            "statchart" === a && (c.find(".j_columnField").remove(), c.find(".j_export_li").remove());
            "statreport" === a && (c.find(".j_column_set").remove(), c.find(".j_export_li").remove(), c.find(".j_search_li").remove())
        },
        getParam: function() {
            var a = {},
            c = "";
            0 < $(this.el).find(".j_keyword_input").length && (c = $(this.el).find(".j_keyword_input").val().trim());
            this.isKeyword && c ? a.keywords = c: this.searchView && (a = this.searchView.assembleParam());
            a.formId = this.formId;
            a.module = "form";
            return a
        },
        getFormDataQueryParam: function() {
            var a = {},
            c = "";
            0 < $(this.el).find(".j_keyword_input").length && (c = $(this.el).find(".j_keyword_input").val().trim());
            this.isKeyword && c ? a.names = [{
                content: c,
                term: "like"
            }] : this.searchView && (a = this.searchView.assembleFormDataQueryParam());
            return a
        },
        renderFormRouter: function() {
            var a = this;
            $(a.el).find(".j_form_router li").each(function() {
                var c = $(this),
                b = c.attr("type");
                c.attr("href", "/forms/" + TEAMS.currentUser.id + "/" + b + "/" + a.formId);
                b == a.type && c.addClass("active")
            })
        },
        remove: function() {
            this.formColumnView && (this.formColumnView.remove(), this.formColumnView = null);
            this.formOperationView && (this.formOperationView.remove(), this.formOperationView = null);
            this.formStatListView && (this.formStatListView.remove(), this.formStatListView = null);
            this.RemindConfigView && (this.RemindConfigView.remove(), this.RemindConfigView = null);
            this.MessageConfigView && (this.MessageConfigView.remove(), this.MessageConfigView = null);
            this.customconfigview && (this.customconfigview.remove(), this.customconfigview = null);
            $(this.el).off(".FormStatHeaderView")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstattableview", "teams/utils eteams/biaoge/formstat/formstatmodel eteams/biaoge/formstat/formcolumnview eteams/biaoge/formstat/baseformstatsearchview eteams/biaoge/formstat/formstattableheaderview eteams/biaoge/formstat/taskformmodel".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel"),
    b = g("eteams/biaoge/formstat/formcolumnview"),
    a = g("eteams/biaoge/formstat/baseformstatsearchview"),
    e = g("eteams/biaoge/formstat/formstattableheaderview"),
    h = g("eteams/biaoge/formstat/taskformmodel"),
    c = [{
        title: "\u4efb\u52a1\u540d\u79f0",
        position: "left",
        name: "TASK_NAME"
    },
    {
        title: "\u8d1f\u8d23\u4eba",
        position: "left",
        name: "TASK_MANAGER"
    },
    {
        title: "\u7d27\u6025\u7a0b\u5ea6",
        position: "left",
        name: "PRIORITY"
    },
    {
        title: "\u5230\u671f\u65e5",
        position: "left",
        name: "TASK_DUE_DATE"
    },
    {
        title: "\u662f\u5426\u5b8c\u6210",
        position: "left",
        name: "TASK_FINISH_TIME"
    }];
    g = Backbone.View.extend({
        teams: {},
        initialize: function(a) {
            this.formId = a.formId;
            this.el = a.container ? a.container: "#j_formContent";
            this.isAdmin = TEAMS.currentUser.admin;
            this.model = new f;
            this.taskFormModel = new h;
            this.module = "task";
            $(this.el).html(d.template("form.taskstat"));
            $(this.el + " #formstat #delete_formdata").remove();
            $(this.el).find("#export_formdata").remove();
            this.fileds = c
        },
        delegateEvents: function() {
            var a = this,
            c = $(a.el);
            $("body").on("click.FormStatView", ".goto-top",
            function(c) {
                d.gotoTop(a.el + " #formStatContent")
            });
            $("body").off("confirmSearch").on("confirmSearch",
            function(c) {
                a.renderListStatByRow(1)
            });
            c.off("click.FormStatView", "#more_data").on("click.FormStatView", "#more_data",
            function(c) {
                c = $(this).data("page");
                a.renderListStatByRow(c.nextPage)
            });
            c.off("click.FormStatView", "#columnField").on("click.FormStatView", "#columnField",
            function(c) {
                $("body").append("\x3cdiv id\x3d'setupColumnField'\x3e\x3c/div\x3e");
                a.formColumnView = new b({
                    formId: a.formId,
                    container: "body #setupColumnField",
                    parentObj: a
                });
                a.formColumnView.render()
            });
            c.off("click.FormStatView", "#initAdvanceSearch").on("click.FormStatView", "#initAdvanceSearch",
            function(b) {
                $(this).data("open") ? ($(this).find("i").attr("class", "icon-angle-down cs-p"), c.find(".j_advanceSearch").hide(), $(this).data("open", !1)) : ($(this).find("i").attr("class", "icon-angle-up cs-p"), c.find(".j_advanceSearch").show(), c.find(".j_advanceSearch .j_formstat-search").length || (a.renderExtendSearch(), a.renderTaskType()), $(this).data("open", !0));
                $(window).resize()
            });
            c.on("change.FormStatView", ".j_tasktype_sel",
            function() {
                var c = $(this).val();
                c ? c != a.formId && (a.formId = c, a.tableheader = null, a.renderListStatByRow(1), a.renderExtendSearch()) : d.notify("\u8be5\u7c7b\u578b\u5c1a\u672a\u8bbe\u7f6e\u8868\u5355\uff01")
            })
        },
        renderExtendSearch: function() {
            var c = this;
            c.searchView && c.searchView.remove();
            c.model.findAdvSearchField({
                formId: c.formId
            },
            function(b) {
                c.searchView = new a({
                    formId: c.formId,
                    el: c.el + " .j_searchField",
                    formFields: b.formFields,
                    module: c.module,
                    parentObj: c
                });
                c.searchView.render()
            })
        },
        renderTaskType: function() {
            var a = this;
            $(a.el).find(".j_tasktype_sel").empty();
            a.taskFormModel.loadTaskType({
                hasForm: !0
            },
            function(c) {
                c.taskFormLinks && c.taskFormLinks.length && ($(a.el).find(".j_tasktype_sel").closest(".sch-group").removeClass("hide"), _.each(c.taskFormLinks,
                function(c) {
                    var b = c.form && c.form.id,
                    e = $("\x3coption /\x3e");
                    c = c.name;
                    b ? a.formId == b && e.attr("selected", !0) : (c += "\uff08\u65e0\u8868\u5355\uff09", e.addClass("option-line"));
                    e.val(b).text(c).appendTo(a.el + " .j_tasktype_sel")
                }))
            })
        },
        render: function() {
            this.renderListStatByRow(1)
        },
        renderTableheader: function() {
            this.tableheader = new e({
                formId: this.formId,
                htable: $(this.el).find("#head_table"),
                ctable: $(this.el).find("#stat_table"),
                fileds: this.fileds,
                parentObj: this
            });
            this.tableheader.render();
            this.formFields = this.tableheader.formFields
        },
        renderListStatByRow: function(a) {
            var c = this,
            b = c.el;
            if (c.formId) {
                var e = {};
                c.searchView && (e = c.searchView.assembleParam());
                c.tableheader ? c.tableheader.getOrderParam(e) : c.renderTableheader();
                e.formId = c.formId;
                e.pageNo = a;
                e.module = c.module;
                1 == a && ($(c.el).find("#stat_table").hide(), $(c.el).find("#stat_table tbody").empty());
                $(c.el).find("#list-loading").show();
                $(c.el).find("#more_data").hide();
                c.model.findRowListStatForTask(e,
                function(e) {
                    var h = e.formDatas,
                    f = e.listStats,
                    g = e.numberFieldStats,
                    r = e.pageDatas,
                    w = e.form,
                    y = e.form.name;
                    $("#formName").html(y + "\uff08\u7edf\u8ba1\uff09");
                    $(c.el).find("#list-loading").hide();
                    $(c.el).find("#stat_table").show();
                    e.message ? $(b).find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e' + e.message + "\x3c/div\x3e") : null == w ? $(b).find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult" style\x3d"color:#e60000;"\x3e\u8868\u5355\u4e0d\u5b58\u5728\x3c/div\x3e') : c.tableheader.renderPageMore($(b), r, h, a) && (c.tableheader.setTableFootCount(g, a), e = c.tableheader.bulidListStats(f), c.renderDataTask(h, e, r), c.mergerCells(h, e), c.tableheader.setfixRow(a, h.length, c.fileds.length + c.formFields.length + 2), d.layout(".j_formstatScrY"))
                })
            } else $("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e\u5f53\u524d\u8868\u5355\u6ca1\u6709\u4efb\u4f55\u5b57\u6bb5\uff01\x3c/div\x3e')
        },
        renderDataTask: function(a, c, b) {
            for (var e = this.el,
            h = this.formFields,
            d = 0; d < a.length; d++) {
                var f = a[d],
                g = f.taskId;
                if (! (0 < $(e + " stat_table tr #" + g).length)) for (var p = c[f.id] ? c[f.id] : [""], w = 0; w < p.length; w++) {
                    var y = p[w],
                    z = $("\x3ctr id\x3d" + g + "\x3e\x3c/tr\x3e");
                    1 == d % 2 && z.addClass("other-bgcolor");
                    z.append("\x3ctd class\x3d'num noSub_taskCheck_" + g + "' title\x3d'" + (b.first + d) + "'\x3e\x3cdiv\x3e" + (b.first + d) + "\x3c/div\x3e\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_name_" + g + "' title\x3d'" + f.taskName + "' name\x3d'TASK_NAME'\x3e\x3cdiv title\x3d'" + f.taskName + '\'\x3e\x3ca class\x3d"j_entityslider-toggle" data-id\x3d"' + g + '"  data-module\x3d"task" renderType\x3d"subordinates"\x3e' + f.taskName + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_operate_" + g + "'  name\x3d'TASK_MANAGER'\x3e\x3cdiv\x3e\x3ca class\x3d'router usercard-toggle' userid\x3d'" + f.taskManager.id + "'\x3e" + f.taskManager.username + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_priority_" + g + "' name\x3d'PRIORITY'\x3e\x3cdiv\x3e" + f.priority + "\x3c/div\x3e\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_time_" + g + "'  name\x3d'TASK_DUE_DATE'\x3e\x3cdiv\x3e" + Date.create(f.taskDueDate).format("{yyyy}-{MM}-{dd}") + "\x3c/div\x3e\x3c/td\x3e");
                    z.append("\x3ctd class\x3d'noSub_status_" + g + "' name\x3d'TASK_FINISH_TIME'\x3e\x3cdiv\x3e" + ("todo" == f.taskStatus ? "\u8fdb\u884c\u4e2d": "\u5df2\u5b8c\u6210") + "\x3c/div\x3e\x3c/td\x3e");
                    for (var l = 0; l < h.length; l++) {
                        var C = h[l],
                        m = C.id,
                        G = C.componentKey,
                        B = "";
                        y && (B = y["C_" + m] || "");
                        var D = "noSub_" + g + "_" + m;
                        C.subForm && (D = "");
                        C = "";
                        if ("Money" == G || "NumberComponent" == G) C = "ta-r";
                        var G = g + "_" + (w + 1) + "_" + m,
                        x = !0;
                        try {
                            var A = JSON.parse(B.replace(/\s+/g, ""));
                            ocount = "";
                            if (0 < A.length && null != A[0].optionId) {
                                for (var E = 0; E < A.length; E++) option = A[E],
                                "image" == option.type || "imageFile" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.optionId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", x = !1) : option.targeId && 0 < option.targeId.length ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.targeId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", x = !1) : "file" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" data-value\x3d"' + option.optionId + '" href\x3d"/base/download/' + option.optionId + '"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", x = !1) : ocount += option.content + ",";
                                B = ocount.substring(0, ocount.length - 1)
                            }
                        } catch(H) {}
                        x ? z.append("\x3ctd id\x3d" + G + " class\x3d'" + D + " " + C + "' title\x3d'" + B + "' name\x3d'" + m + "'\x3e\x3cdiv title\x3d'" + B + "'\x3e" + B + "\x3c/div\x3e\x3c/td\x3e") : z.append("\x3ctd id\x3d" + G + " class\x3d'" + D + " " + C + "' name\x3d'" + m + "'\x3e\x3cdiv title\x3d'" + B + "'\x3e" + B + "\x3c/div\x3e\x3c/td\x3e")
                    }
                    z.append("\x3ctd class\x3d'fix j_fixcol noSub_fixcol_" + g + "'\x3e\x3c/td\x3e");
                    this.tableheader.setTableBodyWidth(z);
                    $(e).find("#stat_table tbody").append(z)
                }
            }
        },
        mergerCells: function(a, c) {
            var b = this.formFields;
            if (b && a) for (var e = 0; e < a.length; e++) {
                var h = a[e];
                if (c[h.id]) {
                    var d = c[h.id].length || 1,
                    f = h.id;
                    "task" === this.module && (f = h.taskId);
                    $(this.el).find("#stat_table .noSub_taskCheck_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_taskCheck_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_name_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_name_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_operate_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_operate_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_time_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_time_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_type_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_type_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .j_opreate_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .j_opreate_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_priority_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_priority_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_status_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_status_" + f + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_fixcol_" + f + ":eq(0)").attr("rowspan", d);
                    $(this.el).find("#stat_table .noSub_fixcol_" + f + ":gt(0)").remove();
                    for (h = 0; h < b.length; h++) {
                        var g = b[h];
                        g.subForm || (g = g.id, $(this.el).find("#stat_table .noSub_" + f + "_" + g + ":eq(0)").attr("rowspan", d), $(this.el).find("#stat_table .noSub_" + f + "_" + g + ":gt(0)").remove())
                    }
                }
            }
        },
        againRenderTable: function() {
            $(this.el);
            this.tableheader.remove();
            this.tableheader = null;
            $(this.el).find("#statbody").html($(d.template("form.stat")).find("#statbody").html());
            this.renderListStatByRow(1);
            $(window).resize()
        },
        remove: function() {
            this.formColumnView && this.formColumnView.remove();
            this.tableheader && this.tableheader.remove();
            $(this.el).off(".FormStatView");
            $(this.el).find("#formstat").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formfielddetailview", ["teams/utils", "eteams/biaoge/formstat/formfielddetailmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formfielddetailmodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            $("#formfield-detail").remove();
            var a = this;
            this.el = "#formfield-detail";
            this.template = "formstat.fielddetaillist";
            this.$el = $(d.template(this.template, b.fieldInfo));
            this.model = new f(b);
            $(document.body).append(this.$el);
            this.model.set({
                pageNo: 1
            });
            this.model.on("change:pageinfo",
            function(e, h) {
                a.showDataItems(h, b.fieldInfo)
            });
            this.renderScrollBar()
        },
        delegateEvents: function() {
            var b = this,
            a = this.model;
            this.$el.on("click.formfielddetailview", ".close",
            function() {
                b.hideDetail()
            });
            this.$el.on("click.formfielddetailview", "#fieldmore_data",
            function() {
                a.set({
                    pageNo: a.get("pageNo") + 1
                })
            })
        },
        showDetail: function() {
            $("#formfield-detail").modal("show");
            $(window).trigger("resize")
        },
        hideDetail: function() {
            $("#formfield-detail").modal("hide")
        },
        showDataItems: function(b, a) {
            for (var e = b.fieldDatas,
            h, c = this.$el.find("#field_table tbody"), k = this.$el.find("#fieldmore_data"), d = 0, f = e.length; d < f; d++) h = $("\x3ctr\x3e\x3ctd\x3e" + ("" === e[d].CONTENT ? "( *\u7a7a  )": e[d].CONTENT) + "\x3c/td\x3e\x3c/tr\x3e"),
            c.append(h);
            "NumberComponent" !== a.componentkey && "Money" !== a.componentkey || this.$el.find(".totalnumber").html("\u603b\u8ba1\x26nbsp;:\x26nbsp;" + b.numberTotal);
            b.pageDatas.hasNext || k.hide();
            0 == b.pageDatas.totalCount && this.$el.find(".j_no-result").removeClass("hide")
        },
        renderScrollBar: function() {
            this.$el.find(".field-datas").mCustomScrollbar({
                theme: "darkblue"
            });
            $(window).trigger("resize")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/statbaseview",
function(g, m, l) {
    g = Backbone.View.extend({
        initialize: function(d, f, b) {
            this.cdata = d;
            this.wrappercontainer = f;
            this.stat = 1;
            this.param = b
        },
        render: function() {
            console.log("please override it!")
        },
        getContainer: function() {
            return this.container
        },
        hideView: function() {
            this.stat = 0;
            this.getContainer().fadeOut()
        },
        showView: function() {
            this.stat = 1;
            this.getContainer().fadeIn()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formdatacolumnview", ["teams/utils", "eteams/biaoge/formstat/formstatmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel"),
    b = {
        formdatareport: [{
            title: "\u4e0a\u62a5\u540d\u79f0",
            name: "FD.NAME",
            checked: !0
        },
        {
            title: "\u63d0\u4ea4\u65f6\u95f4",
            name: "FD.CREATE_TIME"
        }]
    };
    g = Backbone.View.extend({
        teams: {},
        initialize: function(a) {
            this.formId = a.formId;
            this.container = a.container;
            this.parentObj = a.parentObj;
            this.model = new f;
            this.el = "#formdatacolumn";
            this.module = a.module ? a.module: "formdatareport";
            this.fileds = b[this.module];
            this.splitStr = ",";
            $(this.container).html(d.template("formstat.datacolumn"));
            $(this.el).modal()
        },
        delegateEvents: function() {
            var a = this,
            b = $(a.el);
            b.on("hidden.bs.modal",
            function(b) {
                a.remove()
            });
            b.on("click.FormDataColumnView", "#saveColumn",
            function() {
                $(this).data("isClick") || ($(this).data("isClick", !0), a.saveColumn($(this)))
            });
            b.on("click.FormDataColumnView", "#columnFileds .j_column",
            function() {
                a.selectAllStatus()
            });
            b.on("click.FormDataColumnView", "#selectAll",
            function() {
                var a = $(this).is(":checked");
                b.find(".j_column").prop("checked", a)
            })
        },
        render: function() {
            for (var a = this,
            b = a.el,
            h = $(a.el), c = {
                formId: a.formId
            },
            k = a.fileds, f = 0; f < k.length; f++) {
                var q = $(b).find("#columnFiledsClone li").clone();
                q.find(".j_filedName").text(k[f].title);
                q.find(".j_column").prop("checked", k[f].checked).attr("data-type", "column").val(k[f].name);
                h.find("#columnFileds").append(q)
            }
            a.model.findDataColumn(c,
            function(c) {
                var k = c.fieldList;
                c = c.dataColumn;
                if (k) for (var f = 0; f < k.length; f++) {
                    var s = k[f],
                    q = s["delete"],
                    g = $(b).find("#columnFiledsClone li").clone();
                    g.find(".j_filedName").text(s.title);
                    g.find(".j_column").attr("data-type", "field").val(s.id);
                    q && (g.find(".j_filedName").addClass("td-lt c-999"), g.find(".j_bewrite").text("\u8be5\u5b57\u6bb5\u4e3a\u5220\u9664\u5b57\u6bb5,\u4e0d\u5728\u5f53\u524d\u8868\u5355\u7248\u672c\u4e2d\uff01"));
                    h.find("#columnFileds").append(g)
                }
                if (c) {
                    h.find(".j_column").prop("checked", !1);
                    if ((k = c.columnNames) && 0 < k.length) for (columnNameArry = k.split(a.splitStr), f = 0; f < columnNameArry.length; f++) h.find(".j_column[value\x3d'" + columnNameArry[f] + "']").prop("checked", !0);
                    if ((k = c.fieldIds) && 0 < k.length) for (fieldIdsArry = k.split(a.splitStr), f = 0; f < fieldIdsArry.length; f++) h.find(".j_column[value\x3d'" + fieldIdsArry[f] + "']").prop("checked", !0)
                }
                d.layout(b + " .modal-body");
                a.renderSort();
                a.selectAllStatus()
            })
        },
        renderSort: function() {
            $(this.el).find("#columnFileds li").each(function() {
                var a = $(this);
                a.find(".j_sort").html(a.index() + 1)
            })
        },
        saveColumn: function(a) {
            var b = this,
            h = $(this.el),
            c = {};
            c.formId = b.formId;
            c.fieldIds = "";
            c.columnNames = "";
            h.find("#columnFileds .j_column").each(function(a) {
                a = $(this);
                console.log(a.val());
                var h = a.is(":checked"),
                d = a.attr("data-type");
                h && ("field" == d ? c.fieldIds += a.val() + b.splitStr: c.columnNames += a.val() + b.splitStr)
            });
            "" == c.fieldIds && "" == c.columnNames ? (d.notify("\u5fc5\u987b\u9009\u62e9\u4e00\u9879"), a.data("isClick", !1)) : b.model.saveFormDataColumn({
                dataColumn: c
            },
            function(c) {
                a.data("isClick", !1);
                c.actionMsg ? d.notify(c.actionMsg.message) : (d.notify("\u4fdd\u5b58\u6210\u529f\uff01"), h.modal("hide"))
            })
        },
        selectAllStatus: function() {
            var a = $(this.el);
            a.find("#selectAll").prop("checked", !0);
            a.find("#columnFileds .j_column").each(function() {
                0 == $(this).is(":checked") && a.find("#selectAll").prop("checked", !1)
            })
        },
        remove: function() {
            $(".modal-backdrop.fade.in").remove();
            $(this.el).off(".FormDataColumnView");
            $(this.container).remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formfielddetailmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function(d) {
            this.fieldId = d.fieldId;
            this.componetKey = d.componetKey;
            this.set({
                pageNo: 0,
                pageSize: 10
            });
            this.on("change:pageNo",
            function(d) {
                d.getFormFieldDetailData()
            })
        },
        getFormFieldDetailData: function() {
            var d = this;
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formfieldstat/findFieldValueByPage.json",
                dataType: "json",
                data: JSON.stringify({
                    fieldId: d.fieldId,
                    componetKey: d.componetKey,
                    pageNo: d.get("pageNo"),
                    pageSize: d.get("pageSize")
                }),
                success: function(f) {
                    d.set({
                        pageinfo: f
                    })
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatsearchview", ["teams/utils", "teams/component/typeahead", "eteams/biaoge/formstat/formstatmodel", "teams/component/formview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/typeahead"),
    b = g("eteams/biaoge/formstat/formstatmodel"),
    a = g("teams/component/formview");
    g = Backbone.View.extend({
        initialize: function(e) {
            this.el = e.el ? e.el: ".j_advanceSearch";
            this.formFields = e.formFields;
            $(this.el).html(d.template("formstat.search"));
            this.formView = new a;
            this.model = new b
        },
        delegateEvents: function() {
            var a = this,
            b = $(a.el);
            $("body").on("click.FormStatSearchView",
            function(a) {
                0 == $(a.target).closest(".j_comboselect_ul").length && $(".j_comboselect_ul").removeClass("open")
            });
            b.on("change.FormStatSearchView", ".j_condition",
            function() {
                var a = $(this),
                b = a.val();
                "null" == b || "notnull" == b ? a.next().addClass("hide") : a.next().removeClass("hide")
            });
            b.on("click.FormStatSearchView", ".j_ok_btn",
            function() {
                var a = $(this).closest(".j_formField-condition"),
                b = a.find("li.active:last"),
                e = b.attr("selectionId"),
                h = b.attr("title"),
                b = b.closest(".combo_select_js").attr("id"),
                d = a.find(".j_selected");
                if (h && e) {
                    var f = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + e + ' title\x3d"' + h + '" selectId\x3d"' + b + '"\x3e' + h + "\x3c/a\x3e\x3c/span\x3e";
                    d.find(".entity-item").each(function(a) {
                        e == $(this).find("a").attr("id") && (f = null)
                    });
                    d.append(f)
                }
                a.find(".j_comboselect_ul").removeClass("open")
            });
            b.find(".j_filterSub").click(function() {
                var a = $(this);
                "true" == a.data("isFilterSub") ? a.data("isFilterSub", "false").removeClass("open") : a.data("isFilterSub", "true").addClass("open")
            });
            b.on("entitySelected", "#statsearch-entity .typeahead-search",
            function(a) {
                var b = $(this).parents(".j_entityContainer").find(".j_selected");
                b.empty();
                for (var e = 1; e < arguments.length; e++) {
                    var h = arguments[e],
                    d = h.name,
                    f = h.id,
                    g = h.module;
                    if (d && f) {
                        var v = '\x3cspan id\x3d"' + f + '" class\x3d"entity-item j_entity_item" name\x3d"j_entity_item"\x3e\x3ca data-placement\x3d"top" data-toggle\x3d"tooltip" data-original-title\x3d"' + d + '" id\x3d"' + f + '" class\x3d"entitybox-toggle" data-module\x3d"' + g + '" data-value\x3d"' + f + '" data-id\x3d"' + f + '"\x3e' + d + "\x3c/a\x3e\x3c/span\x3e";
                        b.find(".entity-item").each(function(a) {
                            f == $(this).find("a").attr("id") && (v = null)
                        });
                        b.append(v);
                        b.find(".j_entity_item").data("object", h)
                    }
                }
            });
            b.on("entitySelected", ".j_formstat_tag .typeahead-search",
            function(a) {
                for (var b = $(this).parents(".j_optcontainer").find(".j_selected"), e = 1; e < arguments.length; e++) {
                    var h = arguments[e],
                    d = h.name,
                    f = h.id,
                    g = h.module;
                    if (d && f) {
                        var v = '\x3cspan id\x3d"' + f + '" class\x3d"entity-item j_entity_item" name\x3d"j_entity_item"\x3e\x3ca data-placement\x3d"top" data-toggle\x3d"tooltip" data-original-title\x3d"' + d + '" id\x3d"' + f + '" class\x3d"entitybox-toggle" data-module\x3d"' + g + '" data-value\x3d"' + f + '" data-id\x3d"' + f + '"\x3e' + d + "\x3c/a\x3e\x3c/span\x3e";
                        b.find(".entity-item").each(function(a) {
                            f == $(this).find("a").attr("id") && (v = null)
                        });
                        b.append(v);
                        b.find(".j_entity_item").data("object", h)
                    }
                }
            });
            b.on("entitySelected", "#statsearch-entity .j_customer,.j_contact,.j_chance,.j_production",
            function(a) {
                var k = b.find("#statsearch-entity .j_entityContainer .j_selected");
                k.empty();
                for (var e = 1; e < arguments.length; e++) {
                    var d = arguments[e],
                    f = d.module,
                    g = "",
                    g = "contact" == f ? d.username: d.name,
                    n = d.id;
                    if (g && n) {
                        var v = '\x3cspan id\x3d"' + n + '" class\x3d"entity-item j_entity_item" name\x3d"j_entity_item"\x3e\x3ca data-placement\x3d"top" data-toggle\x3d"tooltip" data-original-title\x3d"' + g + '" id\x3d"' + n + '" class\x3d"entitybox-toggle" data-module\x3d"' + f + '" data-value\x3d"' + n + '" data-id\x3d"' + n + '"\x3e' + g + "\x3c/a\x3e\x3c/span\x3e";
                        k.find(".entity-item").each(function(a) {
                            n == $(this).find("a").attr("id") && (v = null)
                        });
                        k.append(v);
                        k.find(".j_entity_item").data("object", d)
                    }
                }
            });
            b.off("entitySelected", "#statsearch-mainline .entity-toggle").on("entitySelected", "#statsearch-mainline .entity-toggle",
            function(a) {
                b.find("#statsearch-mainline").find(".entity-container").empty();
                for (var k = 1; k < arguments.length; k++) {
                    var e = arguments[k],
                    d = e.name,
                    f = e.id;
                    if (d && f) {
                        var g = '\x3cspan id\x3d"' + f + '" class\x3d"entity-item j_entity_item" name\x3d"j_entity_item"\x3e\x3ca id\x3d"' + f + '" class\x3d"entitybox-toggle" data-module\x3d"mainline" data-value\x3d"' + f + '" data-id\x3d"' + f + '"\x3e' + d + "\x3c/a\x3e\x3c/span\x3e";
                        b.find("#statsearch-mainline").find(".entity-item").each(function(a) {
                            f == $(this).find("a").attr("id") && (g = null)
                        });
                        b.find("#statsearch-mainline").find(".entity-container").append(g);
                        b.find("#statsearch-mainline").find(".entity-container").find(".j_entity_item").data("object", e)
                    }
                }
            });
            b.on("change.FormStatSearchView", ".j_formField-select select",
            function() {
                var c = $(this),
                k = (new Date).getTime(),
                s = $(this).find("option:selected"),
                g = s.attr("id"),
                s = s.attr("key"),
                r = "";
                "flowName" == s ? (r = b.find("#flow-name-clone").clone(), c.parent().parent().attr("class", "sch-group j_flowNameSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html())) : "flowSubmitTime" == s ? (r = b.find("#flow-submitTime-clone").clone(), r.find(".j_datetime").attr("id", "j_datetime" + k), c.parent().parent().attr("class", "sch-group j_flowSubmitTimeSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html()), d.datepicker({
                    el: a.el + " #j_datetime" + k + " #startTime",
                    callback: function(c) {
                        c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                        var b = $(a.el + " #j_datetime" + k).find("#startTime"),
                        h = $(a.el + " #j_datetime" + k).find("#endTime");
                        h.val() && c > h.val() ? (d.notify("\u5f00\u59cb\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65e5\u671f"), b.val("")) : b.val(c)
                    }
                }), d.datepicker({
                    el: a.el + " #j_datetime" + k + " #endTime",
                    callback: function(c) {
                        c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                        var b = $(a.el + " #j_datetime" + k).find("#startTime"),
                        h = $(a.el + " #j_datetime" + k).find("#endTime");
                        b.val() && c < b.val() ? (d.notify("\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65e5\u671f"), h.val("")) : h.val(c)
                    }
                })) : "flowFinishTime" == s ? (r = b.find("#flow-finishTime-clone").clone(), r.find(".j_datetime").attr("id", "j_datetime" + k), c.parent().parent().attr("class", "sch-group j_flowFinishTimeSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html()), d.datepicker({
                    el: a.el + " #j_datetime" + k + " #startTime",
                    callback: function(c) {
                        c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                        var b = $(a.el + " #j_datetime" + k).find("#startTime"),
                        h = $(a.el + " #j_datetime" + k).find("#endTime");
                        h.val() && c > h.val() ? (d.notify("\u5f00\u59cb\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65e5\u671f"), b.val("")) : b.val(c)
                    }
                }), d.datepicker({
                    el: a.el + " #j_datetime" + k + " #endTime",
                    callback: function(c) {
                        c = Date.create(c.date).format("{yyyy}-{MM}-{dd}");
                        var b = $(a.el + " #j_datetime" + k).find("#startTime"),
                        h = $(a.el + " #j_datetime" + k).find("#endTime");
                        b.val() && c < b.val() ? (d.notify("\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65e5\u671f"), h.val("")) : h.val(c)
                    }
                })) : "flowStatus" == s ? (r = b.find("#flow-status-clone").clone(), c.parent().parent().attr("class", "sch-group j_flowStatusSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html())) : "flowOperator" == s ? (r = b.find("#flow-operator-clone").clone(), r.find(".j_optcontainer").attr("id", "j_opt" + k), c.parent().parent().attr("class", "sch-group j_flowOptSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html()), f({
                    el: a.el + " #j_opt" + k + " #typeahead-flow-employee",
                    callback: function(c) {
                        if (c && !$.isEmptyObject(c)) {
                            var d = b.find("#j_opt" + k + " .j_selected");
                            a.renderTypeheader(d, c)
                        }
                    }
                })) : "publicTag" == s ? (r = b.find("#publicTag-clone").clone(), r.find(".j_optcontainer").attr("id", "j_opt" + k), c.parent().parent().attr("class", "sch-group j_publicTagSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html()), f({
                    el: a.el + " #j_opt" + k + " #typeahead-flow-publictag",
                    callback: function(c) {
                        if (c && !$.isEmptyObject(c)) {
                            var d = b.find("#j_opt" + k + " .j_selected");
                            a.renderTypeheader(d, c)
                        }
                    }
                })) : "personalTag" == s ? (r = b.find("#personalTag-clone").clone(), r.find(".j_optcontainer").attr("id", "j_opt" + k), c.parent().parent().attr("class", "sch-group j_personalTagSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html()), f({
                    el: a.el + " #j_opt" + k + " #typeahead-flow-personaltag",
                    callback: function(c) {
                        if (c && !$.isEmptyObject(c)) {
                            var d = b.find("#j_opt" + k + " .j_selected");
                            a.renderTypeheader(d, c)
                        }
                    }
                })) : "flowOperatorDept" == s ? (r = b.find("#flow-operatordept-clone").clone(), r.find(".j_optdeptcontainer").attr("id", "j_optdept" + k), c.parent().parent().attr("class", "sch-group j_flowOptDeptSearchGroup"), c.parent().parent().find(".j_formField-condition").html(r.html()), f({
                    el: a.el + " #j_optdept" + k + " #typeahead-flow-department",
                    callback: function(c) {
                        if (c && !$.isEmptyObject(c)) {
                            var d = b.find("#j_optdept" + k + " .j_selected");
                            a.renderTypeheader(d, c)
                        }
                    }
                })) : (c = c.parent().parent(), a.formView.renderStatSearch({
                    parentEl: c,
                    fieldId: g,
                    componentKey: s,
                    container: a.el
                }))
            });
            b.on("change.FormStatSearchView", ".j_formField-condition .j_resultList",
            function() {
                var a = $(this),
                b = $(this).find("option:selected").attr("id"),
                e = a.val(),
                h = a.next().find(".j_selected");
                if (e && b) {
                    var d = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + b + "\x3e" + e + "\x3c/a\x3e\x3c/span\x3e";
                    h.find(".entity-item").each(function(a) {
                        b == $(this).find("a").attr("id") && (d = null)
                    });
                    h.append(d)
                }
                a.find("option").eq(0).prop("selected", !0)
            });
            b.on("change.FormStatSearchView", ".j_formField-condition .j_flowStatusList",
            function() {
                var a = $(this),
                b = $(this).find("option:selected").attr("id"),
                e = a.val(),
                h = a.next().find(".j_selected");
                if (e) {
                    var d = '\x3cspan class\x3d"entity-item"\x3e\x3ca status\x3d' + b + "\x3e" + e + "\x3c/a\x3e\x3c/span\x3e";
                    h.find(".entity-item").each(function(a) {
                        b == $(this).find("a").attr("status") && (d = null)
                    });
                    h.append(d)
                }
                a.find("option").eq(0).prop("selected", !0)
            });
            b.on("click.FormStatSearchView", ".j_addCondition",
            function() {
                var c = a.formFields,
                k = b.find("#form-search-clone").clone();
                b.find("#search-group-list").append(k.removeAttr("id").removeClass("hide"));
                k = k.find(".j_formField-select select");
                a.renderSearchComponent(c, k);
                $(window).resize()
            });
            b.on("click.FormStatSearchView", ".j_deletesearch",
            function() {
                $(this).parents(".sch-group").remove();
                $(window).resize()
            });
            b.on("click.FormStatSearchView", ".j_search-submit",
            function() {
                $("body").trigger("confirmSearch")
            });
            b.on("click.FormStatSearchView", ".j_search-close",
            function() {
                $("#initAdvanceSearch").trigger("click")
            });
            b.on("keyup.FormStatSearchView", ".j_formFieldSearchGroup .j_numberCheck",
            function(a) {
                a = $(this).val();
                $(this).val(a.replace(/[^\d.-]/g, ""))
            });
            b.on("blur.FormStatSearchView", ".j_formFieldSearchGroup .j_numberCheck",
            function(a) {
                $(this).trigger("keyup.FormStatSearchView")
            });
            b.on("keydown.FormStatSearchView", ".j_formFieldSearchGroup .j_numberCheck",
            function(a) {
                a = parseInt(a.keyCode);
                var b = $(this).val();
                if ((110 == a || 190 == a) && 0 <= b.indexOf(".") || (109 == a || 173 == a) && 0 <= b.indexOf("-")) return ! 1
            })
        },
        render: function() {
            var a = $(this.el),
            b = a.find("#search-group-list .j_formField-select select");
            this.renderSearchComponent(this.formFields, b);
            a.find(".j_filterSub").data("isFilterSub", "false").removeClass("open")
        },
        renderSearchComponent: function(a, b) {
            $(this.el);
            for (var c = 0; c < a.length; c++) {
                var k = a[c],
                d = k.id,
                f = k.componentKey,
                g = k.title,
                t = $("\x3coption id\x3d" + d + " key\x3d" + f + "\x3e" + g + "\x3c/option\x3e");
                k.subForm && k.subForm.id && (t = $("\x3coption id\x3d" + d + " subFormId\x3d" + k.subForm.id + " key\x3d" + f + "\x3e" + g + "\x3c/option\x3e"));
                0 != k["delete"] && (t.addClass("option-line"), t.text(t.text() + "(\u5df2\u5220\u9664)"));
                "ImageComponent" != f && "FileComponent" != f && "FormComponent" != f && b.append(t)
            }
            b.trigger("change.FormStatSearchView")
        },
        assembleParam: function() {
            var a = this,
            b = $(a.el),
            c = {},
            k = [];
            b.find("#search-group-list .j_flowNameSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                b = "",
                b = $.trim(a.find("input").val());
                "" == b && (b = null);
                if (null == b) return ! 0;
                k.push({
                    content: b,
                    term: c
                })
            });
            c.names = k;
            var d = [];
            b.find("#search-group-list .j_flowSubmitTimeSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                b = "",
                e = "",
                b = $.trim(a.find("input").eq(0).val()),
                e = $.trim(a.find("input").eq(1).val());
                "" == b && (b = null);
                "" == e && (e = null);
                if (null == b && null == e) return ! 0;
                d.push({
                    content: b,
                    endContent: e,
                    term: c
                })
            });
            c.createTimes = d;
            var f = [];
            b.find("#search-group-list .j_flowFinishTimeSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition");
                var c = c.attr("value"),
                b = "",
                e = "",
                b = $.trim(a.find("input").eq(0).val()),
                e = $.trim(a.find("input").eq(1).val());
                "" == b && (b = null);
                "" == e && (e = null);
                if (null == b && null == e) return ! 0;
                f.push({
                    content: b,
                    endContent: e,
                    term: c
                })
            });
            c.finishTimes = f;
            var g = [];
            b.find("#search-group-list .j_flowStatusSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                b = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("status");
                    b.push(a)
                });
                if (0 == b.length) return ! 0;
                g.push({
                    ids: b,
                    term: c
                })
            });
            c.types = g;
            var t = [];
            b.find("#search-group-list .j_publicTagSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                b = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    b.push(a)
                });
                if (0 == b.length) return ! 0;
                t.push({
                    ids: b,
                    term: c
                })
            });
            c.publicTags = t;
            var n = [];
            b.find("#search-group-list .j_personalTagSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                b = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    b.push(a)
                });
                if (0 == b.length) return ! 0;
                n.push({
                    ids: b,
                    term: c
                })
            });
            c.personalTags = n;
            var v = [];
            b.find("#search-group-list .j_flowOptSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                b = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    b.push(a)
                });
                if (0 == b.length) return ! 0;
                v.push({
                    ids: b,
                    term: c
                })
            });
            c.operators = v;
            var u = [];
            b.find("#search-group-list .j_flowOptDeptSearchGroup").each(function(a) {
                var c = $(this).find(".j_formField-condition select option:selected");
                a = $(this).find(".j_formField-condition .j_selected");
                var c = c.attr("value"),
                b = [];
                a.find(".entity-item").each(function(a) {
                    a = $(this).find("a").attr("id");
                    b.push(a)
                });
                if (0 == b.length) return ! 0;
                u.push({
                    ids: b,
                    term: c
                })
            });
            c.departments = u;
            var p = [];
            b.find("#search-group-list .j_formFieldSearchGroup").each(function(c) {
                var b = $(this).find(".j_formField-select select option:selected"),
                k = $(this).find(".j_formField-condition .j_condition option:selected");
                c = $(this).find(".j_formField-condition");
                var h = $(this).find(".j_formField-condition .j_selected"),
                d = b.attr("id"),
                f = b.attr("subformid"),
                b = b.attr("key"),
                k = k.attr("value"),
                s = "",
                g = "",
                q = [],
                s = "Text TextArea Email Phone Mobile FileComponent".split(" "),
                g = ["DateComponent", "Money", "NumberComponent", "Monitor", "Raty"],
                d = {
                    fieldId: d,
                    subFormId: f,
                    componentKey: b,
                    term: k
                };
                if ("null" != k && "notnull" != k) if (a.getType(b, s)) {
                    s = $.trim(c.find("input").val());
                    if ("" == s) return ! 0;
                    d.content = s
                } else if (a.getType(b, g)) {
                    s = $.trim(c.find("input").eq(0).val());
                    g = $.trim(c.find("input").eq(1).val());
                    "" == s && (s = null);
                    "" == g && (g = null);
                    if (null == s && null == g) return ! 0;
                    d.content = s;
                    d.endContent = g
                } else if ("ComboSelect" == b) {
                    var n = [];
                    h.find(".entity-item").each(function(a) {
                        a = $(this).find("a").attr("selectId");
                        var c;
                        a: {
                            for (c = 0; c < n.length; c++) if (n[c].fieldId == a) {
                                c = !0;
                                break a
                            }
                            c = !1
                        }
                        c || n.push({
                            fieldId: a,
                            componentKey: "Select"
                        })
                    });
                    for (c = 0; c < n.length; c++) f = n[c],
                    q = [],
                    h.find("a[selectId\x3d'" + f.fieldId + "']").each(function(a) {
                        a = $(this).attr("id");
                        q.push(a)
                    }),
                    f.ids = q;
                    if (0 == n.length) return ! 0;
                    d.children = n
                } else {
                    h.find(".entity-item").each(function(a) {
                        a = $(this).find("a").attr("id");
                        q.push(a)
                    });
                    if (0 == q.length) return ! 0;
                    d.ids = q
                }
                p.push(d)
            });
            c.filterFormDatas = p;
            0 < b.find(".j_filterSub").length && (c.isFilterSub = b.find(".j_filterSub").data("isFilterSub"));
            return c
        },
        renderTypeheader: function(a, b) {
            if (b.length) for (var c = 0; c < b.length; c++) {
                var k = b[c],
                d = k.name,
                f = k.id;
                if (d && f) {
                    var g = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + f + "\x3e" + d + "\x3c/a\x3e\x3c/span\x3e";
                    a.find(".entity-item").each(function(a) {
                        f == $(this).find("a").attr("id") && (g = null)
                    });
                    a.append(g)
                }
            } else d = b.name,
            f = b.id,
            d && f && (g = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + f + "\x3e" + d + "\x3c/a\x3e\x3c/span\x3e", a.find(".entity-item").each(function(a) {
                f == $(this).find("a").attr("id") && (g = null)
            }), a.append(g))
        },
        getType: function(a, b) {
            return - 1 < b.toString().indexOf(a) ? !0 : !1
        },
        remove: function() {
            $(this.el).off(".FormStatSearchView");
            $("body").off(".FormStatSearchView");
            $(this.el).find(".j_formstat-search").remove();
            this.formView && (this.formView.remove(), this.formView = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatdatatableview", ["teams/utils", "eteams/biaoge/formstat/formstatheaderview", "eteams/biaoge/formstat/formstatmodel", "eteams/biaoge/formstat/formstattableheaderview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatheaderview"),
    b = g("eteams/biaoge/formstat/formstatmodel"),
    a = g("eteams/biaoge/formstat/formstattableheaderview"),
    e = [{
        title: "\u4e0a\u62a5\u540d\u79f0",
        position: "left",
        name: "FD.NAME"
    },
    {
        title: "\u63d0\u4ea4\u4eba",
        position: "left",
        name: "E.USERNAME"
    },
    {
        title: "\u63d0\u4ea4\u65f6\u95f4",
        position: "left",
        name: "FD.CREATE_TIME"
    },
    {
        title: "\u7c7b\u578b",
        position: "left",
        name: "FD.OPERATOR"
    }];
    g = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.el = a.container ? a.container: "#j_formContent";
            this.model = new b;
            this.fileds = e;
            this.isKeyword = !1;
            this.userId = TEAMS.currentUser.id;
            $(this.el).html(d.template("formstat.formstatdatatable"));
            $(this.el).removeClass("scrollwrapper")
        },
        delegateEvents: function() {
            var a = this,
            c = $(a.el);
            $("body").on("click.FormStatDataTableView", ".goto-top",
            function(a) {
                d.gotoTop(".j_formstatScrY")
            });
            c.on("click.FormStatDataTableView", "#more_data",
            function(c) {
                c = $(this).data("page");
                a.renderListStatByRow(c.nextPage)
            });
            c.on("click.FormStatDataTableView", ".j_checkbox-span",
            function(a) {
                a = $(this).find("i");
                a.hasClass("icon-checkbox-unchecked") ? (a.removeClass("icon-checkbox-unchecked").addClass("icon-checkbox-checked"), $(this).css("display", "inline-block"), $(this).prev().css("display", "none")) : a.removeClass("icon-checkbox-checked").addClass("icon-checkbox-unchecked")
            });
            $("body").off("confirmSearch").on("confirmSearch",
            function(c) {
                a.renderListStatByRow(1)
            });
            $("body").off("confirmRenderTable").on("confirmRenderTable",
            function(c) {
                a.againRenderTable()
            })
        },
        render: function() {
            this.renderHeader();
            this.renderListStatByRow(1)
        },
        renderHeader: function() {
            this.headerView = new f({
                formId: this.formId,
                container: this.el + " .j_form_header",
                type: "stattable"
            });
            this.headerView.render()
        },
        renderTableheader: function() {
            this.tableheader = new a({
                formId: this.formId,
                htable: $(this.el).find("#head_table"),
                ctable: $(this.el).find("#stat_table"),
                fileds: this.fileds,
                parentObj: this
            });
            this.tableheader.render();
            this.formFields = this.tableheader.formFields
        },
        renderListStatByRow: function(a) {
            var c = this,
            b = c.el;
            $(b);
            var e = c.headerView.getParam();
            c.tableheader ? c.tableheader.getOrderParam(e) : c.renderTableheader();
            null == e.isFilterSub && (e.isFilterSub = !1);
            null == c.formFields || 0 == c.formFields.length ? $("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e\u5f53\u524d\u8868\u5355\u6ca1\u6709\u4efb\u4f55\u5b57\u6bb5\uff01\x3c/div\x3e') : (e.pageNo = a, 1 == a && ($(c.el).find("#stat_table").hide(), $(c.el).find("#stat_table tbody").empty()), $(c.el).find("#list-loading").show(), $(c.el).find("#more_data").hide(), c.model.findRowListStatForReport(e,
            function(e) {
                var f = e.formDatas,
                s = e.listStats,
                g = e.numberFieldStats,
                v = e.pageDatas,
                u = e.form;
                $(c.el).find("#list-loading").hide();
                $(c.el).find("#stat_table").show();
                u.permission ? e.message ? $(b).find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult"\x3e' + e.message + "\x3c/div\x3e") : null == u ? $(b).find("#formDatas").html('\x3cdiv class\x3d"formstat-noresult" style\x3d"color:#e60000;"\x3e\u8868\u5355\u4e0d\u5b58\u5728\x3c/div\x3e') : c.tableheader.renderPageMore($(b), v, f, a) && (c.tableheader.setTableFootCount(g, a), e = c.tableheader.bulidListStats(s), c.renderDataReport(f, e, v), c.mergerCells(f, e), c.tableheader.setfixRow(a, f.length, c.fileds.length + c.formFields.length + 2), d.layout(".j_formstatScrY")) : $(c.el).html(d.template("base.nopermission", {
                    msg: null
                }))
            }))
        },
        renderDataReport: function(a, c, b) {
            for (var e = this.el,
            d = TEAMS.currentTenant.tenantKey,
            f = this.formFields,
            g = 0; g < a.length; g++) {
                var n = a[g],
                v = n.id,
                u = Date.create(n.createTime),
                p = n.name ? n.name: "",
                w = "formdatareport" === n.module ? "\u6570\u636e\u4e0a\u62a5": "\u5916\u90e8\u5206\u53d1";
                if (! (0 < $(e + " stat_table tr #" + v).length)) for (var y = c[v] ? c[v] : [""], z = 0; z < y.length; z++) {
                    var l = y[z],
                    m = $("\x3ctr id\x3d" + v + "\x3e\x3c/tr\x3e");
                    m.append("\x3ctd class\x3d'num noSub_checkbox_" + v + "' title\x3d'" + (b.first + g) + "'\x3e\x3cdiv\x3e" + (b.first + g) + "\x3c/div\x3e\x3c/td\x3e");
                    1 == g % 2 && m.addClass("other-bgcolor");
                    m.append("\x3ctd title\x3d'" + p + "' name\x3d'FD.NAME'  class\x3d'noSub_name_" + v + "'\x3e\x3cdiv title\x3d'" + p + '\'\x3e\x3ca class\x3d"j_entityslider-toggle" data-id\x3d"' + v + '" formData\x3d"' + v + '" data-module\x3d"formdatareport" renderType\x3d"subordinates"\x3e' + p + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e");
                    n.operator && n.operator.id && n.tenantKeyTemp && n.tenantKeyTemp.toLowerCase() == d.toLowerCase() ? m.append("\x3ctd class\x3d'noSub_operate_" + v + "' name\x3d'E.USERNAME'\x3e\x3cdiv title\x3d'" + n.operator.username + "'\x3e\x3ca class\x3d'router usercard-toggle' userid\x3d'" + n.operator.id + "'\x3e" + n.operator.username + "\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e") : m.append("\x3ctd class\x3d'noSub_operate_" + v + "' name\x3d'E.USERNAME'\x3e\x3cdiv title\x3d'\u6e38\u5ba2'\x3e\u6e38\u5ba2\x3c/div\x3e\x3c/td\x3e");
                    m.append("\x3ctd class\x3d'noSub_time_" + v + "' name\x3d'FD.CREATE_TIME'\x3e\x3cdiv title\x3d'" + u.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}") + "'\x3e" + u.format("{yyyy}-{MM}-{dd}") + "\x3c/div\x3e\x3c/td\x3e");
                    m.append("\x3ctd class\x3d'noSub_type_" + v + "' name\x3d'FD.OPERATOR'\x3e\x3cdiv title\x3d'" + w + "'\x3e" + w + "\x3c/div\x3e\x3c/td\x3e");
                    for (var F = 0; F < f.length; F++) {
                        var G = f[F],
                        B = G.id,
                        D = G.componentKey,
                        x = "";
                        l && (x = l["C_" + B] || "");
                        var A = "noSub_" + v + "_" + B;
                        G.subForm && (A = "");
                        G = "";
                        if ("Money" == D || "NumberComponent" == D) G = "ta-r";
                        var D = v + "_" + (z + 1) + "_" + B,
                        E = !0;
                        try {
                            var H = JSON.parse(x.replace(/\s+/g, ""));
                            ocount = "";
                            if (0 < H.length && null != H[0].optionId) {
                                for (var I = 0; I < H.length; I++) option = H[I],
                                "image" == option.type || "imageFile" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.optionId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", E = !1) : option.targeId && 0 < option.targeId.length ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" class\x3d"gallery-pic" onclick\x3d"$.openPhotoGallery(this)" rel\x3d"0" imghref\x3d"/base/download/img/' + option.targeId + '/image" type\x3d"image"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", E = !1) : "file" == option.type ? (ocount += '\x3cp class\x3d"ellipsis" title\x3d"' + option.content + '"\x3e\x3ca target\x3d"_blank" data-value\x3d"' + option.optionId + '" href\x3d"/base/download/' + option.optionId + '"\x3e' + option.content + "\x3c/a\x3e\x3c/p\x3e", E = !1) : ocount += option.content + ",";
                                x = ocount.substring(0, ocount.length - 1)
                            }
                        } catch(J) {}
                        E ? m.append("\x3ctd id\x3d" + D + " name\x3d'" + B + "' class\x3d'" + A + " " + G + "' title\x3d'" + x + "'\x3e\x3cdiv title\x3d'" + x + "'\x3e" + x + "\x3c/div\x3e\x3c/td\x3e") : m.append("\x3ctd id\x3d" + D + " name\x3d'" + B + "' class\x3d'" + A + " " + G + "'\x3e\x3cdiv title\x3d'" + x + "'\x3e" + x + "\x3c/div\x3e\x3c/td\x3e")
                    }
                    m.append("\x3ctd class\x3d'fix j_fixcol noSub_fixcol_" + v + "'\x3e\x3c/td\x3e");
                    this.tableheader.setTableBodyWidth(m);
                    $(e).find("#stat_table tbody").append(m)
                }
            }
        },
        mergerCells: function(a, c) {
            var b = this.formFields;
            if (b && a) for (var e = 0; e < a.length; e++) {
                var d = a[e];
                if (c[d.id]) {
                    var f = c[d.id].length,
                    d = d.id;
                    $(this.el).find("#stat_table .noSub_checkbox_" + d + ":eq(0)").attr("rowspan", f);
                    $(this.el).find("#stat_table .noSub_checkbox_" + d + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_name_" + d + ":eq(0)").attr("rowspan", f);
                    $(this.el).find("#stat_table .noSub_name_" + d + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_operate_" + d + ":eq(0)").attr("rowspan", f);
                    $(this.el).find("#stat_table .noSub_operate_" + d + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_time_" + d + ":eq(0)").attr("rowspan", f);
                    $(this.el).find("#stat_table .noSub_time_" + d + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_type_" + d + ":eq(0)").attr("rowspan", f);
                    $(this.el).find("#stat_table .noSub_type_" + d + ":gt(0)").remove();
                    $(this.el).find("#stat_table .noSub_fixcol_" + d + ":eq(0)").attr("rowspan", f);
                    $(this.el).find("#stat_table .noSub_fixcol_" + d + ":gt(0)").remove();
                    for (var g = 0; g < b.length; g++) {
                        var n = b[g];
                        n.subForm || (n = n.id, $(this.el).find("#stat_table .noSub_" + d + "_" + n + ":eq(0)").attr("rowspan", f), $(this.el).find("#stat_table .noSub_" + d + "_" + n + ":gt(0)").remove())
                    }
                }
            }
        },
        againRenderTable: function() {
            var a = $(this.el);
            this.tableheader.remove();
            this.tableheader = null;
            a.find("#formDatas").html($(d.template("formstat.formstatdatatable")).find("#formDatas").html());
            this.renderListStatByRow(1);
            $(window).resize()
        },
        removeFormStatTable: function(a) {
            this.render()
        },
        remove: function() {
            this.formsStatHeaderView && (this.formsStatHeaderView.remove(), this.formsStatHeaderView = null);
            this.tableheader && this.tableheader.remove();
            $(this.el).off(".FormStatDataTableView")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstattabview", "teams/utils eteams/biaoge/formstat/formstattableview eteams/biaoge/formstat/formstatchartview eteams/biaoge/formstat/formfieldstatview eteams/biaoge/formstat/formreportview eteams/biaoge/formmanage/formcollectloglistview eteams/biaoge/formmanage/formloglistview".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstattableview"),
    b = g("eteams/biaoge/formstat/formstatchartview"),
    a = g("eteams/biaoge/formstat/formfieldstatview"),
    e = g("eteams/biaoge/formstat/formreportview"),
    h = g("eteams/biaoge/formmanage/formcollectloglistview"),
    c = g("eteams/biaoge/formmanage/formloglistview");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.el = a.container;
            this.isAdmin = TEAMS.currentUser.admin;
            $(this.el).html(d.template("formstat.baseformstattab"));
            $("#j_formLabelscroll").hide()
        },
        delegateEvents: function() {
            var k = this,
            d = $(k.el);
            d.on("click.BaseFormStatTabView", ".toolkit-item-tab",
            function() {
                var g = $(this),
                r = g.find("a").attr("id");
                d.find(".toolkit-item-tab").removeClass("active");
                g.addClass("active");
                switch (r) {
                case "data-stat":
                    k.mainView = new f({
                        formId: k.formId,
                        container: "#js-formstat"
                    });
                    k.mainView.render();
                    break;
                case "data-trend":
                    k.mainView = new b({
                        formId: k.formId,
                        el: "#js-formstat"
                    });
                    k.mainView.render();
                    break;
                case "field-stat":
                    k.mainView = new a({
                        formId: k.formId,
                        el: "#js-formstat"
                    });
                    k.mainView.render();
                    break;
                case "report-stat":
                    k.mainView = new e({
                        formId: k.formId,
                        el: "#js-formstat"
                    });
                    break;
                case "insidecollect-log":
                    k.mainView = new h({
                        formId: k.formId,
                        el: "#js-formstat"
                    });
                    k.mainView.render();
                    break;
                case "submit-log":
                    k.mainView = new c({
                        formId: k.formId,
                        el: "#js-formstat"
                    });
                    k.mainView.render();
                    break;
                default:
                    d.html("")
                }
            })
        },
        render: function() {
            $(this.el).find("#data-stat").parent().trigger("click")
        },
        remove: function() {
            $(this.el).off(".BaseFormStatTabView")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/taskformview", "teams/utils eteams/biaoge/formstat/formstattableview eteams/biaoge/formstat/formfieldstatview eteams/biaoge/formstat/formreportview teams/component/ispayremindview eteams/biaoge/formstat/taskformmodel".split(" "),
function(g, m, l) {
    var d = g("teams/utils");
    g("eteams/biaoge/formstat/formstattableview");
    g("eteams/biaoge/formstat/formfieldstatview");
    g("eteams/biaoge/formstat/formreportview");
    var f = g("teams/component/ispayremindview"),
    b = g("eteams/biaoge/formstat/taskformmodel");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.isPay = !1;
            if (TEAMS.currentTenant && TEAMS.currentTenant.isPay) this.isPay = !0;
            else if ("normal" == TEAMS.currentTenant.status || "outPayUserInweek" == TEAMS.currentTenant.status || "outPayRoom" == TEAMS.currentTenant.status || "outPayUserOutweek" == TEAMS.currentTenant.status || "prepaid" == TEAMS.currentTenant.status || "probation" == TEAMS.currentTenant.status) this.isPay = !0;
            this.userId = a.userId || TEAMS.currentUser.id;
            this.container = a.container;
            this.model = new b;
            this.tab = "form_set";
            this.el = "#taskform";
            TEAMS.currentUser.admin ? this.isPay ? $(this.container).html(d.template("task.taskform")) : null == this.isPayRemindView && (this.isPayRemindView = new f, this.isPayRemindView.render("freeformview")) : $(this.container).html(d.template("base.nopermission", {
                msg: null
            }))
        },
        delegateEvents: function() {
            var a = this,
            b = $(a.el);
            $("body").on("click.TaskForm", ".goto-top",
            function() {
                d.gotoTop(".j_center")
            });
            b.on("click.TaskForm", ".j_set_form",
            function() {
                var b = $(this),
                c = b.closest(".j_commonType"),
                e = c.attr("id"),
                f = c.attr("formId");
                f ? window.open("/freeform/edit/" + f + "/task") : a.model.getTaskForm({
                    type: "common",
                    id: e
                },
                function(a) {
                    if (a.actionMsg && 0 != a.actionMsg.code) d.notify(a.actionMsg.message);
                    else if (e = a.taskFormLink && a.taskFormLink.id, f = a.taskFormLink && a.taskFormLink.form && a.taskFormLink.form.id) c.attr({
                        id: e,
                        formId: f
                    }),
                    b.removeClass("btn-success").addClass("btn-primary").text("\u5df2\u8bbe\u7f6e"),
                    window.open("/freeform/edit/" + f + "/task")
                },
                !0)
            });
            b.on("keyup.TaskForm", ".j_newTaskTypeName",
            function(a) {
                13 == a.which && b.find(".j_type_add").trigger("click")
            });
            b.on("click.TaskForm", ".j_type_add",
            function(h) {
                var c = $(this),
                k = b.find(".j_newTaskTypeName"),
                f = $.trim(k.val());
                _.isEmpty(f) ? d.notify("\u4efb\u52a1\u7c7b\u578b\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01") : (k.attr("disabled", !0), c.addClass("disabled"), h = b.find(".j_taskType .list-item").length + 1, a.model.addTaskType({
                    name: f,
                    customizeType: "taskType",
                    orderId: h
                },
                function(a) {
                    k.removeAttr("disabled");
                    c.removeClass("disabled");
                    a.actionMsg && 0 != a.actionMsg.code ? d.notify(a.actionMsg.message) : ($newClone = b.find("#itemClone").clone().attr("id", a.taskFormLink.id), a = b.find(".j_taskType .list-item").length + 1, $newClone.find(".sn").text(a), $newClone.find(".j_taskTypeName").val(f).data("name", f), b.find(".j_taskType").append($newClone), k.val(""))
                }))
            });
            b.on("click.TaskForm", ".j_taskType .j_type_del",
            function(h) {
                var c = $(this).closest(".list-item"),
                k = c.attr("id");
                d.confirm("\u8be5\u7c7b\u578b\u5173\u8054\u7684\u4efb\u52a1\u81ea\u5b9a\u4e49\u8868\u5355\u53ca\u6570\u636e\u90fd\u5c06\u88ab\u5220\u9664\uff0c\u786e\u8ba4\u5220\u9664\u5417\uff1f",
                function(h) {
                    h && a.model.delTaskType({
                        id: k
                    },
                    function(a) {
                        a.actionMsg && 0 != a.actionMsg.code ? d.notify(a.actionMsg.message) : (c.remove(), b.find(".j_taskType .sn").each(function(a) {
                            $(this).text(a + 1)
                        }))
                    })
                })
            });
            b.on("focusout.TaskForm", ".j_taskType .j_taskTypeName",
            function() {
                var b = $(this),
                c = b.closest(".list-item").attr("id"),
                e = b.data("name"),
                f = $.trim(b.val());
                _.isEmpty(f) ? d.notify("\u4efb\u52a1\u7c7b\u578b\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01") : f != e && a.model.updateTaskType({
                    id: c,
                    name: f
                },
                function(a) {
                    a.actionMsg && 0 != a.actionMsg.code ? d.notify(a.actionMsg.message) : (b.data("name", f), d.notify("\u4efb\u52a1\u7c7b\u578b\u540d\u79f0\u4fee\u6539\u6210\u529f"))
                })
            });
            b.on("click.TaskForm", ".j_taskType .j_type_setting",
            function() {
                var b = $(this),
                c = b.closest(".list-item"),
                e = c.attr("id"),
                f = c.attr("formId");
                f ? window.open("/freeform/edit/" + f + "/task") : a.model.getTaskForm({
                    type: "taskType",
                    id: e
                },
                function(a) {
                    if (a.actionMsg && 0 != a.actionMsg.code) d.notify(a.actionMsg.message);
                    else if (a = a.taskFormLink && a.taskFormLink.form && a.taskFormLink.form.id) c.attr("formId", a),
                    b.removeClass("btn-success").addClass("btn-primary").text("\u5df2\u8bbe\u7f6e"),
                    window.open("/freeform/edit/" + a + "/task")
                },
                !0)
            })
        },
        renderTaskType: function() {
            var a = this,
            b = $(a.el);
            a.model.loadTaskType({
                type: "common"
            },
            function(a) {
                if (a.actionMsg && 0 != a.actionMsg.code) d.notify(a.actionMsg.message);
                else {
                    if (a = a.taskFormLinks && a.taskFormLinks[0]) b.find(".j_commonType").attr("id", a.id),
                    (a = a.form && a.form.id) && b.find(".j_commonType").attr("formId", a),
                    b.find(".j_set_form").removeClass("btn-success").addClass("btn-primary").text("\u5df2\u8bbe\u7f6e");
                    b.find(".j_set_form").removeClass("disabled")
                }
            });
            a.model.loadTaskType({
                type: "taskType"
            },
            function(h) {
                h.actionMsg && 0 != h.actionMsg.code ? d.notify(h.actionMsg.message) : (_.each(h.taskFormLinks,
                function(a, k) {
                    var h = a.form && a.form.id,
                    d = b.find("#itemClone").clone().attr("id", a.id);
                    d.find(".sn").text(k + 1);
                    d.find(".j_taskTypeName").val(a.name).data("name", a.name);
                    h && (d.attr("formId", h), d.find(".j_type_setting").removeClass("btn-success").addClass("btn-primary").text("\u5df2\u8bbe\u7f6e"));
                    b.find(".j_taskType").append(d)
                }), b.find(".j_taskType").sortable({
                    opacity: .9,
                    handle: ".sn",
                    revert: !0,
                    helper: "clone",
                    axis: "y",
                    placeholder: "tasktype-placeholder",
                    update: function(c, k) {
                        var h = [];
                        b.find(".j_taskType .sn").each(function(a) {
                            $(this).text(a + 1);
                            h.push($(this).closest(".list-item").attr("id"))
                        });
                        a.model.sort({
                            ids: h
                        },
                        function(a) {
                            a.actionMsg && 0 != a.actionMsg.code ? d.notify(a.actionMsg.message) : d.notify("\u987a\u5e8f\u8c03\u6574\u6210\u529f")
                        })
                    }
                }), b.find(".j_taskType .sn").disableSelection())
            })
        },
        render: function() {
            $(this.el);
            TEAMS.currentUser.admin && (this.renderTaskType(), d.layout(".j_center"))
        },
        remove: function() {
            $(this.el).off(".TaskForm");
            this.isPayRemindView && (this.isPayRemindView.remove(), this.isPayRemindView = null);
            $(this.continer).empty()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/docformview", "teams/utils eteams/biaoge/formstat/formstatmodel eteams/biaoge/formstat/formstattableview eteams/biaoge/formstat/formfieldstatview eteams/biaoge/formstat/formreportview teams/component/ispayremindview".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formstat/formstatmodel"),
    b = g("eteams/biaoge/formstat/formstattableview"),
    a = g("eteams/biaoge/formstat/formfieldstatview"),
    e = g("eteams/biaoge/formstat/formreportview"),
    h = g("teams/component/ispayremindview");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.isPay = !1;
            if (TEAMS.currentTenant && TEAMS.currentTenant.isPay) this.isPay = !0;
            else if ("normal" == TEAMS.currentTenant.status || "outPayUserInweek" == TEAMS.currentTenant.status || "outPayRoom" == TEAMS.currentTenant.status || "outPayUserOutweek" == TEAMS.currentTenant.status || "prepaid" == TEAMS.currentTenant.status || "probation" == TEAMS.currentTenant.status) this.isPay = !0;
            this.userId = a.userId || TEAMS.currentUser.id;
            this.container = a.container;
            this.model = new f;
            this.tab = a.userId || "form_set";
            this.el = "#docform";
            TEAMS.currentUser.admin ? this.isPay ? $(this.container).html(d.template("document.docform")) : null == this.isPayRemindView && (this.isPayRemindView = new h, this.isPayRemindView.render("freeformview")) : $(this.container).html(d.template("base.nopermission", {
                msg: null
            }))
        },
        delegateEvents: function() {
            var a = this,
            b = $(a.el);
            b.on("click", ".j_set_form",
            function() {
                a.model.loadDocForm({
                    "form.module": "document"
                },
                function(a) {
                    window.open("/freeform/edit/" + a.form.id + "/document")
                })
            });
            b.on("click", ".js_formtab li",
            function(b) {
                a.renderTab($(this))
            })
        },
        renderTab: function(c) {
            c.addClass("active").siblings().removeClass("active");
            var k = c.attr("data-target"),
            h = $("#" + k);
            h.show().siblings(".js_forms").hide();
            if ("true" != c.attr("data-load")) switch ($("li[data-target\x3d'" + k + "']").attr("data-load", !0), k) {
            case "form_manager":
                this.renderTab($("li[data-target\x3d'form_data']"));
                break;
            case "form_data":
                this.tabView = new b({
                    formId: this.formId,
                    container: "#" + k,
                    module: "document"
                });
                this.tabView.render();
                break;
            case "form_stat":
                this.statView = new a({
                    formId: this.formId,
                    el: "#" + k
                });
                $("li[data-target\x3d'form_stat']").attr("data-load", !1);
                break;
            case "form_report":
                this.reportView = new e({
                    formId: this.formId,
                    el: "#" + k
                })
            } else switch (k) {
            case "form_manager":
                this.renderTab($("li[data-target\x3d'form_data']"));
                break;
            case "form_data":
                h.find("#formStatContent").trigger("resize"),
                h.find(".j_formstarScr").mCustomScrollbar("scrollTo", "left")
            }
        },
        render: function() {
            var a = this;
            TEAMS.currentUser.admin && (a.model.loadDocForm({
                "form.module": "document",
                isCreate: !1
            },
            function(b) { (b = b.form) && b.id ? (a.formId = b.id, $("li[data-target\x3d'form_manager']").show()) : $("li[data-target\x3d'form_manager']").hide()
            }), a.renderTab($("li[data-target\x3d'" + a.tab + "']")))
        },
        remove: function() {
            $(this.el).off(".DocForm");
            this.isPayRemindView && (this.isPayRemindView.remove(), this.isPayRemindView = null);
            $(this.continer).html("")
        }
    });
    l.exports = g
});
define("eteams/biaoge/formstat/formstatchartview", ["teams/utils", "teams/component/typeahead", "eteams/biaoge/formstat/formstatchartmodel"],
function(g, m, l) {
    var d = g("teams/utils");
    g("teams/component/typeahead");
    var f = g("eteams/biaoge/formstat/formstatchartmodel");
    m = Backbone.View.extend({
        initialize: function(b) {
            this.model = new f({
                formId: b.formId
            });
            this.el = b.el;
            b = d.template("formstat.formstatchart");
            this.$el.html(b);
            this.initComponents()
        },
        initComponents: function() {
            var b = this,
            a = b.model;
            d.datepicker([{
                el: "#begin-date",
                callback: function(e) {
                    var h = e.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(h, a.endDate) ? a.beginDate = h || a.beginDate: e.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            },
            {
                el: "#end-date",
                callback: function(e) {
                    var h = e.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(a.beginDate, h) ? a.endDate = h || a.endDate: e.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            }]);
            b.$el.find("#begin-date").val(a.beginDate);
            b.$el.find("#end-date").val(a.endDate)
        },
        isBefore: function(b, a) {
            if (b && a) {
                if (Date.create(b).isBefore(a, 864E5)) return ! 0;
                d.notify("\u8bf7\u786e\u8ba4\u8f93\u5165\u7684\u8d77\u59cb\u65e5\u5728\u5230\u671f\u65e5\u4e4b\u524d");
                return ! 1
            }
            return ! 0
        },
        delegateEvents: function() {
            var b = this,
            a = b.model;
            $("body").on("click.taskreport", ".goto-top",
            function(a) {
                d.gotoTop(".js_taskreportScr")
            });
            b.$el.on("click.taskreport", ".j_time a",
            function(e) {
                switch ($(e.target).attr("data")) {
                case "thisWeek":
                    a.beginDate = Date.create().beginningOfWeek().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "last2weeks":
                    a.beginDate = Date.create().beginningOfWeek().addDays( - 7).format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "thisMonth":
                    a.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}");
                    break;
                case "lastMonth":
                    a.beginDate = Date.create().addMonths( - 1).beginningOfMonth().format("{yyyy}-{MM}-{dd}"),
                    a.endDate = Date.create().addMonths( - 1).endOfMonth().format("{yyyy}-{MM}-{dd}")
                }
                b.$el.find("#begin-date").val(a.beginDate);
                b.$el.find("#end-date").val(a.endDate);
                b.$el.find(".j_time .btn").removeClass("btn-success");
                $(this).addClass("btn-success");
                b.loadDayChart()
            });
            b.$el.on("click.taskreport", "#load",
            function() {
                b.$el.find(".j_time .btn").removeClass("btn-success");
                b.loadDayChart()
            })
        },
        remove: function() {
            this.$el.off(".taskreport");
            this.dayChart && ($(window).off("resize", this.dayChart.resize), this.dayChart.dispose(), this.dayChart = null);
            this.finishChart && ($(window).off("resize", this.finishChart.resize), this.finishChart.dispose(), this.finishChart = null);
            this.urgencyChart && ($(window).off("resize", this.urgencyChart.resize), this.urgencyChart.dispose(), this.urgencyChart = null);
            this.stopListening();
            this.model = null
        },
        render: function(b, a) {
            var e = this;
            d.layout(".js_taskreportScr");
            g.async("https://static.eteams.cn/js/echarts.min.js",
            function() {
                e.initCharts();
                e.loadDayChart()
            })
        },
        dayChartBasicOption: {
            title: {
                text: "\u6570\u636e\u91c7\u96c6\u7edf\u8ba1"
            },
            tooltip: {
                trigger: "item"
            },
            legend: {
                data: [""]
            },
            calculable: !0,
            toolbox: {
                show: !0,
                feature: {
                    magicType: {
                        show: !0,
                        type: ["bar", "line"]
                    },
                    restore: {
                        show: !0
                    },
                    saveAsImage: {
                        show: !0
                    }
                }
            },
            dataZoom: {
                show: !0,
                start: 5,
                end: 95
            },
            yAxis: [{
                type: "value"
            }],
            color: ["#3AEC94"]
        },
        dayChart: null,
        initCharts: function() {
            var b;
            b = this.dayChart = echarts.init(document.getElementById("day-chart"), "macarons");
            $(window).on("resize", b.resize)
        },
        loadDayChart: function() {
            var b = this;
            if (b.dayChart) {
                var a = b.dayChart;
                a.showLoading({
                    effect: "spin"
                });
                b.model.statisticsByDay(function(e) {
                    a.hideLoading();
                    e = _.extend(e, b.dayChartBasicOption);
                    a.setOption(e, !0)
                })
            } else d.alert("\u672a\u627e\u5230\u56fe\u8868\u7ec4\u4ef6\uff0c\u8bf7\u786e\u8ba4\u9875\u9762\u52a0\u8f7d\u6b63\u786e")
        }
    });
    l.exports = m
});
define("eteams/biaoge/formstat/formcollectchartmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        id: "",
        pageNo: 1,
        pageSize: 10,
        initialize: function(d) {
            this.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
            this.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}");
            this.statisticians = [TEAMS.currentUser.id];
            this.formId = d.formId;
            this.xAxis = null
        },
        search: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdata/findFormDataByFormId.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        statisticsByDay: function(d) {
            var f = this;
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/formdatastat/findFormDataTrendForChart.json",
                dataType: "json",
                data: JSON.stringify({
                    beginDate: f.beginDate,
                    endDate: f.endDate + " 24:00:00",
                    formId: f.formId
                }),
                success: function(b) {
                    if (d) {
                        var a = f.xAxis = f.calculateX();
                        b = f.parseSeries(b.formTrendData);
                        d({
                            xAxis: a,
                            series: b
                        })
                    }
                }
            })
        },
        calculateX: function() {
            var d = [{
                type: "category",
                data: []
            }];
            Date.range(this.beginDate, this.endDate).every("day",
            function(f) {
                d[0].data.push(f.format("{yyyy}-{MM}-{dd}"))
            });
            return d
        },
        parseSeries: function(d) {
            var f = [{
                name: "\u6b21\u6570",
                type: "bar",
                data: []
            }];
            _.isEmpty(d) || (f[0].data = this.parseMapToArray(d));
            return f
        },
        parseMapToArray: function(d) {
            for (var f = Array(this.xAxis[0].data.length), b, a, e = 0, h = d.length; e < h; e++) a = d[e],
            b = this.xAxis[0].data.indexOf(a.ctime),
            f[b] = a.counts;
            return f
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formpage", "teams/utils teams/core/page eteams/biaoge/form/formwriteview eteams/biaoge/form/formdatareportlistview eteams/biaoge/formstat/formstattabview eteams/biaoge/formmanage/formwatchlistview eteams/biaoge/formmanage/formwatchchartview eteams/biaoge/formmanage/formlabelpageview eteams/biaoge/form/formcloudview teams/component/trashbinview eteams/biaoge/formstat/formstatdatatableview eteams/biaoge/formstat/formstatdatachartview eteams/biaoge/formstat/formstatdatareportview".split(" "),
function(g, m, l) {
    g("teams/utils");
    m = g("teams/core/page");
    var d = g("eteams/biaoge/form/formwriteview"),
    f = g("eteams/biaoge/form/formdatareportlistview"),
    b = g("eteams/biaoge/formstat/formstattabview"),
    a = g("eteams/biaoge/formmanage/formwatchlistview"),
    e = g("eteams/biaoge/formmanage/formwatchchartview"),
    h = g("eteams/biaoge/formmanage/formlabelpageview"),
    c = g("eteams/biaoge/form/formcloudview"),
    k = g("teams/component/trashbinview"),
    s = g("eteams/biaoge/formstat/formstatdatatableview"),
    q = g("eteams/biaoge/formstat/formstatdatachartview"),
    r = g("eteams/biaoge/formstat/formstatdatareportview");
    g = m.extend({
        initialize: function(a) {
            this.isAdmin = TEAMS.currentUser.admin;
            this.userId = a.userId ? a.userId: TEAMS.currentUser.id;
            this.type = a.type ? a.type: "write";
            this.formId = a.formId;
            this.pageKey = "form#" + this.type + this.userId + this.formId;
            this.reloadPage = a.reloadPage;
            this.options = a;
            this.template = "form.formpage";
            this.pageActive = "form";
            this.el = "#mainContainer";
            this.isAdmin = TEAMS.currentUser.admin;
            this.isWeaver = "t7akvdnf84" == TEAMS.currentTenant.tenantKey || "T7AKVDNF84" == TEAMS.currentTenant.tenantKey ? !0 : !1
        },
        delegateEvents: function() {
            $(this.el);
            this.on("removeformstattable",
            function(a) {
                this.mainView.removeFormStatTable(a)
            })
        },
        render: function() {
            var g = this,
            n = $(g.el);
            g.initLayout({
                userId: this.options.userId ? this.options.userId: TEAMS.currentUser.id,
                isAdmin: this.isAdmin,
                isWeaver: this.isWeaver
            },
            function() {
                g.renderType()
            });
            "form-manager" == g.type ? (g.mainView = new b({
                formId: g.formId,
                container: g.el + " #j_formContent"
            }), n.find(".j_form-form-manager").removeClass("active")) : "cloud" == g.type ? g.mainView = new c({
                id: g.userId,
                el: g.el + " #j_formContent",
                module: "biaoge"
            }) : "monitor" == g.type ? g.mainView = new a: "monitorList" == g.type ? g.mainView = new a: "monitorChart" == g.type ? g.mainView = new e: "label" == g.type ? g.mainView = new h({
                id: g.userId,
                el: g.el + " #j_formContent"
            }) : "write" == g.type || "mywrite" == g.type || "employeewrite" == g.type || "companywrite" == g.type ? (g.mainView = new d({
                userId: g.userId,
                container: g.el + " #j_formContent",
                type: g.type
            }), n.find(".j_form_write").addClass("active")) : "trashbin" == g.type ? g.mainView = new k({
                userId: g.userId,
                container: g.el + " #j_formContent",
                module: "form"
            }) : "todo" == g.type || "finshed" == g.type || "subordinates" == g.type ? (g.mainView = new f({
                userId: g.userId,
                type: g.type
            }), g.entityCallback = function(a) {
                "finshed" == a && $("#report-list").find(".active .text").addClass("finished-line");
                "back" == a && $("#report-list").find(".active .text").removeClass("finished-line")
            }) : "stattable" == g.type ? (g.mainView = new s({
                formId: g.formId,
                container: g.el + " #j_formContent"
            }), n.find(".j_form_write").addClass("active")) : "statreport" == g.type ? (g.mainView = new r({
                formId: g.formId,
                el: g.el + " #j_formContent"
            }), n.find(".j_form-form-manager").removeClass("active")) : "statchart" == g.type && (g.mainView = new q({
                formId: g.formId,
                el: g.el + " #j_formContent"
            }), n.find(".j_form-form-manager").removeClass("active"));
            g._render(".j_form-" + g.type);
            "form-manager" == g.type && n.find(".j_form-form-manager").removeClass("active")
        },
        renderSubview: function() {},
        renderType: function() {
            var a = "\u6211\u7684";
            TEAMS.blogUser && "female" == TEAMS.blogUser.sex ? a = "\u5979\u7684": TEAMS.blogUser && (a = "\u4ed6\u7684");
            $(".j_all_formMenu li").each(function() {
                var b = $(this);
                if (!b.hasClass("sub-indent")) {
                    var c = b.data("title");
                    if ("\u529e\u7406\u7684\u5ba1\u6279" == c || "\u521b\u5efa\u7684\u5ba1\u6279" == c) a = a.substring(0, 1);
                    b.hasClass("shareToMe") ? b.find(".j_type-name").html("\u5171\u4eab\u7ed9" + a + "\u5ba1\u6279") : b.find(".j_type-name").html(a + c)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formuploadmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function(d) {},
        findFormLabel: function(d, f) {
            $.ajax({
                type: "POST",
                data: d,
                url: "/biaoge/findFormLabel.json",
                dataType: "json",
                success: function(b) {
                    f && f(b)
                }
            })
        },
        saveFormUpload: function(d, f) {
            $.ajax({
                type: "post",
                url: "/form/saveFormUpload.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b.resultData)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formdatareportlistview", ["teams/utils", "eteams/biaoge/form/formdatareportmodel", "teams/component/filter"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formdatareportmodel"),
    b = g("teams/component/filter");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.userId = a.userId;
            this.type = a.type;
            this.el = a.container || "#j_formContent";
            this.model = new f(a);
            $(this.el).html(d.template("form.formdatareportlist"))
        },
        render: function() {
            var a = this;
            a.model.search(a._getParam(),
            function(b) {
                $("#reportlist-loading").hide();
                1 == b.page.pageNo && 0 == b.page.result.length ? ($(".j_no_my_datareport").show(), "todo" == a.type ? $(".j_no_my_datareport").find(".j_text").text("\u4eb2\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5173\u7684\u5f85\u586b\u5199\u4e0a\u62a5\u54e6\uff01") : "finshed" == a.type && $(".j_no_my_datareport").find(".j_text").text("\u4eb2\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5173\u7684\u5df2\u586b\u5199\u4e0a\u62a5\u54e6\uff01"), $("#report-list").hide()) : ($("#report-list").show(), $(".j_no_my_datareport").hide());
                b.page.hasNext ? $(".js_more").show() : $(".js_more").hide();
                1 == a.model.pageNo && $("#report-list").empty();
                a._renderList(b.page.result);
                $("#reportlist-loading").addClass("hide");
                d.layout(a.el)
            })
        },
        delegateEvents: function() {
            var a = this,
            e = this.model,
            h = $(a.el);
            h.on("click.FormDataReportList", ".js_more",
            function() {
                e.pageNo = 1 * e.pageNo + 1;
                a.render();
                $(this).hide()
            });
            $("body").on("click.FormDataReportList", ".goto-top",
            function(b) {
                d.gotoTop(a.el)
            });
            h.on("click.FormDataReportList", ".orderType",
            function() {
                $(".orderType").parent("li").removeClass("active");
                $(this).parent("li").addClass("active");
                e.pageNo = 1;
                a.render()
            });
            h.on("search.FormDataReportList", "#report-keywords",
            function() {
                e.pageNo = 1;
                a.render()
            });
            h.on("keyup.FormDataReportList", "#report-keywords",
            function(a) {
                13 == (a ? a: window.event ? window.event: null).keyCode && $(this).trigger("search")
            });
            h.on("click.FormDataReportList", "li.search .icon-search",
            function() {
                h.find("#report-keywords").trigger("search")
            });
            h.on("keyup.FormDataReportList", "#report-list",
            function(b) {
                b = b.which;
                if (38 == b) {
                    var e = a.getPrev();
                    e && e.trigger("click")
                }
                40 == b && (b = a.getNext()) && b.trigger("click")
            });
            h.on("mouseenter.FormDataReportList", "#datareport-filter",
            function(c) {
                var e = $(this).attr("data-toggle");
                a.filter || (a.filter = new b({
                    el: e,
                    module: "formdatareport",
                    targetObj: $(this),
                    userId: a.userId
                }), a.filter.render(c));
                c = setTimeout(function() {
                    $(e).slideDown("fast")
                },
                300);
                $(this).data("showTimer", c);
                $(this).addClass("open")
            }).on("mouseleave.FormDataReportList", "#datareport-filter",
            function(a) {
                a = $(this).attr("data-toggle");
                var b = $(this).data("showTimer");
                b && clearTimeout(b);
                $(this).removeData("showTimer");
                $(a).slideUp(100);
                $(this).removeClass("open")
            }).on("filter.FormDataReportList", "#datareport-filter",
            function(b) {
                e.pageNo = 1;
                a.render()
            });
            h.on("click.FormDataReportList", "li.datareport",
            function(b) {
                $(this).removeClass("unread");
                $(this).removeClass("newComment");
                a._highLight($(this).attr("id"))
            })
        },
        _getParam: function() {
            var a = {},
            b = {};
            b.type = "subordinates" === this.type ? "subordinates": "mine";
            b.status = "subordinates" != this.type ? this.type: null;
            b.order = {
                property: $("#j_order_list").find(".active a").attr("data-entity")
            };
            $("#report-keywords").val() == $("#report-keywords").attr("placeholder") ? b.keywords = null: b.keywords = $("#report-keywords").val().trim() || null;
            b.creators = this.filter ? this.filter.managers: null;
            b.reportGtDate = $("#report-time-begin").val() || null;
            b.reportLtDate = $("#report-time-end").val() || null;
            b.formIds = this.filter ? this.filter.comments: null;
            a.userId = this.userId;
            a.filter = b;
            return a
        },
        _rebuildSN: function() {
            d.rebuildSN($("#report-list"))
        },
        _highLight: function(a) {
            a ? d.highLight("#j_formContent", a) : d.highLight("#j_formContent", $("#j_formContent").find("li:first").attr("id"))
        },
        _renderList: function(a) {
            for (var b = 0; b < a.length; b++) {
                var h = $("#report-clone").clone(),
                c = a[b];
                h.find(".date").html(Date.create(c.createTime).format("{yyyy}-{MM}-{dd}"));
                h.attr("id", c.id);
                h.attr("href", "/forms/" + this.userId + "/" + c.id);
                h.attr("userId", this.userId);
                h.attr("data-id", c.id);
                h.attr("renderType", this.type);
                h.find(".text").html(c.name);
                "subordinates" === this.type && h.find(".user").html(c.reporter.username);
                "finshed" === c.status && h.find(".text").addClass("finished-line");
                c.unread && h.addClass("unread");
                c.newConment && h.addClass("newComment");
                $("#report-list").append(h)
            }
            this._rebuildSN()
        },
        removeFormStatTable: function(a) {
            this.render()
        },
        remove: function() {
            this.undelegateEvents();
            $(this.el).off(".FormDataReportList");
            this.filter && (this.filter.remove(), this.filter = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/remindconfigview", ["teams/utils", "teams/component/typeahead", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/typeahead"),
    b = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.el = "#remind-config-view";
            this.callback = a.callback;
            this.userId = a.userId;
            this.parentEl = a.parentEl ? a.parentEl: "body";
            $(this.parentEl).append(d.template("form.remindconfig"));
            this.model = new b(a)
        },
        delegateEvents: function() {
            var a = this,
            b = $(a.el),
            h = a.model;
            $(a.el).on("hidden.bs.modal.RemindConfig",
            function(b) {
                $(b.target).hasClass("datepicker") || a.remove()
            });
            $(a.el).off("change.RemindConfig", ".j_config #fixUser-select").on("change.RemindConfig", ".j_config #fixUser-select",
            function() {
                $(this);
                var b = $(a.el).find("#fixUser-select").val();
                if ("user" == b) $(a.el).find(".j_remindTo_div .sharetype-user").removeClass("hide"),
                $(a.el).find(".j_remindTo_div .sharetype-dept").addClass("hide"),
                $(a.el).find(".j_remindTo_div .sharetype-user input").focus();
                else if ("department" == b) $(a.el).find(".j_remindTo_div .sharetype-dept").removeClass("hide"),
                $(a.el).find(".j_remindTo_div .sharetype-user").addClass("hide"),
                $(a.el).find(".j_remindTo_div .sharetype-dept input").focus();
                else {
                    $(a.el).find(".j_remindTo_div .sharetype-dept").addClass("hide");
                    $(a.el).find(".j_remindTo_div .sharetype-user").removeClass("hide");
                    $(a.el).find(".j_remindTo_div #addUser").removeClass("hide");
                    $(a.el).find(".j_remindTo_div .typeahead-wrapper").addClass("hide");
                    $(this).val("user");
                    var b = $(a.el).find(".j_remindTo_div .j_selected"),
                    e = !1;
                    b.find(".entity-item").each(function(a) {
                        0 == $(this).find("a").attr("id") && (e = !0)
                    });
                    e ? d.notify("\u5df2\u6dfb\u6240\u6709\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : b.append('\x3cspan class\x3d"entity-item" type\x3d"allpeople"\x3e\x3ca id\x3d"0"\x3e\u6240\u6709\u4eba\x3c/a\x3e\x3c/span\x3e')
                }
            });
            f([{
                el: a.el + " .j_remindTo_div .sharetype-dept input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find(".j_remindTo_div .j_selected");
                        a.renderTypeheader(e, b, "department")
                    }
                }
            },
            {
                el: a.el + " .j_remindTo_div .sharetype-user input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find(".j_remindTo_div .j_selected");
                        a.renderTypeheader(e, b, "user")
                    }
                }
            }]);
            $(a.el).off("click.RemindConfig", "#remindconfig-close").on("click.RemindConfig", "#remindconfig-close",
            function(b) {
                $(a.el).modal("hide")
            });
            $(a.el).off("change.RemindConfig", ".j_config .j_remindTime_select").on("change.RemindConfig", ".j_config .j_remindTime_select",
            function(b) {
                "custom" == $(this).val() ? $(a.el).find(".j_config .j_time_div .j_custom_div").removeClass("hide") : $(a.el).find(".j_config .j_time_div .j_custom_div").addClass("hide")
            });
            $(a.el).off("change.RemindConfig", ".j_config .j_which_day").on("change.RemindConfig", ".j_config .j_which_day",
            function(b) {
                "currentDay" == $(this).val() ? $(a.el).find(".j_config .j_custom_div .j_days").addClass("hide") : $(a.el).find(".j_config .j_custom_div .j_days").removeClass("hide")
            });
            $(a.el).off("change.RemindConfig", ".j_config .j_remindTo_select").on("change.RemindConfig", ".j_config .j_remindTo_select",
            function(b) {
                "fixUser" == $(this).val() ? ($(a.el).find(".j_config .j_remindTo_div .j_addUserDiv").removeClass("hide"), $(a.el).find(".j_config .j_remindTo_div .j_addUsers").removeClass("hide"), $(a.el).find(".j_config .j_remindTo_div .j_selected").removeClass("hide")) : ($(a.el).find(".j_config .j_remindTo_div .j_addUserDiv").addClass("hide"), $(a.el).find(".j_config .j_remindTo_div .j_addUsers").addClass("hide"), $(a.el).find(".j_config .j_remindTo_div .j_selected").addClass("hide"))
            });
            $(a.el).off("click.RemindConfig", ".j_addConfig").on("click.RemindConfig", ".j_addConfig",
            function(b) {
                $(a.el).find(".j_config_result").addClass("hide");
                $(a.el).find(".j_config").removeClass("hide");
                $(a.el).find(".j_detail-actions .j_back").removeClass("hide");
                $(a.el).find(".j_detail-actions .j_addConfig").addClass("hide");
                $(a.el).find(".j_detail-actions .j_saveConfig").removeClass("hide");
                $(a.el).find(".j_detail-actions #remindconfig-close").addClass("hide");
                0 == $(a.el).find(".j_config .j_timeField_div .j_datefieldSelect option").length ? ($(a.el).find(".j_config .j_timeField_div .j_datefieldSelect").addClass("hide"), $(a.el).find(".j_config .j_timeField_div .j_time_div").addClass("hide"), $(a.el).find(".j_config .j_timeField_div .j_noDate").removeClass("hide"), $(a.el).find(".j_config .j_timeField_div .j_tips").addClass("hide")) : ($(a.el).find(".j_config .j_timeField_div .j_datefieldSelect option").eq(0).attr("selected", !0), $(a.el).find(".j_config .j_timeField_div .j_time_div .j_days").addClass("hide"), $(a.el).find(".j_config .j_timeField_div .j_time_div .j_which_day option").eq(0).attr("selected", !0), $(a.el).find(".j_config .j_remindTo_div .j_remindTo_select option").eq(0).attr("selected", !0));
                0 == $(a.el).find(".j_config .j_remindTo_div .j_remindTo_select .j_option").length ? ($(a.el).find(".j_config .j_remindTo_div .j_addUserDiv").removeClass("hide"), $(a.el).find(".j_config .j_remindTo_div .j_addUserDiv .j_addUsers").removeClass("hide")) : $(a.el).find(".j_config .j_remindTo_div .j_addUserDiv").addClass("hide");
                $(a.el).find(".j_remindContent").val("");
                $(a.el).find(".j_config .j_remindTo_div .j_addUserDiv .j_selected").empty();
                $(a.el).find(".j_detail-actions .j_saveConfig").removeAttr("configId configStatus")
            });
            $(a.el).off("click.RemindConfig", ".j_back").on("click.RemindConfig", ".j_back",
            function(b) {
                $(a.el).find(".j_config_result").removeClass("hide");
                $(a.el).find(".j_config").addClass("hide");
                $(a.el).find(".j_detail-actions .j_back").addClass("hide");
                $(a.el).find(".j_detail-actions .j_addConfig").removeClass("hide");
                $(a.el).find(".j_detail-actions .j_saveConfig").addClass("hide");
                $(a.el).find(".j_detail-actions #remindconfig-close").removeClass("hide");
                a.queryConfigByFormId()
            });
            $(a.el).on("keyup", ".j_days",
            function(a) {
                a = $(this).val();
                $(this).val(a.replace(/[^\d.-]/g, ""))
            });
            $(a.el).off("click.RemindConfig", ".j_saveConfig").on("click.RemindConfig", ".j_saveConfig",
            function(c) {
                c = $(this);
                var k = c.attr("configId"),
                f = c.attr("configStatus");
                c = {};
                k && (c.configId = k);
                f && (c.configStatus = f);
                c.formId = a.formId;
                k = b.find(".j_config");
                f = k.find(".j_remindContent").val();
                if (null == f || "" == f) d.notify("\u8bf7\u586b\u5199\u63d0\u9192\u5185\u5bb9");
                else if (150 < f.length) d.notify("\u63d0\u9192\u5185\u5bb9\u592a\u957f\u4e86\uff0c\u6700\u591a\u53ea\u80fd\u8f93\u5165150\u4e2a\u5b57\u54e6");
                else {
                    c.remindConent = f;
                    var f = k.find(".j_datefieldSelect").val(),
                    g = k.find('.j_datefieldSelect option[id\x3d"' + f + '"]').text();
                    if (null == f || "" == f) d.notify("\u8bf7\u9009\u62e9\u63d0\u9192\u65f6\u95f4");
                    else {
                        c.remindDatefield = f;
                        c.dateFieldTitle = g;
                        f = k.find(".j_which_day").val();
                        if ("currentDay" != f) {
                            k.find(".j_days").removeClass("hide");
                            g = k.find(".j_days").val();
                            if (0 == /^[0-9]*[1-9][0-9]*$/.test(g)) {
                                d.notify("\u8bf7\u8f93\u5165\u4e0d\u5927\u4e8e31\u7684\u6b63\u6574\u6570");
                                return
                            }
                            if (null == g || "" == g) {
                                d.notify("\u8bf7\u9009\u62e9\u63d0\u524d\u6216\u5ef6\u540e\u5929\u6570");
                                return
                            }
                            if (0 >= g || 31 < g) {
                                d.notify("\u8bf7\u8f93\u5165\u4e0d\u5927\u4e8e31\u7684\u6b63\u6574\u6570");
                                return
                            }
                            c.customDays = g
                        } else c.customDays = 0;
                        c.customType = f;
                        f = k.find(".j_remindTo_select").val();
                        g = k.find('.j_remindTo_select option[value\x3d"' + f + '"]').text();
                        c.remindtoTitle = g;
                        var r = [];
                        "fixUser" != f ? r.push("field_" + f) : k.find(".j_selected span").each(function() {
                            var a = $(this).attr("type"),
                            b = $(this).find("a").attr("id");
                            r.push(a + "_" + b)
                        });
                        0 == r.length ? d.notify("\u8bf7\u9009\u62e9\u8981\u53d1\u9001\u7684\u4eba") : (c.remindtoTypesAndIds = r, h.createRemindConfig(c,
                        function(b) {
                            b.actionMsg ? d.notify(b.actionMsg.message) : (d.notify("\u6dfb\u52a0\u6210\u529f"), $(a.el).find(".j_config_result").removeClass("hide"), $(a.el).find(".j_config").addClass("hide"), $(a.el).find(".j_detail-actions .j_back").addClass("hide"), $(a.el).find(".j_detail-actions .j_addConfig").removeClass("hide"), $(a.el).find(".j_detail-actions .j_saveConfig").addClass("hide"), $(a.el).find(".j_detail-actions #remindconfig-close").removeClass("hide"), a.queryConfigByFormId())
                        }))
                    }
                }
            });
            $(a.el).off("click.RemindConfig", ".j_statBtn").on("click.RemindConfig", ".j_statBtn",
            function(a) {
                var b = $(this),
                e = b.attr("stat"),
                h = b.parents(".j_configsLi").attr("id");
                a = {};
                a.configId = h;
                a.configStatus = e;
                $.ajax({
                    type: "post",
                    url: "/remindconfig/updateConfigStatus.json",
                    dataType: "json",
                    data: a,
                    success: function(a) {
                        a.actionMsg ? d.notify(a.actionMsg.message) : (d.notify("\u4fee\u6539\u72b6\u6001\u6210\u529f"), "enable" == e ? (b.text("\u505c\u7528").attr("stat", "disable"), b.parents("#" + h).find(".j_status").html('\u542f\u7528\x3ci class\x3d"caret ml-3"\x3e\x3c/i\x3e')) : "disable" == e && (b.text("\u542f\u7528").attr("stat", "enable"), b.parents("#" + h).find(".j_status").html('\u505c\u7528\x3ci class\x3d"caret ml-3"\x3e\x3c/i\x3e')))
                    }
                })
            });
            $(a.el).off("click.RemindConfig", ".j_edit").on("click.RemindConfig", ".j_edit",
            function(b) {
                var e = $(this).parents(".j_configsLi").data("config");
                $(a.el).find(".j_detail-actions .j_addConfig").addClass("hide");
                $(a.el).find(".j_detail-actions .j_saveConfig").removeClass("hide").attr("configId", e.id).attr("configStatus", e.configStatus);
                $(a.el).find(".j_detail-actions .j_back").removeClass("hide");
                $(a.el).find(".j_detail-actions #remindconfig-close").addClass("hide");
                b = $(a.el).find(".j_config");
                var h = e.remindConent,
                d = e.remindDatefield,
                f = e.customType,
                g = e.customDays;
                b.find(".j_remindContent").val(h);
                $(a.el).find(".j_config .j_datefieldSelect").find('option[value\x3d"' + d + '"]').attr("selected", !0);
                "currentDay" == f ? b.find(".j_which_day").find('option[value\x3d"currentDay"]').attr("selected", !0) : (b.find(".j_which_day").find('option[value\x3d"' + f + '"]').attr("selected", !0), b.find(".j_days").val(g).removeClass("hide"));
                e = e.remindScopes;
                if (null != e && 0 < e.length) for (b.find(".j_selected").empty(), h = 0; h < e.length; h++) d = e[h],
                g = d.remindtoType,
                f = d.remindtoId,
                "field" == g ? (b.find(".j_remindTo_select").find('option[value\x3d"' + f + '"]').attr("selected", !0), b.find(".j_addUserDiv").addClass("hide")) : "user" == g ? (b.find(".j_remindTo_select").find('option[value\x3d"fixUser"]').attr("selected", !0), g = $('\x3cspan class\x3d"entity-item" type\x3d"user"\x3e\x3ca\x3e\x3c/a\x3e\x3c/span\x3e'), g.find("a").attr("id", f).text(d.username), b.find(".j_selected").append(g), b.find(".j_addUsers").removeClass("hide"), b.find(".j_addUserDiv").removeClass("hide")) : "department" == g ? (b.find(".j_remindTo_select").find('option[value\x3d"fixUser"]').attr("selected", !0), g = $('\x3cspan class\x3d"entity-item" type\x3d"department"\x3e\x3ca\x3e\x3c/a\x3e\x3c/span\x3e'), g.find("a").attr("id", f).text(d.deptname), b.find(".j_selected").append(g), b.find(".j_addUsers").removeClass("hide"), b.find(".j_addUserDiv").removeClass("hide")) : "allpeople" == g && (b.find(".j_remindTo_select").find('option[value\x3d"fixUser"]').attr("selected", !0), g = $('\x3cspan class\x3d"entity-item" type\x3d"allpeople"\x3e\x3ca\x3e\x3c/a\x3e\x3c/span\x3e'), g.find("a").attr("id", 0).text("\u6240\u6709\u4eba"), b.find(".j_selected").append(g), b.find(".j_addUsers").removeClass("hide"), b.find(".j_addUserDiv").removeClass("hide"));
                $(a.el).find(".j_config_result").addClass("hide");
                $(a.el).find(".j_config").removeClass("hide")
            });
            $(a.el).off("click.RemindConfig", ".j_delete").on("click.RemindConfig", ".j_delete",
            function(b) {
                var e = $(this).parents(".j_configsLi").attr("id");
                d.confirm("\u786e\u8ba4\u5220\u9664\u5417\uff1f",
                function(b) {
                    b && (b = {},
                    b.configId = e, $.ajax({
                        type: "post",
                        url: "/remindconfig/deleteOneConfig.json",
                        dataType: "json",
                        data: b,
                        success: function(b) {
                            b.actionMsg ? d.notify(b.actionMsg.message) : (d.notify("\u5220\u9664\u6210\u529f"), $(a.el).find(".j_configsUL").find('.j_configsLi[id\x3d"' + e + '"]').remove(), 0 == $(a.el).find(".j_configsUL li").length ? $(a.el).find("#no-data").removeClass("hide") : $(a.el).find("#no-data").addClass("hide"))
                        }
                    }))
                })
            })
        },
        renderTypeheader: function(a, b, h) {
            if (b.length) for (var c = 0; c < b.length; c++) {
                var k = b[c],
                d = k.name,
                f = k.id;
                if (d && f) {
                    var g = '\x3cspan class\x3d"entity-item" type\x3d"' + h + '"\x3e\x3ca id\x3d' + f + "\x3e" + d + "\x3c/a\x3e\x3c/span\x3e";
                    a.find(".entity-item").each(function(a) {
                        f == $(this).find("a").attr("id") && (g = null)
                    });
                    a.append(g)
                }
            } else d = b.name,
            f = b.id,
            d && f && (g = '\x3cspan class\x3d"entity-item" type\x3d"' + h + '"\x3e\x3ca id\x3d' + f + "\x3e" + d + "\x3c/a\x3e\x3c/span\x3e", a.find(".entity-item").each(function(a) {
                f == $(this).find("a").attr("id") && (g = null)
            }), a.append(g))
        },
        queryDateComponent: function() {
            var a = $(this.el),
            b = this.model,
            h = {};
            h.formId = this.formId;
            b.queryDateComponent(h,
            function(b) {
                if (!b || !b.actionMsg) {
                    b = b.formFields;
                    for (var e = 0; e < b.length; e++) {
                        var h = b[e];
                        if (!h.subForm) {
                            var d = h.id,
                            h = h.title,
                            f = a.find("#remindconfig-clone .j_option").clone();
                            f.attr("id", d);
                            f.attr("value", d);
                            f.text(h);
                            a.find(".j_config .j_datefieldSelect").append(f)
                        }
                    }
                }
            })
        },
        queryEmployeeComponent: function() {
            var a = $(this.el),
            b = this.model,
            h = {};
            h.formId = this.formId;
            b.queryEmployeeComponent(h,
            function(b) {
                if (!b || !b.actionMsg) {
                    b = b.formFields;
                    for (var e = 0; e < b.length; e++) {
                        var h = b[e];
                        if (!h.subForm) {
                            var d = h.id,
                            h = h.title,
                            f = a.find("#remindconfig-clone .j_option").clone();
                            f.attr("id", d);
                            f.attr("value", d);
                            f.text(h);
                            a.find(".j_config .j_remindTo_select").append(f)
                        }
                    }
                    b = $('\x3coption value\x3d"fixUser"\x3e\u6307\u5b9a\u4eba\u5458\x3c/option\x3e');
                    a.find(".j_config .j_remindTo_select").append(b)
                }
            })
        },
        queryConfigByFormId: function() {
            var a = this,
            b = a.model,
            h = {};
            h.formId = a.formId;
            b.queryConfigByFormId(h,
            function(b) {
                if (!b || !b.actionMsg) if ((b = b.remindConfigs) && 0 == b.length) $(a.el).find("#no-data").removeClass("hide"),
                $(a.el).find(".j_detail-actions .j_addConfig").addClass("hide");
                else {
                    $(a.el).find("#no-data").addClass("hide");
                    $(a.el).find(".j_detail-actions .j_addConfig").removeClass("hide");
                    $(a.el).find(".j_configsUL").empty();
                    for (var e = 0; e < b.length; e++) {
                        var h = b[e],
                        d = $(a.el).find("#remindconfig-clone .j_configsLi").clone();
                        d.find(".j_remindContent").text(h.remindConent);
                        d.find(".j_remindConfigResult").text(h.configResult);
                        d.data("config", h);
                        d.attr("id", h.id);
                        var f = h.configStatus;
                        "enable" == f ? (d.find(".j_status").html('\u542f\u7528\x3ci class\x3d"caret ml-3"\x3e\x3c/i\x3e'), d.find(".j_statBtn").text("\u505c\u7528").attr("stat", "disable")) : "disable" == f && (d.find(".j_status").html('\u505c\u7528\x3ci class\x3d"caret ml-3"\x3e\x3c/i\x3e'), d.find(".j_statBtn").text("\u542f\u7528").attr("stat", "enable"));
                        0 == $(a.el).find(".j_configsUL").find("#" + h.id).length && $(a.el).find(".j_configsUL").append(d)
                    }
                }
            })
        },
        render: function() {
            this.queryDateComponent();
            this.queryEmployeeComponent();
            this.queryConfigByFormId();
            $(this.el).modal("show");
            d.layout(".j_remindConfigScr")
        },
        hide: function() {
            $(this.el).modal("hide")
        },
        remove: function() {
            $(this.el).off(".RemindConfig");
            $("#remind-config-view").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formdatareportstartview", ["teams/utils", "eteams/biaoge/form/formmanagemodel", "eteams/biaoge/form/formoperationview", "eteams/biaoge/form/writeformview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formmanagemodel"),
    b = g("eteams/biaoge/form/formoperationview"),
    a = g("eteams/biaoge/form/writeformview");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.mainlineId = a.mainlineId;
            this.container = a.container ? a.container: "#entitybox-container";
            this.userId = a.userId ? a.userId: TEAMS.currentUser.id;
            this.tpl = d.template("form.formdatareportstart", {
                userId: TEAMS.currentUser.id
            });
            this.callback = a.callback;
            $(this.container).html($(this.tpl).siblings("#formdatareport-container"));
            this.el = "#formdatareport-container";
            this.model = new f(a);
            this.module = "biaoge"
        },
        delegateEvents: function() {
            var e = this,
            h = $(e.tpl),
            c = $(e.el);
            c.on("click.FormDataReportStartView", ".js_formitemsli",
            function(a) {
                a = $(a.target);
                a.hasClass("js_previewbtn") || null != a.parents(".js_previewbtn").get(0) || "form-title" != a.attr("id") && $(this).find("#form-title").click()
            });
            c.on("click.FormDataReportStartView", "#form-title",
            function() {
                var b = $(this);
                e.writeformview = new a({
                    userId: TEAMS.currentUser.id,
                    formId: b.attr("data-id"),
                    container: "#entitySlider",
                    callback: e.callback,
                    mainlineId: e.mainlineId,
                    page: this.page
                });
                e.writeformview.render()
            });
            c.on("click.FormDataReportStartView", ".js_formPreview",
            function() {
                window.open("/form/preview/" + $(this).attr("formId"));
                return ! 1
            });
            c.on("click.FormDataReportStartView", ".js_buildNewForm",
            function() {
                var a = {};
                a.module = e.module;
                a.el = "#build-newform";
                a.tpl = d.template("biaoge.formnew");
                a.ownership = "personal";
                a.formwrite = "formwrite";
                a.saveCallback = function(a) {
                    var b = c.find(".js_forms .js_form_list .js_categoryname"),
                    k;
                    0 == b.length && (c.find(".js_forms #other-category").html('\x3cdiv class\x3d"js_formcategory"\x3e\x3cdiv class\x3d"form-category-hd eform-cty-hd j_form-category"\x3e\x3ch4 id\x3d"cate-name"\x3e\x3cspan class\x3d"js_categoryname ctyname"\x3e\u5176\u4ed6\x3c/span\x3e\x3cspan class\x3d"form-acount js_formcount"\x3e\x3c/span\x3e\x3c/h4\x3e\x3cspan class\x3d"j_formcateInfo formcatetip hide"\x3e\u60a8\u53ef\u4ee5\u62d6\u62fd\u8868\u5355\u5206\u7c7b\u8fdb\u884c\u6392\u5e8f\uff0c\u4ea6\u53ef\u62d6\u62fd\u5206\u7c7b\u4e0b\u7684\u8868\u5355\u8fdb\u884c\u6392\u5e8f\uff1b\u9f20\u6807\u70b9\u51fb\u5206\u7c7b\u540d\u79f0\u56de\u8f66\u5373\u53ef\u4fdd\u5b58\u4fee\u6539\uff0cESC\u4e0d\u4fdd\u5b58\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"wform-list clearfix j_formlist"\x3e\x3c/ul\x3e\x3c/div\x3e'), k = c.find(".js_forms #other-category .js_categoryname"));
                    for (var d = 0; d < b.length; d++) if (a.form.formCategory) {
                        if (a.form.formCategory.id == b[d].id) {
                            k = b[d];
                            break
                        }
                    } else {
                        k = b[b.length - 1];
                        break
                    }
                    b = $(k).parents(".js_formcategory").find(".j_formlist");
                    d = h.siblings("#formitems").find(".js_formitemsli").clone();
                    e.renderForm(a.form, b, d, "prepend");
                    c.find("#noformsShow").remove();
                    c.find(".js_forms #propforms-con").remove();
                    a = $(k).parents(".js_formcategory").find(".j_formlist").find(".js_formitemsli").length;
                    $(k).parents(".js_formcategory").find(".js_formcount").text("(" + a + ")")
                };
                e.formoperationView = new b(a);
                e.formoperationView.render()
            });
            c.on("click.FormDataReportStartView", ".js_searchform .icon-search",
            function(a) {
                a = c.find(".js_searchkeyword");
                a = $.trim(a.val());
                var b = {
                    module: "biaoge"
                };
                b.keyword = a;
                c.find(".js_form_list").empty();
                a ? e.renderKeywords(b) : (c.find(".js_form_list").html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e'), e.renderWriteForms(b))
            });
            c.on("keyup.FormDataReportStartView", ".js_searchform .js_searchkeyword",
            function(a) {
                13 == (a ? a: window.event ? window.event: null).keyCode && c.find(".js_searchform .icon-search").click()
            })
        },
        render: function() {
            this.renderWriteForms({
                module: "biaoge"
            });
            d.layout(".js_formdatareportScr")
        },
        renderWriteForms: function(a) {
            var b = this,
            c = b.model,
            k = $(b.el);
            k.find("#formlist-loading").show();
            c.queryMyForms(a,
            function(a) {
                var c = k.find(".js_forms .js_companyforms");
                b.loadCateAndForms(a, c);
                0 == k.find(".js_companyforms .js_formitemsli").length ? (a = k.find("#noresult-clone").find("#noresultShow").clone(), a.find(".j_small").text("\u60a8\u6682\u65f6\u6ca1\u6709\u4e1a\u52a1\u8868\u5355\u54e6\uff01"), a.find(".j_btn-div").remove(), k.find(".js_companyforms").append(a)) : k.find(".js_companyforms #noresultShow").remove();
                k.find("#formlist-loading").hide()
            })
        },
        loadCateAndForms: function(a, b) {
            $(this.el);
            b.html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e');
            var c = b.find("#custom-category"),
            k = b.find("#other-category"),
            d = a.formCategories,
            f;
            for (f in d) {
                var g = d[f],
                t = g.name,
                n = g.id,
                v = g.sort,
                u = g.forms,
                p = 0;
                u && 0 < u.length && (p = u.length);
                var w = g.type,
                g = $(this.tpl).siblings(".js_formcategory").clone();
                "\u5176\u4ed6" == t ? g.addClass("js_other") : g.find(".js_categoryname").attr("id", n).attr("sort", v).attr("type", w);
                g.find(".js_categoryname").text(t);
                g.find(".js_categoryname").attr("title", t);
                g.find(".form-acount").text("(" + p + ")");
                for (var y in u) t = u[y],
                n = g.find(".j_formlist"),
                v = $(this.tpl).siblings("#formitems").find(".js_formitemsli").clone(),
                this.renderForm(t, n, v);
                g.hasClass("js_other") ? k.append(g) : c.append(g);
                this.buildSerialNumber(g.find(".j_formlist"))
            }
        },
        renderForm: function(a, b, c, k) {
            $(this.el);
            var f = a.name,
            g = a.describe,
            r = a.id;
            c.find("#form-number").css("background-color", d.getRandomColor());
            c.attr("formid", r).attr("sort", a.sort).attr("id", r);
            c.find(".js_formPreview").attr("formId", r);
            c.find("#form-title").text(f).attr("title", f).attr("data-id", r).attr("userId", this.userId);
            if (void 0 == g || "" === g) g = "\u6682\u65e0\u8868\u5355\u63cf\u8ff0",
            c.find("#form-describe").removeClass("description").addClass("nodescription");
            c.find("#form-describe").text(g).attr("title", g);
            c.find(".js_formListBox").attr("formId", r);
            "prepend" == k ? b.prepend(c) : b.append(c);
            this.buildSerialNumber(b)
        },
        renderKeyword: function(a) {
            var b = $(this.el),
            c = $(this.tpl),
            k = b.find(".js_form_list"),
            b = c.siblings("#search-boxlist").find(".j_Search").clone();
            k.html(b);
            var b = k.find(".js_searchlist"),
            d = a.formPage,
            f = d.result;
            a = a.pageNo;
            k.find("#pageNo").val(a);
            k.find(".j_Search .j_formcount").text();
            1 == d.pageNo && 0 == d.result.length ? (k.find(".js_noresult").removeClass("hide"), k.find(".js_noresult .btn-div .router").attr("href", "forms/" + TEAMS.currentUser.id + "/cloud")) : k.find(".js_noresult").addClass("hide");
            d.hasNext ? k.find("#loadMore").show() : k.find("#loadMore").hide();
            for (a = 0; a < f.length; a++) k = f[a],
            d = c.siblings("#formitems").find(".js_formitemsli").clone(),
            this.renderForm(k, b, d, "append");
            this.buildSerialNumber(b)
        },
        renderKeywords: function(a) {
            var b = this,
            c = b.model;
            $(b.el);
            a.pageNo = 1;
            a.pageSize = 2E3;
            c.queryMyFormsKeywords(a,
            function(a) {
                b.renderKeyword(a)
            })
        },
        buildSerialNumber: function(a) {
            a.find('li[class\x3d"js_formitemsli"]').each(function(a) {
                $(this).find("#form-number").text(a + 1)
            })
        },
        remove: function() {
            $(this.el).off(".FormDataReportStartView");
            this.formoperationView && (this.formoperationView.remove(), this.formoperationView = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/importformview", ["teams/utils"],
function(g, m, l) {
    var d = g("teams/utils");
    g = Backbone.View.extend({
        initialize: function(f) {
            this.el = "#importbox";
            this.currentStep = 0;
            this.tpl = d.template("form.importform");
            this.callback = f.callback;
            $("body").append(d.template("form.importform"))
        },
        delegateEvents: function() {
            var f = this,
            b = $(f.el);
            b.on("hidden.bs.modal",
            function() {
                f.remove()
            });
            b.on("click", "#success",
            function() {
                b.modal("hide")
            });
            b.on("change", "#sheet_name",
            function() {
                var a = $(this).find(":selected").attr("index");
                f.renderSheet(a)
            });
            b.on("click", "#datapreview tr",
            function() {
                var a = $(this);
                a.addClass("hr-type").siblings().removeClass("hr-type");
                a.prevAll().addClass("disabled");
                a.nextAll().removeClass("disabled")
            });
            b.on("click", "#nextstep",
            function() {
                var a = f.currentStep + 1;
                4 > a && (1 == a ? d.notify("\u8bf7\u5148\u4e0a\u4f20excel\u6587\u4ef6") : 2 == a ? f.editeExcel() : 3 == a ? f.persistExcel() : (f.currentStep = a, f.renderStep()))
            });
            b.on("click", "#prevstep",
            function() {
                var a = f.currentStep - 1; - 1 < a && (0 == a ? f.uploadAgain() : (f.currentStep = a, f.renderStep()))
            });
            b.on("blur", "#formName",
            function() {
                var a = $.trim($(this).val());
                a && $.ajax({
                    url: "/import/checkName.json",
                    type: "post",
                    data: {
                        formName: a
                    },
                    success: function(a) {
                        a.actionMsg && d.notify(a.actionMsg.message)
                    }
                })
            });
            b.on("click", ".j_field_ul\x3eli",
            function() {
                var a = $(this),
                b = a.closest("th");
                a.addClass("active").siblings().removeClass("active");
                b.find(".j_field_name").attr("componentKey", a.attr("componentKey"));
                b.find(".j_field_name").attr("formate", a.attr("formate"));
                b.find(".j_field_select").parent().attr("data-original-title", a.attr("title"));
                b.find(".j_field_select i:first").attr("class", a.attr("icon") + " mr-3")
            });
            b.on("click", ".j_dropdownchild li",
            function() {
                var a = $(this),
                b = a.parents("li");
                a.addClass("active").siblings().removeClass("active");
                b.attr("componentKey", a.attr("componentKey"));
                b.attr("formate", a.attr("formate"));
                b.attr("title", a.attr("title"))
            });
            b.on("click", "#exportWrong",
            function() {
                f.exportWrong($(this))
            })
        },
        render: function() {
            $(this.el).modal({
                keyboard: !1,
                backdrop: "static"
            });
            this.initUploader();
            this.renderStep();
            d.layout(".j_txtboxScr", [{
                gotoTopButton: !1
            }])
        },
        renderStep: function() {
            var d = $(this.el),
            b = this.currentStep;
            d.find(".j_import_step_" + b).removeClass("hide").siblings().addClass("hide");
            d.find("#nextstep").show();
            d.find("#prevstep").show();
            d.find("#success").hide();
            0 == b && d.find("#prevstep").hide();
            3 == b && (d.find("#nextstep").hide(), d.find("#prevstep").hide(), d.find("#success").show())
        },
        editeExcel: function() {
            var f = this,
            b = $(f.el),
            a = b.find("#sheet_name").val(),
            b = b.find(".hr-type").attr("rowIndex");
            $.ajax({
                url: "/import/editeExcel.json",
                type: "post",
                data: {
                    sheetIndex: a,
                    rowIndex: b
                },
                success: function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : (f.renderEditeExcel(a), f.currentStep = 2, f.renderStep())
                }
            })
        },
        renderEditeExcel: function(d) {
            var b = $(this.el),
            a = d.formName;
            b.find("#formName").val(a).attr("title", a);
            b = b.find("#sheet_name").val();
            b = this.sheetDatas[b].maxColumnIndex;
            this.renderExcelTitle(d.titleList, b);
            this.renderExcelRowDatas(d.rowDatas, b)
        },
        renderExcelTitle: function(d, b) {
            var a = $(this.el),
            e = a.find("#dataedit thead"),
            a = $("\x3cth class\x3d'j_field_title'\x3e\x3c/th\x3e").html(a.find("#component-select").html());
            e.html("");
            var h = $("\x3ctr\x3e\x3c/tr\x3e");
            h.append("\x3cth class\x3d'fields-name'\x3e\u5b57\u6bb5\u540d\x3c/th\x3e");
            for (var c = 0; c < b; c++) {
                var k = d[c],
                g = a.clone();
                k ? g.find(".j_field_name").val(k.value).attr("index", c) : g.find(".j_field_name").attr("index", c);
                h.append(g)
            }
            e.html(h)
        },
        renderExcelRowDatas: function(d, b) {
            var a = $(this.el).find("#dataedit tbody").html("");
            if (d && 0 < d.length) for (var e = 0; e < d.length; e++) {
                var h = $("\x3ctr class\x3d'j_row_data'\x3e\x3c/tr\x3e");
                h.append("\x3ctd\x3e" + (e + 1) + "\x3c/td\x3e");
                var c = d[e].cells;
                if (c && 0 < c.length) for (var k = 0; k < b; k++) c[k] ? h.append("\x3ctd title\x3d'" + c[k].value + "'\x3e" + c[k].value + "\x3c/td\x3e") : h.append("\x3ctd\x3e\x3c/td\x3e");
                a.append(h)
            }
            if (!d || 10 > d.length) for (var c = d ? d.length: 0, g = 10 - c, e = 0; e < g; e++) {
                h = $("\x3ctr class\x3d'j_no_data'\x3e\x3c/tr\x3e");
                h.append("\x3ctd\x3e" + (e + c + 1) + "\x3c/td\x3e");
                for (k = 0; k < b; k++) h.append("\x3ctd\x3e\x3c/td\x3e");
                a.append(h)
            }
        },
        persistExcel: function() {
            var f = this,
            b = $(f.el),
            a = $.trim(b.find("#formName").val());
            a ? $.ajax({
                url: "/import/checkName.json",
                type: "post",
                data: {
                    formName: a
                },
                success: function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : (a = f.getParam(), a.columnDatas && 0 < a.columnDatas.length ? (f.saveExcel(a), f.currentStep = 3, f.getImportRate(b.find(".j_save_progress"))) : d.notify("\u5bfc\u5165\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a"))
                }
            }) : d.notify("\u8bf7\u5148\u586b\u5199\u8868\u5355\u540d\u79f0")
        },
        saveExcel: function(f) {
            var b = this;
            f = JSON.stringify(f);
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/import/saveExcel.json",
                dataType: "json",
                data: f,
                success: function(a) {
                    b.interval && clearInterval(b.interval);
                    a.actionMsg && a.actionMsg.message ? (d.notify(a.actionMsg.message, "error"), b.currentStep = 2, b.renderStep()) : b.finish(a.importRate)
                }
            })
        },
        getImportRate: function(d) {
            var b = this,
            a = $(b.el);
            b.renderStep();
            b.interval = window.setInterval(function() {
                $.ajax({
                    type: "get",
                    url: "/import/findImportRate.json",
                    dataType: "json",
                    data: {
                        rateKey: b.cid
                    },
                    success: function(e) {
                        e = e.importRate;
                        var h = e.success / e.total * 100,
                        c = e.failure / e.total * 100;
                        d.find(".progress-bar-success").css("width", h + "%");
                        d.find(".progress-bar-danger").css("width", c + "%");
                        a.find(".j_total").text(e.total);
                        a.find(".j_success").text(e.success);
                        a.find(".j_failure").text(e.failure);
                        100 == e.rate && (clearInterval(b.interval), b.interval = null)
                    }
                })
            },
            1E3)
        },
        finish: function(d) {
            var b = $(this.el);
            b.find(".j_importing").hide().next().show();
            b.find(".j_success_num").text(d.success);
            d.failure && 0 < d.failure && b.find(".j_failure_num").text(d.failure).next().show();
            this.callback(d)
        },
        exportWrong: function(d) {
            0 != d.data("isClick") && (d.data("isClick", !1), window.location.href = "/import/exportWrong.json?_t\x3d" + (new Date).getTime(), d.data("isClick", !0))
        },
        getParam: function() {
            var d = $(this.el),
            b = {};
            b.formName = $.trim(d.find("#formName").val());
            var a = [];
            d.find(".j_field_title").each(function() {
                var b = $(this).find(".j_field_name"),
                d = $.trim(b.attr("componentKey"));
                d && (b = {
                    name: $.trim(b.val()),
                    componentKey: d,
                    colIndex: b.attr("index"),
                    formate: b.attr("formate")
                },
                a.push(b))
            });
            b.columnDatas = a;
            b.rateKey = this.cid;
            return b
        },
        uploadAgain: function() {
            var f = this,
            b = $(f.el);
            d.confirm("\u662f\u5426\u653e\u5f03\u5df2\u4e0a\u4f20\u7684\u6587\u4ef6\uff1f",
            function(a) {
                a && (f.currentStep = 0, b.find(".j_upload").show(), b.find(".j_load_progress").hide(), f.renderStep())
            })
        },
        renderPreview: function() {
            var d = $(this.el),
            b = this.sheetDatas;
            this.currentStep = 1;
            d.find(".j_file_name").text(this.fileName);
            for (var a = "",
            e = 0; e < b.length; e++) var h = b[e],
            a = a + ("\x3coption value\x3d'" + h.sheetIndex + "' index\x3d'" + e + "'\x3e" + h.name + "\x3c/option\x3e");
            d = d.find("#sheet_name");
            d.html(a);
            a = d.find(":selected").attr("index");
            this.renderSheet(a);
            this.renderStep()
        },
        renderSheet: function(d) {
            var b = $(this.el).find("#datapreview").html("");
            d = this.sheetDatas[d];
            for (var a = 0; a < d.rows.length; a++) {
                var e = d.rows[a].cells,
                h = $("\x3ctr rowIndex\x3d'" + d.rows[a].rowIndex + "'\x3e\x3c/tr\x3e");
                if (null != e && 0 < e.length) {
                    h.append("\x3ctd class\x3d'num-td'\x3e\x3cem class\x3d'label'\x3e\u6807\u9898\u884c\x3c/em\x3e\x3cem class\x3d'num'\x3e" + (a + 1) + "\x3c/em\x3e\x3c/td\x3e");
                    for (var c = 0; c < d.maxColumnIndex; c++) {
                        var k = e[c];
                        k ? h.append("\x3ctd title\x3d'" + k.value + "'\x3e" + k.value + "\x3c/td\x3e") : h.append("\x3ctd\x3e\x3c/td\x3e")
                    }
                }
                b.append(h)
            }
            b.find("tr:first").addClass("hr-type")
        },
        initUploader: function() {
            var f = this,
            b = f.el,
            a = $(f.el),
            b = this.uploader = new plupload.Uploader({
                runtimes: "html5,flash",
                file_data_name: "excel",
                multi_selection: !1,
                container: b,
                browse_button: b + " #pickFiles",
                drop_element: b + " #upload-wrap",
                max_file_size: "2mb",
                url: "/import/uploadExcel.json",
                filters: [{
                    title: "Excel files",
                    extensions: "xlsx,xls"
                }],
                flash_swf_url: "/static/swf/plupload.swf"
            });
            b.init();
            b.bind("FilesAdded",
            function(b, d) {
                a.find(".j_upload").hide();
                a.find(".j_load_progress").show();
                b.refresh();
                b.start()
            });
            b.bind("UploadProgress",
            function(b, d) {
                a.find(".j_import_excel").css("width", d.percent + "%").attr("aria-valuenow", d.percent);
                a.find(".j_import_num").text(d.percent + "%")
            });
            b.bind("Error",
            function(a, b) { - 600 == b.code && d.notify("\u53ea\u80fd\u4e0a\u4f20\u6700\u5927\u4e0d\u8d85\u8fc72M\u7684\u6587\u4ef6", "\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u9650\u5236", "error"); - 601 == b.code && d.notify("\u53ea\u80fd\u4e0a\u4f20xls,xlsx\u7c7b\u578b\u7684Excel\u6587\u4ef6", "\u6587\u4ef6\u7c7b\u578b\u9519\u8bef", "error");
                a.refresh()
            });
            b.bind("FileUploaded",
            function(b, h, c) {
                b = $.parseJSON(c.response);
                b.actionMsg && b.actionMsg.message ? (d.notify(b.actionMsg.message, "error"), a.find(".j_upload").show(), a.find(".j_load_progress").hide()) : (h = b.sheetDatas, null != h && 0 < h.length ? (f.sheetDatas = h, f.fileName = b.excelFileName, f.renderPreview()) : (d.notify("\u4e0d\u80fd\u4e0a\u4f20\u7a7a\u7684excel", "error"), a.find(".j_upload").show(), a.find(".j_load_progress").hide()))
            })
        },
        removeCash: function() {
            $.ajax({
                type: "get",
                url: "/import/removeCash.json",
                dataType: "json",
                data: {
                    rateKey: this.cid
                }
            })
        },
        remove: function() {
            $(this.el).remove();
            this.interval && clearInterval(this.interval);
            this.removeCash()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formreportconfigview", ["teams/utils", "teams/component/typeahead", "teams/component/validation", "teams/utils"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/typeahead");
    g("teams/component/validation");
    d = g("teams/utils");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.formId = b.formId;
            this.type = b.type;
            this.el = "#form-report-config";
            this.callback = b.callback;
            this.userId = b.userId;
            this.parentEl = b.parentEl ? b.parentEl: "body";
            $(this.parentEl).append(d.template("form.formreportconfig"))
        },
        delegateEvents: function() {
            var b = this;
            $(b.el).on("hidden.bs.modal.ReportConfig",
            function(a) {
                $(a.target).hasClass("datepicker") || b.remove()
            });
            $(b.el).off("change.ReportConfig", "#reportConf-participants select").on("change.ReportConfig", "#reportConf-participants select",
            function() {
                $(this);
                var a = $(b.el).find("#user-select").val();
                if ("user" == a) $(b.el).find(".sharetype-user").removeClass("hide"),
                $(b.el).find(".sharetype-dept").addClass("hide"),
                $(b.el).find(".sharetype-user input").focus();
                else if ("department" == a) $(b.el).find(".sharetype-dept").removeClass("hide"),
                $(b.el).find(".sharetype-user").addClass("hide"),
                $(b.el).find(".sharetype-dept input").focus();
                else {
                    $(b.el).find(".sharetype-dept").addClass("hide");
                    $(b.el).find(".sharetype-user").removeClass("hide");
                    $(b.el).find("#editShare").removeClass("hide");
                    $(b.el).find(".typeahead-wrapper").addClass("hide");
                    $(this).val("user");
                    var a = $(b.el).find("#reportConf-participants .j_selected"),
                    e = !1;
                    a.find(".entity-item").each(function(a) {
                        0 == $(this).find("a").attr("id") && (e = !0)
                    });
                    if (e) {
                        d.notify("\u5df2\u6dfb\u6240\u6709\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0");
                        return
                    }
                    a.append('\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d"0"\x3e\u6240\u6709\u4eba\x3c/a\x3e\x3c/span\x3e')
                }
                b.resetRepeatResult()
            });
            f([{
                el: b.el + " .sharetype-dept input",
                callback: function(a) {
                    if (a && !$.isEmptyObject(a)) {
                        var e = $(b.el).find("#reportConf-participants .j_selected");
                        b.renderTypeheader(e, a)
                    }
                }
            },
            {
                el: b.el + " .sharetype-user input",
                callback: function(a) {
                    if (a && !$.isEmptyObject(a)) {
                        var e = $(b.el).find("#reportConf-participants .j_selected");
                        b.renderTypeheader(e, a)
                    }
                }
            }]);
            $(b.el).off("change.ReportConfig", "#config-repeat-type").on("change.ReportConfig", "#config-repeat-type",
            function() {
                var a = $(this).val();
                "everyday" == a ? ($(b.el).find("#week-repeat").addClass("hide"), $(b.el).find("#ford-back").addClass("hide"), $(b.el).find("#frequency-type").text("\u5929")) : "everyWeek" == a ? ($(b.el).find("#week-repeat").removeClass("hide"), $(b.el).find("#ford-back").addClass("hide"), $(b.el).find("#frequency-type").text("\u5468")) : "everyMonth" == a ? ($(b.el).find("#week-repeat").addClass("hide"), $(b.el).find("#ford-back").removeClass("hide"), $(b.el).find("#frequency-type").text("\u6708")) : ($(b.el).find("#week-repeat").addClass("hide"), $(b.el).find("#ford-back").removeClass("hide"), $(b.el).find("#frequency-type").text("\u5b63\u5ea6"));
                b.resetRepeatResult()
            });
            $(b.el).off("click.ReportConfig", ".j_start").on("click.ReportConfig", ".j_start",
            function() {
                b.renderDatePicker(".j_start")
            });
            $(b.el).off("change.ReportConfig", ".j_end-repeat").on("change.ReportConfig", ".j_end-repeat",
            function() {
                var a = $(this).val();
                "never" == a ? ($(b.el).find(".j_happen-times").addClass("hide"), $(b.el).find(".j_end-date").addClass("hide")) : "number" == a ? ($(b.el).find(".j_happen-times").removeClass("hide"), $(b.el).find(".j_end-date").addClass("hide")) : "date" == a && ($(b.el).find(".j_happen-times").addClass("hide"), $(b.el).find(".j_end-date").removeClass("hide"), $(b.el).find(".j_end").val(Date.create(new Date).format("{yyyy}-{MM}-{dd}")));
                b.resetRepeatResult()
            });
            $(b.el).off("click.ReportConfig", ".j_end").on("click.ReportConfig", ".j_end",
            function() {
                b.renderDatePicker(".j_end")
            });
            $(b.el).off("change.ReportConfig", "#forward-backward").on("change.ReportConfig", "#forward-backward",
            function() {
                b.resetRepeatResult()
            });
            $(b.el).on("blur.ReportConfig", "#frequency-input,#fb-days, .j_times",
            function() {
                b.resetRepeatResult()
            });
            $(b.el).off("click.ReportConfig", "#week-repeat input[type\x3dcheckbox][name\x3drepeatWk]").on("click.ReportConfig", "#week-repeat input[type\x3dcheckbox][name\x3drepeatWk]",
            function() {
                b.resetRepeatResult()
            });
            $(b.el).off("change.ReportConfig", ".j_end").on("change.ReportConfig", ".j_end",
            function() {
                b.resetRepeatResult()
            });
            $(b.el).off("click.ReportConfig", ".j_user_btn").on("click.ReportConfig", ".j_user_btn",
            function() {
                b.resetRepeatResult()
            });
            $(b.el).off("click.ReportConfig", ".j_dept_btn").on("click.ReportConfig", ".j_dept_btn",
            function() {
                b.resetRepeatResult()
            });
            $(b.el).off("click.ReportConfig", 'input[name\x3d"onlyWorkDay"]').on("click.ReportConfig", 'input[name\x3d"onlyWorkDay"]',
            function() {
                b.resetRepeatResult()
            });
            $(b.el).off("click.ReportConfig", "#btn-close-conf").on("click.ReportConfig", "#btn-close-conf",
            function(a) {
                $(b.el).modal("hide")
            });
            $(b.el).off("click.ReportConfig", "#save-config").on("click.ReportConfig", "#save-config",
            function() {
                b.saveConfig()
            })
        },
        resetRepeatResult: function() {
            var b = $(this.el),
            a = b.find("#frequency-input").val(),
            e = b.find("#frequency-type").text(),
            d = b.find(".j_end-repeat").val(),
            a = "\u6bcf" + a + e,
            c = "",
            e = b.find("#config-repeat-type").val();
            if ("everyWeek" == e) b.find("input[type\x3dcheckbox][name\x3drepeatWk]:checked").each(function(a) {
                a = $(this).val();
                switch (a) {
                case "sunday":
                    a = "\u661f\u671f\u65e5";
                    break;
                case "monday":
                    a = "\u661f\u671f\u4e00";
                    break;
                case "tuesday":
                    a = "\u661f\u671f\u4e8c";
                    break;
                case "wednesday":
                    a = "\u661f\u671f\u4e09";
                    break;
                case "thursday":
                    a = "\u661f\u671f\u56db";
                    break;
                case "friday":
                    a = "\u661f\u671f\u4e94";
                    break;
                case "saturday":
                    a = "\u661f\u671f\u516d"
                }
                c = c + a + "\u3001"
            }),
            -1 != c.lastIndexOf("\u3001") && (c = c.substring(0, c.length - 1)),
            0 < c.length && (a = a + "," + c);
            else if ("everyMonth" == e || "everyQuarter" == e) var e = b.find("#forward-backward").val(),
            k = b.find("#fb-days").val(),
            a = a + ",",
            a = "forward" == e ? a + ("\u6b63\u6570\u7b2c" + k + "\u5929") : a + ("\u5012\u6570\u7b2c" + k + "\u5929");
            "never" == d ? a += ",\u6c38\u4e0d\u7ed3\u675f": "number" == d ? (d = b.find(".j_times").val(), a += ",\u5171" + d + "\u6b21") : "date" == d && (d = b.find(".j_end").val(), a += ",\u622a\u6b62\u5230" + d); (d = b.find(".j_start").val()) && (a += "," + d + "\u5f00\u59cb");
            d = b.find('input[name\x3d"onlyWorkDay"]').prop("checked");
            if (1 == d || "true" == d) a += ",\u53ea\u5de5\u4f5c\u65e5\u53d1\u9001";
            b.find(".j_resultLabel").text("\u7ed3\u679c:");
            b.find(".j_configResult").text(a)
        },
        renderTypeheader: function(b, a) {
            if (a.length) for (var e = 0; e < a.length; e++) {
                var d = a[e],
                c = d.name,
                k = d.id;
                if (c && k) {
                    var f = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + k + "\x3e" + c + "\x3c/a\x3e\x3c/span\x3e";
                    b.find(".entity-item").each(function(a) {
                        k == $(this).find("a").attr("id") && (f = null)
                    });
                    b.append(f)
                }
            } else c = a.name,
            k = a.id,
            c && k && (f = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + k + "\x3e" + c + "\x3c/a\x3e\x3c/span\x3e", b.find(".entity-item").each(function(a) {
                k == $(this).find("a").attr("id") && (f = null)
            }), b.append(f))
        },
        renderDatePicker: function(b) {
            var a = this;
            $(b).datetimepicker("hide");
            $(b).datetimepicker("remove");
            a.initDatePickerProperty(b, "yyyy-mm-dd", "month", "month");
            $(b).datetimepicker("show");
            $(b).datetimepicker().on("changeDate",
            function(e) { (e = e.date) || (e = "");
                e instanceof Date && (e = e.format("{yyyy}-{MM}-{dd}"), $(b).val(e), a.resetRepeatResult())
            })
        },
        initDatePickerProperty: function(b, a, e, d) {
            $(b).datetimepicker({
                format: a,
                language: "zh-CN",
                todayHighlight: !0,
                todayBtn: !0,
                autoclose: !0,
                initialDate: new Date,
                startView: e,
                minView: d,
                maxView: "decade",
                pickerPosition: "bottom-right",
                showMeridian: !1
            })
        },
        saveConfig: function() {
            var b = this,
            a = $(b.el);
            if (b.checkParam()) {
                var e = [];
                a.find("#reportConf-participants .j_selected a").each(function(a) {
                    e.push($(this).attr("id"))
                });
                var h = b.buildReportData(),
                c = JSON.stringify(e),
                h = JSON.stringify(h),
                a = a.find('input[name\x3d"onlyWorkDay"]').prop("checked"),
                k = !1;
                if (1 == a || "true" == a) k = !0;
                $.ajax({
                    contentType: "application/json;charset\x3dUTF-8",
                    type: "post",
                    url: "/reportconfig.json",
                    dataType: "json",
                    data: '{"shares":' + c + ',"reportConfigData":' + h + ',"isWorkday":' + k + "}",
                    success: function(a) {
                        b.callback(a);
                        d.notify("\u8bbe\u7f6e\u6210\u529f")
                    }
                })
            }
        },
        checkParam: function() {
            var b = $(this.el),
            a = /^[1-9]+[0-9]*]*$/;
            if (0 == b.find("#reportConf-participants .j_selected").find("a").length) return d.notify("\u8bf7\u9009\u62e9\u4eba\u5458"),
            !1;
            var e = b.find("#frequency-input").val();
            if (!a.test(e)) return d.notify("\u91cd\u590d\u9891\u7387\u5fc5\u987b\u4e3a\u6b63\u6574\u6570"),
            !1;
            e = b.find("#config-repeat-type").val();
            if ("everyWeek" == e && 0 == b.find("input[type\x3d'checkbox'][name\x3d'repeatWk']:checked").length) return d.notify("\u8bf7\u8bbe\u7f6e\u5468\u91cd\u590d\u6761\u4ef6"),
            !1;
            if ("everyMonth" == e) {
                var h = b.find("#fb-days").val();
                if (!a.test(h)) return d.notify("\u6b63\u6570\u548c\u5012\u6570\u5929\u6570\u5fc5\u987b\u4e3a\u6b63\u6574\u6570"),
                !1;
                if (31 < h) return d.notify("\u6708\u4efd\u6b63\u6570\u548c\u5012\u6570\u5929\u6570\u4e0d\u80fd\u8d85\u8fc731\u5929"),
                !1
            } else if ("everyQuarter" == e) {
                h = b.find("#fb-days").val();
                if (!a.test(h)) return d.notify("\u6b63\u6570\u548c\u5012\u6570\u5929\u6570\u5fc5\u987b\u4e3a\u6b63\u6574\u6570"),
                !1;
                if (92 < h) return d.notify("\u5b63\u5ea6\u6b63\u6570\u548c\u5012\u6570\u5929\u6570\u4e0d\u80fd\u8d85\u8fc792\u5929"),
                !1
            }
            var c = b.find(".j_start").val(),
            h = Date.create(new Date).format("{yyyy}-{MM}-{dd}");
            if (null == c || "" == c) return d.notify("\u8bf7\u9009\u62e9\u5f00\u59cb\u65f6\u95f4"),
            !1;
            if (c < h) return d.notify("\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u5c0f\u4e8e\u5f53\u5929"),
            !1;
            c = b.find(".j_end-repeat").val();
            if ("number" == c) {
                if (e = b.find(".j_times").val(), !a.test(e)) return d.notify("\u53d1\u751f\u6b21\u6570\u5fc5\u987b\u4e3a\u6b63\u6574\u6570"),
                !1
            } else if ("date" == c) {
                a = b.find(".j_end").val();
                b = b.find(".j_start").val();
                b = Date.create(b).format("{yyyy}-{MM}-{dd}");
                c = Date.create(a).format("{yyyy}-{MM}-{dd}");
                if (null == a || "" == a) return d.notify("\u8bf7\u9009\u62e9\u7ed3\u675f\u65f6\u95f4"),
                !1;
                if (b == h && c == h) return d.notify("\u5f00\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u540c\u65f6\u4e3a\u5f53\u5929"),
                !1;
                if (c < b) return d.notify("\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65f6\u95f4"),
                !1;
                h = this.dateDiff(c, b);
                if ("everyWeek" == e) {
                    if (7 > h) return d.notify("\u5468\u91cd\u590d\u7ed3\u675f\u65e5\u671f\u548c\u5f00\u59cb\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e7\u5929"),
                    !1
                } else if ("everyMonth" == e) {
                    if (31 > h) return d.notify("\u6708\u91cd\u590d\u5f00\u59cb\u65e5\u671f\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e31\u5929"),
                    !1
                } else if ("everyQuarter" == e && 92 > h) return d.notify("\u5b63\u5ea6\u91cd\u590d\u5f00\u59cb\u65e5\u671f\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e92\u5929"),
                !1
            }
            return ! 0
        },
        buildReportData: function() {
            var b = $(this.el),
            a = {};
            a.formId = this.formId;
            var e = b.find("#config-repeat-type").val();
            a.repeatType = e;
            a.frequency = b.find("#frequency-input").val();
            var d = "";
            if ("everyWeek" == e) b.find("input[type\x3dcheckbox][name\x3drepeatWk]:checked").each(function(a) {
                var e = $(this).val();
                d += e;
                a != b.find("input[type\x3dcheckbox][name\x3drepeatWk]:checked").length - 1 && (d += ",")
            }),
            "" != d && (a.weekCycles = d);
            else if ("everyMonth" == e || "everyQuarter" == e) e = b.find("#forward-backward").val(),
            "" != e && (a.forBackward = e),
            e = b.find("#fb-days").val(),
            "" != e && (a.fbDays = e);
            e = b.find(".j_start").val();
            a.startDate = Date.create(e);
            e = b.find(".j_end-repeat").val();
            a.endType = e;
            "number" == e ? a.repeatTimes = b.find(".j_times").val() : "date" == e && (e = b.find(".j_end").val(), a.endDate = Date.create(e));
            a.configResult = b.find(".j_configResult").text();
            return a
        },
        dateDiff: function(b, a) {
            var e, d;
            e = b.split("-");
            d = new Date(e[1] + "-" + e[2] + "-" + e[0]);
            e = a.split("-");
            return parseInt(Math.abs(d - new Date(e[1] + "-" + e[2] + "-" + e[0])) / 1E3 / 60 / 60 / 24)
        },
        queryLastConfigResult: function() {
            var b = this,
            a = $(b.el);
            $.ajax({
                type: "post",
                url: "/reportconfig/queryLastConfig.json",
                dataType: "json",
                data: {
                    formId: b.formId,
                    userId: b.userId
                },
                success: function(e) {
                    if (e && e.actionMsg) d.notify("\u67e5\u8be2\u5931\u8d25");
                    else {
                        var h = e.rptConfig,
                        c = e.rptScope;
                        if (null != h && "" != h) {
                            for (e = 0; e < c.length; e++) {
                                var k = c[e].userTypeId,
                                f = c[e].userTypeName;
                                "allpeople" == c[e].userType && (f = "\u6240\u6709\u4eba");
                                k = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + k + "\x3e" + f + "\x3c/a\x3e\x3c/span\x3e";
                                $(b.el).find("#reportConf-participants .j_selected").append(k)
                            }
                            e = h.repeatType;
                            c = h.frequency;
                            $(b.el).find("#frequency-input").val(c);
                            if ("everyday" == e) $(b.el).find("#week-repeat").addClass("hide"),
                            $(b.el).find("#ford-back").addClass("hide"),
                            $(b.el).find("#frequency-type").text("\u5929"),
                            $(b.el).find("#config-repeat-type").find("option[value\x3d'everyday']").attr("selected", !0);
                            else if ("everyWeek" == e) for ($(b.el).find("#week-repeat").removeClass("hide"), $(b.el).find("#ford-back").addClass("hide"), $(b.el).find("#frequency-type").text("\u5468"), $(b.el).find("#config-repeat-type").find("option[value\x3d'everyWeek']").attr("selected", !0), c = [], c = h.weekCycles.split(","), e = 0; e < c.length; e++) a.find("input[type\x3dcheckbox][name\x3drepeatWk][value\x3d" + c[e] + "]").attr("checked", "checked");
                            else "everyMonth" == e ? ($(b.el).find("#week-repeat").addClass("hide"), $(b.el).find("#ford-back").removeClass("hide"), $(b.el).find("#frequency-type").text("\u6708"), $(b.el).find("#config-repeat-type").find("option[value\x3d'everyMonth']").attr("selected", !0)) : ($(b.el).find("#week-repeat").addClass("hide"), $(b.el).find("#ford-back").removeClass("hide"), $(b.el).find("#frequency-type").text("\u5b63\u5ea6"), $(b.el).find("#config-repeat-type").find("option[value\x3d'everyQuarter']").attr("selected", !0)),
                            e = h.forBackward,
                            "forward" == e ? $(b.el).find("#forward-backward").find("option[value\x3d'forward']").attr("selected", !0) : $(b.el).find("#forward-backward").find("option[value\x3d'backward']").attr("selected", !0),
                            e = h.fbDays,
                            $(b.el).find("#fb-days").val(e);
                            e = Date.create(h.startDate).format("{yyyy}-{MM}-{dd}");
                            $(b.el).find(".j_start").val(e);
                            e = h.endType;
                            "never" == e ? ($(b.el).find(".j_happen-times").addClass("hide"), $(b.el).find(".j_end-date").addClass("hide"), $(b.el).find(".j_end-repeat").find("option[value\x3d'never']").attr("selected", !0)) : "number" == e ? ($(b.el).find(".j_happen-times").removeClass("hide"), $(b.el).find(".j_end-date").addClass("hide"), $(b.el).find(".j_end-repeat").find("option[value\x3d'number']").attr("selected", !0), e = h.repeatTimes, $(b.el).find(".j_happen-times .j_times").val(e)) : "date" == e && ($(b.el).find(".j_happen-times").addClass("hide"), $(b.el).find(".j_end-date").removeClass("hide"), $(b.el).find(".j_end-repeat").find("option[value\x3d'date']").attr("selected", !0), e = Date.create(h.endDate).format("{yyyy}-{MM}-{dd}"), $(b.el).find(".j_end-date .j_end").val(e));
                            e = h.workday;
                            1 == e || "true" == e ? a.find('input[name\x3d"onlyWorkDay"]').prop("checked", !0) : a.find('input[name\x3d"onlyWorkDay"]').prop("checked", !1);
                            h = h.configResult;
                            a.find(".setting-result .j_resultLabel").text("\u4e0a\u6b21\u914d\u7f6e\u7ed3\u679c:");
                            a.find(".j_configResult").text(h)
                        }
                    }
                }
            })
        },
        render: function() {
            $(this.el).modal("show");
            this.queryLastConfigResult();
            d.layout(".j_formRepeatScr")
        },
        hide: function() {
            $(this.el).modal("hide")
        },
        remove: function() {
            $(this.el).off(".ReportConfig");
            $("#form-report-config").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/customconfigview", ["teams/utils", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.formId = b.formId;
            this.el = "#custom-config-view";
            this.callback = b.callback;
            this.userId = b.userId;
            this.parentEl = b.parentEl ? b.parentEl: "body";
            $(this.parentEl).append(d.template("form.customconfig"));
            this.model = new f(b)
        },
        delegateEvents: function() {
            var b = this;
            $(b.el).on("hidden.bs.modal.CustomConfig",
            function(a) {
                $(a.target).hasClass("datepicker") || b.remove()
            });
            $(b.el).off("click.CustomConfig", "#customconfig-close").on("click.CustomConfig", "#customconfig-close",
            function(a) {
                $(b.el).modal("hide")
            });
            $(b.el).off("click.CustomConfig", ".j_autoSaveRange").on("click.CustomConfig", ".j_autoSaveRange",
            function(a) {
                var e = $(this);
                a = !1;
                var h = "";
                e.parents(".j_autoSave").find(".j_autoSaveInput").attr("checked") && e.hasClass("checked") && e.hasClass("open") ? (e.parents(".j_autoSave").find(".j_autoSaveInput").attr("checked", !1), e.removeClass("open checked"), a = !1, h = "\u5173\u95ed") : (e.parents(".j_autoSave").find(".j_autoSaveInput").attr("checked", !0), e.addClass("open checked"), a = !0, h = "\u5f00\u542f");
                var e = e.parents(".j_configUL").find(".j_newLayout .j_newLayoutInput").attr("checked"),
                c = {},
                k = {};
                k.formId = b.formId;
                k.autoSave = a;
                k.newLayout = e ? !0 : !1;
                c.biaogeExt = k;
                $.ajax({
                    contentType: "application/json;charset\x3dUTF-8",
                    type: "post",
                    url: "/biaogefreeformext/updateAutoSaveAndNewLayout.json",
                    dataType: "json",
                    data: JSON.stringify(c),
                    success: function(a) {
                        a && a.actionMsg || d.notify(h + "\u81ea\u52a8\u4fdd\u5b58\u6210\u529f!")
                    }
                })
            });
            $(b.el).off("click.CustomConfig", ".j_newLayoutRange").on("click.CustomConfig", ".j_newLayoutRange",
            function(a) {
                var e = $(this);
                a = !1;
                var h = "";
                e.parents(".j_newLayout").find(".j_newLayoutInput").attr("checked") && e.hasClass("checked") && e.hasClass("open") ? (e.parents(".j_newLayout").find(".j_newLayoutInput").attr("checked", !1), e.removeClass("open checked"), a = !1, h = "\u5173\u95ed") : (e.parents(".j_newLayout").find(".j_newLayoutInput").attr("checked", !0), e.addClass("open checked"), a = !0, h = "\u5f00\u542f");
                var e = e.parents(".j_configUL").find(".j_autoSave .j_autoSaveInput").attr("checked"),
                c = {},
                k = {};
                k.formId = b.formId;
                k.autoSave = e ? !0 : !1;
                k.newLayout = a;
                c.biaogeExt = k;
                $.ajax({
                    contentType: "application/json;charset\x3dUTF-8",
                    type: "post",
                    url: "/biaogefreeformext/updateAutoSaveAndNewLayout.json",
                    dataType: "json",
                    data: JSON.stringify(c),
                    success: function(a) {
                        a && a.actionMsg || d.notify(h + "\u4f7f\u7528\u6700\u65b0\u5e03\u5c40\u6210\u529f!")
                    }
                })
            })
        },
        queryByFormId: function() {
            var b = this,
            a = {},
            e = {};
            e.formId = b.formId;
            e.module = "biaoge";
            a.biaogeExt = e;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/biaogefreeformext/queryByFormIdAndModule.json",
                dataType: "json",
                data: JSON.stringify(a),
                success: function(a) {
                    if (!a || !a.actionMsg) {
                        a = a.biaogeExt;
                        var c = !1,
                        e = !1;
                        a && (c = a.autoSave, e = a.newLayout);
                        1 == c || "true" == c ? ($(b.el).find(".j_autoSave .j_autoSaveInput").attr("checked", !0), $(b.el).find(".j_autoSave .j_autoSaveRange").addClass("open checked")) : ($(b.el).find(".j_autoSave .j_autoSaveInput").attr("checked", !1), $(b.el).find(".j_autoSave .j_autoSaveRange").removeClass("open checked"));
                        1 == e || "true" == e ? ($(b.el).find(".j_newLayout .j_newLayoutInput").attr("checked", !0), $(b.el).find(".j_newLayout .j_newLayoutRange").addClass("open checked")) : ($(b.el).find(".j_newLayout .j_newLayoutInput").attr("checked", !1), $(b.el).find(".j_newLayout .j_newLayoutRange").removeClass("open checked"))
                    }
                }
            })
        },
        render: function() {
            $(this.el).modal("show");
            this.queryByFormId();
            d.layout(".j_customConfigScr")
        },
        hide: function() {
            $(this.el).modal("hide")
        },
        remove: function() {
            $(this.el).off(".CustomConfig");
            $("#custom-config-view").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/biaogeformview", ["teams/utils", "teams/component/formview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/formview");
    g = Backbone.View.extend({
        teams: {},
        initialize: function(b) {
            this.userId = b.userId || TEAMS.currentUser.id;
            this.formId = b.formId;
            this.dataId = b.dataId;
            this.el = b.container || "#entitySlider";
            this.page = b.page;
            this.renderType = b.renderType;
            this.formView = new f
        },
        delegateEvents: function() {
            var b = this;
            $(b.el).on("click.BiaogeFormView", ".btn-save",
            function(a) {
                var e = $(this);
                e.removeClass("btn-save");
                b.formView.submit({
                    parentEl: $(".js-biaoge-form"),
                    dataStatus: 1,
                    callback: function(a) {
                        e.addClass("btn-save");
                        a.message ? d.notify(a.message) : ($("body").trigger("slideClose"), d.notify("\u8868\u5355\u4fdd\u5b58\u6210\u529f"))
                    }
                })
            })
        },
        render: function() {
            var b = this.renderType,
            a = $(this.el);
            switch (b) {
            case "loadForm":
                this.mainView = new f({
                    userId: this.userId,
                    dataId: this.dataId,
                    parentEl: this.el
                }),
                a.html(d.template("biaoge.form")),
                d.layout(this.el + " .j_formContainer"),
                this.mainView.loadForm({
                    parentEl: a.find(".js-biaoge-form"),
                    dataId: this.dataId,
                    readOnly: !0,
                    callback: function(b) {
                        a.find(".j_form_title").text(b.form.name);
                        a.find(".j_action").hide()
                    }
                })
            }
        },
        remove: function() {
            $(this.el).off(".BiaogeFormView");
            this.mainView && (this.mainView.remove(), this.mainView = null);
            this.formView && (this.formView.remove(), this.formView = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formcolor",
function(g, m, l) {
    l.exports = {
        data: "#1cb1e7 #f9a900 #ffc32e #1cb1e7 #f75e8d #5ec9f7 #ff8f6a #3ac3b5 #78c16e #ff953d #78c16c #9b89b9 #78919d #5c6ac1 #5e97f7 #f75e8c #ff8f6a #3ac3b5 #9b89b9 #ff8f6a #a1897e #ff8f6a #9b89b9 #f75e8d #a1897e #ff953d #78c16e #3ac3b5 #a1897e #bd85cd #5ec9f7 #f75e5e #f7bf26 #5c6ac1 #f7bf26 #bd85cd #f75e5e #78919d #5ec9f7 #78c16e #f36666 #ff608f #7066e3 #ff784a #1acf8d #4693f9 #81d12c #7066e3 #b774d3 #81d12c #7066e3 #ff784a #00c3eb #ff9702 #3497f1 #81d12c #ff9700 #00c3eb #1acf8d #f96a6a #81d12c #b774d3 #ff608f #ff5e32 #df3030 #df3058 #46addd #5874bf #5ec956 #f15e4a".split(" "),
        getRandomColor: function() {
            var d = this.data;
            return d[_.random(d.length)]
        },
        getColor: function(d) {
            var f = this.data;
            d = d > f.length ? f.length: d;
            return f[d]
        }
    }
});
define("eteams/biaoge/form/formdatareportview", "teams/utils eteams/biaoge/form/formdatareportmodel teams/component/formview teams/component/extendview teams/component/validation teams/component/mainline teams/component/relevanceview teams/component/relevancemodel".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formdatareportmodel"),
    b = g("teams/component/formview"),
    a = g("teams/component/extendview");
    g("teams/component/validation");
    var e = g("teams/component/mainline"),
    h = g("teams/component/relevanceview"),
    c = g("teams/component/relevancemodel");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.model = new f(a);
            this.relevanceModel = new c(a);
            this.userId = a.userId || TEAMS.currentUser.id;
            this.id = a.id;
            this.formData = a.formData;
            this.closable = a.closable;
            this.el = a.container || "#entitySlider";
            this.page = a.page;
            this.inPrint = window.systemInfo_print;
            "#print" == this.el && $("#print").addClass("print-formdata-view print-sliderfont");
            this.pageType = null == this.page ? null: this.page.type;
            this.formView = new b
        },
        delegateEvents: function() {
            var a = this,
            b = $(a.el);
            b.on("click.FormDataReport", ".j_reportRelevance .j_foldHandles",
            function(c) {
                void 0 == $(this).attr("load") && ($(this).attr("load", !0), b.find(".j_formdatareport_detail .j_entity_item").remove(), $.ajax({
                    contentType: "application/json;charset\x3dUTF-8",
                    type: "post",
                    url: "/relevance/loadModuleRelevances.json",
                    dataType: "json",
                    data: '{"objectId":' + a.id + "}",
                    success: function(b) {
                        b.relevances && a._renderRelevanceInfos(b.relevances);
                        b.mainlines && a.mainline.render(b.mainlines)
                    }
                }))
            });
            b.on("click.FormDataReport", ".handle-item\x3ea",
            function(a) {
                $(this).parent().addClass("hide")
            });
            b.off("click.FormDataReport", ".j_btn_print").on("click.FormDataReport", ".j_btn_print",
            function() {
                var b = a.formData;
                b ? window.open("/print/" + b + "/formdata") : window.open("/print/" + a.id + "/datareport")
            });
            b.off("click.FormDataReport", ".j_btn_back").on("click.FormDataReport", ".j_btn_back",
            function() {
                d.confirm("\u786e\u8ba4\u8981\u9000\u56de\u4e0a\u62a5\u5417\uff1f",
                function(b) {
                    if (b) {
                        b = {};
                        var c = {};
                        b.status = "todo";
                        b.id = a.id;
                        c.dataReport = b;
                        c.userId = a.userId;
                        a.model.update(c,
                        function(b) {
                            b.actionMsg ? d.notify(b.actionMsg.message) : (d.notify("\u5df2\u9000\u56de\u4e0a\u62a5"), 0 < $("#back_report").length && $("#back_report").attr("dataId", a.formData).click(), a.page && "function" == typeof a.page.entityCallback && a.page.entityCallback("back"));
                            $(".j_btn_close").click()
                        })
                    }
                })
            });
            b.off("click.FormDataReport", ".j_btn_save").on("click.FormDataReport", ".j_btn_save",
            function() {
                var c = b.find('#reportContent[reportId\x3d"' + a.id + '"]').find("#datareport-name").val();
                if (null == c || "" == c) d.notify("\u8bf7\u586b\u5199\u4e0a\u62a5\u540d\u79f0");
                else if (a.isautoSave) if (a.dataId) a.updateReportAndFormData({
                    formData: a.dataId,
                    name: c,
                    id: a.id,
                    status: "finshed",
                    formId: a.formId,
                    msg: "\u63d0\u4ea4\u6210\u529f"
                }),
                a.render();
                else {
                    var e = b.find(".form-view_js"),
                    h = {
                        afterDataDetailSave: function(b) {
                            a.updateReportAndFormData({
                                formData: b.id,
                                name: c,
                                id: a.id,
                                status: "finshed",
                                formId: a.formId,
                                msg: "\u63d0\u4ea4\u6210\u529f"
                            });
                            a.render()
                        },
                        afterformDataCreate: function(b) {
                            b = a.updateReportAndFormData({
                                formData: b.id,
                                name: c,
                                id: a.id,
                                status: "finshed",
                                formId: a.formId,
                                msg: "\u63d0\u4ea4\u6210\u529f"
                            });
                            a.render();
                            return b
                        },
                        dataStatus: 1
                    };
                    h.parentEl = e;
                    formPlugin.saveFieldData(h)
                } else {
                    if (!a.formView.submitCheck(b.find(".form-view_js"))) return ! 1;
                    var f = $(a.el).find("#reportContent .j_employeeVal").data("employeeVal"),
                    g = $(this).attr("status");
                    b.find("#datareport-submit,#datareport-save").removeClass("j_btn_save");
                    h = {};
                    h.parentEl = b.find("#datareport-form");
                    h.callback = function(b) {
                        if (b && b.actionMsg) return d.notify(b.actionMsg.message),
                        a.render(),
                        !1;
                        var e = "";
                        if (b && b.formData && b.formData.id) {
                            var h = b.formData.id,
                            e = "todo" === g ? "\u6682\u5b58\u6210\u529f": "\u63d0\u4ea4\u6210\u529f";
                            b = {};
                            var s = {};
                            b.status = g;
                            b.formData = h;
                            b.name = c;
                            b.id = a.id;
                            s.dataReport = b;
                            s.userId = a.userId;
                            s.employeeVal = f;
                            a.model.update(s,
                            function(b) {
                                b && b.actionMsg ? d.notify(b.actionMsg.message) : ("finshed" === g && a.model.updateCollectlogDetail({
                                    dataReportId: b.dataReport.id,
                                    status: "finshed"
                                },
                                function() {}), a.addRelevance(h, a.id), d.notify(e), a.page && "function" == typeof a.page.entityCallback && "finshed" === g && a.page.entityCallback("finshed"));
                                a.render()
                            })
                        } else return e = "todo" === g ? "\u6682\u5b58\u5931\u8d25": "\u63d0\u4ea4\u5931\u8d25",
                        d.notify(e),
                        a.render(),
                        !1
                    };
                    a.formView.submit(h)
                }
            });
            b.off("click.FormDataReport", ".j_btn_delete").on("click.FormDataReport", ".j_btn_delete",
            function() {
                d.confirm("\u786e\u8ba4\u8981\u5220\u9664\u4e0a\u62a5\u5417\uff1f",
                function(c) {
                    if (c) {
                        var e = $(a.el).find(".j_btn_delete").data("dataReport");
                        c = $(a.el).find(".j_btn_delete").attr("candel");
                        var h = e.status,
                        f = e.id,
                        e = {};
                        e.candel = c;
                        e.dataReportId = f;
                        a.model.deleteReport(e,
                        function(c) {
                            c.message && (b.removeClass("in"), d.notify(c.message));
                            a.model.updateCollectlogDetail({
                                dataReportId: f,
                                status: h + "_delete"
                            },
                            function() {});
                            a.page.trigger("removeformstattable", f)
                        })
                    }
                })
            });
            b.off("click.FormDataReport", ".form-view_js .js_hidePrintDiv").on("click.FormDataReport", ".form-view_js .js_hidePrintDiv",
            function() {
                $(this).parentsUntil(".form-view_js").addClass("hide");
                $("body").find("#js_showPrintDiv").removeClass("hide")
            });
            b.off("click.FormDataReport", ".comment-container .comment-box .js_hidePrintDiv").on("click.FormDataReport", ".comment-container .comment-box .js_hidePrintDiv",
            function() {
                $(this).parentsUntil(".comment-container").remove();
                $("body").find("#js_showPrintDiv").removeClass("hide");
                if ($("body").find(".js_printdirection").is(":checked")) {
                    var a = b.find(".comment-container");
                    a.masonry("destroy");
                    a.imagesLoaded(function() {
                        a.masonry({
                            itemSelector: ".comment-box",
                            gutter: 0,
                            isAnimated: !0
                        })
                    })
                }
            });
            $("body").off("click.FormDataReport", "#js_showPrintDiv").on("click.FormDataReport", "#js_showPrintDiv",
            function() {
                if ($("body").find("#js_showPrintDiv input").is(":checked")) {
                    for (var c = 0; c < $("body").find(".form-view_js\x3ediv").length; c++) $($("body").find(".form-view_js\x3ediv")[c]).removeClass("hide");
                    $("body").find("#comment-panel").html(a.commentHtml);
                    var e = b.find(".comment-container");
                    $("body").find(".js_printdirection").is(":checked") ? ($("body").find("#comment-panel").removeClass("print-comment-panel").addClass("print-comment-panel"), $("body").find(".j_comment-line").removeClass("hide"), e.imagesLoaded(function() {
                        e.masonry({
                            itemSelector: ".comment-box",
                            gutter: 0,
                            isAnimated: !0
                        })
                    })) : ($("body").find("#comment-panel").removeClass("print-comment-panel"), $("body").find(".j_comment-line").addClass("hide"));
                    $("body").find("#js_showPrintDiv").addClass("hide");
                    $("body").find("#js_showPrintDiv input").attr("checked", !1)
                }
            })
        },
        getEmployeeComponentVal: function() {
            var a = $(this.el).find("#reportContent"),
            b = [];
            a.find('.field_js[componentkey\x3d"Employee"]').each(function() {
                var a = $(this).attr("id"),
                a = a.substring(a.indexOf("_") + 1),
                c = [],
                e = null;
                $(this).find(".js_useritem_container span").each(function() {
                    var a = $(this).find("a").eq(0).attr("userid");
                    c.push(a)
                });
                e = {
                    fieldId: a,
                    userIds: c
                };
                b.push(e)
            });
            var c = JSON.stringify({
                emps: b
            });
            a.find(".j_employeeVal").data("employeeVal", c)
        },
        render: function() {
            var a = this,
            b = {};
            b.id = a.id;
            b.formData = a.formData;
            a.model.show(b,
            function(b) {
                var c = b.actionMsg;
                if (c && c.message) return $(a.el).html(d.template("base.nopermission", {
                    msg: c,
                    module: "formdatareport",
                    id: a.id
                })),
                $(a.el).find(".scrollwrapper").trigger("resizeSroll"),
                !1;
                $(a.el).html(d.template("form.formdatareport"));
                var e = b.dataReport,
                c = e.formId;
                a.formId = c;
                var h = b.formPermissions;
                if (h && 0 < h.length) for (var f = 0; f < h.length; f++) {
                    var g = h[f].permissions;
                    0 <= g.indexOf("write") && (a.edit = !0);
                    0 <= g.indexOf("delete") && (a.del = !0)
                } (h = b.permissions) && 0 <= h.indexOf("edit") && (a.edit = !0, a.del = !0, "finshed" == e.status && null != e.reporter && (a.back = !0));
                a.id = b.dataReport.id;
                $(a.el).find("#reportContent").attr("reportId", a.id);
                a.editable = "todo" === e.status && e.reporter.id == TEAMS.currentUser.id ? !0 : "finshed" != e.status || TEAMS.currentUser.id != e.form.operator.id && 1 != a.edit ? !1 : !0;
                a.backable = 1 == a.back ? !0 : "finshed" === e.status && 5 < e.permission ? !0 : "finshed" == e.status && TEAMS.currentUser.id == e.form.operator.id && 1 != e.permission ? !0 : !1;
                a.model.queryByFormId({
                    formId: c
                },
                function(b) {
                    b.actionMsg ? d.notify(b.actionMsg) : (b = b.form, 1 == b.autoSave && ("todo" == e.status ? $(a.el).find("#datareport-save").remove() : "finshed" == e.status && $(a.el).find("#datareport-submit").remove()), a._renderMenu(e, b), a._rendeTitle(e), a._renderForm(e, b), a._initComponent(), e.formData && (a.extendview.formDataId = e.formData), a._renderComponent(e), d.layout(a.el + " #reportContent"))
                });
                d.removeDisableModules($(a.el).find("[acl-module-id]"))
            })
        },
        _initComponent: function() {
            var b = this;
            this.extendview = new a({
                targetId: b.id,
                module: "formdatareport",
                container: "#datareport-info",
                parentEl: b.el
            });
            this.mainline = new e({
                targetId: this.id,
                module: "formdatareport",
                container: "#formdatareport-relevance-mainline",
                parentEl: this.el
            });
            b.relevanceViews = [];
            _.each([{
                targetModule: "task",
                module: "formdatareport",
                container: "#formdatareport-relevance-task",
                moduleLabel: "\u5173\u8054\u4efb\u52a1:"
            },
            {
                targetModule: "document",
                module: "formdatareport",
                container: "#formdatareport-relevance-doc",
                moduleLabel: "\u5173\u8054\u6587\u6863:"
            },
            {
                targetModule: "customer",
                module: "formdatareport",
                container: "#formdatareport-relevance-crm",
                moduleLabel: "\u5173\u8054\u5ba2\u6237:"
            },
            {
                targetModule: "saleChance",
                module: "formdatareport",
                container: "#formdatareport-relevance-saleChance",
                moduleLabel: "\u5173\u8054\u5546\u673a:"
            },
            {
                targetModule: "workflow",
                module: "formdatareport",
                container: "#formdatareport-relevance-flow",
                moduleLabel: "\u5173\u8054\u5ba1\u6279:"
            },
            {
                targetModule: "calendar",
                module: "formdatareport",
                container: "#formdatareport-relevance-agenda",
                moduleLabel: "\u5173\u8054\u65e5\u7a0b:"
            },
            {
                targetModule: "formdatareport",
                module: "formdatareport",
                container: "#formdatareport-relevance-formdatareport",
                moduleLabel: "\u5173\u8054\u6570\u636e:"
            }],
            function(a) {
                this.relevanceView = new h({
                    objectId: b.id,
                    module: a.module,
                    container: a.container,
                    moduleLabel: a.moduleLabel,
                    targetModule: a.targetModule,
                    parentEl: b.el
                });
                b.relevanceViews.push(this.relevanceView)
            })
        },
        _renderComponent: function(a) {
            this.extendview.render(a)
        },
        _renderMenu: function(a, b) {
            var c = this.editable,
            e = this.backable;
            $(this.el).find("#datareport-submit,#datareport-save").addClass("j_btn_save");
            c ? "todo" == a.status && a.reporter.id == TEAMS.currentUser.id ? $(this.el).find(".j_btn_save").removeClass("hide") : "finshed" != a.status || TEAMS.currentUser.id != a.form.operator.id && 1 != this.edit || ($(this.el).find(".j_btn_save[status\x3d'finshed']").removeClass("hide"), $(this.el).find(".j_btn_save[status\x3d'todo']").addClass("hide")) : $(this.el).find(".j_btn_save").addClass("hide");
            e ? $(this.el).find(".j_btn_back").removeClass("hide") : $(this.el).find(".j_btn_back").addClass("hide");
            c = a.creator.id;
            if ("enable" == b.status) {
                if (this.userId == c || TEAMS.currentUser.id == a.form.operator.id || 1 == this.del) $(this.el).find(".j_btn_delete").removeClass("hide"),
                $(this.el).find(".j_btn_delete").data("dataReport", a).attr("candel", this.del);
                "todo" != a.status && $(this.el).find("#datareport-print").removeClass("hide")
            } else "disable" == b.status && ("todo" == a.status ? ($(this.el).find(".j_btn_delete").removeClass("hide"), $(this.el).find(".j_btn_delete").data("dataReport", a).attr("candel", this.del)) : "finshed" == a.status && $(this.el).find(".j_btn_delete").addClass("hide"), $(this.el).find(".j_btn_save").addClass("hide"), $(this.el).find(".j_btn_back").addClass("hide"));
            2 > $(this.el).find(".j_more_dropdown li.hide").length && $(this.el).find(".j_more_dropdown").removeClass("hide")
        },
        _rendeTitle: function(a) {
            var b = $(this.el),
            c = "",
            e = "";
            a.creator && a.creator.id && (c = a.creator.id, e = a.creator.name);
            var d = "";
            a.department && a.department.name && (d = a.department.name);
            var h = Date.create(a.createTime).format("{yyyy}-{MM}-{dd}");
            b.find("#applicants .applyUser_js").attr("userId", c).text(e).attr("title", e);
            b.find("#applicants .applyDepa_js").text(d);
            b.find("#applicants .applyDate_js").val(h);
            b.find("#datareport-name").val(a.name).attr("disabled", !this.editable)
        },
        updateReportAndFormData: function(a) {
            $(this.el);
            var b = !1;
            this.model.updateReportAndFormData({
                dataReport: a
            },
            function(c) {
                c && c.actionMsg ? d.notify(c.actionMsg.message) : ((c = a.msg) ? d.notify(c) : d.notify("\u4fdd\u5b58\u6210\u529f"), b = !0)
            });
            return b
        },
        addRelevance: function(a, b) {
            var c = this,
            e = $(c.el),
            d = {};
            d.dataId = a;
            d.objectId = b;
            d.objectModule = "formdatareport";
            d.module = "formdatareport";
            c.relevanceModel.addComponentRelevance(d,
            function() {
                e.find(".j_formdatareport_detail .j_entity_item").remove();
                $.ajax({
                    contentType: "application/json;charset\x3dUTF-8",
                    type: "post",
                    url: "/relevance/loadModuleRelevances.json",
                    dataType: "json",
                    data: '{"objectId":' + c.id + "}",
                    success: function(a) {
                        a.relevances && c._renderRelevanceInfos(a.relevances);
                        a.mainlines && c.mainline.render(a.mainlines)
                    }
                })
            })
        },
        _renderForm: function(a, b) {
            var c = this,
            e = $(c.el),
            d = 1 == b.newLayout ? !0 : !1,
            h = 1 == b.autoSave ? !0 : !1;
            c.isautoSave = h;
            var f = {};
            h && (e.find("#datareport-form").addClass("notShowSave"), f.autoSave = {
                afterDataDetailSave: function(a) {
                    c.dataId = a.id;
                    var b = {
                        formData: a.id,
                        name: e.find('#reportContent[reportId\x3d"' + c.id + '"]').find("#datareport-name").val(),
                        id: c.id
                    };
                    c.updateReportAndFormData(b);
                    c.addRelevance(a.id, c.id)
                },
                afterformDataCreate: function(a) {
                    c.dataId = a.id;
                    var b = {
                        formData: a.id,
                        name: e.find('#reportContent[reportId\x3d"' + c.id + '"]').find("#datareport-name").val(),
                        id: c.id
                    },
                    b = c.updateReportAndFormData(b);
                    c.addRelevance(a.id, c.id);
                    return b
                }
            });
            f.readOnly = !c.editable;
            f.parentEl = e.find("#datareport-form");
            f.module = "formdatareport";
            f.callback = function(a) {
                a.formLayout.layoutDetail && e.find("#datareport-form").show();
                c.pageType && "stattable" == c.pageType && e.find("#datareport-form").addClass("notShowSave");
                a = "(\u56e2\u961f)";
                "personal" == b.ownership && (a = "(\u4e2a\u4eba)");
                "disable" == b.status ? e.find("#formName").text(b.name + "\uff08\u8be5\u8868\u5355\u5df2\u505c\u7528\u6216\u5220\u9664\uff01\uff09") : e.find("#formName").text(b.name);
                e.find("#ownership").text(a);
                if (a = formPlugin.submitAssembleForm({
                    parentEl: e.find(".form-view_js")
                })) a = JSON.stringify(a.formData.dataDetails),
                window.formJsonStr = a;
                c.getEmployeeComponentVal();
                if (c.inPrint) {
                    for (a = 0; a < $("body").find(".form-view_js\x3ediv").length; a++) $($("body").find(".form-view_js\x3ediv")[a]).append('\x3ca class\x3d"js_hidePrintDiv close flow-close ml-5" title\x3d"\u70b9\u51fb\u53ef\u9690\u85cf"\x3e\u00d7\x3c/a\x3e\x3cdiv class\x3d"border"\x3e\x3c/div\x3e').addClass("print-divhide-content");
                    a = $(".wform-title input").css("display", "none").val();
                    $(".wform-title").prepend($('\x3cdiv class\x3d"title-print"\x3e\x3c/div\x3e').text(a));
                    c.commentHtml = $("body").find("#comment-panel").html();
                    e.find(".form-view_js .form-databox").each(function(a) {
                        c.getTableLocalStorage(a);
                        for (a = 0; a < $(this).find("tbody tr:first th").length; a++) {
                            var b = c.thWidth[a];
                            b && $(this).find("tbody tr:first th:eq(" + a + ")").css("width", b)
                        }
                    });
                    $("body").find(".form-view_js .form-databox").css("overflow-x", "hidden");
                    a = e.find(".j_tablelayout");
                    a.find("td").css("position", "relative");
                    a.find("td").prepend("\x3cdiv class\x3d'mask' style\x3d'top:10px;bottom:10px;left:10px;right:10px;position:absolute;z-index:1;'\x3e\x3c/div\x3e");
                    a.parents(".print-divhide-content").find(".border").hide();
                    e.find(".form-view_js .subtable_js").each(function(a) {
                        $(this).find("tbody tr:first th:not(:last)").resizable({
                            handles: "e",
                            minWidth: 30,
                            stop: function(b, e) {
                                $(".j_formstatScrX").mCustomScrollbar("update");
                                c.setTableLocalStorage(a, e.size.width, e.element.index())
                            }
                        })
                    })
                }
            };
            a.formData ? (f.dataId = a.formData, f.newLayout = d, c.formView.loadForm(f)) : (f.formId = a.formId, f.layoutId = a.formLayout, c.formView.render(f))
        },
        setTableLocalStorage: function(a, b, c) {
            a = "formdatareport_print_" + TEAMS.currentUser.id + "_" + this.id + "_" + a;
            this.thWidth[c] = b;
            localStorage.setItem(a, JSON.stringify(this.thWidth))
        },
        getTableLocalStorage: function(a) {
            this.thWidth = JSON.parse(localStorage.getItem("formdatareport_print_" + TEAMS.currentUser.id + "_" + this.id + "_" + a)) || {}
        },
        _renderRelevanceInfos: function(a) {
            var b = $(this.el),
            c = this.relevanceViews,
            e = [],
            d = [],
            h = [],
            f = [],
            g = [],
            p = [],
            w = [];
            _.each(a,
            function(a) {
                var b = a.targetModule;
                "task" == b ? e.push(a) : "document" == b ? d.push(a) : "customer" == b ? f.push(a) : "saleChance" == b ? g.push(a) : "workflow" == b ? h.push(a) : "calendar" == b ? p.push(a) : "formdatareport" == b && w.push(a)
            });
            _.each(c,
            function(a) {
                "task" == a._targetModule ? (a.render(e), 0 < e.length && b.find($(a.el).attr("icon")).parent().addClass("hide")) : "document" == a._targetModule ? (a.render(d), 0 < d.length && b.find($(a.el).attr("icon")).parent().addClass("hide")) : "customer" == a._targetModule ? (a.render(f), 0 < f.length && b.find($(a.el).attr("icon")).parent().addClass("hide")) : "saleChance" == a._targetModule ? (a.render(g), 0 < g.length && b.find($(a.el).attr("icon")).parent().addClass("hide")) : "workflow" == a._targetModule ? (a.render(h), 0 < h.length && b.find($(a.el).attr("icon")).parent().addClass("hide")) : "calendar" == a._targetModule ? (a.render(p), 0 < p.length && b.find($(a.el).attr("icon")).parent().addClass("hide")) : "formdatareport" == a._targetModule && (a.render(w), 0 < w.length && b.find($(a.el).attr("icon")).parent().addClass("hide"))
            })
        },
        remove: function() {
            this.undelegateEvents();
            $(this.el).off(".FormDataReport");
            this.filter && (this.filter.remove(), this.filter = null);
            this.formView && (this.formView.remove(), this.formView = null);
            this.mainline && (this.mainline.remove(), this.mainline = null);
            this.dataId && (this.dataId = null);
            this.isautoSave && (this.isautoSave = null);
            this.formId && (this.formId = null);
            this.relevanceViews && (_.each(this.relevanceViews,
            function(a) {
                a.remove()
            }), this.relevanceViews = null);
            window.formJsonStr && (window.formJsonStr = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formauthconfigview", ["teams/utils", "teams/component/typeahead", "teams/component/validation", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/typeahead");
    g("teams/component/validation");
    var b = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.el = "#form-auth-config";
            this.callback = a.callback;
            this.userId = a.userId;
            this.parentEl = a.parentEl ? a.parentEl: "body";
            $(this.parentEl).append(d.template("form.formauthconfig"));
            this.model = new b(a)
        },
        delegateEvents: function() {
            var a = this,
            b = a.model,
            h = a.formId;
            $(a.el).on("hidden.bs.modal.AuthConfig",
            function(b) {
                $(b.target).hasClass("datepicker") || a.remove()
            });
            $(a.el).off("change.AuthConfig", "#edit-auth select").on("change.AuthConfig", "#edit-auth select",
            function() {
                $(this);
                var b = $(a.el).find("#editauth-select").val(),
                e = $(a.el).find("#edit-auth");
                if ("user" == b) e.find(".sharetype-user").removeClass("hide"),
                e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-user input").focus();
                else if ("department" == b) e.find(".sharetype-dept").removeClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-dept input").focus();
                else if ("group" == b) e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group").removeClass("hide"),
                e.find(".sharetype-group input").focus();
                else {
                    e.find(".sharetype-dept").addClass("hide");
                    e.find(".sharetype-user").removeClass("hide");
                    e.find(".sharetype-group").addClass("hide");
                    e.find("#editShare").removeClass("hide");
                    e.find(".typeahead-wrapper").addClass("hide");
                    $(this).val("user");
                    var e = e.find(".j_selected"),
                    f = !1;
                    e.find(".entity-item").each(function(a) {
                        0 == $(this).find("a").attr("id") && (f = !0)
                    });
                    f ? d.notify("\u5df2\u6dfb\u6240\u6709\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : (a.saveAndSortSelectUser(h, "\u6240\u6709\u4eba", "0", b, e, "edit"), e.append('\x3cspan class\x3d"entity-item" permissionType\x3d"edit" type\x3d"allpeople"\x3e\x3ca id\x3d"0"\x3e\u6240\u6709\u4eba\x3c/a\x3e\x3c/span\x3e'))
                }
            });
            $(a.el).off("change.AuthConfig", "#look-auth select").on("change.AuthConfig", "#look-auth select",
            function() {
                $(this);
                var b = $(a.el).find("#lookauth-select").val(),
                e = $(a.el).find("#look-auth");
                if ("user" == b) e.find(".sharetype-user").removeClass("hide"),
                e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-user input").focus();
                else if ("department" == b) e.find(".sharetype-dept").removeClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-dept input").focus();
                else if ("group" == b) e.find(".sharetype-group").removeClass("hide"),
                e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group input").focus();
                else {
                    e.find(".sharetype-dept").addClass("hide");
                    e.find(".sharetype-user").removeClass("hide");
                    e.find(".sharetype-group").addClass("hide");
                    e.find("#editShare").removeClass("hide");
                    e.find(".typeahead-wrapper").addClass("hide");
                    $(this).val("user");
                    var e = e.find(".j_selected"),
                    f = !1;
                    e.find(".entity-item").each(function(a) {
                        0 == $(this).find("a").attr("id") && (f = !0)
                    });
                    f ? d.notify("\u5df2\u6dfb\u6240\u6709\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : (a.saveAndSortSelectUser(h, "\u6240\u6709\u4eba", "0", b, e, "check"), e.append('\x3cspan class\x3d"entity-item" permissionType\x3d"check" type\x3d"allpeople"\x3e\x3ca id\x3d"0"\x3e\u6240\u6709\u4eba\x3c/a\x3e\x3c/span\x3e'))
                }
            });
            $(a.el).off("change.AuthConfig", "#maintain-auth select").on("change.AuthConfig", "#maintain-auth select",
            function() {
                $(this);
                var b = $(a.el).find("#maintainauth-select").val(),
                e = $(a.el).find("#maintain-auth");
                if ("user" == b) e.find(".sharetype-user").removeClass("hide"),
                e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-user input").focus();
                else if ("department" == b) e.find(".sharetype-dept").removeClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-dept input").focus();
                else if ("group" == b) e.find(".sharetype-group").removeClass("hide"),
                e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group input").focus();
                else {
                    e.find(".sharetype-dept").addClass("hide");
                    e.find(".sharetype-user").removeClass("hide");
                    e.find(".sharetype-group").addClass("hide");
                    e.find("#editShare").removeClass("hide");
                    e.find(".typeahead-wrapper").addClass("hide");
                    $(this).val("user");
                    var e = e.find(".j_selected"),
                    f = !1;
                    e.find(".entity-item").each(function(a) {
                        0 == $(this).find("a").attr("id") && (f = !0)
                    });
                    f ? d.notify("\u5df2\u6dfb\u6240\u6709\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : (a.saveAndSortSelectUser(h, "\u6240\u6709\u4eba", "0", b, e, "maintain"), e.append('\x3cspan class\x3d"entity-item" permissionType\x3d"maintain" type\x3d"allpeople"\x3e\x3ca id\x3d"0"\x3e\u6240\u6709\u4eba\x3c/a\x3e\x3c/span\x3e'))
                }
            });
            $(a.el).off("change.AuthConfig", "#continue-write select").on("change.AuthConfig", "#continue-write select",
            function() {
                $(this);
                var b = $(a.el).find("#contwrite-select").val(),
                e = $(a.el).find("#continue-write");
                if ("user" == b) e.find(".sharetype-user").removeClass("hide"),
                e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-user input").focus();
                else if ("department" == b) e.find(".sharetype-dept").removeClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group").addClass("hide"),
                e.find(".sharetype-dept input").focus();
                else if ("group" == b) e.find(".sharetype-group").removeClass("hide"),
                e.find(".sharetype-dept").addClass("hide"),
                e.find(".sharetype-user").addClass("hide"),
                e.find(".sharetype-group input").focus();
                else {
                    e.find(".sharetype-dept").addClass("hide");
                    e.find(".sharetype-user").removeClass("hide");
                    e.find(".sharetype-group").addClass("hide");
                    e.find("#editShare").removeClass("hide");
                    e.find(".typeahead-wrapper").addClass("hide");
                    $(this).val("user");
                    var e = e.find(".j_selected"),
                    f = !1;
                    e.find(".entity-item").each(function(a) {
                        0 == $(this).find("a").attr("id") && (f = !0)
                    });
                    f ? d.notify("\u5df2\u6dfb\u6240\u6709\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : (a.saveAndSortSelectUser(h, "\u6240\u6709\u4eba", "0", b, e, "write"), e.append('\x3cspan class\x3d"entity-item" permissionType\x3d"write" type\x3d"allpeople"\x3e\x3ca id\x3d"0"\x3e\u6240\u6709\u4eba\x3c/a\x3e\x3c/span\x3e'))
                }
            });
            f([{
                el: a.el + " #edit-auth .sharetype-dept input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#edit-auth .j_selected");
                        a.renderTypeheader(e, b, "department", "edit")
                    }
                }
            },
            {
                el: a.el + " #edit-auth .sharetype-user input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#edit-auth .j_selected");
                        a.renderTypeheader(e, b, "user", "edit")
                    }
                }
            },
            {
                el: a.el + " #edit-auth .sharetype-group input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#edit-auth .j_selected");
                        a.renderTypeheader(e, b, "group", "edit")
                    }
                }
            }]);
            f([{
                el: a.el + " #look-auth .sharetype-dept input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#look-auth .j_selected");
                        a.renderTypeheader(e, b, "department", "check")
                    }
                }
            },
            {
                el: a.el + " #look-auth .sharetype-user input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#look-auth .j_selected");
                        a.renderTypeheader(e, b, "user", "check")
                    }
                }
            },
            {
                el: a.el + " #look-auth .sharetype-group input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#look-auth .j_selected");
                        a.renderTypeheader(e, b, "group", "check")
                    }
                }
            }]);
            f([{
                el: a.el + " #maintain-auth .sharetype-dept input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#maintain-auth .j_selected");
                        a.renderTypeheader(e, b, "department", "maintain")
                    }
                }
            },
            {
                el: a.el + " #maintain-auth .sharetype-user input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#maintain-auth .j_selected");
                        a.renderTypeheader(e, b, "user", "maintain")
                    }
                }
            },
            {
                el: a.el + " #maintain-auth .sharetype-group input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#maintain-auth .j_selected");
                        a.renderTypeheader(e, b, "group", "maintain")
                    }
                }
            }]);
            f([{
                el: a.el + " #continue-write .sharetype-dept input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#continue-write .j_selected");
                        a.renderTypeheader(e, b, "department", "write")
                    }
                }
            },
            {
                el: a.el + " #continue-write .sharetype-user input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#continue-write .j_selected");
                        a.renderTypeheader(e, b, "user", "write")
                    }
                }
            },
            {
                el: a.el + " #continue-write .sharetype-group input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var e = $(a.el).find("#continue-write .j_selected");
                        a.renderTypeheader(e, b, "group", "write")
                    }
                }
            }]);
            $(a.el).off("click.AuthConfig", "#authconfig-close").on("click.AuthConfig", "#authconfig-close",
            function(b) {
                $(a.el).modal("hide")
            });
            $(a.el).off("click.AuthConfig", ".j_formslidedown").on("click.AuthConfig", ".j_formslidedown",
            function(b) {
                $(a.el).find("#formdata-auth").show();
                $(this).hide();
                $(a.el).find(".j_formslideup").show()
            });
            $(a.el).off("click.AuthConfig", ".j_formslideup").on("click.AuthConfig", ".j_formslideup",
            function(b) {
                $(a.el).find("#formdata-auth").hide();
                $(this).hide();
                $(a.el).find(".j_formslidedown").show()
            });
            $(a.el).off("click", ".entity-item .close").on("click ", ".entity-item .close",
            function(b) {
                b.stopPropagation();
                a.deleteEvent($(this))
            });
            $(a.el).off("click.AuthConfig", 'input[name\x3d"authType"]').on("click.AuthConfig", 'input[name\x3d"authType"]',
            function(c) {
                c = $(this);
                var h = {};
                h.formId = a.formId;
                var f = c.parents(".j_field_auth").attr("fieldId");
                h.fieldId = f;
                h.entityType = "biaoge";
                var f = [],
                g = c.attr("value"),
                r = c.prop("checked");
                f.push(g);
                "write" == g || "delete" == g ? r && (g = c.parents(".j_auth_type").find('input[value\x3d"check"]').prop("checked"), 0 == g || "false" == g) && (c.parents(".j_auth_type").find('input[value\x3d"check"]').prop("checked", !0), f.push("check")) : 0 == r && (f.push("write"), f.push("delete"), c.parents(".j_auth_type").find('input[value\x3d"write"]').prop("checked", !1), c.parents(".j_auth_type").find('input[value\x3d"delete"]').prop("checked", !1));
                h.permisionList = f;
                r ? b.saveFieldAuth(h,
                function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : d.notify("\u6dfb\u52a0\u6743\u9650\u6210\u529f!")
                }) : b.deleteFieldAuth(h,
                function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : d.notify("\u53d6\u6d88\u6743\u9650\u6210\u529f!")
                })
            })
        },
        deleteEvent: function(a) {
            var b = a.prevAll("a").attr("id"),
            h = a.parent(".entity-item").attr("permissionType"),
            c = a.parents(".entity-container");
            a.parent(".entity-item").remove();
            c.trigger("removeEntity", b);
            a = a.parent(".entity-item").attr("type");
            c = {};
            c.formId = this.formId;
            c.uidORdeptid = b;
            c.selectType = a;
            c.queryType = h;
            c.entityType = "biaoge";
            $.ajax({
                type: "post",
                url: "/form/deleteShareConfig.json",
                dataType: "json",
                data: c,
                success: function(a) {
                    d.notify("\u6570\u636e\u5df2\u5220\u9664")
                }
            })
        },
        renderTypeheader: function(a, b, d, c) {
            var k = this.formId;
            if (b.length) for (var f = 0; f < b.length; f++) {
                var g = b[f],
                r = g.name,
                t = g.id;
                if (r && t) {
                    var n = '\x3cspan class\x3d"entity-item" permissionType\x3d"' + c + '" type\x3d"' + d + '"\x3e\x3ca id\x3d' + t + "\x3e" + r + "\x3c/a\x3e\x3c/span\x3e";
                    a.find(".entity-item").each(function(a) {
                        t == $(this).find("a").attr("id") && (n = null)
                    });
                    this.saveAndSortSelectUser(k, r, t, d, a, c);
                    a.append(n)
                }
            } else r = b.name,
            t = b.id,
            r && t && (n = '\x3cspan class\x3d"entity-item" permissionType\x3d"' + c + '" type\x3d"' + d + '"\x3e\x3ca id\x3d' + t + "\x3e" + r + "\x3c/a\x3e\x3c/span\x3e", a.find(".entity-item").each(function(a) {
                t == $(this).find("a").attr("id") && (n = null)
            }), this.saveAndSortSelectUser(k, r, t, d, a, c), a.append(n))
        },
        saveAndSortSelectUser: function(a, b, h, c, k, f) {
            var g = this.model,
            r = {};
            r.selectType = c;
            r.formId = a;
            r.content = b;
            r.linkId = h;
            r.uidORdeptid = h;
            r.queryType = f;
            r.entityType = "biaoge";
            var t = !1;
            k.find(".entity-item").each(function(a) {
                h == $(this).find("a").attr("id") && (t = !0)
            });
            t ? d.notify("\u5df2\u6dfb\u52a0\u6b64\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : g.saveShareConfig(r,
            function(a) {
                a.actionMsg ? d.notify(a.actionMsg.message) : "user" == c ? d.notify("\u6dfb\u52a0\u4eba\u5458\u6210\u529f") : "department" == c ? d.notify("\u6dfb\u52a0\u90e8\u95e8\u6210\u529f") : "group" == c ? d.notify("\u6dfb\u52a0\u7fa4\u7ec4\u6210\u529f") : "allpeople" == c && d.notify("\u6dfb\u52a0\u6240\u6709\u4eba\u6210\u529f")
            })
        },
        queryLastConfig: function() {
            var a = this,
            b = a.model,
            d = {};
            d.formId = a.formId;
            d.queryType = "authconfig";
            d.entityType = "biaoge";
            b.queryLastConfig(d,
            function(b) {
                var e = b.formFields;
                $(a.el).find(".j_formslideup").hide();
                if (null != e && 0 < e.length) {
                    $(a.el).find(".j_formslidedown").removeClass("hide");
                    for (var d = 0; d < e.length; d++) {
                        var h = e[d].id,
                        f = e[d]["delete"],
                        g = e[d].title,
                        n = $(a.el).find("#fieldauth-clone .j_field_auth").clone();
                        n.attr("fieldId", h).attr("id", h);
                        n.find(".j_field_name").append('\x3cspan class\x3d"txt ellipsis j_name"\x3e' + g + "\x3c/span\x3e\x3cspan\x3e\uff1a\x3c/span\x3e").attr("title", g);
                        1 != f && "true" != f || n.find(".j_field_name .j_name").addClass("finished-line");
                        $(a.el).find("#formdata-auth").append(n)
                    }
                    $(a.el).find("#formdata-auth").show();
                    $(a.el).find(".j_formslidedown").hide();
                    $(a.el).find(".j_formslideup").show();
                    $(a.el).find("#no-data").addClass("hide")
                } else $(a.el).find("#formdata-auth").show(),
                $(a.el).find("#no-data").removeClass("hide");
                b = b.formPermissions;
                if (null != b && 0 < b.length) for (d = 0; d < b.length; d++) e = b[d].permissionType,
                h = b[d].targetType,
                "field" == h ? (h = b[d].targetId, $(a.el).find('.j_field_auth[id\x3d"' + h + '"] input[value\x3d"' + e + '"]').prop("checked", !0)) : ("all" == h && (h = "allpeople"), f = b[d].targetId, g = b[d].name, "group" != h || null != g && "" != g || (g = "\u672a\u547d\u540d(\u7fa4\u7ec4)"), "edit" == e ? $(a.el).find("#edit-auth .j_selected").append('\x3cspan class\x3d"entity-item" permissionType\x3d"edit" type\x3d"' + h + '"\x3e\x3ca id\x3d' + f + "\x3e" + g + "\x3c/a\x3e\x3c/span\x3e") : "check" == e ? $(a.el).find("#look-auth .j_selected").append('\x3cspan class\x3d"entity-item" permissionType\x3d"check" type\x3d"' + h + '"\x3e\x3ca id\x3d' + f + "\x3e" + g + "\x3c/a\x3e\x3c/span\x3e") : "maintain" == e ? $(a.el).find("#maintain-auth .j_selected").append('\x3cspan class\x3d"entity-item" permissionType\x3d"maintain" type\x3d"' + h + '"\x3e\x3ca id\x3d' + f + "\x3e" + g + "\x3c/a\x3e\x3c/span\x3e") : "write" == e && $(a.el).find("#continue-write .j_selected").append('\x3cspan class\x3d"entity-item" permissionType\x3d"write" type\x3d"' + h + '"\x3e\x3ca id\x3d' + f + "\x3e" + g + "\x3c/a\x3e\x3c/span\x3e"))
            })
        },
        render: function() {
            $(this.el).modal("show");
            this.queryLastConfig();
            d.layout(".j_formAuthScr")
        },
        hide: function() {
            $(this.el).modal("hide")
        },
        remove: function() {
            $(this.el).off(".AuthConfig");
            $("#form-auth-config").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formcloudmodel", ["teams/utils"],
function(g, m, l) {
    var d = g("teams/utils");
    g = Backbone.Model.extend({
        initialize: function(d) {},
        defaults: {
            pageNo: 1,
            pageSize: 10,
            order: "default"
        },
        load: function() {
            this.loadLabel();
            this.searchForm()
        },
        loadLabel: function(f) {
            var b = this;
            $.ajax({
                type: "get",
                url: "/biaoge/findFormLabel.json",
                dataType: "json",
                data: {
                    rank: "2"
                },
                success: function(a) {
                    a && a.actionMsg ? d.notify(a.actionMsg.message, null, "error") : (b.set("formLabels", a.formLabels), f && f(a))
                }
            })
        },
        getFormByLabels: function(d, b) {
            this.set({
                keyword: "",
                labelIds: d,
                pageNo: "1",
                order: "default"
            });
            this.searchForm(b)
        },
        getFormByKeyword: function(d, b) {
            this.set({
                keyword: d,
                pageNo: "1",
                order: "default"
            });
            this.searchForm(b)
        },
        sortFormList: function(d, b) {
            this.set({
                pageNo: "1",
                order: d || "default"
            });
            this.searchForm(b)
        },
        nextPage: function(d) {
            this.set({
                pageNo: this.get("nextPage")
            });
            this.searchForm(d)
        },
        searchForm: function(f) {
            var b = this,
            a = _.pick(b.attributes, "keyword", "labelIds", "pageNo", "pageSize", "order", "lastUpload");
            $.ajax({
                type: "post",
                contentType: "application/json;charset\x3dUTF-8",
                url: "/biaoge/findFormByLabel.json",
                dataType: "json",
                data: JSON.stringify(a),
                success: function(a) {
                    if (a && a.actionMsg) d.notify(a.actionMsg.message, null, "error");
                    else {
                        var h = a && a.formPage;
                        b.set({
                            forms: h.result,
                            pageNo: h.pageNo,
                            nextPage: h.nextPage,
                            hasNext: h.hasNext,
                            hasPre: h.hasPre
                        });
                        0 == h.result ? $(".j_formlist .j_no-result").removeClass("hide") : $(".j_formlist .j_no-result").addClass("hide");
                        f && f(a)
                    }
                }
            })
        },
        popularityForm: function(f, b) {
            $.ajax({
                type: "post",
                url: "/biaoge/popularityForm.json",
                dataType: "json",
                data: f,
                success: function(a) {
                    a && a.actionMsg ? d.notify(a.actionMsg.message, null, "error") : b && b(a)
                }
            })
        },
        getLastUpload: function(d, b) {
            this.set({
                lastUpload: d,
                pageNo: "1",
                order: "default"
            });
            this.searchForm(b)
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formuploadview", ["teams/utils", "eteams/biaoge/form/formuploadmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formuploadmodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.el = "#form-upload-view";
            this.formId = b.formId;
            this.module = b.module;
            this.callback = b.callback;
            this.model = new f;
            this.parentEl = b.parentEl ? b.parentEl: "body";
            $(this.parentEl).append(d.template("form.formupload"))
        },
        render: function() {
            this.renderEformCats();
            $(this.el).modal("show")
        },
        delegateEvents: function() {
            var b = $(this.el),
            a = this;
            $(a.el).on("hidden.bs.modal.formupload",
            function(b) {
                a.remove()
            });
            b.off("click.formupload", ".j_btn_close").on("click.formupload", ".j_btn_close",
            function() {
                $(a.el).modal("hide")
            });
            b.off("click.formupload", ".js_eform_labels\x3eul\x3eli\x3edl\x3edd").on("click.formupload", ".js_eform_labels\x3eul\x3eli\x3edl\x3edd",
            function() {
                $(this).toggleClass("selected")
            });
            b.off("click.formupload", "#formUploadBtn").on("click.formupload", "#formUploadBtn",
            function() {
                var e = b.find(".js_eform_labels\x3eul\x3eli\x3edl\x3edd.selected");
                if (0 == e.length) d.notify("\u8bf7\u9009\u62e9\u60a8\u8981\u4e0a\u4f20\u7684\u4e91\u8868\u5355\u5206\u7c7b");
                else {
                    var h = [];
                    e.each(function() {
                        h.push($(this).find("a").attr("label-id"))
                    });
                    e = {};
                    e.formLabelIds = h.toString();
                    e.formId = a.formId;
                    e.module = a.module;
                    a.model.saveFormUpload(e,
                    function(a) {
                        $(".j_btn_close").click();
                        d.notify("\u8868\u5355\u4e0a\u4f20\u81f3\u4e91\u8868\u5355\u5e93\u6210\u529f")
                    })
                }
            })
        },
        renderEformCats: function() {
            var b = $(this.el);
            this.model.findFormLabel({
                rank: 2
            },
            function(a) {
                a = _.template(b.find("#js_template_eformcats").html(), a);
                b.find(".js_eform_labels").append(a);
                b.find(".js_eform_labels\x3eul\x3eli").eq(0).find("dl").find("dd").eq(0).addClass("selected")
            })
        },
        remove: function() {
            $(this.el).off(".formupload");
            $("#form-upload-view").remove()
        },
        hide: function() {
            $(this.el).modal("hide")
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formdatareportmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        pageNo: 1,
        pageSize: 25,
        initialize: function(d) {
            d && (this.id = d.id, this.userId = d.userId)
        },
        search: function(d, f) {
            d.pageNo = this.pageNo;
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/search.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        show: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/showReport.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        update: function(d, f) {
            var b = !0;
            null != d.async && 0 == d.async && (b = !1);
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/update.json",
                dataType: "json",
                async: b,
                data: JSON.stringify(d),
                success: function(a) {
                    f && f(a)
                }
            })
        },
        updateReportAndFormData: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/updateReportAndFormData.json",
                dataType: "json",
                async: !1,
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        updateCollectlogDetail: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/updateCollectlogDetail.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        deleteReport: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/deleteReport.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        getByFormId: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/getByFormId.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        queryByFormId: function(d, f) {
        	console.log("form/queryByFormId.json");
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/queryByFormId.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formtagview", ["teams/utils", "teams/component/formtagmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/formtagmodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.container = b.container;
            this.el = (this.parentEl = b.parentEl) ? this.parentEl + " " + this.container: this.container;
            this.targetId = b.targetId;
            this._module = b.module;
            this.callbacks = b.callbacks;
            $(this.el).html(d.template("form.formtagnew"));
            this.model = new f(b)
        },
        delegateEvents: function() {
            var b = this,
            a = this.model;
            $(b.el).off("click.FormTagView", "#formtag-container .j_tagname").on("click.FormTagView", "#formtag-container .j_tagname",
            function(e) {
                var h = $(this);
                e = h.attr("tagid");
                if (h.attr("readonly")) {
                    var c = {};
                    c.targetId = b.targetId;
                    c.id = e;
                    c.module = b._module;
                    h.hasClass("linked") ? a.unlink(c,
                    function(a) {
                        a.message ? d.notify(a.message) : (h.removeClass("linked"), h.parent().find(".j_choose").prop("checked", !1), d.notify("\u53d6\u6d88\u5173\u8054\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                    }) : a.link(c,
                    function(a) {
                        a.message ? d.notify(a.message) : (h.addClass("linked"), h.parent().find(".j_choose").prop("checked", !0), d.notify("\u5173\u8054\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                    })
                }
            });
            $(b.el).off("click.FormTagView", "#formtag-container .j_choose").on("click.FormTagView", "#formtag-container .j_choose",
            function(e) {
                var h = $(this);
                e = h.attr("tagid");
                var c = {};
                c.targetId = b.targetId;
                c.id = e;
                c.module = b._module;
                h.parents("a").find(".j_tagname").hasClass("linked") ? a.unlink(c,
                function(a) {
                    a.message ? d.notify(a.message) : (h.parents("a").find(".j_tagname").removeClass("linked"), h.parents("a").find(".j_choose").prop("checked", !1), d.notify("\u53d6\u6d88\u5173\u8054\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                }) : a.link(c,
                function(a) {
                    a.message ? d.notify(a.message) : (h.parents("a").find(".j_tagname").addClass("linked"), h.parents("a").find(".j_choose").prop("checked", !0), d.notify("\u5173\u8054\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                })
            });
            $(b.el).off("click.FormTagView", "#formtag-container .j_tagedit").on("click.FormTagView", "#formtag-container .j_tagedit",
            function(a) {
                a = $(this);
                a.attr("tagid");
                $(b.el).find(".j_tagname").attr("readonly", !0);
                a.parents("a").find(".j_tagname").attr("readonly", !1);
                a.parents("a").find(".j_tagname").focus()
            });
            $(b.el).off("keydown.FormTagView", "#formtag-container .j_tagname").on("keydown.FormTagView", "#formtag-container .j_tagname",
            function(b) {
                var h = $(this);
                b = b.keyCode;
                var c = $.trim(h.val()),
                f = h.attr("tagid"),
                g = {};
                g.id = f;
                g.name = c;
                13 == b && ("" == c || null == c ? d.notify("\u8bf7\u8f93\u5165\u8868\u5355\u5206\u7c7b\u540d\u79f0") : a.updateTag(g,
                function(a) {
                    a.message ? d.notify(a.message) : (h.parents("a").find(".j_tagname").attr("readonly", !0), d.notify("\u7f16\u8f91\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                }))
            });
            $(b.el).off("blur.FormTagView", "#formtag-container .j_tagname").on("blur.FormTagView", "#formtag-container .j_tagname",
            function(b) {
                var h = $(this);
                if (!h.attr("readonly")) {
                    b = $.trim(h.val());
                    var c = h.attr("tagid"),
                    f = {};
                    f.id = c;
                    f.name = b;
                    "" == b || null == b ? d.notify("\u8bf7\u8f93\u5165\u8868\u5355\u5206\u7c7b\u540d\u79f0") : a.updateTag(f,
                    function(a) {
                        a.message ? d.notify(a.message) : (h.parents("a").find(".j_tagname").attr("readonly", !0), d.notify("\u7f16\u8f91\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                    })
                }
            });
            $(b.el).off("click.FormTagView", "#formtag-container .j_tagcreate").on("click.FormTagView", "#formtag-container .j_tagcreate",
            function(e) {
                e = $(b.el).find("#formtag-container").find("#formtagcreate-input").val().trim();
                if (null == e || "" == e) d.notify("\u8bf7\u8f93\u5165\u8868\u5355\u5206\u7c7b\u540d\u79f0");
                else {
                    var h = {};
                    h["formtag.name"] = e;
                    h.targetId = b.targetId;
                    h.module = b._module;
                    a.create(h,
                    function(a) {
                        a.message ? (d.notify(a.message), $(b.el).find("#formtag-container").find("#formtagcreate-input").focus()) : (b.render(), $(b.el).find("#formtag-container").find("#formtagcreate-input").val(""), d.notify("\u6dfb\u52a0\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                    })
                }
            });
            $(b.el).off("keydown.FormTagView", "#formtag-container #formtagcreate-input").on("keydown.FormTagView", "#formtag-container #formtagcreate-input",
            function(a) {
                13 == a.keyCode && $(b.el).find("#formtag-container").find(".j_tagcreate").trigger("click.FormTagView")
            });
            $(b.el).off("click.FormTagView", "#formtag-container .j_tagdelete").on("click.FormTagView", "#formtag-container .j_tagdelete",
            function(e) {
                e = $(this).attr("tagid");
                var h = {};
                h.targetId = b.targetId;
                h.id = e;
                h.module = b._module;
                a.deleteTag(h,
                function(a) {
                    a.message ? d.notify(a.message) : (b.render(), d.notify("\u5220\u9664\u8868\u5355\u5206\u7c7b\u6210\u529f"))
                })
            })
        },
        render: function() {
            $(this.el).find("#formtag-container").find(".j_formtag-ul").empty();
            this.renderMyFormTags();
            d.layout(".j_formtagScr")
        },
        renderMyFormTags: function() {
            var b = this.model,
            a = $(this.el),
            e = {};
            e.targetId = this.targetId;
            b.queryMyFormTags(e,
            function(b) {
                b = b.formtags;
                var c = a.find("#formtag-container .j_formtag-ul");
                if (null != b && 0 < b.length) for (var e = 0; e < b.length; e++) {
                    var d = b[e],
                    f = a.find("#formtag-li-clone li").clone();
                    f.find(".j_tagname").val(d.name);
                    f.find(".j_tagname").attr("title", d.name);
                    f.find(".j_tagname").attr("tagid", d.id);
                    f.find(".j_tagedit").attr("tagid", d.id);
                    f.find(".j_choose").attr("tagid", d.id);
                    f.find(".j_tagdelete").attr("tagid", d.id);
                    f.attr("id", d.id);
                    null != d.formlabellinkId && (f.find(".j_tagname").addClass("linked"), f.find(".j_choose").prop("checked", !0));
                    0 < c.find("#" + d.id).length || c.append(f)
                } else c.html('\x3cspan class\x3d"j_noresult no-data"\x3e\u60a8\u8fd8\u672a\u6dfb\u52a0\u6211\u7684\u8868\u5355\u5206\u7c7b,\u5feb\u53bb\u8bd5\u8bd5\u4e3a\u8868\u5355\u6dfb\u52a0\u4e13\u5c5e\u4e8e\u60a8\u7684\u5206\u7c7b\x3c/span\x3e')
            })
        },
        remove: function() {
            $(this.el).off(".FormTagView")
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/messageconfigview", ["teams/utils", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.formId = b.formId;
            this.el = "#message-config-view";
            this.callback = b.callback;
            this.userId = b.userId;
            this.parentEl = b.parentEl ? b.parentEl: "body";
            $(this.parentEl).append(d.template("form.messageconfig"));
            this.model = new f(b)
        },
        delegateEvents: function() {
            var b = this,
            a = b.model;
            $(b.el).on("hidden.bs.modal.MessageConfig",
            function(a) {
                $(a.target).hasClass("datepicker") || b.remove()
            });
            $(b.el).off("click.MessageConfig", "#messageconfig-close").on("click.MessageConfig", "#messageconfig-close",
            function(a) {
                $(b.el).modal("hide")
            });
            $(b.el).off("change.MessageConfig", ".j_receive").on("change.MessageConfig", ".j_receive",
            function(b) {
                var h = $(this),
                c = h.parent().parent().attr("permissionId");
                b = {};
                b.permissionId = c;
                b.messageType = null;
                var f = "\u5df2\u53d6\u6d88\u6d88\u606f\u63a5\u6536",
                h = h.prop("checked");
                if (1 == h || "true" == h) b.messageType = "all",
                f = "\u5df2\u6dfb\u52a0\u6d88\u606f\u63a5\u6536";
                a.updateMessage(b,
                function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : d.notify(f)
                })
            })
        },
        queryLastMsgConfig: function() {
            var b = this,
            a = b.model,
            e = {};
            e.formId = b.formId;
            e.entityType = "biaoge";
            a.queryLastMsgConfig(e,
            function(a) {
                var c = a.creatorPermissions;
                if (c && 0 < c.length) {
                    var e = c[0],
                    c = $(b.el).find("#messageconfig-clone .j_checkNameLi").clone();
                    c.attr("permissionId", e.id).attr("targetId", e.targetId).attr("targetType", e.targetType);
                    c.find(".j_name").text(e.name + "(\u521b\u5efa\u8005)"); (e = e.messageType) ? c.find(".j_receive").prop("checked", !0) : c.find(".j_receive").prop("checked", !1);
                    $(b.el).find("#checkMsg-config .j_checkUL").append(c)
                }
                a = a.formPermissions;
                if (null != a && 0 < a.length) for (var d = 0; d < a.length; d++) {
                    var f = a[d],
                    g = f.name,
                    e = f.messageType,
                    t = f.targetId,
                    n = a[d].targetType,
                    c = $(b.el).find("#messageconfig-clone .j_checkNameLi").clone();
                    c.attr("permissionId", f.id).attr("targetId", t).attr("targetType", n);
                    c.find(".j_name").text(g);
                    e ? c.find(".j_receive").prop("checked", !0) : c.find(".j_receive").prop("checked", !1);
                    "field" != n ? $(b.el).find("#checkMsg-config .j_checkUL").append(c) : ($(b.el).find("#fieldMsg-config").removeClass("hide"), $(b.el).find("#fieldMsg-config .j_fieldUL").append(c))
                }
                0 == $(b.el).find("#fieldMsg-config .j_fieldUL .j_checkNameLi").length ? $(b.el).find("#no-data").removeClass("hide") : $(b.el).find("#no-data").addClass("hide")
            })
        },
        render: function() {
            $(this.el).modal("show");
            this.queryLastMsgConfig();
            d.layout(".j_messageConfigScr")
        },
        hide: function() {
            $(this.el).modal("hide")
        },
        remove: function() {
            $(this.el).off(".MessageConfig");
            $("#message-config-view").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formwriteview", "teams/utils eteams/biaoge/form/formmanagemodel eteams/biaoge/form/formoperationview teams/component/entityslider teams/component/typeahead eteams/biaoge/formmanage/formdistributeview teams/component/filter eteams/biaoge/form/formreportconfigview eteams/biaoge/form/formauthconfigview eteams/biaoge/form/formuploadview eteams/biaoge/form/importformview.js eteams/biaoge/form/messageconfigview eteams/biaoge/form/remindconfigview eteams/biaoge/form/customconfigview".split(" "),
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formmanagemodel"),
    b = g("eteams/biaoge/form/formoperationview");
    g("teams/component/entityslider");
    g("teams/component/typeahead");
    var a = g("eteams/biaoge/formmanage/formdistributeview"),
    e = g("teams/component/filter"),
    h = g("eteams/biaoge/form/formreportconfigview"),
    c = g("eteams/biaoge/form/formauthconfigview"),
    k = g("eteams/biaoge/form/formuploadview"),
    s = g("eteams/biaoge/form/importformview.js"),
    q = g("eteams/biaoge/form/messageconfigview"),
    r = g("eteams/biaoge/form/remindconfigview"),
    t = g("eteams/biaoge/form/customconfigview");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.userId = a.userId;
            this.el = a.container ? a.container: "#j_workflowcenter";
            this.isAdmin = TEAMS.currentUser.admin;
            this.isWeaver = "t7akvdnf84" == TEAMS.currentTenant.tenantKey || "T7AKVDNF84" == TEAMS.currentTenant.tenantKey ? !0 : !1;
            this.type = a.type;
            this.tpl = d.template("form.formwrite", {
                userId: this.userId,
                isWeaver: this.isWeaver,
                isAdmin: this.isAdmin
            });
            this.model = new f(a);
            this.pageModule = "biaoge";
            this.isPay = !1;
            if (TEAMS.currentTenant && TEAMS.currentTenant.isPay) this.isPay = !0;
            else if ("normal" == TEAMS.currentTenant.status || "outPayUserInweek" == TEAMS.currentTenant.status || "outPayRoom" == TEAMS.currentTenant.status || "outPayUserOutweek" == TEAMS.currentTenant.status || "prepaid" == TEAMS.currentTenant.status || "probation" == TEAMS.currentTenant.status) this.isPay = !0
        },
        delegateEvents: function() {
            var f = this,
            g = f.model,
            l = $(f.tpl),
            p = $(f.el);
            p.off("click.FormWriteView", ".j_excelimport").on("click.FormWriteView", ".j_excelimport",
            function() {
                $(this); (new s({
                    callback: function(a) {
                        f.render()
                    }
                })).render()
            });
            p.off("click.FormWriteView", ".j_form_stat #formstatus_list li").on("click.FormWriteView", ".j_form_stat #formstatus_list li",
            function() {
                var a = $(this),
                b = a.find("a").attr("data-entity"),
                a = a.find("a").text(),
                c = {},
                e = [];
                "all" == b ? (e.push("enable"), e.push("disable")) : e.push(b);
                c.stats = e;
                c.module = "biaoge";
                p.find("#formstatus_list").find("li").removeClass("active");
                p.find("#formstatus_list").find("." + b).addClass("active");
                p.find(".j_form_stat .j_stat_out").html(a + '\x3ci class\x3d"icon-caret-down"\x3e');
                f.renderPersonalForms(c)
            });
            p.off("click.FormWriteView", ".js_reportConf").on("click.FormWriteView", ".js_reportConf",
            function() {
                if ($(this).parents(".js_formboxli").hasClass("unpublished") || $(this).parents(".js_formboxli").hasClass("stopped")) return d.notify("\u8bf7\u53d1\u5e03\u8868\u5355\u540e\u518d\u4e0a\u62a5\uff01"),
                !1;
                var a = $(this).attr("formId");
                g.getFiledByForm({
                    formId: a
                },
                function(b) {
                    if (b.formFields && 0 != b.formFields.length) f.formreportconfigview = new h({
                        parentEl: f.el,
                        userId: f.userId,
                        formId: a,
                        callback: function(a) {
                            f.formreportconfigview.hide()
                        }
                    }),
                    f.formreportconfigview.render();
                    else return d.notify("\u8bf7\u4e3a\u8868\u5355\u6dfb\u52a0\u5185\u5bb9\u518d\u4e0a\u62a5\uff01"),
                    !1
                })
            });
            p.on("mouseenter.FormCompanyView", ".dropdown-toggle",
            function() {
                1 >= $(".js_form-list").find(".j_biaoge").length ? $(".j_updateSecindpatent").hide() : $(".j_updateSecindpatent").show()
            });
            p.on("mouseleave.FormCompanyView", ".j_updateSecindpatent",
            function() {
                $(".dropdownchild-menu-toggle").removeClass("open");
                $(this).find(".j_dropdownchildScr").hasClass("mCustomScrollbar") && d.destroyLayout($(this).find(".j_dropdownchildScr"))
            });
            p.on("mouseenter.FormWriteView", ".j_updateSecindpatent",
            function() {
                $(this).find(".j_dropdownchild").html("");
                $(".dropdownchild-menu-toggle").addClass("open");
                for (var a = $(this).parents(".js_formitemsli").parent().prev().find(".js_categoryname").attr("id"), b = $(".js_form-list").find(".j_biaoge"), c = b.length, e = 0; e < c; e++) {
                    var f = $(b).eq(e).find(".js_categoryname").attr("id"),
                    h = $(b).eq(e).find(".js_categoryname").text();
                    a != f && $(this).find(".j_dropdownchild").append('\x3cli class\x3d"j_romAndAddSecond" formid\x3d' + f + ' title\x3d"' + h + '"\x3e\x3ca\x3e' + h + "\x3c/a\x3e\x3c/li\x3e")
                }
                d.layout($(this).find(".j_dropdownchildScr"))
            });
            p.on("click.FormWriteView", ".j_romAndAddSecond",
            function() {
                $(this).parents(".js_formitemsli").find(".dropdown-menu-right").css("display", "none");
                $(".js_formmanag").css("display", "none");
                $(".dropdownchild-menu-toggle").removeClass("open");
                var a = $(this).attr("formid");
                $(this).attr("title");
                var b = $(".js_form-list").find(".j_biaoge"),
                c = b.length,
                e = $(this).parents(".js_formitemsli").attr("formid"),
                h = parseInt($(this).parents(".js_formcategory").find(".js_formcount").text().split("(")[1].split(")")[0]);
                $(this).parents(".js_formcategory").find(".js_formcount").text("(" + (h - 1) + ")");
                for (var k = 0; k < c; k++) if ($(b).eq(k).find(".js_categoryname").attr("id") == a) {
                    $(b).eq(k).find(".j_formlist").append($(this).parents(".js_formitemsli").clone(!0));
                    $(this).parents(".js_formitemsli").remove();
                    a = {
                        "form.id": e,
                        "formCategory.id": a
                    };
                    g.updateCategory(a,
                    function(a) {
                        if (!a.message) {
                            d.notify("\u8868\u5355\u4fee\u6539\u5206\u7c7b\u6210\u529f");
                            a = $(b).eq(k).find(".js_formitemsli").length;
                            var c = parseInt($(b).eq(k).find(".js_formcount").text().split("(")[1].split(")")[0]);
                            $(b).eq(k).find(".js_formcount").text("(" + (c + 1) + ")");
                            f.sort($(b).eq(k).find(".js_formitemsli").eq(a - 1))
                        }
                    });
                    break
                } else if (void 0 == a || "undefined" == a) {
                    a = void 0;
                    $(b).parents("#custom-category").next().find(".j_formlist").append($(this).parents(".js_formitemsli").clone(!0));
                    $(this).parents(".js_formitemsli").remove();
                    a = {
                        "form.id": e,
                        "formCategory.id": a
                    };
                    g.updateCategory(a,
                    function(a) {
                        a.message || (d.notify("\u8868\u5355\u4fee\u6539\u5206\u7c7b\u6210\u529f"), a = parseInt($("#other-category").find(".js_formcount").text().split("(")[1].split(")")[0]), $("#other-category").find(".js_formcount").text("(" + (a + 1) + ")"), a = $(b).eq(k).find(".js_formitemsli").length, console.log($(b).eq(k).find(".js_formitemsli").eq(a - 1)), f.sort($("#other-category").find(".js_formitemsli").eq(a - 1)))
                    });
                    break
                }
            });
            p.on("click.FormWriteView", ".j_dataReportConfig",
            function() {
                if ($(this).parents(".js_formboxli").hasClass("unpublished") || $(this).parents(".js_formboxli").hasClass("stopped")) return d.notify("\u8bf7\u53d1\u5e03\u8868\u5355\u540e\u518d\u64cd\u4f5c\uff01"),
                !1
            });
            p.on("click.FormWriteView", ".js_authConfig",
            function() {
                if ($(this).parents(".js_formboxli").hasClass("unpublished") || $(this).parents(".js_formboxli").hasClass("stopped")) return d.notify("\u8bf7\u53d1\u5e03\u8868\u5355\u540e\u518d\u4e0a\u62a5\uff01"),
                !1;
                var a = $(this).attr("formId");
                g.getFiledByForm({
                    formId: a
                },
                function(b) {
                    if (b.formFields && 0 != b.formFields.length) f.formauthconfigview = new c({
                        parentEl: f.el,
                        userId: f.userId,
                        formId: a,
                        callback: function(a) {
                            f.formauthconfigview.hide()
                        }
                    }),
                    f.formauthconfigview.render();
                    else return d.notify("\u8bf7\u4e3a\u8868\u5355\u6dfb\u52a0\u5185\u5bb9\u518d\u4e0a\u62a5\uff01"),
                    !1
                })
            });
            p.on("click.FormWriteView", ".js_formUpload",
            function() {
                var a = $(this).attr("formId");
                f.formuploadview = new k({
                    parentEl: f.el,
                    userId: f.userId,
                    formId: a,
                    module: "biaoge",
                    callback: function(a) {
                        f.formuploadview.hide()
                    }
                });
                f.formuploadview.render()
            });
            p.on("click.FormWriteView", ".js_messageConfig",
            function() {
                var a = $(this).attr("formId");
                f.messageconfigview = new q({
                    parentEl: f.el,
                    userId: f.userId,
                    formId: a,
                    callback: function(a) {
                        f.messageconfigview.hide()
                    }
                });
                f.messageconfigview.render()
            });
            p.on("click.FormWriteView", ".remindConfig",
            function() {
                var a = $(this).attr("formId");
                f.remindconfigview = new r({
                    parentEl: f.el,
                    userId: f.userId,
                    formId: a,
                    callback: function(a) {
                        f.remindconfigview.hide()
                    }
                });
                f.remindconfigview.render()
            });
            p.on("click.FormWriteView", ".js_customConfig",
            function() {
                if ($(this).parents(".js_formboxli").hasClass("unpublished") || $(this).parents(".js_formboxli").hasClass("stopped")) return d.notify("\u8bf7\u53d1\u5e03\u8868\u5355\u540e\u518d\u8bbe\u7f6e\uff01"),
                !1;
                var a = $(this).attr("formId");
                f.customconfigview = new t({
                    parentEl: f.el,
                    userId: f.userId,
                    formId: a,
                    callback: function(a) {
                        f.customconfigview.hide()
                    }
                });
                f.customconfigview.render()
            });
            $("body").on("click.FormWriteView", ".goto-top",
            function(a) {
                d.gotoTop(".js_forms." + f.activeTab)
            });
            p.on("click.FormWriteView", ".js_copyForm",
            function() {
                var a = $(this).attr("formId"),
                c = $(this).parents(".js_formListBox").find("#form-title").text(),
                e,
                h = $(this).attr("osp");
                "personal" == h ? e = !1 : "company" == h && (e = !0);
                var k = {};
                k.formId = a;
                k.module = f.pageModule;
                k.el = "#copy-form";
                k.formTitle = c;
                k.ownership = h;
                k.tpl = d.template("flow.formcopy", {
                    userId: f.userId,
                    operationtype: "\u590d\u5236",
                    admin: e,
                    type: "\u8868\u5355"
                });
                k.copyCallback = function(a) {
                    var b = p.find(".js_forms." + f.activeTab + " .js_form-list .js_other .j_formlist"),
                    c = l.siblings("#formitems." + f.activeTab).find(".js_formitemsli").clone();
                    f.renderPersonalForm(a.form, b, c, "prepend")
                };
                f.formoperationView = new b(k);
                f.formoperationView.render()
            });
            p.on("click.FormWriteView", ".js_formPreview",
            function() {
                var a = $(this).attr("formId");
                window.open("/form/preview/" + a)
            });
            p.on("click.FormWriteView", ".js_formPreview-only",
            function() {
                var a = $(this).attr("formId");
                window.open("/form/preview/" + a)
            });
            p.on("click.FormWriteView", ".js_renameForm",
            function() {
                var a = $(this).attr("formId");
                if (0 == $(this).parents(".js_formListBox").find('input[name\x3d"formTitle"]').length) {
                    var a = $('\x3cinput type\x3d"text" name\x3d"formTitle" style\x3d"width:100%" class\x3d"input-formTitle form-control" maxLength\x3d"50" formId\x3d' + a + "\x3e"),
                    b = $(this).parents(".js_formListBox").find("#form-title").text();
                    $(this).parents(".js_formListBox").find("#form-title").hide();
                    $(this).parents(".js_formListBox").find("#form-title").after(a);
                    $(this).parents(".js_formListBox").find('input[name\x3d"formTitle"]').focus().val(b)
                }
            });
            p.on("blur.FormWriteView", 'input[name\x3d"formTitle"]',
            function() {
                var a = $(this).attr("formId"),
                b = $.trim($(this).val()),
                c = this;
                if ("" == b || b == $(c).prev().text()) $(c).prev().show(),
                $(c).remove();
                else {
                    var e = {};
                    e.formId = a;
                    e.formName = $.trim(b);
                    e.ownership = "personal";
                    g.renameForm(e,
                    function(a) { (a = a.message) ? d.notify(a) : ($(c).prev().text(b).attr("title", b).show(), $(c).remove(), d.notify("\u8868\u5355\u540d\u79f0\u4fee\u6539\u6210\u529f"))
                    })
                }
            });
            p.on("keydown.FormWriteView", 'input[name\x3d"formTitle"]',
            function(a) {
                a = a.keyCode;
                var b = $.trim($(this).val());
                27 == a ? ($(this).prev().show(), $(this).remove()) : 13 == a && ("" == b || b == $(this).prev().text() ? ($(this).prev().show(), $(this).remove()) : $(this).trigger("blur.FormWriteView"))
            });
            p.off("click.FormWriteView", ".js_buildNewForm").on("click.FormWriteView", ".js_buildNewForm",
            function() {
                var a = {};
                a.module = f.pageModule;
                a.el = "#build-newform";
                a.tpl = d.template("biaoge.formnew");
                a.ownership = "personal";
                a.formwrite = "formwrite";
                a.saveCallback = function(a) {
                    var b = p.find(".js_forms." + f.activeTab + " .js_form-list .js_categoryname"),
                    c;
                    0 == b.length && (p.find(".js_forms.j_biaoge #other-category").html('\x3cdiv class\x3d"js_formcategory j_biaoge"\x3e\x3cdiv class\x3d"form-category-hd eform-cty-hd j_form-category"\x3e\x3ch4 id\x3d"cate-name"\x3e\x3cspan class\x3d"js_categoryname ctyname"\x3e\u5176\u4ed6\x3c/span\x3e\x3cspan class\x3d"form-acount js_formcount"\x3e\x3c/span\x3e\x3c/h4\x3e\x3cspan class\x3d"j_formcateInfo formcatetip hide"\x3e\u60a8\u53ef\u4ee5\u62d6\u62fd\u8868\u5355\u5206\u7c7b\u8fdb\u884c\u6392\u5e8f\uff0c\u4ea6\u53ef\u62d6\u62fd\u5206\u7c7b\u4e0b\u7684\u8868\u5355\u8fdb\u884c\u6392\u5e8f\uff1b\u9f20\u6807\u70b9\u51fb\u5206\u7c7b\u540d\u79f0\u56de\u8f66\u5373\u53ef\u4fdd\u5b58\u4fee\u6539\uff0cESC\u4e0d\u4fdd\u5b58\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"eform-list clearfix j_formlist"\x3e\x3c/ul\x3e\x3c/div\x3e'), c = p.find(".js_forms.j_biaoge #other-category .js_categoryname"));
                    for (var e = 0; e < b.length; e++) if (a.form.formCategory) {
                        if (a.form.formCategory.id == b[e].id) {
                            c = b[e];
                            break
                        }
                    } else {
                        c = b[b.length - 1];
                        break
                    }
                    b = $(c).parents(".js_formcategory." + f.activeTab).find(".j_formlist");
                    e = l.siblings("#formitems." + f.activeTab).find(".js_formitemsli").clone();
                    f.renderBiageForm(a.form, b, e, "prepend");
                    p.find("#noformsShow").remove();
                    p.find(".js_forms.j_biaoge #propforms-con").remove();
                    a = $(c).parents(".js_formcategory." + f.activeTab).find(".j_formlist").find(".js_formitemsli").length;
                    $(c).parents(".js_formcategory." + f.activeTab).find(".js_formcount").text("(" + a + ")")
                };
                f.formoperationView = new b(a);
                f.formoperationView.render()
            });
            p.off("click.FormWriteView", ".j_form_search").on("click.FormWriteView", ".j_form_search",
            function(a) {
                a = p.find(".js_searchkeyword");
                a = $.trim(a.val());
                var b = {
                    module: "biaoge"
                };
                b.keyword = a;
                var c = p.find(".j_form_stat li.active a").attr("data-entity"),
                e = [];
                "all" == c ? (e.push("enable"), e.push("disable")) : e.push(c);
                b.stats = e;
                p.find(".js_forms." + f.activeTab + " .js_form-list").empty();
                a ? f.renderKeywords(b) : (p.find(".js_forms." + f.activeTab + " .js_form-list").html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e'), f.renderPersonalForms(b))
            });
            p.on("keyup.FormWriteView", ".js_searchkeyword",
            function(a) {
                13 == (a ? a: window.event ? window.event: null).keyCode && p.find(".j_form_search").click()
            });
            p.on("click.FormWriteView", ".js_newcategory",
            function(a) {
                a = l.siblings(".js_formcategory." + f.activeTab).clone().attr("id", "newCateId");
                a.find(".j_formcateInfo").remove();
                var b = $('\x3cinput type\x3d"text" class\x3d"form-control js_createcategory" placeholder\x3d"\u5206\u7c7b\u540d\u79f0(ESC\u53d6\u6d88\uff0c\u56de\u8f66\u952e\u4fdd\u5b58)" maxLength\x3d"20"\x3e');
                a.find(".js_categoryname").append(b);
                var c = p.find(".js_forms." + f.activeTab + " .js_form-list #custom-category #newCateId");
                1 == c.length ? c.find(".js_createcategory").focus() : (p.find(".js_forms." + f.activeTab + " .js_form-list #custom-category").prepend(a), b.focus())
            });
            p.on("blur.FormWriteView", ".js_createcategory",
            function(a) {
                $(this);
                var b = $.trim($(this).val());
                a = $(this).attr("placeholder");
                var c = $(this).parent(),
                e = $(this).parents(".js_formcategory." + f.activeTab);
                b == a || "" == b ? $(".js_forms." + f.activeTab + " .js_form-list #newCateId").remove() : g.createCategory({
                    "formCategory.name": b,
                    "formCategory.type": "company",
                    module: f.pageModule
                },
                function(a) {
                    a.message ? d.notify(a.message) : (c.empty().text(b).next().text("(0)"), c.attr("id", a.formCategory.id), e.removeAttr("id"), d.notify("\u65b0\u5efa\u8868\u5355\u5206\u7c7b\u6210\u529f"), f.drag())
                })
            });
            p.on("keydown.FormWriteView", ".js_createcategory",
            function(a) {
                a = a.keyCode;
                var b = $.trim($(this).val());
                27 == a ? ($(this).val(""), $(this).parents(".js_formcategory." + f.activeTab).remove()) : 13 == a && ("" == b ? d.notify("\u8bf7\u8f93\u5165\u8868\u5355\u5206\u7c7b\u540d\u79f0") : $(this).trigger("blur.FormWriteView"))
            });
            p.on("mouseenter.FormWriteView", "#custom-category #cate-name",
            function(a) {
                if (null == $(this).parents(".js_cloudforms").get(0) || f.isWeaver) 0 < $(this).parents(".js_other").length || 0 == $(this).find(".js_createcategory").length && (0 != $(this).find(".js_formcount .js_deletecategory").length ? $(this).find(".js_formcount .js_deletecategory").show() : $(this).find(".js_formcount").append('\x3ca class\x3d"js_deletecategory btn-delecategory" title\x3d"\u5220\u9664"\x3e\x26times;\x3c/a\x3e'))
            });
            p.on("mouseleave.FormWriteView", "#custom-category #cate-name",
            function(a) {
                $(this).find(".js_formcount .js_deletecategory").hide()
            });
            p.on("click.FormWriteView", ".js_deletecategory",
            function(a) {
                var b = $(this);
                d.confirm("\u5220\u9664\u5206\u7c7b\u540e\uff0c\u8be5\u5206\u7c7b\u7684\u8868\u5355\u4f1a\u81ea\u52a8\u5f52\u7c7b\u5230\u3010\u5176\u4ed6\u3011\u4e2d\uff0c\u786e\u8ba4\u5220\u9664\u8be5\u5206\u7c7b\uff1f",
                function(a) {
                    if (a) {
                        a = {
                            "formCategory.id": b.parents("#cate-name").find(".js_categoryname").attr("id")
                        };
                        var c = b.parents(".js_formcategory." + f.activeTab).find(".j_formlist"),
                        e = c.html(),
                        c = c.find(".js_formitemsli");
                        if (0 != c.length) {
                            var h = "";
                            c.each(function(a) {
                                a = $(this).attr("formid");
                                h += a + ","
                            });
                            a.formIds = h
                        }
                        g.deleteCategory(a,
                        function(a) {
                            b.parents(".js_formcategory." + f.activeTab).remove();
                            p.find(".js_other .j_formlist").prepend(e);
                            d.notify("\u8868\u5355\u7c7b\u522b\u5220\u9664\u6210\u529f")
                        })
                    }
                })
            });
            p.on("click.FormWriteView", "#formmanagelist #custom-category .js_formcategory .js_categoryname",
            function(a) {
                if (null == $(this).parents(".js_cloudforms").get(0) || f.isWeaver) {
                    a = $(this).text();
                    var b = $('\x3cinput type\x3d"text" class\x3d"form-control js_updatecatename" maxLength\x3d"20"\x3e');
                    0 == $(this).find(".js_createcategory").length && ($(this).before(b).hide(), b.focus().val(a))
                }
            });
            p.on("keydown.FormWriteView", ".js_updatecatename",
            function(a, b) {
                var c = $(this),
                e = $.trim($(this).val()),
                h = $(this).next().text(),
                k = $(this).next().attr("id"),
                s = $(this).next().attr("type"),
                q = {},
                p = a.keyCode || b;
                27 == p ? ($(this).next().show(), c.val(h), $(this).remove()) : 13 == p && ("" == e ? d.notify("\u8bf7\u8f93\u5165\u8868\u5355\u5206\u7c7b\u540d\u79f0") : e != h ? (q["formCategory.id"] = k, q["formCategory.name"] = e, q["formCategory.type"] = s, q.module = f.pageModule, g.updateCategoryName(q,
                function(a) {
                    a.message ? d.notify(a.message) : (d.notify("\u8868\u5355\u5206\u7c7b\u540d\u79f0\u4fee\u6539\u6210\u529f"), c.next().text(e).show(), c.remove())
                })) : ($(this).next().show(), $(this).remove()))
            });
            p.on("blur.FormWriteView", ".js_updatecatename",
            function(a) {
                a = $.trim($(this).val());
                var b = $(this).next().text();
                a === b ? ($(this).next().show(), $(this).remove()) : $(this).trigger("keydown.FormWriteView", 13)
            });
            p.on("mouseenter.FormWriteView", ".j_form-category",
            function(a) { (null == $(this).parents(".js_cloudforms").get(0) || f.isWeaver) && $(this).find(".j_formcateInfo").removeClass("hide")
            });
            p.on("mouseleave.FormWriteView", ".form-category-hd",
            function(a) { (null == $(this).parents(".js_cloudforms").get(0) || f.isWeaver) && $(this).find(".j_formcateInfo").addClass("hide")
            });
            $("body").on("relatedFlow.FormWriteView",
            function(a, b, c) {
                f.setFlowsequenceIcon(b, c)
            });
            p.off("mouseenter.FormWriteView", ".j_form_filter #forms-filter").on("mouseenter.FormWriteView", ".j_form_filter #forms-filter",
            function(a) {
                var b = $(this),
                c = b.attr("data-toggle");
                f.filter || (f.filter = new e({
                    el: c,
                    module: "biaoge",
                    targetObj: b,
                    userId: f.userId
                }), f.filter.render(a));
                a = setTimeout(function() {
                    $(c).slideDown("fast")
                },
                300);
                b.data("showTimer", a);
                b.addClass("open")
            }).off("mouseleave.FormWriteView", ".j_form_filter #forms-filter").on("mouseleave.FormWriteView", ".j_form_filter #forms-filter",
            function(a) {
                a = $(this);
                var b = a.attr("data-toggle"),
                c = a.data("showTimer");
                c && clearTimeout(c);
                a.removeData("showTimer");
                $(b).slideUp(100);
                a.removeClass("open")
            }).off("filter.FormWriteView", ".j_form_filter #forms-filter").on("filter.FormWriteView", ".j_form_filter #forms-filter",
            function(a) {
                g.pageNo = 1;
                f.search({
                    pageNo: g.pageNo,
                    pageSize: 1E6
                })
            });
            p.on("click.FormWriteView", ".js_editForm",
            function() {
                var a = $(this).attr("formId");
                window.open("/form/edit/" + a)
            });
            p.on("click.FormWriteView", ".js_shareForm",
            function() {
                var b = this;
                if ($(this).parents(".js_formboxli").hasClass("unpublished") || $(this).parents(".js_formboxli").hasClass("stopped")) d.notify("\u8bf7\u53d1\u5e03\u8868\u5355\u540e\u518d\u5206\u53d1\uff01");
                else if ($(this).parents(".js_formboxli").hasClass("collecting")) {
                    var c = $(this).attr("formId");
                    g.getFiledByForm({
                        formId: c
                    },
                    function(e) {
                        if (e.formFields && 0 < e.formFields.length) {
                            var f = $(b).parents("ul").parents("li").find("#form-title").text(),
                            h = $(b).parents("ul").parents("li").find("#form-describe").text(),
                            k = window.location.protocol + "//" + window.location.host;
                            TEAMS.service.external && (k = TEAMS.service.external);
                            new a({
                                container: "#baidushare",
                                shareTitle: f,
                                shareDesc: h,
                                shareUrl: k + "/biaoge/fill/" + c,
                                form: e.form,
                                formId: c
                            });
                            $("#distributeModal").modal("show")
                        } else d.notify("\u8bf7\u4e3a\u8868\u5355\u6dfb\u52a0\u5185\u5bb9\u518d\u5206\u53d1\uff01")
                    })
                }
            });
            p.on("confirmHandler.FormWriteView", ".j_employee",
            function(a, b) {
                var c = $(this).parents("li"),
                e = c.attr("formid"),
                c = c.find("#form-title").text(),
                f = b.objs;
                if (b && f && 0 < f.length) {
                    for (var h = {},
                    k = 0; k < f.length; k++) h["userIds[" + k + "]"] = f[k].id;
                    h["form.id"] = e;
                    h["form.name"] = c;
                    g.incollect(h,
                    function(a) {
                        a.actionMsg ? d.notify(a.actionMsg.message) : d.notify("\u64cd\u4f5c\u6210\u529f\uff01")
                    })
                } else d.notify("\u8bf7\u9009\u62e9\u4eba\u5458\uff01")
            });
            p.on("click.FormWriteView", ".j_insideCollect",
            function(a, b) {
                if ($(this).parents(".js_formboxli").hasClass("unpublished") || $(this).parents(".js_formboxli").hasClass("stopped")) return d.notify("\u8bf7\u53d1\u5e03\u8868\u5355\u540e\u518d\u5185\u90e8\u6536\u96c6\uff01"),
                !1;
                var c = $(this).parents("ul").parents("li"),
                e = $(this).attr("formId");
                g.getFiledByForm({
                    formId: e
                },
                function(a) {
                    a.formFields && 0 != a.formFields.length ? c.find(".j_employee").click() : d.notify("\u8bf7\u4e3a\u8868\u5355\u6dfb\u52a0\u5185\u5bb9\u518d\u5206\u53d1\uff01")
                })
            });
            p.on("click.FormWriteView", ".js_deleteForm",
            function() {
                if ($(this).parents(".js_formitemsli").hasClass("collecting")) d.notify("\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u505c\u7528\u8868\u5355\u540e\u91cd\u65b0\u64cd\u4f5c\uff01");
                else {
                    var a = this,
                    b = $(this).attr("formId"),
                    c = $(this).attr("type"),
                    e = {
                        formId: b
                    };
                    "cloud" === c ? f.deleteForm(a, e, c) : g.findCount({
                        formId: b
                    },
                    function(b) {
                        f.deleteForm(a, e, c, b.count, b.todoCount)
                    })
                }
            });
            p.on("click.FormWriteView", ".j_changeStatus",
            function() {
                var a = this,
                b = $(this).attr("formId"),
                c = $(this).attr("target-status"),
                e = $(this).text(),
                h = "",
                k = {
                    "form.id": b,
                    "form.status": c
                };
                updateStatus = function(c) {
                    c && g.updateStatus(k,
                    function(c) {
                        c = c.form.status;
                        if ("j_biaoge" == f.activeTab) {
                            var e = $(a).parents(".js_formitemsli");
                            switch (c) {
                            case "disable":
                                h = "\u505c\u7528";
                                e.find("#form-title").removeClass("j_entityslider-toggle");
                                e.find(".reportConfig-btn").removeClass("dropdown-menu-toggle");
                                e.removeClass("collecting unpublished").addClass("stopped");
                                e.find(".j_gatherStatus \x3e ul").html('\x3cli\x3e\x3ca class\x3d"j_changeStatus" target-status\x3d"disable" formid\x3d"' + b + '"\x3e\u542f\u7528\x3c/a\x3e\x3c/li\x3e');
                                break;
                            case "enable":
                                h = "\u542f\u7528",
                                e.find("#form-title").addClass("j_entityslider-toggle"),
                                e.find(".reportConfig-btn").addClass("dropdown-menu-toggle"),
                                e.removeClass("stopped unpublished").addClass("collecting"),
                                e.find(".j_gatherStatus \x3e ul").html('\x3cli\x3e\x3ca class\x3d"j_changeStatus" target-status\x3d"enable" formid\x3d"' + b + '"\x3e\u505c\u6b62\x3c/a\x3e\x3c/li\x3e')
                            }
                            e.find(".j_gatherStatus \x3e a").html(h + '\x3ci class\x3d"caret ml-3"\x3e\x3c/i\x3e')
                        }
                        d.notify("\u8868\u5355\u72b6\u6001\u4fee\u6539\u6210\u529f")
                    })
                };
                d.confirm("\u786e\u5b9a\u8981" + e + "\u6b64\u8868\u5355\u5417\uff1f", updateStatus)
            });
            p.on("click.FormWriteView", ".js_useflow",
            function(a) {
                a = $(this);
                var c = TEAMS.currentUser.admin ? !0 : !1,
                e = {};
                e.formId = a.attr("formId");
                e.module = "workflow";
                e.el = "#copy-form";
                e.formTitle = a.attr("name");
                e.ownership = a.attr("ownership");
                e.tpl = d.template("flow.formcopy", {
                    userId: TEAMS.currentUser.id,
                    operationtype: "\u4f7f\u7528\u5ba1\u6279",
                    admin: c,
                    type: "\u8868\u5355"
                });
                e.copyCallback = function(a) {
                    a && a.form && "company" == a.form.ownership ? ROUTER.navigate("/workflows/" + TEAMS.currentUser.id + "/company", {
                        trigger: !0
                    }) : ROUTER.navigate("/workflows/" + TEAMS.currentUser.id + "/personal", {
                        trigger: !0
                    })
                };
                f.formoperationView = new b(e);
                f.formoperationView.render()
            });
            p.on("click.FormWriteView", ".js_changeFormStatus",
            function() {
                var a = this,
                b = $(this).attr("formId"),
                c = $(this).attr("status"),
                e = $(this).text(),
                f = {
                    "form.id": b,
                    "form.status": c
                },
                h = $(a).parents(".js_formitemsli").attr("formtype");
                updateStatus = function(c) {
                    c && g.updateStatus(f,
                    function(c) {
                        c = c.form.status;
                        var f = "";
                        if ("enable" == c) f = "personal" == h ? "\u505c\u7528": "\u4e0b\u67b6",
                        $(a).parents(".js_formitemsli").find(".icon-lock").hide(),
                        $(a).parents(".js_formitemsli").find(".j_formRecommend").show();
                        else if ("disable" == c) {
                            f = "personal" == h ? "\u542f\u7528": "\u53d1\u5e03";
                            $(a).parents(".js_formitemsli").find(".icon-lock").show();
                            $(a).parents(".js_formitemsli").find(".j_formRecommend").hide();
                            var k = $(a).parents(".js_formitemsli").find(".j_star"),
                            s = k.data("recommend");
                            0 == s && g.recommend({
                                formId: b,
                                recommend: s
                            },
                            function(a) {
                                k.data("recommend", 1);
                                k.removeClass("icon-star").addClass("icon-star-empty").attr("title", "\u63a8\u8350")
                            })
                        }
                        $(a).attr("status", c);
                        $(a).text(f);
                        d.notify("\u8868\u5355\u5df2" + e)
                    })
                };
                d.confirm("\u786e\u5b9a\u8981" + e + "\u6b64\u8868\u5355\u5417\uff1f", updateStatus)
            });
            p.on("click.FormWriteView", "#pop-forms .j_preview",
            function() {
                var a = $(this).parents("#pop-forms").attr("data-form-id");
                window.open("/biaoge/preview/" + a + "/biaoge")
            });
            p.on("click.FormWriteView", "#pop-forms .j_use",
            function() {
                var a = $(this).parents("#pop-forms").attr("data-form-id"),
                c = $(this).parents("#pop-forms").find(".item-title").text();
                f.formoperationView = new b({
                    el: "#copy-form",
                    formId: a,
                    module: f.pageModule,
                    formTitle: c,
                    ownership: "personal",
                    tpl: d.template("flow.formcopy", {
                        userId: f.userId,
                        operationtype: "\u542f\u7528",
                        admin: TEAMS.currentUser.admin,
                        type: "\u8868\u5355"
                    }),
                    copyCallback: function(a) {
                        d.notify("\u8868\u5355\u542f\u7528\u6210\u529f!");
                        f.render()
                    }
                });
                f.formoperationView.render()
            });
            p.on("click.FormWriteView", "#pop-forms .j_title",
            function() {
                var a = $(this).parents("#pop-forms").attr("data-form-id");
                window.open("/biaoge/preview/" + a + "/biaoge")
            })
        },
        cloneeForm: function() {
            var a = $(this.tpl).siblings("#formitems.j_biaoge").find(".js_formitemsli").clone();
            a.find(".j_fillCount").html("0\u4efd\u6570\u636e");
            a.find("#form-title").html("\u67e5\u770b\u4ecb\u7ecd");
            a.addClass("unpublished");
            var b = $(this.tpl).siblings(".js_formcategory.j_biaoge").find(".j_formlist").clone();
            b.attr("id", "intro_clonee");
            b.append(a);
            $(this.el).find(".js_forms.j_biaoge .js_form-list").append(b)
        },
        ifShowIntro: function(a) {
            var b = this,
            c = b.model,
            e = {},
            d;
            e["config.configKey"] = "guide.biaoge.showintro";
            c.queryIntroCount(e,
            function(e) {
                0 > $("body").find(".j_form-personal").length || (1 == !e.introCount ? (1 > a ? (d = "N", b.cloneeForm()) : d = "Y", b.renderIntro(d)) : 1 > a ? ($(".j_biaoge .js_form-list").show(), e = $(b.tpl).siblings("#noform-clone").find("#noformsShow").clone(), e.find(".router").attr("href", "forms/" + TEAMS.currentUser.id + "/cloud"), $(".j_biaoge .js_form-list").append(e), $(".j_biaoge .js_form-list").append('\x3cdiv id\x3d"propforms-con"\x3e\x3c/div\x3e'), c.queryRecommend({},
                function(a) {
                    a = a.forms;
                    if (null != a && "" != a) for (var c in a) {
                        var e = a[c],
                        d = $(b.tpl).siblings("#noform-clone").find("#pop-forms").clone();
                        d.attr("data-form-id", e.id);
                        d.find(".item-title").text(e.name);
                        d.find(".item-info").text(Date.create(e.createTime).format("{yyyy}-{MM}-{dd}") + " | \u67e5\u770b" + e.viewCount + "\u6b21");
                        d.find(".dlcnt").attr("title", "\u4f7f\u7528" + e.copyCount + "\u6b21");
                        d.find(".dlcnt .countnum").text(e.copyCount);
                        $(".j_biaoge .js_form-list #propforms-con").append(d)
                    }
                })) : $("#noformsShow").remove())
            })
        },
        renderIntro: function(a) {
            var b = this;
            $("body").addClass("introjs-open");
            introJs().setOptions({
                showStepNumbers: !1,
                steps: [{
                    element: ".aside .j_aside-nav",
                    intro: "\x3ch5\x3e\u83dc\u5355\u533a\x3c/h5\x3e1\u3001\u201c\u6570\u636e\u8bb0\u5f55\u201d\u53ef\u4ee5\u5bf9\u81ea\u5df1\u7684\u8868\u5355\u6570\u636e\u8fdb\u884c\u7ba1\u7406\uff1b\x3cbr\x3e2\u3001\u5f85\u586b\u5199\u4e0a\u62a5\u548c\u672a\u586b\u5199\u4e0a\u62a5\u4ee5\u53ca\u4e0b\u5c5e\u4e0a\u62a5\u53ef\u4ee5\u586b\u5199\u6216\u67e5\u770b\u81ea\u5df1\u6216\u4e0b\u5c5e\u7684\u4e0a\u62a5\u4fe1\u606f\uff1b\x3cbr\x3e3\u3001\u201c\u4e91\u8868\u5355\u5e93\u201d\u53ef\u6311\u9009\u9002\u5408\u81ea\u5df1\u7684\u8868\u5355\uff1b\x3cbr\x3e\x3cbr\x3e",
                    position: "right"
                },
                {
                    element: ".j_toolList .j_form_new",
                    intro: "\x3ch5\x3e\u65b0\u5efa\u8868\u5355\x3c/h5\x3e\u70b9\u51fb\u65b0\u5efa\u8868\u5355\u521b\u5efa\u65b0\u7684\u8868\u5355\uff0c\u5982\u679c\u662f\u7ba1\u7406\u5458\uff0c\u53ef\u521b\u5efa\u56e2\u961f\u8868\u5355\uff1b\x3cbr\x3e\x3cbr\x3e",
                    position: "left"
                },
                {
                    element: ".j_toolList .j_formIntroduction",
                    intro: "\x3ch5\x3e\u65b0\u5efa\u5206\u7c7b\x3c/h5\x3e1\u3001\u65b0\u5efa\u5206\u7c7b\u53ef\u66f4\u597d\u7ba1\u7406\u60a8\u7684\u8868\u5355\uff0c\u53ea\u6709\u7ba1\u7406\u5458\u53ef\u89c1\u6b64\u6309\u94ae\uff1b\x3cbr\x3e\x3cbr\x3e",
                    position: "left"
                },
                {
                    element: ".js_forms.j_biaoge .js_formitemsli",
                    intro: "\x3ch5\x3e\u8868\u5355\u6982\u51b5\x3c/h5\x3e1\u3001\u5bf9\u8868\u5355\u57fa\u672c\u4fe1\u606f\u8fdb\u884c\u7ba1\u7406\uff0c\u5305\u62ec\u7f16\u8f91\u9884\u89c8\u7b49\uff1b\x3cbr\x3e2\u3001\u5185\u90e8\u6536\u96c6\uff0c\u4ee5\u5ba1\u6279\u5f62\u5f0f\u5206\u53d1\u7ed9\u56e2\u961f\u6210\u5458\u6536\u96c6\u6570\u636e\uff1b\x3cbr\x3e3\u3001\u5916\u90e8\u5206\u53d1\uff0c\u5206\u4eab\u94fe\u63a5\u81f3\u670b\u53cb\u5708\u6536\u96c6\u6570\u636e\uff1b\x3cbr\x3e\x3cbr\x3e",
                    position: "right"
                },
                {
                    element: ".js_forms.j_biaoge .j_fillCount",
                    intro: "\x3ch5\x3e\u6570\u636e\u6536\u96c6\u7edf\u8ba1\x3c/h5\x3e\u53ef\u5bf9\u6536\u96c6\u7684\u6570\u636e\u8fdb\u884c\u591a\u7ef4\u5ea6\u7edf\u8ba1\u5206\u6790\uff1b\x3cbr\x3e\x3cbr\x3e",
                    position: "right"
                }]
            }).onbeforechange(function(a) {}).onchange(function(a) {}).oncomplete(function() {
                b.introSaveConf(a)
            }).onexit(function() {
                b.introSaveConf(a)
            }).start().refresh()
        },
        introSaveConf: function(a) {
            var b = this,
            c = b.model;
            window.onbeforeunload = null;
            $("body").removeClass("introjs-open");
            $.ajax({
                type: "POST",
                data: {
                    "config.configKey": "guide.biaoge.showintro",
                    "config.configValue": "1"
                },
                dataType: "json",
                url: "/base/configuration/saveConfig.json",
                success: function(a) {}
            });
            $("#intro_clonee").remove();
            "N" == a ? ($(".j_biaoge .js_form-list").show(), a = $(b.tpl).siblings("#noform-clone").find("#noformsShow").clone(), a.find(".router").attr("href", "forms/" + TEAMS.currentUser.id + "/cloud"), $(".j_biaoge .js_form-list").append(a), $(".j_biaoge .js_form-list").append('\x3cdiv id\x3d"propforms-con"\x3e\x3c/div\x3e'), c.queryRecommend({},
            function(a) {
                a = a.forms;
                if (null != a && "" != a) for (var c in a) {
                    var e = a[c],
                    d = $(b.tpl).siblings("#noform-clone").find("#pop-forms").clone();
                    d.attr("data-form-id", e.id);
                    d.find(".item-title").text(e.name);
                    d.find(".item-info").text(Date.create(e.createTime).format("{yyyy}-{MM}-{dd}") + " | \u67e5\u770b" + e.viewCount + "\u6b21");
                    d.find(".dlcnt").attr("title", "\u4f7f\u7528" + e.copyCount + "\u6b21");
                    d.find(".dlcnt .countnum").text(e.copyCount);
                    $(".j_biaoge .js_form-list #propforms-con").append(d)
                }
            })) : "Y" == a && $("#noformsShow").remove()
        },
        render: function() {
            var a = $(this.el),
            b = this.tpl,
            b = $(b).siblings("#formmanage-container");
            a.html(b.html());
            this.rendertab();
            a.find(".j_toolList .j_cloudpage-a").addClass("router");
            a.find(".j_toolList .j_cloudpage-a").attr("href", "/forms/" + TEAMS.currentUser.id + "/cloud")
        },
        getPageModule: function() {
            this.activeTab = "j_" + this.pageModule
        },
        rendertab: function() {
            var a = $(this.el);
            this.getPageModule();
            d.layout(this.el + " .js_forms." + this.activeTab);
            a.find(".js_forms." + this.activeTab + " #formlist-loading").show();
            a.find(".js_forms.j_" + this.pageModule).show();
            a.find(".js_formtab li[module\x3d'" + this.pageModule + "']").attr("data-load", "true").addClass("active");
            this.isAdmin || a.find(".j_formIntroduction .js_newcategory").remove();
            this.renderPersonalForms({
                module: "biaoge"
            });
            $(".js_forms." + this.activeTab + " .js_form-list").removeClass("hide")
        },
        drag: function() {
            var a = this,
            b = a.model;
            $(a.el).find(".js_forms." + a.activeTab + " .js_form-list #custom-category ul.form-list,.js_forms." + a.activeTab + " .js_form-list #other-category ul.form-list,.js_formcategory." + a.activeTab + " ul.j_formlist").sortable({
                placeholder: "form-placeholder",
                connectWith: ".js_forms." + a.activeTab + " .js_form-list ul.form-list,.js_forms." + a.activeTab + " .js_form-list ul.form-list,.js_formcategory." + a.activeTab + " ul.j_formlist",
                update: function(b, c) {
                    a.buildCount($(this));
                    a.buildSerialNumber($(this));
                    c.item.data("update", !0)
                },
                receive: function(a, b) {
                    b.item.data("receive", !0)
                },
                stop: function(c, e) {
                    if (e.item.data("update")) if (e.item.data("update", !1), e.item.data("receive")) {
                        e.item.data("receive", !1);
                        var f = e.item.attr("formid"),
                        h = e.item.parents(".js_formcategory." + a.activeTab).find(".form-category-hd .js_categoryname").attr("id");
                        b.updateCategory({
                            "form.id": f,
                            "formCategory.id": h
                        },
                        function(b) {
                            b.message || (d.notify("\u8868\u5355\u4fee\u6539\u5206\u7c7b\u6210\u529f"), a.sort(e.item))
                        })
                    } else a.sort(e.item)
                }
            })
        },
        loadCateAndForms: function(a, b, c) {
            $(this.el);
            c = this.tpl;
            b.empty();
            b.html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e');
            var e = b.find("#custom-category");
            b = b.find("#other-category");
            a = a.formCategories;
            if (null != a && 0 != a.length) for (var d = 0,
            f = a.length; d < f; d++) {
                var h = a[d],
                k = h.name,
                g = h.id,
                s = h.sort,
                q = h.forms,
                t = 0;
                q && 0 < q.length && (t = q.length);
                var r = h.type,
                h = $(c).siblings(".js_formcategory." + this.activeTab);
                "\u5176\u4ed6" == k ? h.addClass("js_other").find(".j_form-category").removeClass("j_form-category") : h.find(".js_categoryname").attr("id", g).attr("sort", s).attr("type", r);
                h.find(".js_categoryname").text(k).attr("title", k);
                h.find(".form-acount").text("(" + t + ")");
                if (q) for (k = 0, g = q.length; k < g; k++) s = q[k],
                t = h.find(".j_formlist"),
                r = $(c).siblings("#formitems." + this.activeTab).find(".js_formitemsli").clone(),
                this.renderPersonalForm(s, t, r);
                h.hasClass("js_other") ? b.append(h) : e.append(h);
                this.buildSerialNumber(h.find(".j_formlist"))
            }
        },
        renderPersonalForms: function(a) {
            var b = this,
            c = b.model,
            e = $(b.el);
            a.module = "biaoge";
            a.needCount = !0;
            c.queryMyForms(a,
            function(a) {
                var h = e.find("#formmanagelist .js_forms." + b.activeTab + " .js_form-list");
                b.loadCateAndForms(a, h, "personal");
                "j_biaoge" == b.activeTab && (a = e.find(".js_forms.j_biaoge .js_formitemsli").length, b.ifShowIntro(a));
                e.find(".js_forms." + b.activeTab + " #formlist-loading").hide();
                b.drag();
                e.find(".js_forms." + b.activeTab + " .js_form-list #custom-category").sortable({
                    handle: ".form-category-hd",
                    update: function(a, b) {
                        b.item.data("update", !0)
                    },
                    stop: function(a, e) {
                        if (e.item.data("update")) {
                            b.sortCategory($(this));
                            var h = {};
                            $(this).find(".js_formcategory." + b.activeTab + " #cate-name .js_categoryname").each(function(a) {
                                h["formCategories[" + a + "].id"] = $(this).attr("id");
                                h["formCategories[" + a + "].sort"] = $(this).attr("sort")
                            });
                            c.formCategorSort(h,
                            function(a) {
                                a.message || ($(".js_updatecatename").trigger("keydown.FormListView", 13), d.notify("\u8868\u5355\u5206\u7c7b\u6392\u5e8f\u6210\u529f"))
                            })
                        }
                    }
                });
                d.removeDisableModules(e.find("[acl-module-id]"))
            })
        },
        renderBiageForm: function(a, b, c, e) {
            c = this.tpl;
            $(this.el);
            var h = a.name,
            f = a.id,
            k = a.qx,
            g = a.newFillCount,
            s = a.operator.id,
            q = TEAMS.currentUser.id;
            c = $(c).siblings("#formitems." + this.activeTab).find(".js_formitemsli");
            c.find("#form-number").css("background-color", d.getRandomColor());
            c.attr("formid", f).attr("sort", a.sort).attr("id", f);
            "company" == a.ownership && c.find(".j_team-icon").removeClass("hide");
            c.find("#form-title").text(h).attr("title", h).attr("data-id", f).attr("userId", this.userId).attr("href", "/forms/" + TEAMS.currentUser.id + "/stattable/" + f);
            c.find(".js_formListBox").attr("formId", f);
            c.find(".j_fillCount").text(g + "\u4efd\u6570\u636e").attr("href", "/forms/" + TEAMS.currentUser.id + "/stattable/" + f);
            c.find(".j_click_event").attr("formId", f);
            c.find(".js_copyForm").attr("osp", a.ownership);
            c.find(".js_useflow").attr("ownership", a.ownership).attr("name", h);
            c.find(".js_formUpload").attr("data-id", f);
            s != q && (h = c.find(".js_manager_btn"), 0 <= k.indexOf("maintain") ? (h.find(".js_deleteForm").remove(), h.find(".js_formPreview-only").addClass("hide")) : (h.find(".js_editForm").remove(), h.find(".reportConfig-btn").remove(), h.find(".formmore-btn").remove(), h.find(".js_formPreview-only").removeClass("hide"), c.find(".js_formPreview-only").attr("formId", f), c.find(".js_formListBox .j_gatherStatus").remove()), c.find(".j_recover-icon").removeClass("hide").attr("data-original-title", Date.create(a.createTime).format("{yyyy}-{MM}-{dd}") + "\u7531" + a.operator.name + "\u521b\u5efa"));
            this.createStatus(c, a);
            "prepend" == e ? b.prepend(c) : b.append(c);
            this.buildSerialNumber(b)
        },
        renderPersonalForm: function(a, b, c, e) {
            this.renderBiageForm(a, b, c, e)
        },
        renderPersonalKeyword: function(a) {
            var b = $(this.el),
            c = $(this.tpl),
            e = b.find(".js_forms." + this.activeTab + " .js_form-list"),
            b = c.siblings("#search-boxlist").find(".j_Search." + this.activeTab).clone();
            e.html(b);
            var b = e.find(".js_searchlist"),
            d = a.formPage,
            h = d.result;
            a = a.pageNo;
            e.find("#pageNo").val(a);
            a = e.find(".j_Search." + this.activeTab + " .j_formcount").text();
            a = a.substring(1, a.length - 1);
            a = parseInt(a) ? h.length + parseInt(a) : h.length;
            e.find(".j_Search." + this.activeTab + " .j_formcount").text("(" + a + ")");
            1 == d.pageNo && 0 == d.result.length ? (e.find(".js_noresult").removeClass("hide"), e.find(".js_noresult .btn-div .router").attr("href", "forms/" + TEAMS.currentUser.id + "/cloud")) : e.find(".js_noresult").addClass("hide");
            d.hasNext ? e.find("#loadMore").show() : e.find("#loadMore").hide();
            for (e = 0; e < h.length; e++) d = h[e],
            a = c.siblings("#formitems." + this.activeTab).find(".js_formitemsli").clone(),
            this.renderPersonalForm(d, b, a, "append");
            this.buildSerialNumber(b)
        },
        renderKeywords: function(a) {
            var b = this,
            c = b.model,
            e = $(b.el);
            a.pageNo = 1;
            a.pageSize = 1E7;
            a.needCount = !0;
            c.queryMyFormsKeywords(a,
            function(a) {
                b.renderPersonalKeyword(a);
                e.find("#loadMore").attr("isKeyword", "isKeyword")
            })
        },
        deleteForm: function(a, b, c, e, h) {
            var f = this,
            k = f.model,
            g = $(a).parents(".j_formlist");
            "cloud" === c && (g = $(a).parents("#cloudformul"));
            var s = function(c) {
                c && k.deleteForm(b,
                function(b) {
                    b.message ? d.notify(b.message) : ($(a).parents("li").remove(), d.notify("\u8868\u5355\u5220\u9664\u6210\u529f"), f.buildCount(g), f.buildSerialNumber(g))
                })
            };
            "cloud" === c ? d.confirm("\u4e91\u8868\u5355\u5220\u9664\u540e\u4e0d\u53ef\u6062\u590d,\u786e\u5b9a\u5220\u9664\u5417\uff1f", s) : d.confirm("\u6b64\u8868\u5355\u5df2\u586b\u5199\u8fc7" + e + "\u6b21,\u8fd8\u6709" + h + "\u6761\u5f85\u586b\u5199\u4e0a\u62a5\uff0c\u60a8\u53ef\u4ee5\u5728\u5185\u90e8\u6536\u96c6\u65e5\u5fd7\u4e2d\u5220\u9664\u5f85\u586b\u5199\u4e0a\u62a5\uff0c\u786e\u5b9a\u5220\u9664\u5417\uff1f", s)
        },
        buildSerialNumber: function(a) {
            a.find(".js_formitemsli").each(function(a) {
                $(this).find("#form-number").text(a + 1)
            })
        },
        buildCount: function(a) {
            var b = a.parents(".js_formcategory." + this.activeTab).find(".js_formitemsli"),
            b = b.length ? b.length: 0;
            a.parents(".js_formcategory." + this.activeTab).find(".js_formcount").text("(" + b + ")")
        },
        sortCategory: function(a) {
            a.find(".js_formcategory." + this.activeTab).each(function(a) {
                $(this).find("#cate-name .js_categoryname").attr("sort", a + 1)
            })
        },
        sort: function(a) {
            $(this.el);
            var b = this.model,
            c = {},
            e = a.prevAll(),
            h = a.next(),
            f = a.prev(),
            k = a.parents(".j_formlist").find(".js_formitemsli").eq(0);
            e.each(function(a) {
                c["forms[" + a + "].id"] = $(this).attr("formid")
            }); (e = parseInt(h.attr("sort")) + 1) || (e = parseInt(f.attr("sort")));
            var f = k.attr("formid"),
            k = parseInt(k.attr("sort")),
            h = a.attr("formid"),
            g = a.parents(".js_formcategory." + this.activeTab).find(".form-category-hd .js_categoryname").attr("id");
            c.formId = h;
            c.sort = e;
            c.categoryId = g;
            49990 <= k && (c.firstFormId = f);
            b.sort(c,
            function(b) {
                b.sort && a.attr("sort", b.sort);
                a.prevAll().each(function(a) {
                    $(this).attr("sort", parseInt($(this).attr("sort")) + 1)
                });
                b.message || d.notify("\u8868\u5355\u6392\u5e8f\u6210\u529f")
            })
        },
        createStatus: function(a, b) {
            var c = b.status,
            e = b.id,
            d = "";
            if ("j_biaoge" == this.activeTab) {
                switch (c) {
                case "submit":
                    d = "\u505c\u7528";
                    a.find("#form-title").removeClass("j_entityslider-toggle");
                    a.find(".reportConfig-btn").removeClass("dropdown-menu-toggle");
                    a.removeClass("collecting stopped").addClass("unpublished");
                    a.find(".j_gatherStatus \x3e ul").html('\x3cli\x3e\x3ca class\x3d"j_changeStatus" target-status\x3d"submit" formid\x3d"' + e + '"\x3e\u542f\u7528\x3c/a\x3e\x3c/li\x3e');
                    break;
                case "disable":
                    d = "\u505c\u7528";
                    a.find("#form-title").removeClass("j_entityslider-toggle");
                    a.find(".reportConfig-btn").removeClass("dropdown-menu-toggle");
                    a.removeClass("collecting unpublished").addClass("stopped");
                    a.find(".j_gatherStatus \x3e ul").html('\x3cli\x3e\x3ca class\x3d"j_changeStatus" target-status\x3d"disable" formid\x3d"' + e + '"\x3e\u542f\u7528\x3c/a\x3e\x3c/li\x3e');
                    break;
                case "enable":
                    d = "\u542f\u7528",
                    a.find("#form-title").addClass("j_entityslider-toggle"),
                    a.removeClass("stopped unpublished").addClass("collecting"),
                    a.find(".j_gatherStatus \x3e ul").html('\x3cli\x3e\x3ca class\x3d"j_changeStatus" target-status\x3d"enable" formid\x3d"' + e + '"\x3e\u505c\u7528\x3c/a\x3e\x3c/li\x3e')
                }
                a.find(".j_gatherStatus \x3e a").html(d + '\x3ci class\x3d"caret ml-3"\x3e\x3c/i\x3e')
            }
        },
        remove: function() {
            $(this.el).off(".FormWriteView");
            this.formoperationView && (this.formoperationView.remove(), this.formoperationView = null);
            this.messageconfigview && (this.messageconfigview.remove(), this.messageconfigview = null);
            this.remindconfigview && (this.remindconfigview.remove(), this.remindconfigview = null);
            this.customconfigview && (this.customconfigview.remove(), this.customconfigview = null);
            this.header && (this.header.remove(), this.header = null)
        },
        setFlowsequenceIcon: function(a, b) {
            "show" == b ? $(this.el).find(".js_formboxli[formid\x3d" + a + "]").find(".form-message").show() : $(this.el).find(".js_formboxli[formid\x3d" + a + "]").find(" .form-message").hide()
        },
        search: function(a) {
            var b = $(this.el);
            a.creators = this.filter ? this.filter.managers: null;
            a.tags = this.filter ? this.filter.tags: null;
            a.stats = this.filter ? this.filter.status: null;
            a.formtypes = this.filter ? this.filter.formtypes: null;
            a.startTime = b.find("#form-filter-dropdown #formcreate-time-begin").val();
            a.endTime = b.find("#form-filter-dropdown #formcreate-time-end").val();
            b.find(".js_forms." + this.activeTab + " .js_form-list").html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e');
            a.module = "biaoge";
            a.needCount = !0;
            this.filterPersonalForms(a);
            $(".js_forms." + this.activeTab + " .js_form-list").removeClass("hide")
        },
        filterPersonalForms: function(a) {
            var b = this,
            c = b.model,
            e = $(b.el);
            $(b.tpl);
            c.queryMyForms(a,
            function(a) {
                var h = e.find("#formmanagelist .js_forms." + b.activeTab + " .js_form-list");
                b.loadCateAndForms(a, h, "personal");
                "j_biaoge" == b.activeTab && (0 < e.find(".js_forms.j_biaoge .js_formitemsli").length ? e.find("#noformsShow").remove() : (e.find(".js_forms.j_biaoge .js_form-list #custom-category").empty(), e.find(".js_forms.j_biaoge .js_form-list #other-category").empty(), a = $(b.tpl).siblings("#noform-clone").find("#noformsShow").clone(), a.find(".router").attr("href", "forms/" + TEAMS.currentUser.id + "/cloud"), a.find(".small").text("\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u8868\u5355\u54e6\uff01\u60a8\u53ef\u4ee5\u65b0\u5efa\u8868\u5355\uff0c\u53ef\u4ee5\u5728\u4e91\u8868\u5355\u5e93\u4e2d\u9009\u62e9\u8868\u5355"), $(".js_forms.j_biaoge .js_form-list").append(a)));
                e.find(".js_forms." + b.activeTab + " #formlist-loading").hide();
                b.drag();
                e.find(".js_forms." + b.activeTab + " .js_form-list #custom-category").sortable({
                    handle: ".form-category-hd",
                    update: function(a, b) {
                        b.item.data("update", !0)
                    },
                    stop: function(a, e) {
                        if (e.item.data("update")) {
                            b.sortCategory($(this));
                            var h = {};
                            $(this).find(".js_formcategory." + b.activeTab + " #cate-name .js_categoryname").each(function(a) {
                                h["formCategories[" + a + "].id"] = $(this).attr("id");
                                h["formCategories[" + a + "].sort"] = $(this).attr("sort")
                            });
                            c.formCategorSort(h,
                            function(a) {
                                a.message || ($(".js_updatecatename").trigger("keydown.FormListView", 13), d.notify("\u8868\u5355\u5206\u7c7b\u6392\u5e8f\u6210\u529f"))
                            })
                        }
                    }
                })
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formsubordinateview", "teams/utils teams/component/validation eteams/biaoge/form/formmanagemodel teams/component/entityslider teams/component/typeahead eteams/biaoge/formmanage/formloglistview teams/component/filter eteams/biaoge/form/formoperationview".split(" "),
function(g, m, l) {
    var d = g("teams/utils");
    g("teams/component/validation");
    var f = g("eteams/biaoge/form/formmanagemodel");
    g("teams/component/entityslider");
    g("teams/component/typeahead");
    g("eteams/biaoge/formmanage/formloglistview");
    var b = g("teams/component/filter");
    g("eteams/biaoge/form/formoperationview");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.userId = a.userId;
            this.el = a.container ? a.container: "#j_workflowcenter";
            this.isAdmin = TEAMS.currentUser.admin;
            this.isWeaver = "t7akvdnf84" == TEAMS.currentTenant.tenantKey || "T7AKVDNF84" == TEAMS.currentTenant.tenantKey ? !0 : !1;
            this.type = a.type;
            this.tpl = d.template("form.formsubordinate", {
                isWeaver: this.isWeaver,
                isAdmin: this.isAdmin
            });
            this.model = new f(a);
            this.activeTab = "j_biaoge";
            this.loadmoreType = "list";
            this.pageModule = "biaoge"
        },
        delegateEvents: function() {
            var a = this,
            e = a.model;
            $(a.tpl);
            var h = $(a.el);
            $("body").on("click.FormSubordinateView", ".goto-top",
            function(b) {
                d.gotoTop(".js_forms." + a.activeTab)
            });
            h.on("click.FormSubordinateView", ".js_formPreview",
            function() {
                var a = $(this).attr("formId");
                window.open("/form/preview/" + a)
            });
            h.on("keyup.FormSubordinateView", ".js_searchkeyword",
            function(b) {
                var e = $.trim($(this).val());
                13 == (b ? b: window.event ? window.event: null).keyCode && (b = {},
                a.model.pageNo = 1, b.pageNo = a.model.pageNo, h.find(".js_forms." + a.activeTab + " .js_form-list").empty(), e ? a.renderKeywords(b) : (h.find(".js_forms." + a.activeTab + " .js_form-list").html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e'), a.renderSubordinateForms(b)))
            });
            $("body").on("relatedFlow.FormSubordinateView",
            function(b, e, d) {
                a.setFlowsequenceIcon(e, d)
            });
            h.on("mouseenter.FormSubordinateView", "#forms-filter",
            function(c) {
                var e = $(this).attr("data-toggle");
                a.filter = new b({
                    el: e,
                    module: "formmanage",
                    targetObj: $(this),
                    userId: a.userId
                });
                a.filter.render(c);
                c = setTimeout(function() {
                    $(e).slideDown("fast")
                },
                300);
                $(this).data("showTimer", c);
                $(this).addClass("open")
            }).on("mouseleave.FormSubordinateView", "#forms-filter",
            function(a) {
                a = $(this).attr("data-toggle");
                var b = $(this).data("showTimer");
                b && clearTimeout(b);
                $(this).removeData("showTimer");
                $(a).slideUp(100);
                $(this).removeClass("open")
            }).on("filter.FormSubordinateView", "#forms-filter",
            function(b) {
                e.pageNo = 1;
                a.search({
                    pageNo: e.pageNo,
                    pageSize: 1E6
                })
            });
            h.on("click.FormSubordinateView", "#form-filter-dropdown .filter-item",
            function(b) {
                e.pageNo = 1;
                a.search({
                    pageNo: e.pageNo,
                    pageSize: 1E6
                })
            });
            h.on("click.FormSubordinateView", ".js_formtab .toolkit-item",
            function(b) {
                h.find(".js_formtab .toolkit-item").removeClass("active");
                $(this).addClass("active");
                $(this).hasClass("j_biaoge-tab") ? (a.activeTab = "j_biaoge", h.find(".js_forms.j_biaoge").removeClass("hide"), h.find(".js_forms.j_workflow").addClass("hide"), a.pageModule = "biaoge") : $(this).hasClass("j_workflow-tab") && (a.activeTab = "j_workflow", h.find(".js_forms.j_biaoge").addClass("hide"), h.find(".js_forms.j_workflow").removeClass("hide"), a.pageModule = "workflow", "false" == h.find(".js_forms.j_workflow").attr("data-load") && (a.rendertab({
                    pageNo: 1
                }), h.find(".js_forms.j_workflow").attr("data-load", "true")))
            });
            h.on("click.FormSubordinateView", ".j_Search .js_loadMore",
            function(b) {
                a.model.pageNo++;
                b = {
                    pageNo: a.model.pageNo
                };
                "list" == a.loadmoreType ? a.rendertab(b) : "keyword" == a.loadmoreType && a.renderKeywords(b)
            })
        },
        render: function() {
            var a = $(this.el),
            b = this.tpl,
            b = $(b).siblings("#formmanage-container");
            a.html(b.html());
            a.find(".return_js").attr("href", "/workflows/" + this.userId + "/new");
            a.find(".js_forms." + this.activeTab + " .js_form-list").html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e');
            this.rendertab({
                pageNo: 1
            })
        },
        rendertab: function(a) {
            var b = $(this.el);
            d.layout(this.el + " .js_forms." + this.activeTab);
            b.find(".js_forms." + this.activeTab + " #formlist-loading").show();
            a.queryType = "formManange";
            a.ownership = "personal";
            "j_biaoge" == this.activeTab ? a.module = "biaoge": "j_workflow" == this.activeTab && (a.module = "workflow");
            this.renderSubordinateForms(a);
            $(".js_forms." + this.activeTab + " .js_form-list").removeClass("hide")
        },
        drag: function() {
            var a = this,
            b = a.model;
            $(a.el).find(".js_forms." + a.activeTab + " .js_form-list #custom-category ul.form-list,.js_forms." + a.activeTab + " .js_form-list #other-category ul.form-list,.js_formcategory." + a.activeTab + " ul.j_formlist").sortable({
                handle: ".js_formListBox",
                placeholder: "form-placeholder",
                connectWith: ".js_forms." + a.activeTab + " .js_form-list ul.form-list,.js_forms." + a.activeTab + " .js_form-list ul.form-list,.js_formcategory." + a.activeTab + " ul.j_formlist",
                update: function(b, c) {
                    a.buildCount($(this));
                    a.buildSerialNumber($(this));
                    c.item.data("update", !0)
                },
                receive: function(a, b) {
                    b.item.data("receive", !0)
                },
                stop: function(h, c) {
                    if (c.item.data("update")) if (c.item.data("update", !1), c.item.data("receive")) {
                        c.item.data("receive", !1);
                        var f = c.item.attr("formid"),
                        g = c.item.parents(".js_formcategory." + a.activeTab).find(".form-category-hd .js_categoryname").attr("id");
                        b.updateCategory({
                            "form.id": f,
                            "formCategory.id": g
                        },
                        function(b) {
                            b.message || (d.notify("\u8868\u5355\u4fee\u6539\u5206\u7c7b\u6210\u529f"), a.sort(c.item))
                        })
                    } else a.sort(c.item)
                }
            })
        },
        loadCateAndForms: function(a, b, d) {
            $(this.el);
            d = this.tpl;
            var c = b.find("#custom-category");
            b = b.find("#other-category");
            a = a.formCategories;
            for (var f in a) {
                var g = a[f],
                q = g.name,
                r = g.id,
                t = g.sort,
                n = g.forms,
                l = n.length,
                m = g.type,
                g = $(d).siblings(".js_formcategory." + this.activeTab);
                "\u5176\u4ed6" == q ? g.addClass("js_other").find(".j_form-category").removeClass("j_form-category") : g.find(".js_categoryname").attr("id", r).attr("sort", t).attr("type", m);
                g.find(".js_categoryname").text(q);
                g.find(".js_categoryname").attr("title", q);
                g.find(".form-acount").text("(" + l + ")");
                for (var p in n) q = n[p],
                r = g.find(".j_formlist"),
                t = $(d).siblings("#formitems." + this.activeTab).find(".js_formitemsli").clone(),
                this.renderPersonalForm(q, r, t);
                g.hasClass("js_other") ? b.append(g) : c.append(g);
                this.buildSerialNumber(g.find(".j_formlist"))
            }
        },
        renderSubordinateForms: function(a) {
            var b = this;
            b.loadmoreType = "list";
            var d = b.model,
            c = $(b.el);
            c.find(".js_forms." + b.activeTab + " #formlist-loading").show();
            a.pageSize = 20;
            a.queryType = "manange";
            a["form.status"] = "enable";
            a.module = b.pageModule;
            d.findSubordinateForms(a,
            function(a) {
                b.renderEmployeeKeyword(a);
                c.find(".js_forms." + b.activeTab + " #formlist-loading").hide();
                0 == c.find(".js_forms." + b.activeTab + " .js_formitemsli").length ? c.find(".js_forms." + b.activeTab + " .js_noresult").show() : c.find(".js_forms." + b.activeTab + " .js_noresult").hide()
            })
        },
        renderPersonalForm: function(a, b, h, c) {
            h = this.tpl;
            $(this.el);
            var f = a.name,
            g = a.describe,
            q = a.id,
            r = a.fillCount;
            h = $(h).siblings("#formitems." + this.activeTab).find(".js_formitemsli");
            h.find(".js_copyForm").addClass("hide");
            h.attr("formid", q);
            h.attr("id", q);
            h.find("#form-number").css("background-color", d.getRandomColor());
            h.find(".js_formPreview").attr("formId", q);
            h.find("#form-title").text(f);
            h.find("#form-title").attr("data-id", q);
            h.find("#form-title").attr("userId", this.userId);
            h.find("#form-title").attr("title", f);
            void 0 == g && (g = "\u6682\u65e0\u8868\u5355\u63cf\u8ff0", h.find("#form-describe").removeClass("description").addClass("nodescription"));
            h.find("#form-describe").text(g);
            h.find("#form-describe").attr("title", g);
            h.find(".js_renameForm").attr("formId", q);
            h.find(".js_editForm").attr("formId", q);
            h.find(".js_shareForm").attr("formId", q);
            h.find(".js_formLog").attr("formId", q);
            h.find(".js_copyForm").attr("formId", q);
            h.find(".js_deleteForm").attr("formId", q);
            h.find(".js_formListBox").attr("formId", q);
            h.find(".j_fillCount").text(r + "\u4efd\u6570\u636e");
            h.find(".j_fillCount").attr("href", "/forms/" + TEAMS.currentUser.id + "/form-manager/" + q);
            h.find(".j_operator").text(a.operator.username).attr("title", a.operator.username);
            h.find(".j_createtime").text(Date.create(a.createTime).format("{yyyy}-{MM}-{dd}")).attr("title", Date.create(a.createTime).format("{yyyy}-{MM}-{dd}"));
            h.find(".form-message").addClass("hide").hide();
            h.find("#form-title").attr("renderType", "notRelateFlow");
            h.find(".js_relateFlow").attr("formId", q);
            h.find(".js_relateFlow").attr("data-id", q);
            this.createStatus(h, a);
            "prepend" == c ? b.prepend(h) : b.append(h)
        },
        renderEmployeeKeyword: function(a) {
            var b = $(this.el),
            d = $(this.tpl),
            c = b.find(".js_forms." + this.activeTab + " .js_form-list"),
            b = d.siblings("#search-boxlist").find(".j_Search." + this.activeTab).clone();
            null == c.find(".j_Search." + this.activeTab).get(0) && c.html(b);
            var b = c.find(".js_searchlist"),
            f = a.formPage,
            g = f.result;
            a = a.pageNo;
            c.find("#pageNo").val(a);
            a = c.find(".j_Search." + this.activeTab + " .j_formcount").text();
            a = a.substring(1, a.length - 1);
            a = parseInt(a) ? g.length + parseInt(a) : g.length;
            c.find(".j_Search." + this.activeTab + " .j_formcount").text("(" + a + ")");
            1 == f.pageNo && 0 == f.result.length ? c.find(".js_noresult").show() : c.find(".js_noresult").hide();
            f.hasNext ? c.find("#loadMore").show() : c.find("#loadMore").hide();
            for (c = 0; c < g.length; c++) f = g[c],
            a = d.siblings("#formitems." + this.activeTab).find(".js_formitemsli").clone(),
            this.renderPersonalForm(f, b, a, "append");
            this.buildSerialNumber(b)
        },
        renderKeywords: function(a) {
            var b = this,
            d = b.model,
            c = $(b.el),
            f = $.trim(c.find(".js_searchkeyword").val());
            a.pageSize = 20;
            a["form.ownership"] = "personal";
            a["form.keyword"] = f;
            a["form.status"] = "enable";
            a["form.module"] = "biaoge";
            d.findSubordinateForms(a,
            function(a) {
                b.renderEmployeeKeyword(a);
                c.find("#loadMore").attr("isKeyword", "isKeyword")
            })
        },
        deleteForm: function(a, b, f, c) {
            var k = this,
            g = k.model,
            q = $(a).parents(".j_formlist");
            "cloud" === f && (q = $(a).parents("#cloudformul"));
            var r = function(c) {
                c && g.deleteForm(b,
                function(b) {
                    b.message ? d.notify(b.message) : ($(a).parents("li").remove(), d.notify("\u8868\u5355\u5220\u9664\u6210\u529f"), k.buildSerialNumber(q))
                })
            };
            "cloud" === f ? d.confirm("\u4e91\u8868\u5355\u5220\u9664\u540e\u4e0d\u53ef\u6062\u590d,\u786e\u5b9a\u5220\u9664\u5417\uff1f", r) : d.confirm("\u6b64\u8868\u5355\u5df2\u586b\u5199\u8fc7" + c + "\u6b21,\u786e\u5b9a\u5220\u9664\u5417\uff1f", r)
        },
        buildSerialNumber: function(a) {
            a.find(".js_formitemsli").each(function(a) {
                $(this).find("#form-number").text(a + 1)
            })
        },
        buildCount: function(a) {
            var b = a.parents(".js_formcategory." + this.activeTab).find(".js_formitemsli").length;
            a.parents(".js_formcategory." + this.activeTab).find(".js_formcount").text("(" + b + ")")
        },
        sortCategory: function(a) {
            a.find(".js_formcategory." + view.activeTab).each(function(a) {
                $(this).find("#cate-name .js_categoryname").attr("sort", a + 1)
            })
        },
        sort: function(a) {
            $(this.el);
            var b = this.model,
            f = {},
            c = a.prevAll(),
            k = a.next(),
            g = a.prev(),
            q = a.parents(".j_formlist").find(".js_formitemsli").eq(0);
            c.each(function(a) {
                f["forms[" + a + "].id"] = $(this).attr("formid")
            }); (c = parseInt(k.attr("sort")) + 1) || (c = parseInt(g.attr("sort")));
            var g = q.attr("formid"),
            q = parseInt(q.attr("sort")),
            k = a.attr("formid"),
            r = a.parents(".js_formcategory." + this.activeTab).find(".form-category-hd .js_categoryname").attr("id");
            f.formId = k;
            f.sort = c;
            f.categoryId = r;
            49990 <= q && (f.firstFormId = g);
            b.sort(f,
            function(b) {
                b.sort && a.attr("sort", b.sort);
                a.prevAll().each(function(a) {
                    $(this).attr("sort", parseInt($(this).attr("sort")) + 1)
                });
                b.message || d.notify("\u8868\u5355\u6392\u5e8f\u6210\u529f")
            })
        },
        createStatus: function(a, b) {
            var d = b.status,
            c = b.id,
            f = "";
            if ("j_biaoge" != this.activeTab && "j_workflow" == this.activeTab) switch (d) {
            case "submit":
            case "disable":
                f = "\u542f\u7528";
                a.find("#form-title").removeClass("j_entityslider-toggle");
                a.removeClass("collecting").addClass("unpublished");
                a.find(".j_changeStatus").attr("formid", c);
                a.find(".j_changeStatus").attr("target-status", d);
                a.find(".j_changeStatus \x3e span").text(f);
                break;
            case "enable":
                f = "\u505c\u7528",
                a.find("#form-title").addClass("j_entityslider-toggle"),
                a.removeClass("unpublished").addClass("collecting"),
                a.find(".j_changeStatus").attr("formid", c),
                a.find(".j_changeStatus").attr("target-status", d),
                a.find(".j_changeStatus \x3e span").text(f)
            }
        },
        remove: function() {
            $(this.el).off(".FormSubordinateView");
            this.header && (this.header.remove(), this.header = null)
        },
        setFlowsequenceIcon: function(a, b) {
            "show" == b ? $(this.el).find(".js_formboxli[formid\x3d" + a + "]").find(".form-message").show() : $(this.el).find(".js_formboxli[formid\x3d" + a + "]").find(" .form-message").hide()
        },
        search: function(a) {
            $(this.el).find(".js_forms." + this.activeTab + " .js_form-list").html('\x3cdiv id\x3d"custom-category"\x3e\x3c/div\x3e\x3cdiv id\x3d"other-category"\x3e\x3c/div\x3e');
            var b = $("#formstatus-filter .filter-item .checked");
            1 == b.length && (a["form.status"] = b.data("entity"));
            b = $("#relatedstatus-filter .filter-item .checked");
            1 == b.length && (a["form.relateFlow"] = b.data("entity"));
            "j_biaoge" == this.activeTab ? a.module = "biaoge": "j_workflow" == this.activeTab && (a.module = "workflow");
            this.filterForms(a);
            $(".js_forms." + this.activeTab + " .js_form-list").removeClass("hide")
        },
        filterForms: function(a) {
            var b = this,
            d = b.model,
            c = $(b.el),
            f = $(b.tpl);
            d.findSubordinateForms(a,
            function(a) {
                c.find("#formmanagelist .js_forms." + b.activeTab + " .js_form-list");
                var d = c.find(".js_forms." + b.activeTab + " .js_form-list"),
                h = f.siblings("#search-boxlist").find(".j_Search." + b.activeTab).clone();
                null == d.find(".j_Search." + b.activeTab).get(0) && d.html(h);
                var h = d.find(".js_searchlist"),
                g = a.formPage.result,
                n;
                for (n in g) {
                    var l = g[n],
                    m = f.siblings("#formitems." + b.activeTab).find(".js_formitemsli").clone();
                    b.renderPersonalForm(l, h, m, "append")
                }
                a = a.formPage;
                1 == a.pageNo && 0 == a.result.length ? d.find(".js_noresult").show() : d.find(".js_noresult").hide();
                a.hasNext ? (d.find("#loadMore").show(), c.find(".js_loadMore").removeAttr("isKeyword")) : d.find("#loadMore").hide();
                b.buildSerialNumber(h);
                c.find("#formlist-loading").hide()
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formtag", ["teams/utils", "teams/component/typeahead", "teams/component/formtagmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/typeahead"),
    b = g("teams/component/formtagmodel");
    g = Backbone.View.extend({
        el: "",
        targetId: "",
        initialize: function(a) {
            this.container = a.container;
            this.ccontainer = a.ccontainer;
            this.el = (this.parentEl = a.parentEl) ? this.parentEl + " " + this.container: this.container;
            this.targetId = a.targetId;
            this._module = a.module;
            this.callbacks = a.callbacks;
            $(this.el).html(d.template("form.formtag", {
                panel: "tag"
            }));
            this.retpl($(this.el), !0);
            this.model = new b(a)
        },
        render: function(a) {
            $(this.el).find(".entity-container").attr({
                "target-id": this.targetId,
                module: this._module
            });
            this.renderExistTags()
        },
        renderExistTags: function() {
            var a = this.model,
            b = $(this.el),
            d = {};
            d.targetId = this.targetId;
            a.queryExistTags(d,
            function(a) {
                a = a.formtags;
                if (null != a) for (var d = 0; d < a.length; d++) {
                    var f = a[d],
                    h = !0;
                    b.find(".entity-item").each(function() {
                        f.id == $(this).find("a").attr("data-value") && (h = !1)
                    });
                    if (h) {
                        var g = "\x3cspan class\x3d'entity-item'\x3e\x3ca data-value\x3d'" + f.id + "'\x3e" + f.name + "\x3c/a\x3e\x3c/span\x3e";
                        b.find(".entity-container").append(g)
                    }
                }
            })
        },
        delegateEvents: function() {
            var a = this,
            b = this.model;
            $(a.el).off("click", ".entity-item .close").on("click ", ".entity-item .close",
            function(f) {
                var c = $(this).prevAll("a").attr("data-value"),
                k = $(this).parents(".entity-container");
                $(this).parent(".entity-item").remove();
                k.trigger("removeEntity", c);
                var g = {};
                g.targetId = a.targetId;
                g.id = c;
                g.module = a._module;
                b.unlink(g,
                function(a) {});
                f.stopPropagation();
                var q = $(this).prevAll("a").attr("data-value"),
                k = $(this).parents(".entity-container"),
                r = k.attr("data-url");
                if (r && q) {
                    var t = $(this).parent(),
                    g = k.data("param") || {};
                    g._method = "delete";
                    f = function(b) {
                        b && $.ajax({
                            type: "POST",
                            dataType: "json",
                            data: g,
                            url: r.replace("{id}", q),
                            success: function(b) {
                                t.remove();
                                k.trigger("removeEntity", b);
                                $("#stream").trigger("insertStream", b.streams || b.stream);
                                $("#readinfo").trigger("updateReadInfo");
                                d.notify("\u6570\u636e\u5df2\u5220\u9664");
                                a.callbacks && a.callbacks.unlink && a.callbacks.unlink(q, b.streams || b.stream)
                            }
                        })
                    };
                    k.attr("data-noConfirm") ? f(!0) : d.confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f", f)
                } else $(this).parent().hasClass("tag") || ($(this).parent(".entity-item").remove(), k.trigger("removeEntity", c))
            });
            f({
                el: a.el + " #typeahead-tag",
                callback: function(b) {
                    "new" == b.id ? a.create(b) : a.link(b)
                }
            })
        },
        retpl: function(a, b) {
            b && (a.find(".tag-controls").addClass("tag-controls-mine"), a.find(".j_tag_label").text("\u6211\u7684\u6807\u7b7e:"), a.find("#typeahead-tag").attr({
                placeholder: "\u8f93\u5165\u6211\u7684\u6807\u7b7e",
                privacy: 1
            }))
        },
        link: function(a) {
            var b = this,
            f = this.model,
            c = !1,
            k = b.el;
            $(k).find("#tags .entity-item a").each(function() {
                $(this).attr("data-value") == a.id && (c = !0, d.notify("\u6807\u7b7e\u5df2\u5b58\u5728"))
            });
            c || f.link(a,
            function(a) {
                var c = a.formtag;
                b.renderTag(k, c);
                $(b.parentEl + " #stream").trigger("insertStream", a.stream);
                b.callbacks && b.callbacks.link && b.callbacks.link(c.id, a.stream)
            })
        },
        create: function(a) {
            var b = this,
            f = a.privacy ? b.el: b.cel;
            this.model.create(a,
            function(a) {
                var k = a.formtag;
                b.renderTag(f, k);
                $(b.parentEl + " #stream").trigger("insertStream", a.stream);
                $("#left").trigger("refresh", "tag");
                d.notify("\u6807\u7b7e\u521b\u5efa\u6210\u529f");
                b.callbacks && b.callbacks.link && b.callbacks.link(k.id, a.stream)
            })
        },
        renderTag: function(a, b) {
            var d = "\x3cspan class\x3d'entity-item'\x3e\x3ca class\x3d'router' href\x3d'/tag/" + (b.privacy ? "privacy": "common") + "/" + b.id + "' data-value\x3d'" + b.id + "'\x3e" + b.name + "\x3c/a\x3e\x3c/span\x3e";
            $(a).find(".entity-container").append(d)
        },
        getLinkIds: function() {
            var a = [];
            $(this.el).find(".entity-item").each(function() {
                a.push($(this).find("a").attr("data-value"))
            });
            return a
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formcontinuewriteview", ["teams/utils", "teams/component/typeahead", "teams/component/validation", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/component/typeahead");
    g("teams/component/validation");
    var b = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.formId = a.formId;
            this.el = "#form-continue-write";
            this.callback = a.callback;
            this.userId = a.userId;
            this.parentEl = a.parentEl ? a.parentEl: "body";
            $(this.parentEl).append(d.template("form.formcontinuewrite"));
            this.model = new b(a);
            this.workflowConfig = a.workflowConfig
        },
        delegateEvents: function() {
            var a = this,
            b = a.formId;
            $(a.el).on("hidden.bs.modal.ContinueWrite",
            function(b) {
                $(b.target).hasClass("datepicker") || a.remove()
            });
            $(a.el).off("change.ContinueWrite", "#continue-write select").on("change.ContinueWrite", "#continue-write select",
            function() {
                $(this);
                var f = $(a.el).find("#contwrite-select").val();
                if ("user" == f) $(a.el).find(".sharetype-user").removeClass("hide"),
                $(a.el).find(".sharetype-dept").addClass("hide"),
                $(a.el).find(".sharetype-user input").focus();
                else if ("department" == f) $(a.el).find(".sharetype-dept").removeClass("hide"),
                $(a.el).find(".sharetype-user").addClass("hide"),
                $(a.el).find(".sharetype-dept input").focus();
                else {
                    $(a.el).find(".sharetype-dept").addClass("hide");
                    $(a.el).find(".sharetype-user").removeClass("hide");
                    $(a.el).find("#editShare").removeClass("hide");
                    $(a.el).find(".typeahead-wrapper").addClass("hide");
                    $(this).val("user");
                    var c = $(a.el).find("#continue-write .j_selected"),
                    k = !1;
                    c.find(".entity-item").each(function(a) {
                        0 == $(this).find("a").attr("id") && (k = !0)
                    });
                    k ? d.notify("\u5df2\u6dfb\u6240\u6709\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : (a.saveAndSortSelectUser(b, "\u6240\u6709\u4eba", "0", f, c), c.append('\x3cspan class\x3d"entity-item" type\x3d"allpeople"\x3e\x3ca id\x3d"0"\x3e\u6240\u6709\u4eba\x3c/a\x3e\x3c/span\x3e'))
                }
            });
            f([{
                el: a.el + " .sharetype-dept input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var c = $(a.el).find("#continue-write .j_selected");
                        a.renderTypeheader(c, b, "department")
                    }
                }
            },
            {
                el: a.el + " .sharetype-user input",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var c = $(a.el).find("#continue-write .j_selected");
                        a.renderTypeheader(c, b, "user")
                    }
                }
            }]);
            $(a.el).off("click.ContinueWrite", "#contWrite-close").on("click.ContinueWrite", "#contWrite-close",
            function(b) {
                $(a.el).modal("hide")
            });
            $(a.el).off("click", ".entity-item .close").on("click ", ".entity-item .close",
            function(b) {
                b.stopPropagation();
                a.deleteEvent($(this))
            })
        },
        deleteEvent: function(a) {
            var b = a.prevAll("a").attr("id"),
            f = a.parents(".entity-container");
            a.parent(".entity-item").remove();
            f.trigger("removeEntity", b);
            a = a.parent(".entity-item").attr("type");
            f = {};
            f.formId = this.formId;
            f.uidORdeptid = b;
            f.selectType = a;
            f.queryType = "write";
            f.entityType = "biaoge";
            $.ajax({
                type: "post",
                url: "/form/deleteShareConfig.json",
                dataType: "json",
                data: f,
                success: function(a) {
                    d.notify("\u6570\u636e\u5df2\u5220\u9664")
                }
            })
        },
        renderTypeheader: function(a, b, d) {
            var c = this.formId;
            if (b.length) for (var f = 0; f < b.length; f++) {
                var g = b[f],
                q = g.name,
                r = g.id;
                if (q && r) {
                    var t = '\x3cspan class\x3d"entity-item" type\x3d"' + d + '"\x3e\x3ca id\x3d' + r + "\x3e" + q + "\x3c/a\x3e\x3c/span\x3e";
                    a.find(".entity-item").each(function(a) {
                        r == $(this).find("a").attr("id") && (t = null)
                    });
                    this.saveAndSortSelectUser(c, q, r, d, a);
                    a.append(t)
                }
            } else q = b.name,
            r = b.id,
            q && r && (t = '\x3cspan class\x3d"entity-item" type\x3d"' + d + '"\x3e\x3ca id\x3d' + r + "\x3e" + q + "\x3c/a\x3e\x3c/span\x3e", a.find(".entity-item").each(function(a) {
                r == $(this).find("a").attr("id") && (t = null)
            }), this.saveAndSortSelectUser(c, q, r, d, a), a.append(t))
        },
        saveAndSortSelectUser: function(a, b, f, c, k) {
            var g = this.model,
            q = {};
            q.selectType = c;
            q.formId = a;
            q.content = b;
            q.linkId = f;
            q.uidORdeptid = f;
            q.queryType = "write";
            q.entityType = "biaoge";
            var r = !1;
            k.find(".entity-item").each(function(a) {
                f == $(this).find("a").attr("id") && (r = !0)
            });
            r ? d.notify("\u5df2\u6dfb\u52a0\u6b64\u4eba\uff0c\u4e0d\u7528\u91cd\u590d\u6dfb\u52a0") : g.saveShareConfig(q,
            function(a) {
                a.actionMsg ? d.notify(a.actionMsg.message) : d.notify("\u4fdd\u5b58\u6210\u529f")
            })
        },
        queryLastConfig: function() {
            var a = this,
            b = a.model,
            d = {};
            d.formId = a.formId;
            d.queryType = "write";
            d.entityType = "biaoge";
            b.queryLastConfig(d,
            function(b) {
                b = b.formPermissions;
                if (null != b) for (var e = 0; e < b.length; e++) {
                    var d = b[e].targetType;
                    "all" == d && (d = "allpeople");
                    $(a.el).find("#contwrite-select").find("option[value\x3d'user']").attr("selected", !0);
                    var f = b[e].targetId,
                    h = b[e].name;
                    $(a.el).find("#continue-write .j_selected").append('\x3cspan class\x3d"entity-item" type\x3d"' + d + '"\x3e\x3ca id\x3d' + f + "\x3e" + h + "\x3c/a\x3e\x3c/span\x3e")
                }
            })
        },
        render: function() {
            this.workflowConfig ? ($(this.el).find(".detail-header .j_header").html('\x3ci class\x3d"graph graph-agenda"\x3e\x3c/i\x3e\u5ba1\u6279\u8868\u5355\u6743\u9650\u8bbe\u7f6e'), $(this.el).find("#continue-write .j_write-label").text("\u5ba1\u6279\u8868\u5355\u6743\u9650\u8bbe\u7f6e")) : ($(this.el).find(".detail-header .j_header").html('\x3ci class\x3d"graph graph-agenda"\x3e\x3c/i\x3e\u5185\u90e8\u6301\u7eed\u586b\u5199\u8bbe\u7f6e'), $(this.el).find("#continue-write .j_write-label").text("\u5185\u90e8\u6301\u7eed\u586b\u5199\u8bbe\u7f6e"));
            $(this.el).modal("show");
            this.queryLastConfig();
            d.layout(".j_formcontinueScr")
        },
        hide: function() {
            $(this.el).modal("hide")
        },
        remove: function() {
            $(this.el).off(".ContinueWrite");
            $("#form-continue-write").remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formmanagemodel", ["teams/utils"],
function(g, m, l) {
    var d = g("teams/utils");
    g = Backbone.Model.extend({
        formId: 0,
        pageNo: 1,
        pageSize: 10,
        initialize: function(d) {},
        createUserStream: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/createUserStream.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        createDepartmentStream: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/createDepartmentStream.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        saveShareConfig: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/saveShareConfig.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryLastConfig: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryLastConfig.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        saveFieldAuth: function(d, b) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/saveFieldAuth.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(a) {
                    b && b(a)
                }
            })
        },
        deleteFieldAuth: function(d, b) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/deleteFieldAuth.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryCompanyAndEmployForms: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryCompanyAndEmployForms.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryMyForms: function(d, b) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/queryMyForms.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryMyFormsKeywords: function(d, b) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/queryMyFormsKeywords.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryMyWriteForms: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryMyWriteForms.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findSubordinateForms: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/findSubordinateForms.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findPersonal: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/findPersonal.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findCompany: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/findCompany.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findCloud: function(d, b) {
            $.ajax({
                type: "get",
                url: "/form/findCloud.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        deleteForm: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/delete.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryMaxSort: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryMaxSort.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        copyForm: function(f, b) {
            $.ajax({
                type: "post",
                url: "/form/copy.json",
                dataType: "json",
                data: f,
                success: function(a) {
                    a.actionMsg && a.actionMsg.message ? d.notify(a.actionMsg.message) : b && b(a)
                }
            })
        },
        saveForm: function(f, b) {
            $.ajax({
                type: "post",
                async: !1,
                url: "/form/save.json",
                dataType: "json",
                data: f,
                success: function(a) {
                    a.actionMsg && a.actionMsg.message ? d.notify(a.actionMsg.message) : b && b(a)
                }
            })
        },
        renameForm: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/rename.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        checkFormName: function(d, b) {
            $.ajax({
                type: "get",
                url: "/form/checkFormName.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        updateStatus: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/updateStatus.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        updateCollectStatus: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/updateCollectStatus.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryKeywords: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryKeywords.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findCount: function(d, b) {
            $.ajax({
                type: "get",
                url: "/form/findCount.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        suggestion: function(d) {
            $.ajax({
                type: "get",
                url: "/search/suggestion.json",
                dataType: "json",
                success: function(b) {
                    d && d(b)
                }
            })
        },
        updateCategory: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/updateCategory.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findCateAndCompany: function(d, b) {
            $.ajax({
                type: "get",
                url: "/form/findCateAndCompany.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findCateAndPersonal: function(d, b) {
            $.ajax({
                type: "get",
                url: "/form/findCateAndPersonal.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findCateAndCloud: function(d, b) {
            $.ajax({
                type: "get",
                url: "/form/findCateAndCloud.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        createCategory: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/createCategory.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        deleteCategory: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/deleteCategory.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        formCategorSort: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/formCategorSort.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        updateCategoryName: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/updateCategoryName.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        sort: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/sort.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        recommend: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/recommend.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        updateRelateFlow: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/updateRelateFLow.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryCategory: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryCategory.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        incollect: function(d, b) {
            $.ajax({
                type: "post",
                url: "/formdatareport/incollect.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryIntroCount: function(d, b) {
            $.ajax({
                type: "post",
                url: "/base/configuration/queryIntroCount.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        useflow: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/useflow.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        getFiledByForm: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/findFiledByForm.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findMember: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/findMember.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryRecommend: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryRecommend.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        findForm: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/findForm.json",
                dataType: "json",
                data: {
                    formId: d
                },
                async: !1,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryMyApplyWorkflow: function(d, b) {
            $.ajax({
                type: "get",
                url: "/form/queryMyApplyWorkflow.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryLastMsgConfig: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryLastMsgConfig.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        updateMessage: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/updateMessage.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryEmployeeComponent: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryEmployeeComponent.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryDateComponent: function(d, b) {
            $.ajax({
                type: "post",
                url: "/form/queryDateComponent.json",
                dataType: "json",
                data: d,
                success: function(a) {
                    b && b(a)
                }
            })
        },
        createRemindConfig: function(d, b) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/remindconfig/createRemindConfig.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryConfigByFormId: function(d, b) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/remindconfig/queryConfigByFormId.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(a) {
                    b && b(a)
                }
            })
        },
        queryByFormId: function(d, b) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/getByFormId.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(a) {
                    b && b(a)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formoperationview", ["teams/utils", "teams/component/validation", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils");
    g("teams/component/validation");
    var f = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.isPay = !1;
            if (TEAMS.currentTenant && TEAMS.currentTenant.isPay) this.isPay = !0;
            else if ("normal" == TEAMS.currentTenant.status || "outPayUserInweek" == TEAMS.currentTenant.status || "outPayRoom" == TEAMS.currentTenant.status || "outPayUserOutweek" == TEAMS.currentTenant.status || "prepaid" == TEAMS.currentTenant.status || "probation" == TEAMS.currentTenant.status) this.isPay = !0;
            this.param = b;
            this.model = new f(b);
            this.userId = TEAMS.currentUser.id;
            this.tpl = b.tpl;
            this.saveCallback = b.saveCallback;
            this.el = b.el;
            this.ownership = b.ownership;
            this.formwrite = b.formwrite;
            this.formTitle = b.formTitle;
            this.copyCallback = b.copyCallback;
            this.module = b.module;
            this.isAdmin = TEAMS.currentUser.admin;
            $("body").append(this.tpl);
            this.initElement()
        },
        initElement: function() {
            var b = $(this.el);
            "t7akvdnf84" == TEAMS.currentTenant.tenantKey ? b.find(".js_formowner .js_cloudform").removeClass("hide") : b.find(".js_formowner .js_cloudform").remove();
            "cloud" == this.ownership ? b.find(".js_formowner").parent().addClass("hide") : b.find(".js_formowner .js_cloudform").addClass("hide")
        },
        delegateEvents: function() {
            var b = this,
            a = b.model,
            e = $(b.el),
            f = b.el;
            e.on("hidden.bs.modal",
            function(a) {
                b.remove()
            });
            e.on("keydown.FormoperationView", "#form-name",
            function(a) {
                13 === a.keyCode && (e.find("#form-btn-save").trigger("click"), a.preventDefault())
            });
            e.on("keydown.FormoperationView", "#form-name-copy",
            function(a) {
                13 === a.keyCode && (e.find("#form-btn-copy").trigger("click"), a.preventDefault())
            });
            e.on("click.FormoperationView", "#form-btn-cancel",
            function() {
                e.modal("hide")
            });
            e.on("shown.bs.modal",
            function() {
                "#build-newform" == f ? e.find("#form-name").focus() : e.find("#form-name-copy").focus().val(b.formTitle)
            });
            e.on("blur.FormoperationView", "#form-name",
            function() {
                var c = $(this).val(),
                f = e.find('.js_forminfo input[name\x3d"ownership"]:checked').val(),
                h = {};
                f || (f = "personal");
                "personal" == f && (h["form.operator"] = b.userId);
                h["form.name"] = $.trim(c);
                h["form.ownership"] = f;
                b.param["form.report.id"] && (h["form.report.id"] = b.param["form.report.id"]);
                h.module = b.param.module;
                "" != $.trim(c) && "cloud" != f && a.checkFormName(h,
                function(a) { (a = a.message) && d.notify(a)
                })
            });
            e.on("click.BuildnewformView", "#form-btn-save",
            function() {
                var c = $.trim(e.find(".js_forminfo #form-name").val()),
                f = $.trim(e.find(".js_forminfo #form-describe").val()),
                h = e.find('.js_forminfo input[name\x3d"ownership"]:checked').val(),
                g = {};
                h || (h = "personal");
                b.param["form.report.id"] && (g["form.report.id"] = b.param["form.report.id"]);
                if ("" == $.trim(c)) d.notify("\u8bf7\u8f93\u5165" + ("workflow" == b.module ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\u540d\u79f0");
                else {
                    if (!b.isPay && "company" == h) {
                        var r = !1;
                        $.ajax({
                            contentType: "application/json;charset\x3dUTF-8",
                            type: "post",
                            url: "/form/isExceedMaximum.json",
                            async: !1,
                            dataType: "json",
                            success: function(a) {
                                a && a.exceedMaximum && (r = a.exceedMaximum)
                            }
                        });
                        if (r) {
                            d.notify("\u60a8\u7684\u56e2\u961f\u76ee\u524d\u662f\u514d\u8d39\u7248\u672c\uff0c\u6700\u591a\u53ef\u4ee5\u521b\u5efa6\u4e2a\u56e2\u961f" + ("workflow" == b.module ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\uff01");
                            return
                        }
                    }
                    g["form.name"] = c;
                    g["form.describe"] = f;
                    g["form.ownership"] = h;
                    g.module = b.param.module;
                    void 0 != b.param && void 0 != b.param.formLabelId && (g["formLabel.id"] = b.param.formLabelId);
                    var t = null;
                    a.saveForm(g,
                    function(a) {
                        var c = a.message;
                        c ? d.notify(c) : (t = a.form.id, b.saveCallback && b.saveCallback(a), d.notify(("workflow" == b.module ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\u4fdd\u5b58\u6210\u529f"), e.modal("hide"))
                    });
                    null != t && b.isReportForm ? window.open("/form/editreport/" + t) : null != t && window.open("/form/edit/" + t)
                }
            });
            e.on("click.BuildnewformView", "#biaoge-form-btn-save",
            function() {
                var c = $.trim(e.find(".js_forminfo #form-name").val()),
                f = $.trim(e.find(".js_forminfo #form-describe").val()),
                h = e.find('.js_forminfo input[name\x3d"ownership"]:checked').val(),
                g = e.find('.js_forminfo input[name\x3d"asCompany-form"]').is(":checked"),
                r = {};
                h || (h = "personal");
                b.param["form.report.id"] && (r["form.report.id"] = b.param["form.report.id"]);
                if ("" == $.trim(c)) d.notify("\u8bf7\u8f93\u5165" + ("workflow" == b.module ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\u540d\u79f0");
                else {
                    var t;
                    "company" == h ? t = e.find(".js_company_select").val() : "personal" == h && (null != b.formwrite && "" != b.formwrite ? (t = e.find(".js_company_select").val(), r["form.formwrite"] = "formwrite", g && (h = "company")) : t = e.find(".js_personal_select").val());
                    r["form.name"] = c;
                    r["form.describe"] = f;
                    r["form.ownership"] = h;
                    r.module = b.param.module;
                    "\u5176\u4ed6" != t && (r["form.formCategory.id"] = t);
                    void 0 != b.param.formLabelId && (r["formLabel.id"] = b.param.formLabelId);
                    var n = null;
                    a.saveForm(r,
                    function(a) {
                        a.message ? d.notify(a.message) : a.actionMsg ? d.notify(a.actionMsg.message) : (n = a.form.id, b.saveCallback && b.saveCallback(a), d.notify(("workflow" == b.module ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\u4fdd\u5b58\u6210\u529f"), e.modal("hide"))
                    });
                    null != n && b.isReportForm ? window.open("/form/editreport/" + n) : null != n && window.open("/form/edit/" + n)
                }
            });
            e.on("click.FormoperationView", "#form-btn-copy",
            function() {
                var c = {},
                f = $.trim(e.find(".js_forminfo #form-name-copy").val()),
                h = $(this).parents(".js_forminfo").find(".js_formowner").find('input[name\x3d"ownership"]:checked').val();
                "" == $.trim(f) ? d.notify("\u8bf7\u8f93\u5165" + ("workflow" == b.module ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\u540d\u79f0") : (h || (h = "personal"), c["form.name"] = f, c.formName = f, c["form.ownership"] = h, c.ownership = h, "personal" == h && (c["form.operator"] = b.userId), c.module = b.param.module, c.formId = b.param.formId, a.checkFormName(c,
                function(f) { (f = f.message) ? d.notify(f) : a.queryMaxSort(c,
                    function(f) {
                        c.newSort = f.newSort;
                        a.copyForm(c,
                        function(a) {
                            d.notify(("workflow" == b.module ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\u590d\u5236\u6210\u529f");
                            b.copyCallback && b.copyCallback(a);
                            e.modal("hide")
                        })
                    })
                }))
            });
            e.on("hidden.bs.modal",
            function(a) {
                b.remove()
            })
        },
        render: function() {
            var b = $(this.el);
            b.modal();
            b.find('input[name\x3d"ownership"][id\x3d"' + this.ownership + '"]').attr("checked", !0);
            var a = {
                ownership: this.ownership,
                module: this.param.module
            };
            "company" == this.ownership ? (b.find(".js_personal_select").remove(), b.find(".js_personal_label").remove(), this.model.queryCategory(a,
            function(a) {
                for (var d = 0; d < a.formCategories.length; d++) b.find(".js_company_select").append('\x3coption value\x3d"' + a.formCategories[d].id + '"\x3e' + a.formCategories[d].name + "\x3c/option\x3e");
                b.find(".js_company_select").append('\x3coption selected\x3d"selected"\x3e\u5176\u4ed6\x3c/option\x3e')
            })) : "personal" == this.ownership && (null != this.formwrite && "" != this.formwrite ? (b.find(".js_personal_select").remove(), b.find(".js_personal_label").remove(), this.model.queryCategory({
                ownership: "company",
                module: "biaoge"
            },
            function(a) {
                for (var d = 0; d < a.formCategories.length; d++) b.find(".js_company_select").append('\x3coption value\x3d"' + a.formCategories[d].id + '"\x3e' + a.formCategories[d].name + "\x3c/option\x3e");
                b.find(".js_company_select").append('\x3coption selected\x3d"selected"\x3e\u5176\u4ed6\x3c/option\x3e')
            }), this.isAdmin && b.find(".j_asCompany").removeClass("hide")) : (b.find(".js_company_select").remove(), b.find(".js_company_label").remove(), this.model.queryCategory(a,
            function(a) {
                for (var d = 0; d < a.formCategories.length; d++) b.find(".js_personal_select").append('\x3coption value\x3d"' + a.formCategories[d].id + '"\x3e' + a.formCategories[d].name + "\x3c/option\x3e");
                b.find(".js_personal_select").append('\x3coption selected\x3d"selected"\x3e\u5176\u4ed6\x3c/option\x3e')
            })));
            b.find("#form-describe").autosize();
            this.param.ownership_display && "false" == this.param.ownership_display && $(".js_formowner").parent().addClass("hide")
        },
        remove: function() {
            $(this.el).off(".FormoperationView");
            $(this.el).remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/writeformview", ["teams/utils", "teams/component/formview", "eteams/biaoge/form/formdatareportmodel", "teams/component/relevancemodel"],
function(g, m, l) {
	console.log("eteams/biaoge/form/writeformview")
    var d = g("teams/utils"),
    f = g("teams/component/formview"),
    b = g("eteams/biaoge/form/formdatareportmodel"),
    a = g("teams/component/relevancemodel");
    g = Backbone.View.extend({
        teams: {},
        initialize: function(e) {
        	console.log("initialize")
            this.model = new b(e);
            this.relevanceModel = new a(e);
            this.userId = e.userId || TEAMS.currentUser.id;
            this.formId = e.formId;
            this.dataId = e.dataId;
            this.mainlineId = e.mainlineId;
            this.el = e.container || "#entitySlider";
            this.page = e.page;
            this.callback = e.callback ? e.callback: $.noop;
            this.formView = new f;
            $(this.el).html(d.template("form.writeform"))
        },
        delegateEvents: function() {
            var a = this,
            b = $(a.el);
            b.off("click.WriteFormView", ".j_btn_save").on("click.WriteFormView", ".j_btn_save",
            function(c) {
                var f = b.find("#form-info-div #form-name").val();
                if (null == f || "" == f) d.notify("\u8bf7\u586b\u5199\u4e0a\u62a5\u540d\u79f0");
                else {
                    var g = b.find("#form-info-div #applicants .applyUser_js").attr("userid");
                    if (a.isautoSave) if (a.reportId) c = {
                        formData: a.dataId,
                        name: b.find("#form-info-div #form-name").val(),
                        id: a.reportId,
                        status: "finshed",
                        formId: a.formId,
                        msg: "\u63d0\u4ea4\u6210\u529f"
                    },
                    a.updateReportAndFormData(c),
                    $("body").trigger("slideClose");
                    else {
                        c = b.find(".js-biaoge-form");
                        var q = {
                            afterDataDetailSave: function(a) {},
                            afterformDataCreate: function(b) {
                                window.formJsonStr = null;
                                b = a.getParam(g, f, b.id, "finshed", a.layoutId, !1);
                                var c = !1;
                                a.model.update(b,
                                function(a) {
                                    a && a.actionMsg ? d.notify(a.actionMsg.message) : (d.notify("\u63d0\u4ea4\u6210\u529f"), c = !0, $("body").trigger("slideClose"))
                                });
                                return c
                            },
                            dataStatus: 1
                        };
                        q.parentEl = c;
                        formPlugin.saveFieldData(q)
                    } else {
                        if (!a.formView.submitCheck(b.find(".form-view_js"))) return ! 1;
                        c = $(this);
                        var r = c.attr("status");
                        c.removeClass("j_btn_save");
                        a.formView.submit({
                            parentEl: $(".js-biaoge-form"),
                            dataStatus: 1,
                            callback: function(b) {
                                if (b && b.message) d.notify(b.message);
                                else {
                                    var c = b.formData.id;
                                    b = a.getParam(g, f, c, r, b.formData.formLayout.id, !0);
                                    msg = "todo" == r ? "\u6682\u5b58\u6210\u529f": "\u63d0\u4ea4\u6210\u529f";
                                    a.model.update(b,
                                    function(b) {
                                        window.formJsonStr = null;
                                        "function" == typeof a.callback && a.callback(b.dataReport);
                                        b && b.dataReport && a.addRelevance(c, b.dataReport.id);
                                        $("body").trigger("slideClose");
                                        d.notify(msg)
                                    })
                                }
                            }
                        })
                    }
                }
            })
        },
        getParam: function(a, b, c, d, f, g) {
            var r = {},
            t = {
                id: this.userId
            };
            a = {
                id: a
            };
            var n = {};
            n.status = d;
            n.formData = c;
            n.name = b;
            n.formId = this.formId;
            n.formLayout = f;
            n.id = null;
            n.reporter = t;
            n.creator = a;
            r.dataReport = n;
            this.mainlineId && (r.mainlineIds = [this.mainlineId]);
            r.async = g;
            return r
        },
        addRelevance: function(a, b) {
            $(this.el);
            var c = {};
            c.dataId = a;
            c.objectId = b;
            c.objectModule = "formdatareport";
            c.module = "formdatareport";
            this.relevanceModel.addComponentRelevance(c,
            function() {})
        },
        render: function() {
            var a = this,
            b = $(a.el);
            d.layout(a.el + " .j_formContainer");
            a.model.queryByFormId({
                formId: a.formId
            },
            function(c) {
                c.actionMsg ? d.notify(c.actionMsg) : (c = c.form, 1 == c.autoSave && b.find("#write-form-save").remove(), a.renderForm(c))
            })
        },
        updateReportAndFormData: function(a) {
            $(this.el);
            var b = a.msg;
            this.model.updateReportAndFormData({
                dataReport: a
            },
            function(a) {
                a && a.actionMsg ? d.notify(a.actionMsg.message) : b ? d.notify(b) : d.notify("\u4fdd\u5b58\u6210\u529f")
            })
        },
        renderForm: function(a) {
            var b = this,
            c = $(b.el);
            this.mainView = new f({
                userId: b.userId,
                formId: b.formId,
                parentEl: b.el
            });
            var k = a.operator.id;
            a = 1 == a.autoSave ? !0 : !1;
            b.isautoSave = a;
            var g = null;
            a && (c.find(".form-view_js").addClass("notShowSave"), g = {
                afterDataDetailSave: function(a) {
                    b.dataId = a.id;
                    var e = {
                        formData: a.id,
                        name: c.find("#form-info-div #form-name").val(),
                        id: b.reportId
                    };
                    b.updateReportAndFormData(e);
                    b.addRelevance(a.id, b.reportId)
                },
                afterformDataCreate: function(a) {
                    b.dataId = a.id;
                    window.formJsonStr = null;
                    var e = c.find("#form-info-div #form-name").val(),
                    e = b.getParam(k, e, a.id, "todo", b.layoutId, !1),
                    f = !1;
                    b.model.update(e,
                    function(c) {
                        c && c.actionMsg ? d.notify(c.actionMsg.message) : (b.reportId = c.dataReport.id, b.addRelevance(a.id, c.dataReport.id), d.notify("\u4fdd\u5b58\u6210\u529f"), f = !0)
                    });
                    return f
                }
            });
            this.mainView.render({
                parentEl: c.find(".js-biaoge-form"),
                formId: b.formId,
                autoSave: g,
                callback: function(a) {
                    var e = a.form;
                    b.layoutId = a.formLayout.id;
                    null != e && (c.find(".j_formContainer #formName").text(e.name), c.find("#form-info-div #form-name").val(e.name), c.find("#form-info-div #applicants .applyUser_js").text(e.operator.name), c.find("#form-info-div #applicants .applyUser_js").attr("userid", e.operator.id), c.find("#form-info-div #applicants .j_dept").text(e.operator.department.name), c.find("#form-info-div #applicants .j_date").text(Date.create(new Date).format("{yyyy}-{MM}-{dd}")));
                    if (a = formPlugin.submitAssembleForm({
                        parentEl: c.find(".form-view_js")
                    })) a = JSON.stringify(a.formData.dataDetails),
                    window.formJsonStr = a
                }
            })
        },
        remove: function() {
            $(this.el).off(".WriteFormView");
            this.mainView && (this.mainView.remove(), this.mainView = null);
            this.formView && (this.formView.remove(), this.formView = null);
            window.formJsonStr && (window.formJsonStr = null);
            this.reportId && (this.reportId = null);
            this.isautoSave && (this.isautoSave = null);
            this.dataId && (this.dataId = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/form/formcloudview", ["teams/utils", "eteams/biaoge/form/formcloudmodel", "eteams/biaoge/form/formoperationview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/form/formcloudmodel"),
    b = g("eteams/biaoge/form/formoperationview");
    g = Backbone.View.extend({
        initialize: function(a) {
            a = a || {};
            this.el = a.el;
            this.userId = a.userId;
            this.model = new f;
            $(this.el).html(d.template("form.cloud"));
            this.currentForm = {};
            this.pageModule = a.module
        },
        delegateEvents: function() {
            var a = this,
            e = $(a.el);
            $("body").off("click.FormCloud", ".goto-top").on("click.FormCloud", ".goto-top",
            function(a) {
                d.gotoTop(".j_formcloudmain")
            });
            $(window).off("resize.FormCloud").on("resize.FormCloud",
            function() {
                0 < $(".j_formlabel").length && ($(".j_formlabel")[0].scrollHeight > $(".j_formlabel").data("maxHeight") ? $(".j_labelmore").show() : $(".j_labelmore").hide())
            });
            this.model.on("change:formLabels",
            function(b, c) {
                a.$(".j_formlabel").html(d.template("form.cloud.label", {
                    data: c
                }));
                $(".j_formlabel")[0].scrollHeight > $(".j_formlabel").data("maxHeight") ? $(".j_labelmore").show() : $(".j_labelmore").hide()
            }).on("change:forms",
            function(b, c) {
                a.$(".form-more").hide();
                1 === b.get("pageNo") ? a.$(".j_formlist .j_table").html(d.template("form.cloud.list", {
                    data: c
                })) : a.$(".j_formlist .j_table").append(d.template("form.cloud.list", {
                    data: c
                }));
                b.get("hasNext") && a.$(".form-more").show()
            }).on("change:order",
            function(b, c) {
                var e = c || "default";
                a.$('.j_toolkit a[data-order\x3d"' + e + '"]').hasClass("current") || (a.$(".j_toolkit a").removeClass("current"), a.$('.j_toolkit a[data-order\x3d"' + e + '"]').addClass("current"))
            }).on("change:keyword",
            function(a, b) {
                $("#formsearch-keywords").val() !== b && $("#formsearch-keywords").val(b)
            });
            this.$(".j_formlist").off("click.FormCloud", "a").on("click.FormCloud", "a",
            function() {
                var e = $(this).data("operate"),
                c = $(this).parents(".eform-cloud-item").data("formId"),
                f = $(this).parents(".eform-cloud-item").find(".item-title").text();
                switch (e) {
                case "preview":
                    "biaoge" == a.pageModule ? window.open("/biaoge/preview/" + c + "/biaoge") : "workflow" == a.pageModule && window.open("/biaoge/preview/" + c + "/workflow");
                    break;
                case "copy":
                    a.formoperationView = new b({
                        el: "#copy-form",
                        formId: c,
                        module: a.pageModule,
                        formTitle: f,
                        ownership: "personal",
                        tpl: d.template("flow.formcopy", {
                            userId: a.userId,
                            operationtype: "\u542f\u7528",
                            admin: TEAMS.currentUser.admin,
                            type: "workflow" == a.pageModule ? "\u5ba1\u6279\u8868": "\u8868\u5355"
                        }),
                        copyCallback: function(b) {
                            d.notify(("workflow" == a.pageModule ? "\u5ba1\u6279\u8868": "\u8868\u5355") + "\u542f\u7528\u6210\u529f!");
                            var c;
                            "workflow" == a.pageModule ? c = "personal" == b.form.ownership ? "/workflows/" + TEAMS.currentUser.id + "/personal": "/workflows/" + TEAMS.currentUser.id + "/company": "biaoge" == a.pageModule && (c = "/forms/" + TEAMS.currentUser.id + "/write");
                            ROUTER.navigate(c, {
                                trigger: !0
                            })
                        }
                    }),
                    a.formoperationView.render()
                }
                return ! 1
            });
            this.$(".j_formlabel").off("click.FormCloud", "a[data-label-id]").on("click.FormCloud", "a[data-label-id]",
            function() {
                var b = $(this).parent();
                if (b.hasClass("selected")) {
                    var c = $(this).data("labelId");
                    b.removeClass("selected");
                    $(".j_formresult a[data-label-id\x3d" + c + "]").parent().remove()
                } else b.addClass("selected"),
                $(".j_formresult dl").append(b.clone());
                var e = [];
                $(".j_formresult a[data-label-id]").each(function() {
                    e.add($(this).data("labelId"))
                });
                a.model.getFormByLabels(e);
                return ! 1
            });
            this.$(".j_formresult").off("click.FormCloud", "a[data-label-id]").on("click.FormCloud", "a[data-label-id]",
            function() {
                var b = $(this).data("labelId");
                $(this).parent().remove();
                $(".j_formlabel a[data-label-id\x3d" + b + "]").parent().removeClass("selected");
                var c = [];
                $(".j_formresult a[data-label-id]").each(function() {
                    c.add($(this).data("labelId"))
                });
                a.model.getFormByLabels(c);
                return ! 1
            });
            this.$(".j_toolkit").off("click.FormCloud", "a[data-order]").on("click.FormCloud", "a[data-order]",
            function() {
                var b = $(this),
                c = b.data("order");
                a.$(".j_toolkit a").removeClass("current");
                b.addClass("current");
                c && a.model.sortFormList(c);
                return ! 1
            });
            this.$(".form-more").off("click.FormCloud").on("click.FormCloud",
            function() {
                a.model.nextPage()
            });
            this.$(".j_labelmore").off("click.FormCloud", "span").on("click.FormCloud", "span",
            function() {
                a.$(".j_formlabel").hasClass("formcloud-sub") ? (a.$(".j_formlabel").removeClass("formcloud-sub"), a.$(".j_labelmore i").removeClass().addClass("icon-angle-up")) : (a.$(".j_formlabel").addClass("formcloud-sub"), a.$(".j_labelmore i").removeClass().addClass("icon-angle-down"))
            });
            this.$(".j_toolkit").off("search.FormCloud", "#formsearch-keywords").on("search.FormCloud", "#formsearch-keywords",
            function(b) {
                b = $.trim($(this).val());
                a.model.getFormByKeyword(b)
            });
            this.$(".j_toolkit").off("keyup.FormCloud", "#formsearch-keywords").on("keyup.FormCloud", "#formsearch-keywords",
            function(a) {
                13 == a.which && $(this).trigger("search")
            });
            this.$(".j_toolkit").off("click.FormCloud", ".icon-search").on("click.FormCloud", ".icon-search",
            function(b) {
                b = e.find("#formsearch-keywords");
                b = $.trim(b.val());
                a.model.getFormByKeyword(b)
            });
            this.$("#js_lastUploadForm").off("click.FormCloud").on("click.FormCloud",
            function() {
                $(this).is(":checked") ? a.model.getLastUpload(!0) : (a.model.set({
                    lastUpload: !1,
                    pageNo: "1",
                    order: "default"
                }), a.$('.j_toolkit a[data-order\x3d"default"]').trigger("click"))
            })
        },
        render: function() {
            $(".j_formlist .j_no-result").addClass("hide");
            this.model.load();
            d.layout(".j_formcloudmain");
            this.popularityForm()
        },
        remove: function() {
            $(this.el).off(".FormCloud");
            $(window).off(".FormCloud");
            $(this.el).html("")
        },
        popularityForm: function() {
            var a = this.pageModule;
            this.model.popularityForm({
                pageNo: 1,
                pageSize: 5
            },
            function(b) {
                $.each(b.forms,
                function(b) {
                    var c = $(".j_hotform-wrap .hotform-list:first").clone().show();
                    b += 1;
                    4 <= b && b++;
                    c.find(".catalog-logo img").attr("src", "/static/img/global/formcloudview/" + b + ".png");
                    c.find(".j_formname").attr("title", this.name).text(this.name);
                    c.find(".hotform-card").attr("href", "/biaoge/preview/" + this.id + "/" + a);
                    $(".j_hotform-wrap").append(c)
                })
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formwatchmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        id: "",
        pageNo: 1,
        pageSize: 15,
        formwatch: {
            filter: 1,
            status: 1
        },
        initialize: function(d) {
            d = d || {};
            this.id = d.id;
            this.targetId = d.targetId;
            this._module = d.module;
            this.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
            this.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}")
        },
        load: function(d) {
            var f = this;
            $.ajax({
                type: "get",
                url: "/formmanage/findList.json",
                dataType: "json",
                success: function(b) {
                    f.form = b.form;
                    d && d(b)
                }
            })
        },
        search: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formmanage/search.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        formwatchByDay: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formmanage/formwatchByDay.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formcollectloglistmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        initialize: function(d) {
            this.pageSize = 10;
            this.pageNo = 1
        },
        queryLog: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/queryInCollectLog.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        queryDetailList: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/queryDetailList.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        sendRemindMsg: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/sendRemindMsg.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        sendAllRemindMsg: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/sendAllRemindMsg.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        inCollectSendAgain: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdatareport/inCollectSendAgain.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        queryLogDetail: function(d, f) {
            d.pageSize = this.pageSize;
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/form/queryInCollectLogDetail.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        deleteToDoReport: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/deleteToDoReport.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        beachDeleteToDoReport: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: "/formdatareport/beachDeleteToDoReport.json",
                dataType: "json",
                data: JSON.stringify(d),
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formdistributeview", ["teams/utils", "teams/baidushare/baidushare"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("teams/baidushare/baidushare");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.el = "#formmanageDialog-container";
            $(this.el).html(d.template("formmanage.formdistribute"));
            $(this.el).find(".j_sharetitle").text("\u3010" + b.shareTitle + "\u3011");
            this.$el = $(this.el);
            this.options = b;
            this.create_qccode();
            ZeroClipboard.config({
                swfPath: "/static/swf/clipboard.swf",
                activeClass: "zeroclipboard-is-active"
            });
            this.renderStatus()
        },
        delegateEvents: function() {
            var b = this,
            a = this.$el;
            $("#distributeModal").on("hidden.bs.modal",
            function(a) {
                $("#formdistribute-container").empty()
            });
            $("#create-qccode").off("click").on("click",
            function(a) {
                b.create_qccode()
            });
            $("#distributeModal .btn-image-group .btn-image-item").click(function() {
                var a = $(this);
                a.parent().find(".btn-image-item").removeClass("select unselect");
                a.siblings().addClass("unselect");
                a.addClass("select");
                $("#distributeModal .modal-body .form").addClass("hide");
                a = a.attr("target");
                $(a).removeClass("hide")
            });
            $("#bdTitle").blur(function() {
                var a = $.trim($("#bdTitle").text());
                window._bd_share_config.share[0].bdText = a
            });
            a.find(".j_collect_status").click(function() {
                var e = $(this),
                f = e.data("collect"),
                c = {};
                c["form.collectStatus"] = "disable" == f ? "enable": "disable";
                c["form.id"] = b.options.formId;
                $.ajax({
                    type: "post",
                    url: "/form/updateCollectStatus.json",
                    dataType: "json",
                    data: c,
                    success: function(c) {
                        var g = (c = c.sensitiWor) && 0 < c.length;
                        if (g) {
                            d.notify("\u5f53\u524d\u8868\u5355\u4e2d\u5b58\u5728\u654f\u611f\u8bcd\uff0c\u65e0\u6cd5\u5916\u90e8\u5206\u53d1\uff01");
                            for (var q = "",
                            r = 0; r < c.length; r++) q += '\x3cspan class\x3d"word-item"\x3e' + c[r] + "\x3c/span\x3e";
                            a.find(".j_sensitiWor").removeClass("hide");
                            a.find(".j_sensitiWor .j_swcontent").html(q);
                            d.layout(".j_swcontent", [{
                                gotoTopButton: !1
                            }])
                        }
                        "disable" != f || g ? (e.data("collect", "disable").removeClass("open"), b.options.form.collectStatus = "disable", $(".distribute-form").addClass("disabled"), $(".disabled-shade").removeClass("hide"), $(".js_shareForm").find("a").addClass("disabled")) : (e.data("collect", "enable").addClass("open"), b.options.form.collectStatus = "enable", $(".distribute-form").removeClass("disabled"), $(".disabled-shade").addClass("hide"), $(".js_shareForm").find("a").removeClass("disabled"))
                    }
                })
            });
            if (window.clipboardData) $("#distributeModal").on("click.distributeModal", ".j_invite_link",
            function() {
                window.clipboardData.setData("text", $(this).attr("data-entity"));
                d.notify("\u94fe\u63a5\u5df2\u7ecf\u590d\u5236\u5230\u526a\u8d34\u677f")
            });
            else b.copyLink($("#distributeModal").find(".j_invite_link"));
            b.$el.find(".j_share").off("click", "span").on("click", "span",
            function(a) {
                a = $(this);
                var d = b.options.shareUrl,
                c = b.options.shareTitle;
                a.hasClass("j_qzone") ? window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url\x3d" + d + "\x26title\x3d" + c) : a.hasClass("j_tsina") ? window.open("http://service.weibo.com/share/share.php?url\x3d" + d + "\x26title\x3d" + c) : a.hasClass("j_tqq") ? window.open("http://share.v.t.qq.com/index.php?c\x3dshare\x26a\x3dindex\x26url\x3d" + d + "\x26title\x3d" + c) : a.hasClass("j_mshare") ? window.open("http://s.share.baidu.com/mshare?click\x3d1\x26url\x3d" + d + "\x26title\x3d" + c) : a.hasClass("j_douban") && window.open("http://www.douban.com/share/service?href\x3d" + d + "\x26name\x3d" + c)
            })
        },
        create_qccode: function() {
            $("#copy-text").val(this.options.shareUrl);
            $("#copy-btn").attr("data-entity", this.options.shareUrl);
            $("#qrcode").html("");
            $("#qrcode").qrcode({
                width: 130,
                height: 130,
                correctLevel: 0,
                text: this.options.shareUrl
            });
            $("#qrcode").show()
        },
        baidushare: function(b) {
            $("#bdTitle").text(b.shareTitle);
            b.callback = function(a) {
                "weixin" == a && setTimeout(function() {
                    $("#bdshare_weixin_qrcode_dialog").addClass("weixin_qrcode")
                },
                100)
            };
            this.baidushareView = new f(b)
        },
        renderStatus: function() {
            var b = this.$el;
            "disable" == this.options.form.collectStatus ? (b.find(".j_collect_status").data("collect", "disable").removeClass("open"), $(".distribute-form").addClass("disabled"), $(".disabled-shade").removeClass("hide")) : (b.find(".j_collect_status").data("collect", "enable").addClass("open"), $(".distribute-form").removeClass("disabled"), $(".disabled-shade").addClass("hide"));
            var a = TEAMS.service.biaoge + "/reporttrack.jsp";
            b.find(".j_sharequery").attr("href", a)
        },
        render: function() {},
        copyLink: function(b) {
            var a = new ZeroClipboard(b);
            a.on("ready",
            function() {
                a.on("copy",
                function(a) {
                    a.clipboardData.setData("text/plain", b.attr("data-entity"))
                });
                a.on("aftercopy",
                function(a) {
                    d.notify("\u94fe\u63a5\u5df2\u7ecf\u590d\u5236\u5230\u526a\u8d34\u677f")
                });
                a.on("error",
                function(a) {
                    d.notify(a.messsage)
                })
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formlabeleditview", ["teams/utils", "eteams/biaoge/formmanage/formlabeltreemodel", "teams/component/typeahead"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formlabeltreemodel"),
    b = g("teams/component/typeahead");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.model = new f;
            this.el = a.el;
            this.id = a.id;
            this.name = a.name;
            this.type = a.type;
            this.root = a.root;
            this.parent = a.parent;
            this.rank = a.rank;
            this.options = a;
            $(this.el).html(d.template("formmanage.formlabeledit"));
            d.layout("#formlabel-info");
            this.firstPageLoad = !0;
            this.checkNumberEvent()
        },
        delegateEvents: function() {
            var a = this,
            e = $(a.el);
            e.off("blur.formlabel", "#formlabel-name").on("blur.formlabel", "#formlabel-name",
            function(b) {
                var c = $(b.currentTarget);
                b = $("#formlabel-id").val();
                c = c.val();
                $("#formlabel-name").attr("data-old") != c && (b ? a.saveFormLabelProperty() : a.saveFormLabel())
            });
            e.off("blur.formlabel", "#formlabel-sort").on("blur.formlabel", "#formlabel-sort",
            function(b) {
                var c = $(b.currentTarget);
                b = $("#formlabel-id").val();
                var c = c.val(),
                e = $("#formlabel-sort").attr("data-old");
                "" == $.trim(c) ? ($(this).focus(), d.notify("\u7c7b\u522b\u5e8f\u53f7\u4e0d\u80fd\u4e3a\u7a7a")) : e != c && b && a.saveFormLabelProperty()
            });
            b({
                el: "#formlabel-info #typeahead-formlabel",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b) && a.id != b.id) {
                        var c = $("#formlabel-name").val();
                        a.model.saveFormLabelProperty({
                            id: a.id,
                            parentId: b.id,
                            rank: b.rank + 1,
                            name: c
                        },
                        function(c) {
                            c.message ? d.notify(c.message) : (a.options.parentNode = $("#" + b.id), a.parent.reload(), a.reload(), d.notify("\u4fee\u6539\u6210\u529f"))
                        })
                    }
                },
                resultHandler: function(b) {
                    var c = [];
                    $.each(b,
                    function(b, e) {
                        a.id != e.id && c.push(e)
                    });
                    return c
                }
            })
        },
        checkNumberEvent: function() {
            $(document).on("keydown", "input[componentKey\x3d'NumberComponent']",
            function(a) {
                a = parseInt(a.keyCode);
                var b = $(this).val();
                if ((110 == a || 190 == a) && 0 <= b.indexOf(".") || (109 == a || 173 == a) && 0 <= b.indexOf("-")) return ! 1
            });
            $(document).on("keyup", "input[componentKey\x3d'NumberComponent']",
            function(a) {
                a = $(this).val();
                isNaN(a) && "-" != a && $(this).val(parseFloat(a));
                "." == a.charAt(0) && $(this).val(0 + parseFloat(a))
            });
            $(document).on("keyup", "input[componentKey\x3d'NumberComponent']",
            function(a) {
                a = $(this).val();
                $(this).val(a.replace(/[^\d.-]/g, ""));
                if (null != $(this).parents(".subform_js").get(0)) {
                    a = $(this).attr("name");
                    var b = $(this).parents(".subform_js"),
                    d = b.find('input[name\x3d"' + a + '"]'),
                    d = window.formPlugin.calculateTotal(d);
                    b.find('span[name\x3d"' + a + '"]').html(d)
                }
            });
            $(document).on("blur", "input[componentKey\x3d'NumberComponent']",
            function(a) {
                a = $(this).val();
                $(this).val(a.replace(/[^\d.-]/g, ""));
                if (null != $(this).parents(".subform_js").get(0)) {
                    a = $(this).attr("name");
                    var b = $(this).parents(".subform_js"),
                    d = b.find('input[name\x3d"' + a + '"]'),
                    d = window.formPlugin.calculateTotal(d);
                    b.find('span[name\x3d"' + a + '"]').html(d)
                }
            })
        },
        render: function() {
            "edit" == this.type ? ($("#operType").text("\u4fee\u6539\u7c7b\u522b"), this.root && $("#formlabel-info #formlabel-root").hide(), $("#formlabel-info").removeClass("hide"), $("#formlabel-id").val(this.id), $("#formlabel-name").val(this.name), $("#formlabel-parent").val(this.options.parentNode.attr("id")), $("#formlabelSelector a").text(this.options.parentNode.find(".tree-name").text()), $("#parent-rank").val(this.options.parentNode.attr("data-rank")), $("#formlabel-name").attr("data-old", this.name), this.model.getById(this.id,
            function(a) {
                if (a = a.formLabel.sort) $("#formlabel-sort").attr("data-old", a),
                $("#formlabel-sort").val(a)
            })) : ($("#operType").text("\u6dfb\u52a0\u7c7b\u522b"), "add" == this.type ? this.renderAdd() : this.renderAddRoot(), $("#formlabel-sort").val(0));
            this.firstPageLoad && $("#formlabel-name").focus()
        },
        renderAdd: function() {
            var a = this,
            b = this.model,
            d = a.id,
            c = $("#formlabel-info").removeClass("hide");
            c.find("input:not(#formlabelSelector)").val("");
            c.find("textarea").val("");
            b.getById(d,
            function(b) {
                var e = b.formLabel;
                a.formlabel = b.formLabel;
                c.find("#formlabel-parent").val(e.id);
                c.find("#formlabelSelector a").html(e.name);
                c.find("#parent-rank").val(e.rank)
            })
        },
        saveFormLabel: function() {
            var a = this,
            b = $("#formlabel-info"),
            f = $("#formlabel-name").val();
            if (20 < $.trim(f).length) d.notify("\u7c7b\u522b\u540d\u79f0\u4e0d\u5f97\u8d85\u8fc720\u4e2a\u5b57\u7b26");
            else if (0 == $.trim(f).length) d.notify("\u7c7b\u522b\u540d\u79f0\u4e0d\u5f97\u4e3a\u7a7a");
            else {
                var c = b.find("#formlabel-name").val(),
                k = b.find("#formlabel-parent").val(),
                f = parseInt(b.find("#parent-rank").val()),
                g = b.find("#formlabel-sort").val();
                k ? (f = {
                    formLabel: {
                        name: c,
                        parentId: k,
                        rank: f + 1,
                        sort: g,
                        labelType: "cloud"
                    }
                },
                f = JSON.stringify(f), this.model.saveFormLabel(f,
                function(f) {
                    f.message ? d.notify(f.message) : f.formLabel.id ? (b.find("#formlabel-id").val(f.formLabel.id), $("#formlabel-info").data("formlabel", f.formLabel), f.formLabel.name && a.trigger("addNode", f.formLabel.id), d.notify("\u4fdd\u5b58\u6210\u529f"), a.id = f.formLabel.id, a.name = c, a.options.parentNode = $("#" + k), a.parent.reload(), a.reload()) : d.notify("\u6570\u636e\u9519\u8bef\uff0c\u6dfb\u52a0\u5931\u8d25")
                })) : d.notify("\u4e0a\u7ea7\u7c7b\u522b\u4e0d\u80fd\u4e3a\u7a7a")
            }
        },
        saveFormLabelProperty: function() {
            var a = $("#formlabel-info #formlabel-name"),
            b = this;
            $("#formlabel-info").data("formlabel");
            var f = a.val(),
            a = a.attr("name"),
            c = $("#formlabel-name").val();
            if (20 < $.trim(c).length) $("#formlabel-info").data("formlabelName", c),
            d.notify("\u7c7b\u522b\u540d\u79f0\u4e0d\u5f97\u8d85\u8fc720\u4e2a\u5b57\u7b26");
            else if (0 == $.trim(c).length) d.notify("\u7c7b\u522b\u540d\u79f0\u4e0d\u5f97\u4e3a\u7a7a"),
            $("#formlabel-name").val(formlabelName);
            else {
                var k = "";
                a && (k = a.replace("formLabel.", ""));
                a = {};
                a.id = $("#formlabel-id").val();
                a.name = f;
                a.parentId = $("#formlabel-parent").val();
                "" == a.parentId && (a.parentId = -1);
                a.sort = $("#formlabel-sort").val();
                b.model.saveFormLabelProperty(a,
                function(a) {
                    a.message ? d.notify(a.message) : ("parent.id" === k || "disporder" === k ? b.trigger("rerenderTree") : (b.name = f, b.parent.reload(), b.reload()), d.notify("\u4fdd\u5b58\u6210\u529f"))
                })
            }
        },
        remove: function() {},
        renderAddRoot: function() {
            var a = $("#formlabel-info").removeClass("hide");
            $("#formlabel-info #formlabel-root").hide();
            a.find("#formlabel-parent").val( - 1);
            a.find("#parent-rank").val(0)
        },
        reload: function() {
            view = this;
            view.type = "edit";
            view.firstPageLoad = !1;
            view.render()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formcollectloglistview", ["teams/utils", "eteams/biaoge/formmanage/formcollectloglistmodel", "teams/component/typeahead"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formcollectloglistmodel"),
    b = g("teams/component/typeahead");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.el = a.el;
            this.formId = a.formId;
            $(this.el).html(d.template("formmanage.formcollectloglist"));
            this.model = new f(a)
        },
        delegateEvents: function() {
            var a = this,
            e = $(this.el),
            f = this.model;
            $("body").off("click.FormCollectLogListView", ".goto-top").on("click.FormCollectLogListView", ".goto-top",
            function(a) {
                d.gotoTop()
            });
            e.on("click.FormCollectLogListView", ".pagination .page-first",
            function(b) {
                $(this).hasClass("disabled") || (f.pageNo = 1, a.renderPage(f.pageNo))
            });
            e.on("click.FormCollectLogListView", ".pagination .page-pre",
            function(b) {
                $(this).hasClass("disabled") || (--f.pageNo, a.renderPage(f.pageNo))
            });
            e.on("click.FormCollectLogListView", ".pagination .page-next",
            function(b) {
                $(this).hasClass("disabled") || (++f.pageNo, a.renderPage(f.pageNo))
            });
            e.on("click.FormCollectLogListView", ".pagination .page-last",
            function(b) {
                $(this).hasClass("disabled") || a.renderPage(a.totalPages)
            });
            e.on("click.FormCollectLogListView", "#collectlogContent .j_detail",
            function(b) {
                b = $(this).parent().parent();
                if (b.hasClass("active")) b.find(".detailContentClone").addClass("hide"),
                b.removeClass("active");
                else {
                    var e = $(this).attr("collectId");
                    a.renderDetailPage(1, e, b)
                }
            });
            e.on("click.FormCollectLogListView", "#collectlog-more",
            function(b) {
                b = $(this).data("page");
                var e = $(this).parents(".j_loglist").find(".active .j_detail").attr("collectId"),
                d = $(this).parent().parent().find(".j_logdetaillist");
                a.renderDetailPage(b.nextPage, e, d)
            });
            d.datepicker({
                el: a.el + " #sendStartTime",
                callback: function(b) {
                    b = Date.create(b.date).format("{yyyy}-{MM}-{dd}");
                    var e = $(a.el).find("#sendStartTime"),
                    f = $(a.el).find("#sendEndTime");
                    f.val() && b > f.val() ? (d.notify("\u5f00\u59cb\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65e5\u671f"), e.val("")) : e.val(b)
                }
            });
            d.datepicker({
                el: a.el + " #sendEndTime",
                callback: function(b) {
                    b = Date.create(b.date).format("{yyyy}-{MM}-{dd}");
                    var e = $(a.el).find("#sendStartTime"),
                    f = $(a.el).find("#sendEndTime");
                    e.val() && b < e.val() ? (d.notify("\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65e5\u671f"), f.val("")) : f.val(b)
                }
            });
            b({
                el: a.el + " #sendersDiv #senders",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var d = e.find("#sendersDiv .j_selected");
                        a.renderTypeheader(d, b)
                    }
                }
            });
            e.on("click.FormCollectLogListView", ".btn-search",
            function(b) {
                $(this).removeClass("btn-search");
                e.find("#collectlogContent .j_loglist");
                a.renderPage(1);
                $(this).addClass("btn-search")
            });
            e.on("click.FormCollectLogListView", ".j_send_again",
            function(b) {
                b = {};
                b["userIds[0]"] = $(this).parent().find(".j_accepter").attr("userId");
                b.collectId = $(this).parents(".j_logdetaillist").attr("collectId");
                b["form.id"] = a.formId;
                f.inCollectSendAgain(b,
                function(a) {
                    console.log(a)
                });
                d.notify("\u64cd\u4f5c\u6210\u529f\uff01")
            })
        },
        render: function() {
            this.renderPage(this.model.pageNo);
            d.layout("#collectlog-Content")
        },
        renderPage: function(a) {
            var b = this,
            d = b.model,
            c = {},
            f = $(b.el),
            g = f.find("#sendStartTime").val(),
            q = f.find("#sendEndTime").val(),
            r = [];
            f.find("#sendersDiv .j_optcontainer .j_selected span a").each(function() {
                var a = $(this).attr("id");
                r.push(a)
            });
            c.formId = b.formId;
            c.startTime = $.trim(g);
            c.endTime = $.trim(q);
            c.userIds = r;
            c.pageNo = a;
            d.queryLog(c,
            function(c) {
                c = c.collectLogPage;
                b.totalPages = c.totalPages;
                c = c.result;
                var d = f.find("#collectlogContent .j_loglist");
                1 == a && (null == c || 0 == c.length ? (f.find(".j_collectlog_empty").removeClass("hide"), f.find(".list-sub").addClass("hide"), f.find(".j_page_set").addClass("hide")) : (f.find(".j_collectlog_empty").addClass("hide"), f.find(".list-sub").removeClass("hide"), f.find(".j_page_set").removeClass("hide")));
                d.empty();
                if (null != c) for (var h = 0; h < c.length; h++) {
                    var g = f.find("#collectlogClone li").clone(),
                    s = c[h];
                    g.find(".j_number").text(1 + h + 10 * (a - 1));
                    g.find(".j_opertor").text(s.creator.username);
                    g.find(".j_send_count").text(s.sendCount);
                    g.find(".j_detail").attr("collectId", s.id);
                    g.find(".j_success_failure").text(s.successCount + "/" + s.failureCount);
                    s = Date.create(s.createTime);
                    g.find(".j_send_time").text(s.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")).attr("title", s.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
                    d.append(g)
                }
                f.find(".j_page_set .active a").text("\u7b2c" + a + "/" + b.totalPages + "\u9875");
                b.loadPageControl(a)
            })
        },
        renderDetailPage: function(a, b, d) {
            var c = this.model,
            f = {},
            g = $(this.el);
            f.collectId = b;
            f.pageNo = a;
            c.queryLogDetail(f,
            function(b) {
                b = b.collectLogDetailPage;
                var c = b.result,
                e, f;
                1 == a ? (e = g.find("#collectlogDetailContent ul").clone(), f = e.find(".j_logdetaillist")) : (e = d.parents(".detailContentClone"), f = d);
                b && b.hasNext ? (e.find("#collectlog-more").parent().show(), e.find("#collectlog-more").data("page", b)) : e.find("#collectlog-more").parent().hide();
                1 == a && (f.empty(), null == c || 0 == c.length ? e.find(".j_empty").show() : e.find(".j_empty").hide());
                if (null != c) {
                    f.attr("collectId", c[0].collectId);
                    for (var k = 0; k < c.length; k++) {
                        var l = g.find("#collectlogdetailClone li").clone(),
                        p = c[k];
                        l.find(".j_accepter").text(p.operator.username);
                        l.find(".j_accepter").attr("userId", p.operator.id);
                        "failure" == p.status ? (l.find(".j_success_status").text("\u53d1\u9001\u5931\u8d25"), l.find(".j_send_again").removeClass("hide")) : "success" == p.status ? l.find(".j_success_status").text("\u53d1\u9001\u6210\u529f") : l.find(".j_success_status").text("\u5904\u7406\u4e2d");
                        f.append(l)
                    }
                }
                e.removeClass("hide");
                1 == b.pageNo && d.append(e).addClass("active")
            })
        },
        renderTypeheader: function(a, b) {
            if (b.length) for (var d = 0; d < b.length; d++) {
                var c = b[d],
                f = c.name,
                g = c.id;
                if (f && g) {
                    var q = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + g + "\x3e" + f + "\x3c/a\x3e\x3c/span\x3e";
                    a.find(".entity-item").each(function(a) {
                        g == $(this).find("a").attr("id") && (q = null)
                    });
                    a.append(q)
                }
            } else f = b.name,
            g = b.id,
            f && g && (q = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + g + "\x3e" + f + "\x3c/a\x3e\x3c/span\x3e", a.find(".entity-item").each(function(a) {
                g == $(this).find("a").attr("id") && (q = null)
            }), a.append(q))
        },
        loadPageControl: function(a) {
            $(this.el);
            1 >= this.totalPages ? $(this.el).find(".page-buttons").addClass("disabled") : (1 == a && ($(this.el).find(".page-next").removeClass("disabled"), $(this.el).find(".page-last").removeClass("disabled"), $(this.el).find(".page-first").addClass("disabled"), $(this.el).find(".page-pre").addClass("disabled")), a == this.totalPages && ($(this.el).find(".page-first").removeClass("disabled"), $(this.el).find(".page-pre").removeClass("disabled"), $(this.el).find(".page-next").addClass("disabled"), $(this.el).find(".page-last").addClass("disabled")), 1 != a && a != this.totalPages && ($(this.el).find(".page-first").removeClass("disabled"), $(this.el).find(".page-pre").removeClass("disabled"), $(this.el).find(".page-next").removeClass("disabled"), $(this.el).find(".page-last").removeClass("disabled")))
        },
        remove: function() {
            var a = $(this.el);
            a.off(".FormCollectLogListView");
            a.remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formwatchpage", ["teams/utils", "teams/core/page", "eteams/biaoge/formmanage/formwatchlistview", "eteams/biaoge/formmanage/formwatchchartview"],
function(g, m, l) {
    var d = g("teams/utils");
    m = g("teams/core/page");
    var f = g("eteams/biaoge/formmanage/formwatchlistview"),
    b = g("eteams/biaoge/formmanage/formwatchchartview");
    g = m.extend({
        initialize: function(a) {
            this.el = a.container;
            this.userId = a.userId ? a.userId: TEAMS.currentUser.id;
            $(this.el).html(d.template("formmanage.formwatchpage", {
                userId: this.userId
            }));
            d.layout(this.el);
            this.subType = a.subType
        },
        render: function() {
            this.initLayout({
                userId: this.options.userId ? this.options.userId: TEAMS.currentUser.id,
                self: !this.options.userId || this.options.userId == TEAMS.currentUser.id
            });
            this.mainView = "chart" == this.subType ? new b(this.options) : new f(this.options);
            this.mainView.render()
        },
        delegateEvents: function() {
            var a = this;
            $("#formwatch-page").find(".js_formtab .toolkit-item-tab").click(function() {
                $(this).parent().find(".toolkit-item-tab").removeClass("active");
                $(this).addClass("active");
                a.render()
            })
        },
        load: function(a) {}
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formlabellistmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        id: "",
        pageNo: 1,
        pageSize: 15,
        initialize: function(d) {
            this.pageSize = d.pageSize || this.pageSize
        },
        loadData: function(d, f) {
            var b = $.extend(d, {
                pageNo: this.pageNo,
                pageSize: this.pageSize
            });
            $.ajax({
                url: "/form/findFormLabelData.json",
                type: "post",
                dataType: "json",
                data: b,
                success: function(a) {
                    f && f(a)
                }
            })
        },
        findCateAndCloud: function(d, f) {
            $.ajax({
                url: "/form/findCateAndCloud.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        saveFormLabelLink: function(d, f) {
            $.ajax({
                url: "/form/saveFormLabelLink.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        findFormSelectData: function(d, f) {
            $.ajax({
                url: "/form/findFormSelectData.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        deleteFormLabelLink: function(d, f) {
            $.ajax({
                url: "/form/deleteFormLabelLink.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        updateFormStatus: function(d, f) {
            $.ajax({
                url: "/form/updateStatus.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        updateFormRecommend: function(d, f) {
            $.ajax({
                url: "/form/recommend.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formlabeltreemodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        loadData: function(d) {
            $.ajax({
                url: "/form/findFormLaberAll.json",
                type: "post",
                dataType: "json",
                success: function(f) {
                    d && d(f)
                }
            })
        },
        saveFormLabelProperty: function(d, f) {
            $.ajax({
                url: "/form/updateFormLabel.json",
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                dataType: "json",
                data: JSON.stringify({
                    params: d
                }),
                success: function(b) {
                    f && f(b)
                }
            })
        },
        getById: function(d, f) {
            $.ajax({
                url: "/form/getById.json",
                type: "post",
                dataType: "json",
                data: {
                    labelId: d
                },
                success: function(b) {
                    f && f(b)
                }
            })
        },
        saveFormLabel: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                url: "/form/saveFormLabel.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        },
        deleteFormLabel: function(d, f) {
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                url: "/form/deleteFormLabel.json",
                type: "post",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formwatchlistview", ["teams/utils", "eteams/biaoge/formmanage/formwatchmodel", "teams/component/filter", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formwatchmodel");
    g("teams/component/filter");
    var b = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.el = "#j_formContent";
            $(this.el).html(d.template("formmanage.formwatchlist"));
            this.model = new f;
            d.layout("#j_formContent #formwatch-list");
            this.keywords = ""
        },
        delegateEvents: function() {
            var a = this,
            b = this.model,
            f = $("#formwatch-list");
            $("body").off("click.FormWatchList", ".goto-top").on("click.FormWatchList", ".goto-top",
            function(a) {
                d.gotoTop("#formwatch-list")
            });
            f.off("click.status", ".status .tzCheckBox").on("click.status", ".status .tzCheckBox",
            function(b) {
                var e = $(this).parent().parent(),
                f = e.find(".index").attr("data-id"),
                h;
                $(this).hasClass("open") ? (h = "enable", b = "\u8868\u5355\u5f53\u524d\u72b6\u6001\u4e3a\u542f\u7528\uff0c\u662f\u5426\u7981\u7528\u8868\u5355\uff1f") : (h = "disable", b = "\u8868\u5355\u5f53\u524d\u72b6\u6001\u4e3a\u7981\u7528\uff0c\u662f\u5426\u542f\u7528\u8868\u5355\uff1f");
                d.confirm(b,
                function(b) {
                    b && a.updateStatus({
                        "form.id": f,
                        "form.status": h
                    },
                    e)
                })
            });
            f.on("click.toolkit-list", "#check-all",
            function() {
                var a = !1;
                $(this).hasClass("icon-checkbox-checked") && (a = !0);
                a ? $("#form-list .index span.checkbox").not(":first").each(function() {
                    $(this).find("i").removeClass("icon-checkbox-checked").addClass("icon-checkbox-unchecked");
                    $(this).addClass("hide");
                    $(this).parent("th").removeClass("selected");
                    $(this).prev().removeClass("hide")
                }) : $("#form-list .index span.checkbox").not(":first").each(function() {
                    $(this).find("i").addClass("icon-checkbox-checked").removeClass("icon-checkbox-unchecked");
                    $(this).removeClass("hide");
                    $(this).parent("th").addClass("selected");
                    $(this).prev().addClass("hide")
                });
                $(this).toggleClass("icon-checkbox-checked").toggleClass("icon-checkbox-unchecked")
            });
            f.on("click.index", ".checkbox",
            function() {
                var a = !1;
                $(this).find("i").hasClass("icon-checkbox-checked") && (a = !0);
                a ? $(this).parent("th").removeClass("selected") : $(this).parent("th").addClass("selected");
                $(this).find("i").toggleClass("icon-checkbox-checked").toggleClass("icon-checkbox-unchecked")
            });
            f.on("mouseenter.table", "tbody tr",
            function(a) {
                a = !1;
                $(this).find(".index").hasClass("selected") && (a = !0);
                a || ($(this).find(".sn").addClass("hide"), $(this).find(".checkbox").removeClass("hide"))
            }).on("mouseleave.table", "tbody tr",
            function(a) {
                a = !1;
                $(this).find(".index").hasClass("selected") && (a = !0);
                a || ($(this).find(".sn").removeClass("hide"), $(this).find(".checkbox").addClass("hide"))
            });
            f.on("click.toolkit-list", ".j_batch",
            function(b) {
                var e = "disable";
                b = "\u542f\u7528";
                $(this).hasClass("watch-disable") && (e = "enable", b = "\u7981\u7528");
                d.confirm("\u786e\u8ba4" + b + "\u9009\u4e2d\u7684\u8868\u5355\uff1f",
                function(b) {
                    b && $("#form-list tbody th.selected").each(function() {
                        var b = $(this).parent(),
                        c = {
                            "form.id": b.find(".index").attr("data-id"),
                            "form.status": e
                        };
                        a.updateStatus(c, b)
                    })
                })
            });
            f.on("click.toolkit-list", ".orderType",
            function() {
                $(".orderType").parent("li").removeClass("active");
                $(this).parent("li").addClass("active");
                $("#formwatch-order").attr("data-entity", $(this).attr("data-entity"));
                $("#formwatch-order").attr("data-direction", $(this).attr("data-direction"));
                b.pageNo = 1;
                a.search()
            });
            f.on("search.toolkit-list", "#formsearch-keywords",
            function(c) {
                b.pageNo = 1;
                a.keywords = $.trim($("#formsearch-keywords").val());
                a.search()
            });
            f.on("keyup.toolkit-list", "#formsearch-keywords",
            function(a) {
                13 == (a ? a: window.event ? window.event: null).keyCode && $(this).trigger("search")
            });
            $(a.el).find(".page-first").click(function() {
                $(this).hasClass("disabled") || (b.pageNo = 1, a.search())
            });
            $(a.el).find(".page-pre").click(function() {
                $(this).hasClass("disabled") || (--b.pageNo, a.search())
            });
            $(a.el).find(".page-next").click(function() {
                $(this).hasClass("disabled") || (++b.pageNo, a.search())
            })
        },
        render: function() {
            this.renderFormWatchList(this.filterType)
        },
        renderFormWatchList: function(a) {
            this.load(a)
        },
        search: function() {
            $("#formwatch-loading").removeClass("hide");
            var a = this,
            b = a.model,
            d = a.keywords,
            c = "";
            if ("undefined" != typeof $("#formwatch-order").attr("data-entity")) var c = $("#formwatch-order").attr("data-entity"),
            f = $("#formwatch-order").attr("data-direction"),
            c = "default" == c ? "": "C." + c + " " + f;
            else c = "C.create_time DESC";
            d = {
                formManage: {
                    name: d,
                    sortType: c
                },
                pageNo: b.pageNo,
                pageSize: b.pageSize
            };
            d = JSON.stringify(d);
            b.search(d,
            function(b) {
                $("#fromwatchlist-loading").addClass("hide");
                var c = $("#form-list tbody");
                $("#form-list tbody tr").not(":first").detach();
                $.each(b.page.result,
                function(a) {
                    var b = $("#form-list tbody tr:first").clone().removeClass("hide");
                    b.find(".index .sn").text(a + 1);
                    b.find(".index").attr("data-id", this.id);
                    b.find(".name").html('\x3ca href\x3d"/form/preview/' + this.id + '" target\x3d"_blank"\x3e' + this.name + "\x3c/a\x3e");
                    b.find(".user").text(this.operator ? this.operator.name: "");
                    "enable" == this.status && b.find(".status .tzCheckBox").addClass("open checked").attr("title", "\u7981\u7528\u8868\u5355");
                    b.find(".viewCount").text(this.viewCount);
                    b.find(".copyCount").text(this.copyCount);
                    b.find(".submit-counts").text(this.fillCount);
                    b.find(".createTime").text((new Date(this.createTime)).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
                    b.appendTo(c)
                });
                a.loadPage(b.page)
            })
        },
        load: function(a) {
            this.model.pageNo = 1;
            this.search()
        },
        updateStatus: function(a, e) { (new b).updateStatus(a,
            function(b) {
                "enable" == a["form.status"] ? e.find(".status .tzCheckBox").removeClass("open").attr("title", "\u542f\u7528\u8868\u5355") : e.find(".status .tzCheckBox").addClass("open").attr("title", "\u7981\u7528\u8868\u5355")
            })
        },
        loadPage: function(a) {
            var b = this,
            d = b.model;
            0 >= a.totalCount ? ($(b.el).find(".page-last").unbind("click"), $(b.el).find(".page-buttons").addClass("disabled"), $(b.el).find(".pagination").find(".active a").html("\u65e0\u8bb0\u5f55")) : ($(b.el).find(".pagination").find(".active a").html("\u7b2c" + a.pageNo + "/" + a.totalPages + "\u9875"), 1 == a.totalPages ? $(b.el).find(".page-buttons").addClass("disabled") : ($(b.el).find(".page-last").click(function() {
                $(this).hasClass("disabled") || (d.pageNo = a.totalPages, b.search())
            }), 1 == a.pageNo && ($(b.el).find(".page-next").removeClass("disabled"), $(b.el).find(".page-last").removeClass("disabled"), $(b.el).find(".page-first").addClass("disabled"), $(b.el).find(".page-pre").addClass("disabled")), a.pageNo == a.totalPages && ($(b.el).find(".page-first").removeClass("disabled"), $(b.el).find(".page-pre").removeClass("disabled"), $(b.el).find(".page-next").addClass("disabled"), $(b.el).find(".page-last").addClass("disabled")), 1 != a.pageNo && a.pageNo != a.totalPages && ($(b.el).find(".page-first").removeClass("disabled"), $(b.el).find(".page-pre").removeClass("disabled"), $(b.el).find(".page-next").removeClass("disabled"), $(b.el).find(".page-last").removeClass("disabled")), $("#formwatch-list .pagination-centered").removeClass("hide")))
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formlabelpageview", ["teams/utils", "eteams/biaoge/formmanage/formlabeltreeview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formlabeltreeview");
    g = Backbone.View.extend({
        teams: {},
        initialize: function(b) {
            this.id = b.id;
            this.el = b.el;
            this.noUrl = b.noUrl;
            $(this.el).html(d.template("formmanage.formlabelpage"));
            this.formLabelTreeView = new f({
                el: this.el + " #form-tree-list",
                readonly: this.readonly,
                noUrl: this.noUrl
            });
            TEAMS.currentUser.admin || $(this.el).find("#add-root").hide();
            d.layout("#form-tree")
        },
        delegateEvents: function() {
            var b = this;
            $(b.el).on("click.departmenttree", "#organization-users",
            function(a) {
                $(b.el).find("#organization-users").parent().addClass("active");
                $(b.el).find("#group-users").parent().removeClass("active");
                $(b.el).find("#org-tree-list").removeClass("hide");
                $(b.el).find("#org-group-list").addClass("hide");
                $(b.el).find(".root").trigger("click")
            });
            $(b.el).on("click.departmenttree", ".nodeicon",
            function(a) {
                $(this).toggleClass("icon-caret-right");
                $(this).toggleClass("icon-caret-down");
                $(this).parent(".treenode").next().slideToggle("fast")
            })
        },
        render: function() {
            var b = this,
            a = b.id,
            d = $(b.el),
            f = b.type;
            this.formLabelTreeView.render(a,
            function() {
                "department" == f ? b.formLabelTreeView.highLight(a) : a && 0 < d.find("#" + b.id).length ? d.find("#" + b.id).trigger("click") : $("#formlabel-all").trigger("click")
            });
            $(b).find("#organization-users").trigger("click")
        },
        remove: function() {
            $(this.el).html("");
            this.formLabelTreeView && (this.formLabelTreeView.remove(), this.formLabelTreeView = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formwatchchartview", ["teams/utils", "teams/component/typeahead", "eteams/biaoge/formmanage/formwatchmodel"],
function(g, m, l) {
    var d = g("teams/utils");
    g("teams/component/typeahead");
    var f = g("eteams/biaoge/formmanage/formwatchmodel");
    m = Backbone.View.extend({
        initialize: function(b) {
            b = d.template("formmanage.formwatchchart");
            $("#j_formContent").html(b);
            this.el = "#formwatchchartview";
            this.$el = $("#formwatchchartview");
            this.model = new f;
            this.initComponents();
            d.layout("#j_formContent #formwatchchartview")
        },
        initComponents: function() {
            var b = this,
            a = b.model;
            d.datepicker([{
                el: "#begin-date",
                callback: function(d) {
                    var f = d.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(f, a.endDate) ? a.beginDate = f || a.beginDate: d.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            },
            {
                el: "#end-date",
                callback: function(d) {
                    var f = d.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(a.beginDate, f) ? a.endDate = f || a.endDate: d.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            }]);
            b.$el.find("#begin-date").val(a.beginDate);
            b.$el.find("#end-date").val(a.endDate);
            b.$el.find('[data\x3d"thisMonth"]').addClass("btn-success")
        },
        isBefore: function(b, a) {
            if (b && a) {
                if (Date.create(b).isBefore(a, 864E5)) return ! 0;
                d.notify("\u8bf7\u786e\u8ba4\u8f93\u5165\u7684\u8d77\u59cb\u65e5\u5728\u5230\u671f\u65e5\u4e4b\u524d");
                return ! 1
            }
            return ! 0
        },
        delegateEvents: function() {
            var b = this,
            a = b.model;
            $("body").off("click.formwatchreport", ".goto-top").on("click.formwatchreport", ".goto-top",
            function(a) {
                d.gotoTop("#formwatchchartview")
            });
            b.$el.on("click.formwatchreport", ".j_time a",
            function(d) {
                switch ($(d.target).attr("data")) {
                case "thisWeek":
                    a.beginDate = Date.create().beginningOfWeek().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "last2weeks":
                    a.beginDate = Date.create().beginningOfWeek().addDays( - 7).format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "thisMonth":
                    a.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}");
                    break;
                case "lastMonth":
                    a.beginDate = Date.create().addMonths( - 1).beginningOfMonth().format("{yyyy}-{MM}-{dd}"),
                    a.endDate = Date.create().addMonths( - 1).endOfMonth().format("{yyyy}-{MM}-{dd}")
                }
                b.$el.find("#begin-date").val(a.beginDate);
                b.$el.find("#end-date").val(a.endDate);
                b.$el.find(".j_time .btn").removeClass("btn-success");
                $(this).addClass("btn-success");
                b.loadDayChart()
            });
            b.$el.on("click.formwatchreport", "#load",
            function() {
                b.$el.find(".j_time .btn").removeClass("btn-success");
                b.loadDayChart()
            })
        },
        remove: function() {
            this.$el.off(".formwatchreport");
            this.dayChart && ($(window).off("resize", this.dayChart.resize), this.dayChart.dispose(), this.dayChart = null);
            this.finishChart && ($(window).off("resize", this.finishChart.resize), this.finishChart.dispose(), this.finishChart = null);
            this.urgencyChart && ($(window).off("resize", this.urgencyChart.resize), this.urgencyChart.dispose(), this.urgencyChart = null);
            this.stopListening();
            this.model = null
        },
        render: function(b, a) {
            var e = this;
            d.layout("#j_formContent");
            g.async("https://static.eteams.cn/js/echarts.min.js",
            function() {
                e.initCharts();
                e.loadDayChart()
            })
        },
        dayChartBasicOption: {
            title: {
                text: "\u8868\u5355\u65b0\u5efa\u8d8b\u52bf\u7edf\u8ba1"
            },
            tooltip: {
                trigger: "item"
            },
            legend: {
                data: [""]
            },
            calculable: !0,
            toolbox: {
                show: !0,
                feature: {
                    magicType: {
                        show: !0,
                        type: ["bar", "line"]
                    },
                    restore: {
                        show: !0
                    },
                    saveAsImage: {
                        show: !0
                    }
                }
            },
            dataZoom: {
                show: !0,
                start: 5,
                end: 95
            },
            yAxis: [{
                type: "value"
            }],
            color: ["#3AEC94"]
        },
        dayChart: null,
        initCharts: function() {
            var b;
            b = this.dayChart = echarts.init(document.getElementById("day-chart"), "macarons");
            $(window).on("resize", b.resize)
        },
        loadDayChart: function() {
            var b = this;
            if (b.dayChart) {
                var a = b.dayChart;
                a.showLoading({
                    effect: "spin"
                });
                var e = b.$el.find("#begin-date").val(),
                f = b.$el.find("#end-date").val() + " 24:00:00",
                e = {
                    formManage: {
                        beginDate: e,
                        endDate: f
                    }
                },
                e = JSON.stringify(e);
                b.model.formwatchByDay(e,
                function(c) {
                    a.hideLoading();
                    var d = [],
                    e = [];
                    $.each(c.list,
                    function() {
                        d.push((new Date(this.createTime)).format("{yyyy}-{MM}-{dd}"));
                        e.push(this.submitCounts)
                    });
                    c = _.extend({
                        xAxis: [{
                            type: "category",
                            data: d
                        }],
                        series: [{
                            name: "\u8868\u5355\u65b0\u5efa\u91cf",
                            type: "bar",
                            data: e
                        }]
                    },
                    b.dayChartBasicOption);
                    a.setOption(c, !0)
                })
            } else d.alert("\u672a\u627e\u5230\u56fe\u8868\u7ec4\u4ef6\uff0c\u8bf7\u786e\u8ba4\u9875\u9762\u52a0\u8f7d\u6b63\u786e")
        }
    });
    l.exports = m
});
define("eteams/biaoge/formmanage/formlabellistview", ["teams/utils", "eteams/biaoge/formmanage/formlabellistmodel", "eteams/biaoge/form/formoperationview", "eteams/biaoge/formmanage/formselectview", "eteams/biaoge/form/formmanagemodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formlabellistmodel"),
    b = g("eteams/biaoge/form/formoperationview"),
    a = g("eteams/biaoge/formmanage/formselectview"),
    e = g("eteams/biaoge/form/formmanagemodel");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.el = a.el;
            this.id = a.id;
            this.model = new f({
                pageSize: 15
            });
            this.parent = a.parent;
            this.page = null;
            $(this.el).html(d.template("formmanage.formlabellist"));
            this.keywords = "";
            this.render();
            d.layout("#form-table-list");
            $("#formlabelid").val(this.id);
            null == this.id && ($(this.el).find(".js_buildNewForm").remove(), $(this.el).find(".js_addLinkForm").remove(), $(this.el).find(".j_clearAll").remove())
        },
        render: function() {
            var a = "";
            if ("undefined" != typeof $("#form-order").attr("data-entity")) var a = $("#form-order").attr("data-entity"),
            b = $("#form-order").attr("data-direction"),
            a = "default" == a ? "": "F." + a + " " + b;
            else a = "F.create_time desc";
            var d = this;
            d.model.loadData({
                "formLabel.id": d.id,
                "formLabel.sortType": a,
                "formLabel.name": d.keywords
            },
            function(a) {
                d.page = a.formPage;
                $("#formLabelClone tbody tr").not(":first").detach();
                for (var b = 0; b < a.formPage.result.length; b++) d.loadFormList(b + 1, a.formPage.result[b]);
                d.loadPage(d.page)
            });
            $(d.el).find("#formLabelListClone").removeClass("hide");
            $(d.el).find("#employee-container").addClass("hide")
        },
        delegateEvents: function() {
            var f = this,
            c = f.model,
            g = $("#formLabelListClone");
            $("body").off("click.formLabelList", ".goto-top").on("click.formLabelList", ".goto-top",
            function(a) {
                d.gotoTop("#form-table-list")
            });
            $("#formLabelListClone .orderType").click(function() {
                $(".orderType").parent("li").removeClass("active");
                $(this).parent("li").addClass("active");
                $("#form-order").attr("data-entity", $(this).attr("data-entity"));
                $("#form-order").attr("data-direction", $(this).attr("data-direction"));
                c.pageNo = 1;
                f.render()
            });
            g.on("search.formLabelList", "#formsearch-keywords",
            function(a) {
                c.pageNo = 1;
                f.keywords = $.trim(g.find("#formsearch-keywords").val());
                f.render()
            });
            g.on("keyup.formLabelList", "#formsearch-keywords",
            function(a) {
                13 == (a ? a: window.event ? window.event: null).keyCode && $(this).trigger("search")
            });
            $(f.el).find(".page-first").click(function() {
                $(this).hasClass("disabled") || (c.pageNo = 1, f.render())
            });
            $(f.el).find(".page-pre").click(function() {
                $(this).hasClass("disabled") || (--c.pageNo, f.render())
            });
            $(f.el).find(".page-next").click(function() {
                $(this).hasClass("disabled") || (++c.pageNo, f.render())
            });
            g.on("click.formLabelList", ".js_buildNewForm",
            function() {
                var a = {
                    module: "cloud",
                    formLabelId: f.id,
                    el: "#build-newform"
                };
                a.parentEl = f.el;
                a.tpl = d.template("flow.formnew", {
                    userId: TEAMS.currentUser.id,
                    admin: TEAMS.currentUser.admin,
                    type: "\u8868\u5355"
                });
                a.ownership = "cloud";
                a.saveCallback = function(a) {
                    a.message ? d.notify(a.message) : (f.parent.reload(), f.render())
                };
                f.formoperationView = new b(a);
                f.formoperationView.render()
            });
            $("#btn_addForm").click(function() {
                f.model.findCateAndCloud({
                    pageNo: 1
                },
                function(a) {
                    f.loadCloudForm(a)
                })
            });
            g.find(".js_addLinkForm").click(function() { (new a({
                    "formLabel.id": f.id,
                    parent: f
                })).findFormSelectData()
            });
            g.on("click.formLabelList", "#check-all",
            function() {
                var a = !1;
                $(this).hasClass("icon-checkbox-checked") && (a = !0);
                a ? $("#formLabelClone tbody #index span.checkbox").not(":first").each(function() {
                    $(this).find("i").removeClass("icon-checkbox-checked").addClass("icon-checkbox-unchecked");
                    $(this).addClass("hide");
                    $(this).parent("th").removeClass("selected");
                    $(this).prev().removeClass("hide")
                }) : $("#formLabelClone tbody #index span.checkbox").not(":first").each(function() {
                    $(this).find("i").addClass("icon-checkbox-checked").removeClass("icon-checkbox-unchecked");
                    $(this).removeClass("hide");
                    $(this).parent("th").addClass("selected");
                    $(this).prev().addClass("hide")
                });
                $(this).toggleClass("icon-checkbox-checked").toggleClass("icon-checkbox-unchecked")
            });
            g.on("click.formLabelList", ".checkbox",
            function() {
                var a = !1;
                $(this).find("i").hasClass("icon-checkbox-checked") && (a = !0);
                a ? $(this).parent("th").removeClass("selected") : $(this).parent("th").addClass("selected");
                $(this).find("i").toggleClass("icon-checkbox-checked").toggleClass("icon-checkbox-unchecked")
            });
            $("#js_deletelink").click(function() {
                d.confirm("\u786e\u8ba4\u5220\u9664\u9009\u4e2d\u7684\u5173\u8054\u8868\u5355\uff1f",
                function(a) {
                    a && (f.deleteFormlabelLink(), f.render())
                })
            });
            g.off("click.formLabelList", "#status .tzCheckBox").on("click.formLabelList", "#status .tzCheckBox",
            function(a) {
                var b = $(this).parent().parent(),
                c = b.find("#index").attr("data-id"),
                e;
                $(this).hasClass("open") ? (e = "enable", a = "\u8868\u5355\u5f53\u524d\u72b6\u6001\u4e3a\u542f\u7528\uff0c\u662f\u5426\u7981\u7528\u8868\u5355\uff1f") : (e = "disable", a = "\u8868\u5355\u5f53\u524d\u72b6\u6001\u4e3a\u7981\u7528\uff0c\u662f\u5426\u542f\u7528\u8868\u5355\uff1f");
                d.confirm(a,
                function(a) {
                    a && f.updateFormStatus({
                        "form.id": c,
                        "form.status": e
                    },
                    b)
                })
            });
            g.off("click.formLabelList", "#recommend .j_star").on("click.formLabelList", "#recommend .j_star",
            function(a) {
                var b = $(this).parent().parent().parent(),
                c = b.find("#index").attr("data-id"),
                e;
                $(this).hasClass("icon-star") ? (e = 0, a = "\u786e\u5b9a\u53d6\u6d88\u63a8\u8350\u8be5\u8868\u5355\uff1f") : (e = 1, a = "\u786e\u5b9a\u63a8\u8350\u8be5\u8868\u5355\uff1f");
                d.confirm(a,
                function(a) {
                    a && f.updateFormRecommend({
                        formId: c,
                        recommend: e
                    },
                    b)
                })
            });
            g.off("click.formLabelList", "#operation .j_operationType").on("click.formLabelList", "#operation .j_operationType",
            function(a) {
                var b = $(this).parent().parent().attr("data-formId");
                switch ($(this).attr("data-operatype")) {
                case "edit":
                    window.open("/form/edit/" + b);
                    break;
                case "delete":
                    a = "\u786e\u8ba4\u5220\u9664\u8be5\u8868\u5355\uff1f";
                    var g = new e;
                    d.confirm(a,
                    function(a) {
                        a && g.deleteForm({
                            formId: b
                        },
                        function(a) {
                            a.message ? d.notify(a.message) : (f.parent.reload(), f.render())
                        })
                    });
                    break;
                case "deletelink":
                    d.confirm("\u786e\u8ba4\u5220\u9664\u8be5\u8868\u5355\u4e0e\u7c7b\u522b\u7684\u5173\u8054\uff1f",
                    function(a) {
                        a && c.deleteFormLabelLink({
                            "formLabel.id": f.id,
                            ids: b
                        },
                        function(a) {
                            a.message ? d.notify(a.message) : (f.parent.reload(), f.render())
                        })
                    });
                    break;
                case "rename":
                    a = $(this).parents("tr").find("#title");
                    var k = a.find("a").text();
                    a.html('\x3cinput class\x3d"form-control" type\x3d"text" data-old\x3d"' + k + '" value\x3d"" maxlength\x3d"100" \x3e').addClass("input");
                    a.find("input").focus().val(k)
                }
            });
            g.find("#formLabelClone").off("blur.formLabelList", "#title input").on("blur.formLabelList", "#title input",
            function(a) {
                var b = $(this);
                a = $.trim(b.val());
                var c = b.parent(),
                f = c.parent().find("#index").attr("data-id"),
                h = b.attr("data-old"),
                g = '\x3ca target\x3d"_blank" href\x3d"/form/preview/' + f + '"\x3e' + a + "\x3c/a\x3e";
                h == a ? c.html(g).removeClass("input") : "" == a ? (b.focus(), d.notify("\u8868\u5355\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a")) : (new e).renameForm({
                    formId: f,
                    formName: a
                },
                function(a) {
                    a.message ? (b.focus(), d.notify(a.message)) : c.html(g).removeClass("input")
                })
            });
            g.off("click.formLabelList", ".j_clearAll").on("click.formLabelList", ".j_clearAll",
            function(a) {
                a = "\u786e\u8ba4\u6e05\u7a7a" + $("#form-tree-list .treenode.selected .tree-name").text() + "\u7c7b\u522b\u4e0b\u6240\u6709\u5173\u8054\uff1f";
                d.confirm(a,
                function(a) {
                    a && c.deleteFormLabelLink({
                        "formLabel.id": f.id
                    },
                    function(a) {
                        a.message ? d.notify(a.message) : (f.parent.reload(), f.render())
                    })
                })
            })
        },
        loadFormList: function(a, b) {
            var d = $(this.el).find("#formLabelClone tbody tr:first").clone().show();
            d.find("#index .sn").text(a);
            d.find("#index").attr("data-id", b.id);
            d.find("#title").html("\x3ca href\x3d'/form/preview/" + b.id + "' target\x3d'_blank' title\x3d'" + b.name + "'\x3e" + b.name + "\x3c/a\x3e");
            d.find("#createTime").html((new Date(b.createTime)).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
            d.find("#showNum").html(b.viewCount);
            d.find("#saveNum").html(b.copyCount);
            d.find("#operation .dropdown-menu").attr("data-formId", b.id);
            "enable" == b.status && (d.find("#status .tzCheckBox").addClass("open checked").attr("title", "\u7981\u7528\u8868\u5355"), b.recommend ? d.find("#recommend .j_star").addClass("icon-star").attr("title", "\u53d6\u6d88\u63a8\u8350") : d.find("#recommend .j_star").addClass("icon-star-empty").attr("title", "\u63a8\u8350"));
            if (b.formlabels) {
                for (var e = [], f = 0; f < b.formlabels.length; f++) e.push(b.formlabels[f].name);
                e = e.join("\uff0c");
                d.find("#includeLabels").text(e).attr("title", e)
            }
            d.appendTo($(this.el).find("#formLabelClone tbody"))
        },
        loadPage: function(a) {
            var b = this,
            d = b.model;
            0 >= a.totalCount ? ($(b.el).find(".page-last").unbind("click"), $(b.el).find(".page-buttons").addClass("disabled"), $(b.el).find(".pagination").find(".active a").html("\u65e0\u8bb0\u5f55")) : ($(b.el).find(".pagination").find(".active a").html("\u7b2c" + a.pageNo + "/" + a.totalPages + "\u9875"), 1 == a.totalPages ? $(b.el).find(".page-buttons").addClass("disabled") : ($(b.el).find(".page-last").click(function() {
                $(this).hasClass("disabled") || (d.pageNo = a.totalPages, b.render())
            }), 1 == a.pageNo && ($(b.el).find(".page-next").removeClass("disabled"), $(b.el).find(".page-last").removeClass("disabled"), $(b.el).find(".page-first").addClass("disabled"), $(b.el).find(".page-pre").addClass("disabled")), a.pageNo == a.totalPages && ($(b.el).find(".page-first").removeClass("disabled"), $(b.el).find(".page-pre").removeClass("disabled"), $(b.el).find(".page-next").addClass("disabled"), $(b.el).find(".page-last").addClass("disabled")), 1 != a.pageNo && a.pageNo != a.totalPages && ($(b.el).find(".page-first").removeClass("disabled"), $(b.el).find(".page-pre").removeClass("disabled"), $(b.el).find(".page-next").removeClass("disabled"), $(b.el).find(".page-last").removeClass("disabled")), b.$el.find(".pagination-centered").removeClass("hide")))
        },
        remove: function() {
            var a = $(this.el);
            a.off("#formLabel");
            a.remove()
        },
        loadCloudForm: function(a) {
            var b = $("#cloudformlist_dialog .modal-body tbody");
            b.find("tr").not(":first").detach();
            $.each(a.formCategories,
            function() {
                var a = b.find("tr:first").clone().show();
                a.find("#index").text("");
                a.find("#title").text("");
                a.find("#desc").text("");
                a.appendTo(b)
            })
        },
        deleteFormlabelLink: function() {
            var a = this,
            b = a.model,
            d = [];
            $("#formLabelClone tbody th.selected").each(function() {
                d.push($(this).attr("data-id"))
            });
            b.deleteFormLabelLink({
                "formLabel.id": a.id,
                ids: d
            },
            function(b) {
                a.parent.reload()
            })
        },
        updateFormStatus: function(a, b) {
            this.model.updateFormStatus(a,
            function(d) {
                "enable" == a["form.status"] ? (b.find("#status .tzCheckBox").removeClass("open").attr("title", "\u542f\u7528\u8868\u5355"), b.find("#recommend .j_star").removeClass("icon-star icon-star-empty")) : (b.find("#status .tzCheckBox").addClass("open").attr("title", "\u7981\u7528\u8868\u5355"), b.find("#recommend .j_star").removeClass("icon-star"), b.find("#recommend .j_star").addClass("icon-star-empty").attr("title", "\u63a8\u8350"))
            })
        },
        updateFormRecommend: function(a, b) {
            this.model.updateFormRecommend(a,
            function(d) {
                0 == a.recommend ? (b.find("#recommend .j_star").removeClass("icon-star icon-star-empty"), b.find("#recommend .j_star").addClass("icon-star-empty").attr("title", "\u63a8\u8350")) : (b.find("#recommend .j_star").removeClass("icon-star icon-star-empty"), b.find("#recommend .j_star").addClass("icon-star").attr("title", "\u53d6\u6d88\u63a8\u8350"))
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formselectview", ["teams/utils", "teams/baidushare/baidushare", "eteams/biaoge/formmanage/formlabellistmodel"],
function(g, m, l) {
    var d = g("teams/utils");
    g("teams/baidushare/baidushare");
    var f = g("eteams/biaoge/formmanage/formlabellistmodel");
    g = Backbone.View.extend({
        pageNo: 1,
        pageSize: 10,
        initialize: function(b) {
            this.el = "#formselect_Container";
            this.$el = $(this.el);
            this.model = new f({
                pageSize: 10
            });
            this.options = b;
            this.id = b["formLabel.id"];
            this.page = null;
            this.parent = b.parent;
            $(this.el).html(d.template("formmanage.select"));
            d.layout("#formselect_Container .modal-body")
        },
        delegateEvents: function() {
            var b = this,
            a = b.$el,
            e = b.model;
            a.find("#check-all").click(function() {
                a.find("tbody tr:visible").find("#index input").prop("checked", $(this).is(":checked"))
            });
            a.find("#btnSave").click(function() {
                var a = [];
                $("#select-form-list tbody th.selected").each(function() {
                    var b = $(this).parent().find(".index").attr("data-id");
                    a.push(b)
                });
                a = a.join(",");
                b.model.saveFormLabelLink({
                    "params.formids": a,
                    "params.formlableid": b.id
                },
                function(a) {
                    b.$el.find("#formselect").modal("hide");
                    $("#form-tree-list").trigger("reload");
                    b.parent.render();
                    d.notify("\u64cd\u4f5c\u6210\u529f")
                })
            });
            a.off("click.toolkit-list", "#form-check-all").on("click.toolkit-list", "#form-check-all",
            function() {
                var a = !1;
                $(this).hasClass("icon-checkbox-checked") && (a = !0);
                a ? $("#select-form-list #index span.checkbox").not(":first").each(function() {
                    $(this).find("i").removeClass("icon-checkbox-checked").addClass("icon-checkbox-unchecked");
                    $(this).addClass("hide");
                    $(this).parent("th").removeClass("selected");
                    $(this).prev().removeClass("hide")
                }) : $("#select-form-list #index span.checkbox").not(":first").each(function() {
                    $(this).find("i").addClass("icon-checkbox-checked").removeClass("icon-checkbox-unchecked");
                    $(this).removeClass("hide");
                    $(this).parent("th").addClass("selected");
                    $(this).prev().addClass("hide")
                });
                $(this).toggleClass("icon-checkbox-checked").toggleClass("icon-checkbox-unchecked")
            });
            a.off("click.index", ".checkbox").on("click.index", ".checkbox",
            function() {
                var a = !1;
                $(this).find("i").hasClass("icon-checkbox-checked") && (a = !0);
                a ? $(this).parent("th").removeClass("selected") : $(this).parent("th").addClass("selected");
                $(this).find("i").toggleClass("icon-checkbox-checked").toggleClass("icon-checkbox-unchecked")
            });
            a.off("mouseenter.table", "tbody tr").on("mouseenter.table", "tbody tr",
            function(a) {
                a = !1;
                $(this).find(".index").hasClass("selected") && (a = !0);
                a || ($(this).find(".sn").addClass("hide"), $(this).find(".checkbox").removeClass("hide"))
            }).off("mouseleave.table", "tbody tr").on("mouseleave.table", "tbody tr",
            function(a) {
                a = !1;
                $(this).find(".index").hasClass("selected") && (a = !0);
                a || ($(this).find(".sn").removeClass("hide"), $(this).find(".checkbox").addClass("hide"))
            });
            a.off("search.toolkit-list", "#formsearch-keywords").on("search.toolkit-list", "#formsearch-keywords",
            function(d) {
                e.pageNo = 1;
                b.keywords = $.trim(a.find("#formsearch-keywords").val());
                b.render()
            });
            a.off("keyup.toolkit-list", "#formsearch-keywords").on("keyup.toolkit-list", "#formsearch-keywords",
            function(a) {
                13 == (a ? a: window.event ? window.event: null).keyCode && $(this).trigger("search")
            });
            $(b.el).find(".page-first").click(function() {
                $(this).hasClass("disabled") || (e.pageNo = 1, b.render())
            });
            $(b.el).find(".page-pre").click(function() {
                $(this).hasClass("disabled") || (--e.pageNo, b.render())
            });
            $(b.el).find(".page-next").click(function() {
                $(this).hasClass("disabled") || (++e.pageNo, b.render())
            })
        },
        render: function() {
            this.findFormSelectData()
        },
        findFormSelectData: function() {
            var b = this;
            b.model.findFormSelectData({
                "formLabel.id": b.id,
                "form.name": b.keywords,
                pageNo: b.model.pageNo,
                pageSize: b.model.pageSize
            },
            function(a) {
                var d = b.$el.find("#formselect");
                d.find("tbody tr").not(":first").detach();
                $.each(a.formPage.result,
                function(a) {
                    var c = d.find("tbody tr:first").clone().show();
                    c.find("#index").attr("data-id", this.id).find(".sn").text(a + 1);
                    c.find("#title").text(this.name).attr("title", this.name);
                    if (this.formlabels) {
                        var f = [];
                        for (a = 0; a < this.formlabels.length; a++) f.push(this.formlabels[a].name);
                        f = f.join("\uff0c");
                        c.find("#includeLabels").text(f).attr("title", f)
                    }
                    c.appendTo($(b.el).find("#formLabelClone tbody"));
                    c.appendTo(d.find("tbody"))
                });
                b.loadPage(a.formPage);
                d.modal("show")
            })
        },
        loadPage: function(b) {
            var a = this,
            d = a.model;
            0 >= b.totalCount ? ($(a.el).find(".page-last").unbind("click"), $(a.el).find(".page-buttons").addClass("disabled"), $(a.el).find(".pagination").find(".active a").html("\u65e0\u8bb0\u5f55")) : ($(a.el).find(".pagination").find(".active a").html("\u7b2c" + b.pageNo + "/" + b.totalPages + "\u9875"), 1 == b.totalPages ? $(a.el).find(".page-buttons").addClass("disabled") : ($(a.el).find(".page-last").click(function() {
                $(this).hasClass("disabled") || (d.pageNo = b.totalPages, a.render())
            }), 1 == b.pageNo && ($(a.el).find(".page-next").removeClass("disabled"), $(a.el).find(".page-last").removeClass("disabled"), $(a.el).find(".page-first").addClass("disabled"), $(a.el).find(".page-pre").addClass("disabled")), b.pageNo == b.totalPages && ($(a.el).find(".page-first").removeClass("disabled"), $(a.el).find(".page-pre").removeClass("disabled"), $(a.el).find(".page-next").addClass("disabled"), $(a.el).find(".page-last").addClass("disabled")), 1 != b.pageNo && b.pageNo != b.totalPages && ($(a.el).find(".page-first").removeClass("disabled"), $(a.el).find(".page-pre").removeClass("disabled"), $(a.el).find(".page-next").removeClass("disabled"), $(a.el).find(".page-last").removeClass("disabled")), a.$el.find(".pagination-centered").removeClass("hide")))
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formlabeltreeview", ["teams/utils", "eteams/biaoge/formmanage/formlabeltreemodel", "eteams/biaoge/formmanage/formlabellistview", "eteams/biaoge/formmanage/formlabeleditview"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formlabeltreemodel"),
    b = g("eteams/biaoge/formmanage/formlabellistview"),
    a = g("eteams/biaoge/formmanage/formlabeleditview");
    g = Backbone.View.extend({
        lightClass: "selected",
        fold: "icon-caret-right",
        unfold: "icon-caret-down",
        initialize: function(a) {
            this.el = a.el;
            this.noUrl = a.noUrl;
            this.readonly = a.readonly;
            this.model = new f;
            this.formLabelId = null
        },
        delegateEvents: function() {
            var e = this,
            f = $(e.el);
            f.off(".tree");
            f.on("click", "." + e.unfold,
            function(a) {
                a.stopPropagation();
                $(this).parent().parent().find("ul").slideToggle(400);
                $(this).removeClass(e.unfold).addClass(e.fold)
            });
            f.on("click", "." + e.fold,
            function(a) {
                a.stopPropagation();
                $(this).parent().parent().find("ul").slideToggle(400);
                $(this).removeClass(e.fold).addClass(e.unfold)
            });
            f.off("click", ".j_treenode").on("click", ".j_treenode",
            function(a) {
                e.formLabelId = $(this).attr("id");
                new b({
                    id: e.formLabelId,
                    el: "#mainContainer #form-table-list",
                    parent: e
                });
                e.highLight(e.formLabelId)
            });
            $("#formlabel-all").off("click").on("click",
            function(a) {
                new b({
                    id: null,
                    el: "#mainContainer #form-table-list",
                    parent: e
                });
                f.find(".treenode").removeClass("selected")
            });
            f.on("click", "#edit-department",
            function(b) {
                b.stopPropagation();
                b = $(this).attr("nodeid");
                var d = $(this).parent().parent().attr("data-parentId"),
                d = $("#" + d),
                f = $(this).parent().parent().find("a").text(); (new a({
                    id: b,
                    parentNode: d,
                    name: f,
                    type: "edit",
                    root: 0 < d.length ? !1 : !0,
                    parent: e,
                    el: "#mainContainer #form-table-list"
                })).render();
                e.highLight(b)
            });
            f.on("click", "#add-department",
            function(b) {
                b.stopPropagation();
                b = $(this).attr("nodeid");
                var d = $(this).parent().parent().attr("data-rank"); (new a({
                    id: b,
                    parent: e,
                    type: "add",
                    el: "#mainContainer #form-table-list",
                    rank: d
                })).render();
                e.highLight(b)
            });
            f.on("click", "#delete-department",
            function(a) {
                a.stopPropagation();
                var b = {
                    formLabel: {
                        id: $(this).attr("nodeid")
                    }
                },
                b = JSON.stringify(b);
                d.confirm("\u786e\u5b9a\u8981\u5220\u9664\u7c7b\u522b\u5417\uff1f\u5220\u9664\u540e\u5c06\u65e0\u6cd5\u6062\u590d",
                function(a) {
                    a && e.model.deleteFormLabel(b,
                    function(a) {
                        a.message ? d.notify(a.message) : e.reload(function() {
                            $("#formlabel-all").trigger("click")
                        })
                    })
                })
            });
            $("#add-root").click(function(b) { (new a({
                    id: -1,
                    parent: e,
                    type: "add-root",
                    el: "#mainContainer #form-table-list",
                    rank: 1
                })).render()
            });
            $("#form-tree-list").off("reload.tree").on("reload.tree",
            function() {
                e.reload()
            })
        },
        render: function(a, b) {
            var c = this;
            c.id = a;
            c.model.loadData(function(a) {
                a = a.formLabels;
                c.initTree(a);
                c.bindData(a);
                b()
            })
        },
        initTree: function(a) {
            var b = this,
            c = b.getRoot(a);
            $.each(c,
            function() {
                var c = b.createRootTree(this, a);
                $(b.el).append(c)
            });
            $("#list-loading").addClass("hide")
        },
        reload: function(a) {
            var b = this;
            $(b.el).html("");
            b.render(b.id,
            function() {
                b.highLight(b.formLabelId);
                a && a()
            })
        },
        parseDom: function(a) {
            var b = document.createElement("div");
            b.innerHTML = a;
            return b.childNodes
        },
        createRootTree: function(a, b) {
            var c = "\x3cul\x3e",
            d = this.createChild(a, b);
            return c = c + d + "\x3c/ul\x3e"
        },
        createTree: function(a, b) {
            for (var c = "\x3cul\x3e",
            d = 0,
            f = 0,
            g = b.length; f < g; f++) {
                var l = b[f];
                if (!l) break;
                var m = l.nodeObj.parent;
                m && m.id == a.id && l.id != a.id && (l = this.createChild(l, b), c += l, d++)
            }
            return 0 == d ? "": c + "\x3c/ul\x3e"
        },
        createChild: function(a, b) {
            if (a) {
                var c = "root" == a.parentId ? "root": "",
                d = "padding-left:" + 20 * a.rank + "px",
                f = this.createTree(a, b),
                g = f ? this.unfold: "",
                l = "j_treenode";
                this.readonly && (l = "");
                d = "\x3cli\x3e" + ('\x3cdiv class\x3d"treenode router ' + l + " " + c + '" style\x3d"' + d + '" id\x3d"' + a.id + '" data-parentId\x3d"' + a.parentId + '" data-rank\x3d"' + a.rank + '"\x3e');
                c = '\x3cspan class\x3d"num fr"\x3e' + a.attachment + '\x3c/span\x3e\x3ca class\x3d"router j_label" root\x3d"' + c + '" id\x3d"' + a.id + '" title\x3d"' + a.name + '"\x3e\x3cspan class\x3d"tree-name word-limit"\x3e' + a.name + "\x3c/span\x3e\x3c/a\x3e";
                "" === (this.noUrl ? "": a.url ? a.url: "#") && (c = '\x3ca class\x3d"router" title\x3d"' + a.name + '"\x3e\x3cspan class\x3d"tree-name"\x3e' + a.name + "\x3c/span\x3e\x3c/a\x3e");
                this.readonly || (l = "\x3cspan class\x3d'actions'\x3e", TEAMS.currentUser.admin && (l += "\x3ca id\x3d'add-department' nodeid\x3d'" + a.id + "' class\x3d'router' title\x3d'\u6dfb\u52a0\u4e0b\u7ea7\u6807\u7b7e'\x3e\x3ci class\x3d'icon-plus-thin'\x3e\x3c/i\x3e\x3c/a\x3e", 19 == a.id.length && (l += "\x3ca id\x3d'edit-department' nodeid\x3d'" + a.id + "' class\x3d'router' title\x3d'\u7f16\u8f91'\x3e\x3ci class\x3d'icon-edit'\x3e\x3c/i\x3e\x3c/a\x3e", a.nodeObj.hasChildren || 0 != a.nodeObj.formCounts || (l += "\x3ca id\x3d'delete-department' nodeid\x3d'" + a.id + "' title\x3d'\u5220\u9664\u6807\u7b7e'\x3e\x3ci class\x3d'icon-trash'\x3e\x3c/i\x3e\x3c/a\x3e"))), d += l + "\x3c/span\x3e");
                d += "\x3ci class\x3d'nodeicon " + g + "'\x3e\x3c/i\x3e";
                d = d + c + "\x3c/div\x3e";
                d += f;
                return d += "\x3c/li\x3e"
            }
        },
        getRoot: function(a) {
            for (var b = [], c = 0, d = a.length; c < d; c++) {
                var f = a[c];
                f.nodeObj.parent || b.push(f)
            }
            return b
        },
        bindData: function(a) {
            for (var b = 0,
            c = a.length; b < c; b++) {
                var d = a[b];
                $(this.el).find("#" + d.id).data("node", d)
            }
        },
        getSelectedNode: function() {
            return $(this.el).find(".selected")
        },
        getSelectedNodeObj: function() {
            return this.getSelectedNode().data("node")
        },
        reloadNode: function(a, b) {
            var c = this,
            d = a.data("node");
            c.model.loadData(function(d) {
                c.restoreNode(a, d.nodes);
                b && b()
            },
            d.id)
        },
        restoreNode: function(a, b) {
            view = this;
            var c = a.data("node"),
            d = a.parent().prev(),
            f = a.parent().next(),
            g = a.parent().parent();
            a.parent().remove();
            var l = view.createChild(c, b);
            0 < d.length ? d.after(l) : 0 < f.length ? f.before(l) : g.append(l);
            view.highLight(c.id);
            b.push(c);
            view.bindData(b)
        },
        updateNode: function(a) {
            var b = $(this.el),
            c = a.name;
            b.find("#" + a.id + " .j_label span").text(c)
        },
        highLight: function(a) {
            var b = $(this.el),
            c = this.lightClass;
            b.find(".treenode").removeClass(c);
            b.find("#" + a).addClass(c);
            a || b.find(".root").addClass(c);
            this.formLabelId = a
        },
        remove: function() {
            $(this.el).html("");
            this.FormLabelListView && (this.FormLabelListView.remove(), this.FormLabelListView = null)
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formloglistmodel",
function(g, m, l) {
    g = Backbone.Model.extend({
        id: "",
        pageNo: 1,
        pageSize: 10,
        initialize: function(d) {
            d = d || {};
            this.formId = d.formId;
            this.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
            this.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}")
        },
        search: function(d, f) {
            $.ajax({
                type: "post",
                url: "/formdata/findFormDataByFormId.json",
                dataType: "json",
                data: d,
                success: function(b) {
                    f && f(b)
                }
            })
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formincollectlogview", ["teams/utils", "eteams/biaoge/formmanage/formcollectloglistmodel", "teams/component/typeahead"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formcollectloglistmodel"),
    b = g("teams/component/typeahead");
    g = Backbone.View.extend({
        initialize: function(a) {
            this.el = "#formcollectlog-dialog";
            this.formId = a.formId;
            $("body").append(d.template("formmanage.formincollectlog", {
                userId: this.userId
            }));
            this.model = new f(a)
        },
        delegateEvents: function() {
            var a = this,
            e = $(this.el),
            f = this.model;
            e.on("hidden.bs.modal",
            function(b) {
                a.remove()
            });
            $("body").off("click.FormCollectLogListView", ".goto-top").on("click.FormCollectLogListView", ".goto-top",
            function(a) {
                d.gotoTop()
            });
            e.on("click.FormCollectLogListView", ".pagination .page-first",
            function(b) {
                $(this).hasClass("disabled") || (f.pageNo = 1, a.renderPage(f.pageNo))
            });
            e.on("click.FormCollectLogListView", ".pagination .page-pre",
            function(b) {
                $(this).hasClass("disabled") || (--f.pageNo, a.renderPage(f.pageNo))
            });
            e.on("click.FormCollectLogListView", ".pagination .page-next",
            function(b) {
                $(this).hasClass("disabled") || (++f.pageNo, f.pageNo > a.totalPages || a.renderPage(f.pageNo))
            });
            e.on("click.FormCollectLogListView", ".pagination .page-last",
            function(b) {
                $(this).hasClass("disabled") || a.renderPage(a.totalPages)
            });
            e.on("click.FormCollectLogListView", "#collectlogContent .j_detail",
            function(b) {
                b = $(this).parent().parent();
                if (b.hasClass("active")) b.find(".detailContentClone").addClass("hide"),
                b.removeClass("active");
                else {
                    var d = $(this).attr("collectId");
                    a.renderDetailPage(1, d, b)
                }
            });
            e.on("click.FormCollectLogListView", "#collectlog-more",
            function(b) {
                b = $(this).data("page");
                var d = b.result[0].collectId,
                e = $(this).parent().parent().find(".j_logdetaillist");
                a.renderDetailPage(b.nextPage, d, e)
            });
            d.datepicker({
                el: a.el + " #sendStartTime",
                callback: function(b) {
                    b = Date.create(b.date).format("{yyyy}-{MM}-{dd}");
                    var e = $(a.el).find("#sendStartTime"),
                    f = $(a.el).find("#sendEndTime");
                    f.val() && b > f.val() ? (d.notify("\u5f00\u59cb\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65e5\u671f"), e.val("")) : e.val(b)
                }
            });
            d.datepicker({
                el: a.el + " #sendEndTime",
                callback: function(b) {
                    b = Date.create(b.date).format("{yyyy}-{MM}-{dd}");
                    var e = $(a.el).find("#sendStartTime"),
                    f = $(a.el).find("#sendEndTime");
                    e.val() && b < e.val() ? (d.notify("\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65e5\u671f"), f.val("")) : f.val(b)
                }
            });
            b({
                el: a.el + " #sendersDiv #senders",
                callback: function(b) {
                    if (b && !$.isEmptyObject(b)) {
                        var d = e.find("#sendersDiv .j_selected");
                        a.renderTypeheader(d, b)
                    }
                }
            });
            e.on("click.FormCollectLogListView", ".btn-search",
            function(b) {
                $(this).removeClass("btn-search");
                e.find("#collectlogContent .j_loglist");
                a.renderPage(1);
                $(this).addClass("btn-search")
            });
            e.on("click.FormCollectLogListView", ".j_send_again",
            function(b) {
                b = {};
                b["userIds[0]"] = $(this).parent().find(".j_accepter").attr("userId");
                b.collectId = $(this).parents(".j_logdetaillist").attr("collectId");
                b["form.id"] = a.formId;
                f.inCollectSendAgain(b,
                function(a) {
                    console.log(a)
                });
                d.notify("\u64cd\u4f5c\u6210\u529f\uff01")
            });
            e.off("click.FormCollectLogListView", "#send-msg").on("click.FormCollectLogListView", "#send-msg",
            function(b) {
                var e = $(this);
                b = e.attr("receiveid");
                var e = e.attr("datareportid"),
                g = {};
                g.receiveId = b;
                g.dataReportId = e;
                g["form.id"] = a.formId;
                f.sendRemindMsg(g,
                function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : d.notify("\u50ac\u529e\u6210\u529f!")
                })
            });
            e.off("click.FormCollectLogListView", "#send-msg-all").on("click.FormCollectLogListView", "#send-msg-all",
            function(a) {
                a = $(this).attr("collectId");
                var b = {};
                b.collectId = a;
                f.sendAllRemindMsg(b,
                function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : d.notify("\u6279\u91cf\u50ac\u529e\u6210\u529f!")
                })
            });
            e.off("click.FormCollectLogListView", "#delete-todo").on("click.FormCollectLogListView", "#delete-todo",
            function(b) {
                var e = $(this),
                g = e.attr("datareportid"),
                l = e.attr("collectId");
                b = {};
                b.dataReportId = g;
                b["form.id"] = a.formId;
                f.deleteToDoReport(b,
                function(a) {
                    if (a.actionMsg) d.notify(a.actionMsg.message);
                    else {
                        d.notify("\u5220\u9664\u6210\u529f!");
                        e.parents("#" + g).find(".j_submit-result").text("\u5df2\u5220\u9664").addClass("deleted");
                        e.parents("#" + g).find("#send-msg").addClass("hide");
                        e.parents("#" + g).find("#delete-todo").addClass("hide");
                        a = e.parents("#" + l).find(".deleted").length;
                        var b = e.parents("#" + l).find(".j_logdetaillist li").length;
                        a == b && (e.parents("#" + l).find("#send-msg-all").addClass("hide"), e.parents("#" + l).find("#delete-todo-all").addClass("hide"))
                    }
                })
            });
            e.off("click.FormCollectLogListView", "#delete-todo-all").on("click.FormCollectLogListView", "#delete-todo-all",
            function(a) {
                var b = $(this),
                e = b.attr("collectId");
                a = {};
                a.collectId = e;
                f.beachDeleteToDoReport(a,
                function(a) {
                    a.actionMsg ? d.notify(a.actionMsg.message) : (d.notify("\u6279\u91cf\u5220\u9664\u6210\u529f!"), b.parents("#" + e).find(".j_logdetaillist .j_submit-result").text("\u5df2\u5220\u9664"), b.parents("#" + e).find(".j_item_btn #send-msg-all").addClass("hide"), b.parents("#" + e).find(".j_item_btn #delete-todo-all").addClass("hide"), b.parents("#" + e).find(".j_logdetaillist #send-msg").addClass("hide"), b.parents("#" + e).find(".j_logdetaillist #delete-todo").addClass("hide"))
                })
            })
        },
        render: function() {
            this.renderPage(this.model.pageNo);
            $("#formcollectlog-dialog").modal("show");
            d.layout(".j_trashbinListScrMod")
        },
        renderPage: function(a) {
            var b = this,
            d = b.model,
            c = {},
            f = $(b.el),
            g = f.find("#sendStartTime").val(),
            l = f.find("#sendEndTime").val(),
            m = [];
            f.find("#sendersDiv .j_optcontainer .j_selected span a").each(function() {
                var a = $(this).attr("id");
                m.push(a)
            });
            c.formId = b.formId;
            c.startTime = $.trim(g);
            c.endTime = $.trim(l);
            c.userIds = m;
            c.pageNo = a;
            d.queryLog(c,
            function(c) {
                c = c.collectLogPage;
                b.totalPages = c.totalPages;
                c = c.result;
                var d = f.find("#collectlogContent .j_loglist");
                1 == a && (null == c || 0 == c.length ? (f.find(".j_collectlog_empty").removeClass("hide"), f.find(".list-sub").addClass("hide"), f.find(".j_page_set").addClass("hide")) : (f.find(".j_collectlog_empty").addClass("hide"), f.find(".list-sub").removeClass("hide"), f.find(".j_page_set").removeClass("hide")));
                d.empty();
                if (null != c) for (var g = 0; g < c.length; g++) {
                    var h = f.find("#collectlogClone li").clone(),
                    l = c[g];
                    h.attr("id", l.id);
                    h.find(".j_number").text(1 + g + 10 * (a - 1));
                    h.find(".j_tuname").text(l.creator.username);
                    h.find(".j_sendallcount").text(l.sendCount);
                    h.find(".j_submitcount").text(l.finishedCount);
                    h.find(".j_detail").attr("collectId", l.id);
                    h.find(".j_item_btn #send-msg-all").attr("collectId", l.id);
                    h.find(".j_item_btn #delete-todo-all").attr("collectId", l.id);
                    var q = Date.create(l.createTime);
                    h.find(".j_ttime").text(q.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")).attr("title", q.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
                    if (0 == l.todoCount || 0 == l.finishedCount && 0 == l.todoCount) h.find(".j_item_btn #send-msg-all").addClass("hide"),
                    h.find(".j_item_btn #delete-todo-all").addClass("hide");
                    d.append(h)
                }
                f.find(".j_page_set .active a").text("\u7b2c" + a + "/" + b.totalPages + "\u9875");
                b.loadPageControl(a)
            })
        },
        renderDetailPage: function(a, b, d) {
            var c = this.model,
            f = {},
            g = $(this.el);
            f.collectId = b;
            f.pageNo = a;
            c.queryLogDetail(f,
            function(c) {
                c = c.collectLogDetailPage;
                var f = c.result,
                k, l;
                1 == a ? (k = g.find("#collectlogDetailContent ul").clone(), l = k.find(".j_logdetaillist")) : (k = d.parents(".detailContentClone"), l = d);
                c && c.hasNext ? (k.find("#collectlog-more").parent().show(), k.find("#collectlog-more").data("page", c)) : k.find("#collectlog-more").parent().hide();
                1 == a && (l.empty(), null == f || 0 == f.length ? k.find(".j_empty").show() : k.find(".j_empty").hide());
                if (null != f) {
                    l.attr("collectId", f[0].collectId);
                    for (var m = 0; m < f.length; m++) {
                        var u = g.find("#collectlogdetailClone li").clone(),
                        p = f[m];
                        u.find(".j_accepter").text(p.operator.username);
                        u.find(".j_accepter").attr("userId", p.operator.id);
                        u.attr("id", p.dataReport.id);
                        p.reportStatus ? "todo" == p.reportStatus ? (u.find(".j_submitstatus .j_submit-result").text("\u672a\u63d0\u4ea4"), p && p.dataReport && p.dataReport.id && (u.find(".j_submitstatus #send-msg").removeClass("hide").attr("datareportid", p.dataReport.id).attr("receiveid", p.operator.id), u.find(".j_submitstatus #delete-todo").removeClass("hide").attr("datareportid", p.dataReport.id).attr("collectId", b))) : "finshed" == p.reportStatus ? u.find(".j_submitstatus .j_submit-result").text("\u5df2\u63d0\u4ea4") : "finshed_delete" != p.reportStatus && "todo_delete" != p.reportStatus || u.find(".j_submitstatus .j_submit-result").text("\u5df2\u5220\u9664").addClass("deleted") : u.find(".j_submitstatus .j_submit-result").text("\u65e0");
                        l.append(u)
                    }
                }
                k.removeClass("hide");
                1 == c.pageNo && d.append(k).addClass("active")
            })
        },
        renderTypeheader: function(a, b) {
            if (b.length) for (var d = 0; d < b.length; d++) {
                var c = b[d],
                f = c.name,
                g = c.id;
                if (f && g) {
                    var l = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + g + "\x3e" + f + "\x3c/a\x3e\x3c/span\x3e";
                    a.find(".entity-item").each(function(a) {
                        g == $(this).find("a").attr("id") && (l = null)
                    });
                    a.append(l)
                }
            } else f = b.name,
            g = b.id,
            f && g && (l = '\x3cspan class\x3d"entity-item"\x3e\x3ca id\x3d' + g + "\x3e" + f + "\x3c/a\x3e\x3c/span\x3e", a.find(".entity-item").each(function(a) {
                g == $(this).find("a").attr("id") && (l = null)
            }), a.append(l))
        },
        loadPageControl: function(a) {
            $(this.el);
            1 >= this.totalPages ? $(this.el).find(".page-buttons").addClass("disabled") : (1 == a && ($(this.el).find(".page-next").removeClass("disabled"), $(this.el).find(".page-last").removeClass("disabled"), $(this.el).find(".page-first").addClass("disabled"), $(this.el).find(".page-pre").addClass("disabled")), a >= this.totalPages && ($(this.el).find(".page-first").removeClass("disabled"), $(this.el).find(".page-pre").removeClass("disabled"), $(this.el).find(".page-next").addClass("disabled"), $(this.el).find(".page-last").addClass("disabled")), 1 != a && a != this.totalPages && ($(this.el).find(".page-first").removeClass("disabled"), $(this.el).find(".page-pre").removeClass("disabled"), $(this.el).find(".page-next").removeClass("disabled"), $(this.el).find(".page-last").removeClass("disabled")))
        },
        remove: function() {
            var a = $(this.el);
            a.off(".FormCollectLogListView");
            a.remove()
        }
    });
    l.exports = g
});
define("eteams/biaoge/formmanage/formloglistview", ["teams/utils", "eteams/biaoge/formmanage/formloglistmodel"],
function(g, m, l) {
    var d = g("teams/utils"),
    f = g("eteams/biaoge/formmanage/formloglistmodel");
    g = Backbone.View.extend({
        initialize: function(b) {
            this.el = b.el;
            this.userId = b.userId ? b.userId: TEAMS.currentUser.id;
            $(this.el).html(d.template("formmanage.formloglist"));
            this.$el = $(this.el);
            this.model = new f(b);
            this.initComponents();
            d.layout(this.el)
        },
        initComponents: function() {
            var b = this,
            a = b.model;
            d.datepicker([{
                el: "#begin-date",
                callback: function(d) {
                    var f = d.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(f, a.endDate) ? a.beginDate = f || a.beginDate: d.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            },
            {
                el: "#end-date",
                callback: function(d) {
                    var f = d.date.format("{yyyy}-{MM}-{dd}");
                    b.isBefore(a.beginDate, f) ? a.endDate = f || a.endDate: d.target.value = null
                },
                startDate: Date.create().addMonths( - 6).format("{yyyy}-{MM}-{dd}"),
                endDate: Date.create().format("{yyyy}-{MM}-{dd}")
            }]);
            b.$el.find("#begin-date").val(a.beginDate);
            b.$el.find("#end-date").val(a.endDate);
            b.$el.find('[data\x3d"thisMonth"]').addClass("btn-success")
        },
        isBefore: function(b, a) {
            if (b && a) {
                if (Date.create(b).isBefore(a, 864E5)) return ! 0;
                d.notify("\u8bf7\u786e\u8ba4\u8f93\u5165\u7684\u8d77\u59cb\u65e5\u5728\u5230\u671f\u65e5\u4e4b\u524d");
                return ! 1
            }
            return ! 0
        },
        delegateEvents: function() {
            var b = this,
            a = this.model;
            $("body").off("click.FormLogListView", ".goto-top").on("click.FormLogListView", ".goto-top",
            function(a) {
                d.gotoTop()
            });
            this.$el.on("click.FormLogListView", ".orderType",
            function() {
                $(".orderType").parent("li").removeClass("active");
                $(this).parent("li").addClass("active");
                $("#form-order").attr("data-entity", $(this).attr("data-entity"));
                $("#form-order").attr("data-direction", $(this).attr("data-direction"));
                a.pageNo = 1;
                b.search()
            });
            b.$el.find(".page-first").click(function() {
                $(this).hasClass("disabled") || (a.pageNo = 1, b.search())
            });
            b.$el.find(".page-pre").click(function() {
                $(this).hasClass("disabled") || (--a.pageNo, b.search())
            });
            b.$el.find(".page-next").click(function() {
                $(this).hasClass("disabled") || (++a.pageNo, b.search())
            });
            b.$el.on("click.FormLogListView", ".j_time a",
            function(d) {
                switch ($(d.target).attr("data")) {
                case "thisWeek":
                    a.beginDate = Date.create().beginningOfWeek().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "last2weeks":
                    a.beginDate = Date.create().beginningOfWeek().addDays( - 7).format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfWeek().format("{yyyy}-{MM}-{dd}");
                    break;
                case "thisMonth":
                    a.beginDate = Date.create().beginningOfMonth().format("{yyyy}-{MM}-{dd}");
                    a.endDate = Date.create().endOfMonth().format("{yyyy}-{MM}-{dd}");
                    break;
                case "lastMonth":
                    a.beginDate = Date.create().addMonths( - 1).beginningOfMonth().format("{yyyy}-{MM}-{dd}"),
                    a.endDate = Date.create().addMonths( - 1).endOfMonth().format("{yyyy}-{MM}-{dd}")
                }
                b.$el.find("#begin-date").val(a.beginDate);
                b.$el.find("#end-date").val(a.endDate);
                b.$el.find(".j_time .btn").removeClass("btn-success");
                $(this).addClass("btn-success");
                a.pageNo = 1;
                b.search()
            });
            b.$el.find("#load").click(function() {
                b.$el.find(".j_time .btn").removeClass("btn-success");
                a.pageNo = 1;
                b.search()
            })
        },
        render: function() {
            this.search();
            d.layout("#oneformlog-Content")
        },
        search: function() {
            $("#formlist-loading").removeClass("hide");
            var b = this,
            a = b.model,
            d = "";
            if ("undefined" != typeof b.$el.find("#form-order").attr("data-entity")) var d = b.$el.find("#form-order").attr("data-entity"),
            f = b.$el.find("#form-order").attr("data-direction"),
            d = "default" == d ? "": "F." + d + " " + f;
            else d = "F.CREATE_TIME DESC";
            f = "";
            "" != a.beginDate && (f += " and F.create_Time \x3e '" + a.beginDate + "'");
            "" != a.endDate && (f += " and F.create_Time \x3c '" + a.endDate + " 24:00:00'");
            a.search({
                pageNo: a.pageNo,
                pageSize: a.pageSize,
                "form.id": a.formId,
                sortType: d,
                searchFilter: f
            },
            function(a) {
                $("#formlist-loading").addClass("hide");
                var d = $("#formlog-table tbody");
                $("#formlog-table tbody tr").not(":first").detach();
                $.each(a.formDataPage.result,
                function(a) {
                    var b = $("#formlog-table tbody tr:first").clone().show();
                    b.find("#index").text(a + 1);
                    b.find("#createTime").text((new Date(this.createTime)).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
                    b.find("#spentTime").text(this.spentTime);
                    b.find("#ip").text(this.ip);
                    a = this.client;
                    "undefined" != typeof this.version && (a += " - " + this.version);
                    b.find("#source").text(a);
                    a = "/form/previewFill/" + this.id;
                    b.find("#query a").attr("href", a);
                    b.appendTo(d)
                });
                b.loadPage(a.formDataPage)
            })
        },
        loadPage: function(b) {
            var a = this,
            d = a.model;
            0 >= b.totalCount ? ($(a.el).find(".page-last").unbind("click"), $(a.el).find(".page-buttons").addClass("disabled"), $(a.el).find(".pagination").find(".active a").html("\u65e0\u8bb0\u5f55")) : ($(a.el).find(".pagination").find(".active a").html("\u7b2c" + b.pageNo + "/" + b.totalPages + "\u9875"), 1 == b.totalPages ? $(a.el).find(".page-buttons").addClass("disabled") : ($(a.el).find(".page-last").click(function() {
                $(this).hasClass("disabled") || (d.pageNo = b.totalPages, a.search())
            }), 1 == b.pageNo && ($(a.el).find(".page-next").removeClass("disabled"), $(a.el).find(".page-last").removeClass("disabled"), $(a.el).find(".page-first").addClass("disabled"), $(a.el).find(".page-pre").addClass("disabled")), b.pageNo == b.totalPages && ($(a.el).find(".page-first").removeClass("disabled"), $(a.el).find(".page-pre").removeClass("disabled"), $(a.el).find(".page-next").addClass("disabled"), $(a.el).find(".page-last").addClass("disabled")), 1 != b.pageNo && b.pageNo != b.totalPages && ($(a.el).find(".page-first").removeClass("disabled"), $(a.el).find(".page-pre").removeClass("disabled"), $(a.el).find(".page-next").removeClass("disabled"), $(a.el).find(".page-last").removeClass("disabled")), a.$el.find(".pagination-centered").removeClass("hide")))
        },
        remove: function() {
            $(this.el).off(".FormLogListView");
            $(this.el).remove()
        }
    });
    l.exports = g
});